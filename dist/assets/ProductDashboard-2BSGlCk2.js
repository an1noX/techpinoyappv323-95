const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/clientService-scOH6ADK.js","assets/index-FgfazPn4.js","assets/index-CWiAdddQ.css"])))=>i.map(i=>d[i]);
import{s as L,r as n,u as ue,R as Bs,j as e,X as ge,S as re,q as ae,v as ie,w as ne,x as Q,P as J,D as X,d as Y,e as Z,f as ee,h as _e,B as A,o as ke,i as Fe,Q as Qe,V as Je,Y as Ae,Z as we,a1 as $s,$ as Os,a0 as Us,a2 as Vs,W as zs,l as se,J as D,_ as We,C as fe,a3 as Xe,a4 as Ye,a5 as Ks,a6 as Ze,a7 as es,a8 as Ws,a9 as Gs,aa as Hs,b as Qs,g as Js,E as Xs}from"./index-FgfazPn4.js";import{u as Ys}from"./use-mobile-CasDpXHz.js";import{p as $,a as Se,c as Zs}from"./clientService-scOH6ADK.js";import{C as O,b as ce,c as le,a as U}from"./card-S-815Fh1.js";import{I as B}from"./input-Cc5DIsqr.js";import{C as et,f as xe,P as st,A as tt,a as rt,b as at}from"./useRefreshFunctions-DaHXTbHG.js";import{L as q,C as it}from"./label-C7AHjZf1.js";import{P as te,D as nt,U as Pe}from"./users-7LwHL_dG.js";import{S as ss,A as Ee,a as Le,b as Me,c as Te,d as De,e as Re,f as qe,g as Ie,h as ts,E as ct}from"./alert-dialog-a1roshmq.js";import{a as Be,S as me,C as lt,b as je,T as Ce}from"./checkbox-De7F5xfH.js";import{S as ot}from"./scroll-area-DzmqWWKn.js";import{d as rs,R as dt,I as ut,T as mt,a as pt,b as Ge,c as He}from"./tabs-CXhmf9qd.js";import{C as ht}from"./useSuppliers-CWirxHH7.js";import{A as xt,a as gt}from"./alert-5f0mIJz3.js";import{L as as}from"./loader-circle-HvrrQJfJ.js";import{B as H}from"./badge-PQ_Xgg0c.js";import{T as ye}from"./trending-up-_gLokptJ.js";import{M as ft}from"./minus-QEom8Zbo.js";import{B as jt}from"./BottomMobileNavigation-COLTeJeJ.js";import"./eye-BJula9yD.js";import"./chevron-right-BqyfOyy6.js";import"./MobileFilterButtons-DfOhOMAv.js";import"./printer-X5np4qGe.js";import"./shopping-cart-Dlmx8wK6.js";const yt={async getCategories(){const{data:c,error:l}=await L.from("products").select("category").order("category");if(l)throw console.error("Error fetching categories:",l),l;return[...new Set(c.map(o=>o.category))].filter(o=>o&&o.trim()!=="")}},Nt=()=>{const[c,l]=n.useState([]),[t,o]=n.useState(!0);return n.useEffect(()=>{(async()=>{try{o(!0);const u=await yt.getCategories();l(u)}catch(u){console.error("Failed to fetch categories:",u)}finally{o(!1)}})()},[]),{categories:c,loading:t}},$e=({isOpen:c,onClose:l,onProductAdded:t,searchTerm:o})=>{const[s,u]=n.useState({name:o,sku:o,category:"",printers:"",colors:[],alias:""}),[g,f]=n.useState({}),[y,S]=n.useState(!1),[N,v]=n.useState(!1),[p,h]=n.useState(""),{toast:j}=ue(),{categories:F,loading:a}=Nt(),b=async r=>{var P;r.preventDefault();const i={};s.name.trim()||(i.name="Product name is required"),s.sku.trim()||(i.sku="SKU is required");let x=s.category;if(N?p.trim()?x=p.trim():i.category="New category name is required":s.category.trim()||(i.category="Category is required"),(!s.colors||s.colors.length===0)&&(i.colors="Select at least one color"),Object.keys(i).length>0){f(i);return}S(!0);try{const C=s.printers.split(",").map(_=>_.trim()).filter(Boolean),m=[];if(s.colors.length===1){const _=await $.createProduct({name:s.name.trim(),sku:s.sku.trim(),category:x,color:s.colors[0],alias:s.alias.trim()});m.push(_.id);for(const E of C){let R=await Se.findOrCreatePrinter(E);await d(_.id,R.id)}}else for(const _ of s.colors){const E=await $.createProduct({name:s.name.trim(),sku:s.sku.trim(),category:x,color:_,alias:s.alias.trim()});m.push(E.id);for(const R of C){let z=await Se.findOrCreatePrinter(R);await d(E.id,z.id)}}j({title:"Success",description:s.colors.length===1?"Product created successfully!":"All product variants created and linked!"}),u({name:"",sku:"",category:"",printers:"",colors:[],alias:""}),h(""),v(!1),f({}),t(m[0])}catch(C){console.error("Failed to create product:",C),j({title:"Error",description:(P=C.message)!=null&&P.includes("duplicate")?"A product with this SKU already exists":"Failed to create product. Please try again.",variant:"destructive"})}finally{S(!1)}},w=(r,i)=>{u(x=>{const P={...x,[r]:i};return r==="name"&&(x.sku===x.name||x.sku==="")&&(P.sku=i),P}),g[r]&&f(x=>({...x,[r]:""}))},T=r=>{u(i=>({...i,colors:Array.isArray(r)?r:[r]}))},M=r=>{r==="add-new"?(v(!0),u(i=>({...i,category:""}))):(v(!1),h(""),u(i=>({...i,category:r}))),g.category&&f(i=>({...i,category:""}))};Bs.useEffect(()=>{c&&u(r=>({...r,name:o,sku:o}))},[c,o]);const d=async(r,i)=>{await L.from("product_printers").insert({product_id:r,printer_id:i})};return c?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(te,{className:"h-5 w-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Add New Product"})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:e.jsx(ge,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Name *"}),e.jsx("input",{type:"text",value:s.name,onChange:r=>w("name",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${g.name?"border-red-300":"border-gray-300"}`,placeholder:"Enter product name",disabled:y}),g.name&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:g.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SKU *"}),e.jsx("input",{type:"text",value:s.sku,onChange:r=>w("sku",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${g.sku?"border-red-300":"border-gray-300"}`,placeholder:"Enter SKU",disabled:y}),g.sku&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:g.sku})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),N?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:p,onChange:r=>{h(r.target.value),g.category&&f(i=>({...i,category:""}))},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${g.category?"border-red-300":"border-gray-300"}`,placeholder:"Enter new category name",disabled:y}),e.jsx("button",{type:"button",onClick:()=>{v(!1),h(""),f(r=>({...r,category:""}))},className:"text-sm text-gray-600 hover:text-gray-800",disabled:y,children:"Cancel - Select existing category"})]}):e.jsxs(re,{value:s.category,onValueChange:M,disabled:y,children:[e.jsx(ae,{className:`w-full ${g.category?"border-red-300":""}`,children:e.jsx(ie,{placeholder:a?"Loading categories...":"Select a category"})}),e.jsxs(ne,{className:"bg-white z-50",children:[F.map(r=>e.jsx(Q,{value:r,children:r},r)),e.jsx(Q,{value:"add-new",className:"text-green-600 font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:"Add new category"})]})})]})]}),g.category&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:g.category})]}),e.jsx(et,{selectedColor:s.colors.length===1?s.colors[0]:void 0,selectedColors:s.colors.length>1?s.colors:void 0,onColorChange:T,size:"lg",multiSelect:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supported Printers"}),e.jsx("textarea",{value:s.printers,onChange:r=>w("printers",r.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Enter supported printer models separated by commas (e.g., HP LaserJet Pro, Canon PIXMA, Epson EcoTank)",disabled:y})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"alias",className:"text-sm font-medium",children:"Alias"}),e.jsx(B,{id:"alias",value:s.alias,onChange:r=>w("alias",r.target.value),className:"w-full",placeholder:"e.g., 128A"})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200",disabled:y,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50",disabled:y,children:y?"Creating...":"Add Product"})]})]})]})}):null},Oe=({color:c,size:l="sm"})=>{if(!c)return null;const t={cyan:"bg-cyan-500",yellow:"bg-yellow-500",magenta:"bg-fuchsia-500",black:"bg-black"},o={sm:"w-3 h-3",md:"w-4 h-4"},s=t[c]||"bg-gray-300";return e.jsx("div",{className:`${o[l]} ${s} rounded border border-gray-300 inline-block`,title:`Color: ${c}`})},bt=({isOpen:c,onClose:l,productGroup:t,onProductSelect:o,action:s})=>{if(!c)return null;const u=s==="edit"?"Select a Product to Edit":"Select a Product to Delete",g=`The SKU group ${t.baseSku} contains multiple products. Please select the specific one you'd like to ${s}.`;return e.jsx(X,{open:c,onOpenChange:l,children:e.jsxs(Y,{className:"sm:max-w-[525px]",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:u}),e.jsx(_e,{children:g})]}),e.jsx("div",{className:"py-4 space-y-3 max-h-[60vh] overflow-y-auto",children:t.allProducts.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:f.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",f.sku]})]}),f.color&&e.jsx(Oe,{color:f.color})]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>o(f),"aria-label":`Select ${f.name}`,children:[s==="edit"?e.jsx(Be,{className:"h-4 w-4 mr-2"}):e.jsx(ke,{className:"h-4 w-4 mr-2"}),s==="edit"?"Edit":"Delete"]})]},f.id))}),e.jsx(Fe,{children:e.jsx(A,{variant:"ghost",onClick:l,children:"Cancel"})})]})})},vt=({isOpen:c,onClose:l,onProductsSelected:t,allProducts:o,initialSelectedProduct:s})=>{const[u,g]=n.useState([]),[f,y]=n.useState("");n.useEffect(()=>{g(s&&c?[s]:[])},[s,c]);const S=o.filter(p=>p.name.toLowerCase().includes(f.toLowerCase())||p.sku.toLowerCase().includes(f.toLowerCase())),N=p=>{g(h=>h.some(j=>j.id===p.id)?h.filter(j=>j.id!==p.id):[...h,p])},v=()=>{u.length>=2?t(u):console.log("Please select at least 2 products to merge.")};return e.jsx(X,{open:c,onOpenChange:l,children:e.jsxs(Y,{className:"sm:max-w-[600px]",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Select Products to Merge"}),e.jsx(_e,{children:"Choose 2 or more products from the list to merge them."})]}),e.jsxs("div",{className:"relative my-4",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(B,{placeholder:"Search products...",value:f,onChange:p=>y(p.target.value),className:"pl-10"})]}),e.jsx(ot,{className:"h-[400px] border rounded-md p-4",children:e.jsx("div",{className:"space-y-2",children:S.map(p=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-gray-50",children:[e.jsx(lt,{id:`product-${p.id}`,checked:u.some(h=>h.id===p.id),onCheckedChange:()=>N(p)}),e.jsxs("label",{htmlFor:`product-${p.id}`,className:"flex-1 cursor-pointer",children:[e.jsx("div",{className:"font-medium",children:p.name}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[e.jsxs("span",{children:["SKU: ",p.sku]}),p.color&&e.jsx(Oe,{color:p.color})]})]})]},p.id))})}),e.jsxs(Fe,{children:[e.jsx(A,{variant:"outline",onClick:l,children:"Cancel"}),e.jsxs(A,{onClick:v,disabled:u.length<2,children:["Proceed to Merge (",u.length,")"]})]})]})})};var Ue="Radio",[wt,is]=Qe(Ue),[St,Pt]=wt(Ue),ns=n.forwardRef((c,l)=>{const{__scopeRadio:t,name:o,checked:s=!1,required:u,disabled:g,value:f="on",onCheck:y,form:S,...N}=c,[v,p]=n.useState(null),h=Je(l,a=>p(a)),j=n.useRef(!1),F=v?S||!!v.closest("form"):!0;return e.jsxs(St,{scope:t,checked:s,disabled:g,children:[e.jsx(Ae.button,{type:"button",role:"radio","aria-checked":s,"data-state":os(s),"data-disabled":g?"":void 0,disabled:g,value:f,...N,ref:h,onClick:we(c.onClick,a=>{s||y==null||y(),F&&(j.current=a.isPropagationStopped(),j.current||a.stopPropagation())})}),F&&e.jsx(Ct,{control:v,bubbles:!j.current,name:o,value:f,checked:s,required:u,disabled:g,form:S,style:{transform:"translateX(-100%)"}})]})});ns.displayName=Ue;var cs="RadioIndicator",ls=n.forwardRef((c,l)=>{const{__scopeRadio:t,forceMount:o,...s}=c,u=Pt(cs,t);return e.jsx($s,{present:o||u.checked,children:e.jsx(Ae.span,{"data-state":os(u.checked),"data-disabled":u.disabled?"":void 0,...s,ref:l})})});ls.displayName=cs;var Ct=c=>{const{control:l,checked:t,bubbles:o=!0,...s}=c,u=n.useRef(null),g=Os(t),f=Us(l);return n.useEffect(()=>{const y=u.current,S=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(S,"checked").set;if(g!==t&&v){const p=new Event("click",{bubbles:o});v.call(y,t),y.dispatchEvent(p)}},[g,t,o]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:t,...s,tabIndex:-1,ref:u,style:{...c.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function os(c){return c?"checked":"unchecked"}var _t=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ve="RadioGroup",[kt,jr]=Qe(Ve,[rs,is]),ds=rs(),us=is(),[Ft,At]=kt(Ve),ms=n.forwardRef((c,l)=>{const{__scopeRadioGroup:t,name:o,defaultValue:s,value:u,required:g=!1,disabled:f=!1,orientation:y,dir:S,loop:N=!0,onValueChange:v,...p}=c,h=ds(t),j=Vs(S),[F,a]=zs({prop:u,defaultProp:s,onChange:v});return e.jsx(Ft,{scope:t,name:o,required:g,disabled:f,value:F,onValueChange:a,children:e.jsx(dt,{asChild:!0,...h,orientation:y,dir:j,loop:N,children:e.jsx(Ae.div,{role:"radiogroup","aria-required":g,"aria-orientation":y,"data-disabled":f?"":void 0,dir:j,...p,ref:l})})})});ms.displayName=Ve;var ps="RadioGroupItem",hs=n.forwardRef((c,l)=>{const{__scopeRadioGroup:t,disabled:o,...s}=c,u=At(ps,t),g=u.disabled||o,f=ds(t),y=us(t),S=n.useRef(null),N=Je(l,S),v=u.value===s.value,p=n.useRef(!1);return n.useEffect(()=>{const h=F=>{_t.includes(F.key)&&(p.current=!0)},j=()=>p.current=!1;return document.addEventListener("keydown",h),document.addEventListener("keyup",j),()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",j)}},[]),e.jsx(ut,{asChild:!0,...f,focusable:!g,active:v,children:e.jsx(ns,{disabled:g,required:u.required,checked:v,...y,...s,name:u.name,ref:N,onCheck:()=>u.onValueChange(s.value),onKeyDown:we(h=>{h.key==="Enter"&&h.preventDefault()}),onFocus:we(s.onFocus,()=>{var h;p.current&&((h=S.current)==null||h.click())})})})});hs.displayName=ps;var Et="RadioGroupIndicator",xs=n.forwardRef((c,l)=>{const{__scopeRadioGroup:t,...o}=c,s=us(t);return e.jsx(ls,{...s,...o,ref:l})});xs.displayName=Et;var gs=ms,fs=hs,Lt=xs;const js=n.forwardRef(({className:c,...l},t)=>e.jsx(gs,{className:se("grid gap-2",c),...l,ref:t}));js.displayName=gs.displayName;const ys=n.forwardRef(({className:c,...l},t)=>e.jsx(fs,{ref:t,className:se("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",c),...l,children:e.jsx(Lt,{className:"flex items-center justify-center",children:e.jsx(ht,{className:"h-2.5 w-2.5 fill-current text-current"})})}));ys.displayName=fs.displayName;const Mt=({isOpen:c,onClose:l,products:t,onMergeComplete:o})=>{const[s,u]=n.useState(null),[g,f]=n.useState(!1),[y,S]=n.useState(null),[N,v]=n.useState(!1);n.useEffect(()=>{t.length>0&&u(t[0].id)},[t]);const p=async()=>{v(!0);let j={transactions:0,suppliers:0,clients:0,printers:0};const F=t.filter(a=>a.id!==s);for(const a of F){const{data:b}=await L.from("transaction_records").select("id",{count:"exact"}).eq("product_id",a.id),{data:w}=await L.from("product_suppliers").select("id",{count:"exact"}).eq("product_id",a.id),{data:T}=await L.from("product_clients").select("id",{count:"exact"}).eq("product_id",a.id),{data:M}=await L.from("product_printers").select("id",{count:"exact"}).eq("product_id",a.id);j.transactions+=(b==null?void 0:b.length)||0,j.suppliers+=(w==null?void 0:w.length)||0,j.clients+=(T==null?void 0:T.length)||0,j.printers+=(M==null?void 0:M.length)||0}S(j),v(!1)};n.useEffect(()=>{s&&p()},[s]);const h=async()=>{if(!s){D.error("You must select a primary product.");return}f(!0);const j=t.find(a=>a.id===s),F=t.filter(a=>a.id!==s);if(!j){D.error("Primary product not found."),f(!1);return}try{const a=F.map(w=>`${w.sku} - ${w.name}`).join(", "),b=j.alias?`${j.alias}, ${a}`:a;await $.mergeProducts(s,F.map(w=>w.id),b),D.success("Products merged successfully!"),o(),l()}catch(a){D.error("Failed to merge products."),console.error("Merge failed",a)}finally{f(!1)}};return e.jsx(X,{open:c,onOpenChange:l,children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsxs(ee,{children:["Merge ",t.length," Products"]}),e.jsx(_e,{children:"Select a primary product. All other products will be merged into it. The merged products' SKUs and Names will be added to the primary product's alias, and they will be deleted."})]}),e.jsx("div",{className:"py-4",children:e.jsx(js,{value:s||"",onValueChange:u,children:t.map(j=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-md hover:bg-gray-50",children:[e.jsx(ys,{value:j.id,id:j.id}),e.jsxs(q,{htmlFor:j.id,className:"flex-1 cursor-pointer",children:[e.jsx("div",{className:"font-medium",children:j.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",j.sku]})]})]},j.id))})}),N&&e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx(as,{className:"h-6 w-6 animate-spin"})," ",e.jsx("span",{className:"ml-2",children:"Loading summary..."})]}),y&&!N&&e.jsxs("div",{className:"p-4 border bg-gray-50 rounded-md",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Merge Summary"}),e.jsx("p",{className:"text-sm",children:"The following items from the secondary products will be moved to the primary product:"}),e.jsxs("ul",{className:"list-disc list-inside text-sm mt-2",children:[e.jsxs("li",{children:[y.transactions," Transaction Records"]}),e.jsxs("li",{children:[y.suppliers," Supplier Prices"]}),e.jsxs("li",{children:[y.clients," Client Quotes"]}),e.jsxs("li",{children:[y.printers," Printer Compatibilities"]})]})]}),e.jsx(xt,{variant:"destructive",className:"mt-4",children:e.jsx(gt,{children:"This action is irreversible. The non-primary products will be permanently deleted."})}),e.jsxs(Fe,{children:[e.jsx(A,{variant:"outline",onClick:l,disabled:g,children:"Cancel"}),e.jsx(A,{onClick:h,disabled:g||!s,children:g?"Merging...":"Confirm Merge"})]})]})})},Tt=({isOpen:c,onClose:l,type:t,entityName:o,currentPrice:s,productName:u,onPriceUpdate:g,priceHistory:f=[]})=>{const[y,S]=n.useState(s.toString()),[N,v]=n.useState(""),[p,h]=n.useState(!1);n.useEffect(()=>{S(s.toString()),v("")},[s,c]);const j=async()=>{const a=parseFloat(y);if(isNaN(a)||a<=0){D.error("Please enter a valid price");return}h(!0);try{await g(a,N),D.success(`${t==="supplier"?"Supplier":"Client"} price updated successfully`),l()}catch{D.error("Failed to update price")}finally{h(!1)}},F=[...f].sort((a,b)=>new Date(b.timestamp).getTime()-new Date(a.timestamp).getTime());return e.jsx(X,{open:c,onOpenChange:l,children:e.jsxs(Y,{className:"max-w-2xl",children:[e.jsxs(Z,{children:[e.jsxs(ee,{className:"flex items-center gap-2",children:["Manage ",t==="supplier"?"Supplier":"Client"," Pricing"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[o," - ",u]})]}),e.jsxs(mt,{defaultValue:"update",className:"w-full",children:[e.jsxs(pt,{className:"grid w-full grid-cols-2",children:[e.jsx(Ge,{value:"update",children:"Update Price"}),e.jsx(Ge,{value:"history",children:"Price History"})]}),e.jsx(He,{value:"update",className:"space-y-4",children:e.jsxs(O,{children:[e.jsx(ce,{children:e.jsx(le,{className:"text-lg",children:"Current Price"})}),e.jsxs(U,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-4",children:xe(s)}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"newPrice",children:"New Price"}),e.jsx(B,{id:"newPrice",type:"number",value:y,onChange:a=>S(a.target.value),placeholder:"Enter new price",step:"0.01",min:"0"})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"note",children:"Note (optional)"}),e.jsx(B,{id:"note",value:N,onChange:a=>v(a.target.value),placeholder:"Add a note about this price change"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{onClick:j,disabled:p,className:"flex-1",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),p?"Updating...":"Update Price"]}),e.jsxs(A,{variant:"outline",onClick:l,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})]})]})}),e.jsx(He,{value:"history",className:"space-y-4",children:e.jsxs(O,{children:[e.jsx(ce,{children:e.jsxs(le,{className:"text-lg flex items-center gap-2",children:[e.jsx(it,{className:"h-5 w-5"}),"Price History"]})}),e.jsx(U,{children:F.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No price history available"}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:F.map((a,b)=>{const w=F[b+1],T=w&&a.price>w.price,M=w&&a.price<w.price,d=w?a.price-w.price:0;return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:xe(a.price)}),w&&e.jsxs("div",{className:"flex items-center",children:[T&&e.jsxs("div",{className:"flex items-center text-red-600 text-sm",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),"+",xe(Math.abs(d))]}),M&&e.jsxs("div",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(je,{className:"h-3 w-3 mr-1"}),"-",xe(Math.abs(d))]})]})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[new Date(a.timestamp).toLocaleDateString()," ",new Date(a.timestamp).toLocaleTimeString()]})]}),a.note&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1 italic",children:['"',a.note,'"']}),b===0&&e.jsx(H,{variant:"secondary",className:"mt-1",children:"Current"})]},a.id)})})})]})})]})]})})},Dt={async createSupplier(c){const{error:l}=await L.from("suppliers").insert(c);return!l},async updateSupplier(c,l){const{error:t}=await L.from("suppliers").update(l).eq("id",c);return!t},async deleteSupplier(c){const{error:l}=await L.from("suppliers").delete().eq("id",c);return!l},async getSuppliers(){const{data:c,error:l}=await L.from("suppliers").select("*").order("name");return!l&&c?c:[]}},Rt=({isOpen:c,onClose:l,type:t,productId:o,productName:s,onSuccess:u})=>{const[g,f]=n.useState(""),[y,S]=n.useState(""),[N,v]=n.useState(""),[p,h]=n.useState(!1),[j,F]=n.useState(""),[a,b]=n.useState(""),[w,T]=n.useState(""),[M,d]=n.useState(!1),[r,i]=n.useState([]);n.useEffect(()=>{c&&(P(),x())},[c,t]);const x=()=>{f(""),S(""),v(""),h(!1),F(""),b(""),T("")},P=async()=>{try{if(t==="supplier"){const m=await Dt.getSuppliers();i(m)}else{const m=await Zs.getClients();i(m)}}catch(m){console.error(`Error loading ${t}s:`,m),D.error(`Failed to load ${t}s`)}},C=async()=>{var _,E;const m=parseFloat(y);if(isNaN(m)||m<=0){D.error("Please enter a valid price");return}if(!g&&!p){D.error(`Please select a ${t} or create a new one`);return}if(p&&!j.trim()){D.error(`Please enter ${t} name`);return}d(!0);try{if(t==="supplier"){const{productService:R}=await We(async()=>{const{productService:z}=await import("./clientService-scOH6ADK.js").then(K=>K.b);return{productService:z}},__vite__mapDeps([0,1,2]));await R.addSupplierToProduct(o,p?{name:j,contact_email:a,phone:w}:{name:((_=r.find(z=>z.id===g))==null?void 0:_.name)||""},m)}else{const{productService:R}=await We(async()=>{const{productService:K}=await import("./clientService-scOH6ADK.js").then(Ne=>Ne.b);return{productService:K}},__vite__mapDeps([0,1,2])),z=N?parseFloat(N):void 0;await R.addClientToProduct(o,p?{name:j,contact_email:a,phone:w}:{name:((E=r.find(K=>K.id===g))==null?void 0:E.name)||""},m,z)}D.success(`${t==="supplier"?"Supplier":"Client"} pricing added successfully`),u(),l()}catch(R){console.error(`Error adding ${t} pricing:`,R),D.error(`Failed to add ${t} pricing`)}finally{d(!1)}};return e.jsx(X,{open:c,onOpenChange:l,children:e.jsxs(Y,{className:"max-w-md",children:[e.jsxs(Z,{children:[e.jsxs(ee,{children:["Add ",t==="supplier"?"Supplier":"Client"," Pricing"]}),e.jsx("div",{className:"text-sm text-gray-600",children:s})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(O,{children:e.jsx(U,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[p?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(q,{children:["New ",t==="supplier"?"Supplier":"Client"]}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:()=>h(!1),children:e.jsx(ge,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"newName",children:"Name *"}),e.jsx(B,{id:"newName",value:j,onChange:m=>F(m.target.value),placeholder:`Enter ${t} name`})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"newEmail",children:"Email"}),e.jsx(B,{id:"newEmail",type:"email",value:a,onChange:m=>b(m.target.value),placeholder:"Enter email"})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"newPhone",children:"Phone"}),e.jsx(B,{id:"newPhone",value:w,onChange:m=>T(m.target.value),placeholder:"Enter phone number"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs(q,{htmlFor:"entity",children:["Select ",t==="supplier"?"Supplier":"Client"]}),e.jsxs(re,{value:g,onValueChange:f,children:[e.jsx(ae,{children:e.jsx(ie,{placeholder:`Select ${t}...`})}),e.jsx(ne,{children:r.map(m=>e.jsx(Q,{value:m.id,children:m.name},m.id))})]})]}),e.jsxs(A,{type:"button",variant:"outline",onClick:()=>h(!0),className:"w-full",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add New ",t==="supplier"?"Supplier":"Client"]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"price",children:"Price *"}),e.jsx(B,{id:"price",type:"number",value:y,onChange:m=>S(m.target.value),placeholder:"Enter price",step:"0.01",min:"0"})]}),t==="client"&&e.jsxs("div",{children:[e.jsx(q,{htmlFor:"margin",children:"Margin Percentage"}),e.jsx(B,{id:"margin",type:"number",value:N,onChange:m=>v(m.target.value),placeholder:"Enter margin %",step:"0.01",min:"0"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(A,{onClick:C,disabled:M,className:"flex-1",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),M?"Adding...":"Add Pricing"]}),e.jsx(A,{variant:"outline",onClick:l,children:"Cancel"})]})]})})})})]})})},Ns=({isOpen:c,onClose:l})=>{const[t,o]=n.useState(""),[s,u]=n.useState([]),[g,f]=n.useState([]),[y,S]=n.useState(!1),[N,v]=n.useState(null),[p,h]=n.useState(null);n.useEffect(()=>{const x=setTimeout(async()=>{if(!t.trim()){u([]),f([]);return}try{S(!0);const P=await $.searchProducts(t);u(P);const C=await Promise.all(P.map(async m=>{try{const[_,E]=await Promise.all([$.getProductWithSuppliers(m.id),$.getProductWithClients(m.id)]);return{...m,suppliers:(_==null?void 0:_.suppliers)||[],clients:(E==null?void 0:E.clients)||[]}}catch(_){return console.error(`Error loading pricing for product ${m.id}:`,_),{...m,suppliers:[],clients:[]}}}));f(C)}catch(P){console.error("Error searching products:",P),D.error("Failed to search products")}finally{S(!1)}},300);return()=>clearTimeout(x)},[t]);const j=()=>{o(""),u([]),f([]),l()},F=(i,x)=>{v({isOpen:!0,type:"supplier",entityName:x.supplier.name,currentPrice:x.current_price,productName:i.name,productId:i.id,relationId:x.id})},a=(i,x)=>{v({isOpen:!0,type:"client",entityName:x.client.name,currentPrice:x.quoted_price,productName:i.name,productId:i.id,relationId:x.id})},b=i=>{h({isOpen:!0,type:"supplier",productId:i.id,productName:i.name})},w=i=>{h({isOpen:!0,type:"client",productId:i.id,productName:i.name})},T=async(i,x)=>{if(N)try{if(N.type==="supplier")await $.updateSupplierPrice(N.relationId,i,x);else{D.info("Client price update functionality coming soon");return}await(async()=>{const C=await $.searchProducts(t),m=await Promise.all(C.map(async _=>{try{const[E,R]=await Promise.all([$.getProductWithSuppliers(_.id),$.getProductWithClients(_.id)]);return{..._,suppliers:(E==null?void 0:E.suppliers)||[],clients:(R==null?void 0:R.clients)||[]}}catch(E){return console.error(`Error loading pricing for product ${_.id}:`,E),{..._,suppliers:[],clients:[]}}}));f(m)})()}catch(P){throw P}},M=async()=>{const i=await $.searchProducts(t),x=await Promise.all(i.map(async P=>{try{const[C,m]=await Promise.all([$.getProductWithSuppliers(P.id),$.getProductWithClients(P.id)]);return{...P,suppliers:(C==null?void 0:C.suppliers)||[],clients:(m==null?void 0:m.clients)||[]}}catch(C){return console.error(`Error loading pricing for product ${P.id}:`,C),{...P,suppliers:[],clients:[]}}}));f(x)},d=()=>{const i=["up","down","stable"];return i[Math.floor(Math.random()*i.length)]},r=({trend:i})=>{switch(i){case"up":return e.jsx(ye,{className:"h-3 w-3 text-red-500"});case"down":return e.jsx(je,{className:"h-3 w-3 text-green-500"});default:return e.jsx(ft,{className:"h-3 w-3 text-gray-400"})}};return e.jsxs(e.Fragment,{children:[e.jsx(X,{open:c,onOpenChange:j,children:e.jsxs(Y,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Z,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(nt,{className:"h-5 w-5"}),"Price Check"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(B,{placeholder:"Search products by name, SKU, or category...",value:t,onChange:i=>o(i.target.value),className:"pl-10"})]}),y&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Searching and loading pricing data..."}),!y&&t&&g.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No products found"}),!y&&g.length>0&&e.jsx("div",{className:"space-y-3",children:g.map(i=>e.jsx(O,{className:"hover:shadow-sm transition-shadow",children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 leading-tight",children:i.name}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded text-xs",children:i.sku}),i.color&&e.jsx(Oe,{color:i.color,size:"sm"})]})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Supplier pricing:"}),e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>b(i),className:"h-6 px-2 text-xs",children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),"Add"]})]}),i.suppliers&&i.suppliers.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:i.suppliers.map(x=>{var C,m;const P=d();return e.jsxs("div",{className:"flex items-center gap-1 bg-blue-50 border border-blue-200 rounded px-2 py-1 hover:bg-blue-100 transition-colors cursor-pointer",onClick:()=>F(i,x),children:[e.jsxs("span",{className:"text-xs font-medium text-blue-800",children:[(C=x.supplier)==null?void 0:C.name,":"]}),e.jsxs("span",{className:"text-xs font-semibold text-blue-900",children:["₱",(m=x.current_price)==null?void 0:m.toLocaleString()]}),e.jsx(r,{trend:P})]},x.id)})}):e.jsx("div",{className:"text-xs text-gray-500",children:"No supplier pricing available"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Client pricing:"}),e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>w(i),className:"h-6 px-2 text-xs",children:[e.jsx(J,{className:"h-3 w-3 mr-1"}),"Add"]})]}),i.clients&&i.clients.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:i.clients.map(x=>{var P,C;return e.jsxs("div",{className:"flex items-center gap-1 bg-green-50 border border-green-200 rounded px-2 py-1 hover:bg-green-100 transition-colors cursor-pointer",onClick:()=>a(i,x),children:[e.jsxs("span",{className:"text-xs font-medium text-green-800",children:[(P=x.client)==null?void 0:P.name,":"]}),e.jsxs("span",{className:"text-xs font-semibold text-green-900",children:["₱",(C=x.quoted_price)==null?void 0:C.toLocaleString()]})]},x.id)})}):e.jsx("div",{className:"text-xs text-gray-500",children:"No client pricing available"})]})]})})},i.id))})]})]})}),N&&e.jsx(Tt,{isOpen:N.isOpen,onClose:()=>v(null),type:N.type,entityName:N.entityName,currentPrice:N.currentPrice,productName:N.productName,onPriceUpdate:T}),p&&e.jsx(Rt,{isOpen:p.isOpen,onClose:()=>h(null),type:p.type,productId:p.productId,productName:p.productName,onSuccess:M})]})},qt=c=>{const l={};return c.forEach(t=>{let o=(t.sku||"").trim(),s,u;if(o){o=o.replace(/[A-Z]$/,"");const g=o.match(/^CE(\d+)$/i);g&&(o={320:"128",321:"128",322:"128",323:"128"}[g[1]]||g[1]),s=o,u=`SKU: ${o}`}else s=t.id,u=t.name;l[s]||(l[s]={baseSku:s,category:t.category||"",name:u,colors:[],priceType:"standard",status:"active",allProducts:[],supportedPrinters:[],departmentsSupplied:[],skus:[],productSkus:[]}),l[s].allProducts.push(t),l[s].skus.includes(t.sku)||(l[s].skus.push(t.sku),l[s].productSkus.push({sku:t.sku,color:t.color})),t.color&&!l[s].colors.includes(t.color)&&l[s].colors.push(t.color)}),Object.values(l)},It=async c=>{const{data:l,error:t}=await L.from("product_clients").select("*, client:clients(*)").eq("product_id",c);return t?[]:(l||[]).map(o=>{var s,u,g,f;return{id:(s=o.client)==null?void 0:s.id,departmentName:((u=o.client)==null?void 0:u.department)||"",locationName:((g=o.client)==null?void 0:g.location)||"",clientName:((f=o.client)==null?void 0:f.name)||""}})},Bt=({products:c=[],onAddProduct:l,onEditProduct:t,onDeleteProduct:o,onRefresh:s})=>{const[u,g]=n.useState(""),[f,y]=n.useState(!1),[S,N]=n.useState(!1),[v,p]=n.useState(!1),[h,j]=n.useState(null),[F,a]=n.useState(null),[b,w]=n.useState(!1),[T,M]=n.useState(null),[d,r]=n.useState(!1),[i,x]=n.useState([]),[P,C]=n.useState(!1),[m,_]=n.useState(void 0),[E,R]=n.useState([]),[z,K]=n.useState(!1),[Ne,ze]=n.useState(!0),Cs=qt(c);n.useEffect(()=>{(async()=>{ze(!0);const I=await Promise.all(Cs.map(async W=>{let oe=[],de=[];for(const V of W.allProducts){try{const G=await Se.getProductPrinters(V.id);oe.push(...G||[])}catch{}try{const G=await It(V.id);de.push(...G||[])}catch{}}const pe=oe.filter((V,G,be)=>V&&V.id&&be.findIndex(ve=>ve.id===V.id)===G),he=de.filter((V,G,be)=>V&&V.id&&be.findIndex(ve=>ve.id===V.id)===G);return{...W,supportedPrinters:pe,departmentsSupplied:he}}));R(I),ze(!1)})()},[c]);const Ke=E.filter(k=>{if(!u.trim())return!0;const I=u.toLowerCase();return k.baseSku.toLowerCase().includes(I)?!0:k.allProducts.some(W=>{var oe,de,pe,he;return((oe=W.name)==null?void 0:oe.toLowerCase().includes(I))||((de=W.sku)==null?void 0:de.toLowerCase().includes(I))||((pe=W.category)==null?void 0:pe.toLowerCase().includes(I))||((he=W.alias)==null?void 0:he.toLowerCase().includes(I))})}),_s=k=>{if(k.allProducts.length===1){const I=k.allProducts[0];t?t(I):(j(I),N(!0))}else a(k),M("edit"),w(!0)},ks=k=>{if(k.allProducts.length===1){const I=k.allProducts[0];o?o(I):(j(I),p(!0))}else a(k),M("delete"),w(!0)},Fs=k=>{const I=k.allProducts[0];console.log("View product details:",I)},As=k=>{w(!1),T==="edit"?(j(k),N(!0)):T==="delete"&&(j(k),p(!0)),a(null),M(null)},Es=k=>{N(!1),_(k),r(!0)},Ls=k=>{x(k),r(!1),C(!0)},Ms=()=>{C(!1),x([]),s&&s()},Ts=async()=>{if(h){p(!1),j(null);try{await $.deleteProduct(h.id),D.success("Product deleted successfully"),s&&s()}catch(k){console.error("Failed to delete product:",k),D.error("Failed to delete product")}}},Ds=()=>{y(!1),s&&s(),D.success("Product added successfully")},Rs=()=>{N(!1),j(null),s&&s(),D.success("Product updated successfully")},qs=k=>{D.info(`Clone product: ${k.allProducts[0].name}`)},Is=k=>{_(k.allProducts[0]),r(!0)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between"}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(B,{placeholder:"Search products...",value:u,onChange:k=>g(k.target.value),className:"pl-10"})]}),Ne?e.jsx(fe,{message:"Loading products..."}):Ke.length===0?e.jsx(O,{children:e.jsxs(U,{className:"p-6 text-center",children:[e.jsx(te,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No products found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:u?"Try adjusting your search":"No products available"})]})}):e.jsx("div",{className:"space-y-3",children:Ke.map((k,I)=>e.jsx(st,{productGroup:k,onEdit:()=>_s(k),onDelete:()=>ks(k),onViewDetails:()=>Fs(k),onClone:qs,onMerge:Is},`${k.baseSku}-${I}`))}),f&&e.jsx($e,{isOpen:f,onClose:()=>y(!1),onProductAdded:Ds,searchTerm:""}),S&&h&&e.jsx(tt,{isOpen:S,onClose:()=>{N(!1),j(null)},product:h,onProductUpdated:Rs,onStartMerge:Es}),v&&h&&e.jsx(Ee,{open:v&&!!h,onOpenChange:k=>{k||(p(!1),j(null))},children:e.jsxs(Le,{children:[e.jsxs(Me,{children:[e.jsxs(Te,{children:["Delete Product: ",h.name]}),e.jsxs(De,{children:["Are you sure you want to delete ",h.name," (",h.sku,")? This action cannot be undone."]})]}),e.jsxs(Re,{children:[e.jsx(qe,{children:"Cancel"}),e.jsx(Ie,{onClick:Ts,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),F&&e.jsx(bt,{isOpen:b,onClose:()=>{w(!1),a(null),M(null)},productGroup:F,onProductSelect:As,action:T}),d&&e.jsx(vt,{isOpen:d,onClose:()=>r(!1),onProductsSelected:Ls,allProducts:c,initialSelectedProduct:m}),P&&e.jsx(Mt,{isOpen:P,onClose:()=>C(!1),products:i,onMergeComplete:Ms}),e.jsx(Ns,{isOpen:z,onClose:()=>K(!1)})]})},$t=({isLoading:c,filteredData:l,searchQuery:t,onDataRefresh:o})=>{const[s,u]=n.useState(!1);return e.jsxs(e.Fragment,{children:[c?e.jsx(fe,{message:"Loading products..."}):e.jsx(Bt,{products:l,onEditClientPrice:()=>{},onEditSupplierPrice:()=>{},onRequestQuote:()=>{}}),e.jsx($e,{isOpen:s,onClose:()=>u(!1),onProductAdded:()=>{u(!1),o()},searchTerm:t})]})},Ot=({isOpen:c,onClose:l,onSuccess:t,editData:o})=>{const[s,u]=n.useState({product_id:"",client_id:"",quoted_price:"",margin_percentage:""}),[g,f]=n.useState([]),[y,S]=n.useState([]),[N,v]=n.useState(!1),{toast:p}=ue();n.useEffect(()=>{var a;c&&(h(),j(),u(o?{product_id:o.product_id,client_id:o.client_id,quoted_price:o.quoted_price.toString(),margin_percentage:((a=o.margin_percentage)==null?void 0:a.toString())||""}:{product_id:"",client_id:"",quoted_price:"",margin_percentage:""}))},[c,o]);const h=async()=>{try{const{data:a,error:b}=await L.from("products").select("id, name, sku").order("name");if(b)throw b;f(a||[])}catch(a){console.error("Error fetching products:",a)}},j=async()=>{try{const{data:a,error:b}=await L.from("clients").select("id, name").order("name");if(b)throw b;S(a||[])}catch(a){console.error("Error fetching clients:",a)}},F=async a=>{if(a.preventDefault(),!s.product_id||!s.client_id||!s.quoted_price){p({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}v(!0);try{const b={product_id:s.product_id,client_id:s.client_id,quoted_price:parseFloat(s.quoted_price),margin_percentage:s.margin_percentage?parseFloat(s.margin_percentage):null};if(o){const{error:w}=await L.from("product_clients").update(b).eq("id",o.id);if(w)throw w;p({title:"Success",description:"Client pricing updated successfully"})}else{const{error:w}=await L.from("product_clients").insert([b]);if(w)throw w;p({title:"Success",description:"Client pricing added successfully"})}t(),l()}catch(b){console.error("Error saving client pricing:",b),p({title:"Error",description:b.message||"Failed to save client pricing",variant:"destructive"})}finally{v(!1)}};return e.jsx(X,{open:c,onOpenChange:l,children:e.jsxs(Y,{className:"sm:max-w-md",children:[e.jsx(Z,{children:e.jsx(ee,{children:o?"Edit Client Pricing":"Add Client Pricing"})}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"product",children:"Product *"}),e.jsxs(re,{value:s.product_id,onValueChange:a=>u(b=>({...b,product_id:a})),children:[e.jsx(ae,{children:e.jsx(ie,{placeholder:"Select a product"})}),e.jsx(ne,{children:g.map(a=>e.jsxs(Q,{value:a.id,children:[a.name," (",a.sku,")"]},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"client",children:"Client *"}),e.jsxs(re,{value:s.client_id,onValueChange:a=>u(b=>({...b,client_id:a})),children:[e.jsx(ae,{children:e.jsx(ie,{placeholder:"Select a client"})}),e.jsx(ne,{children:y.map(a=>e.jsx(Q,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"quoted_price",children:"Quoted Price *"}),e.jsx(B,{id:"quoted_price",type:"number",step:"0.01",placeholder:"0.00",value:s.quoted_price,onChange:a=>u(b=>({...b,quoted_price:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"margin_percentage",children:"Margin Percentage"}),e.jsx(B,{id:"margin_percentage",type:"number",step:"0.01",placeholder:"0.00",value:s.margin_percentage,onChange:a=>u(b=>({...b,margin_percentage:a.target.value}))})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:l,children:"Cancel"}),e.jsx(A,{type:"submit",disabled:N,children:N?"Saving...":o?"Update":"Add"})]})]})]})})},Ut=()=>{const[c,l]=n.useState([]),[t,o]=n.useState(!0),[s,u]=n.useState(""),[g,f]=n.useState(!1),[y,S]=n.useState(null),{toast:N}=ue(),v=d=>{if(!d)return"#6B7280";const r={black:"#000000",cyan:"#00BFFF",magenta:"#FF1493",yellow:"#FFD700",red:"#FF0000",blue:"#0000FF",green:"#008000",orange:"#FFA500",purple:"#800080",pink:"#FFC0CB",brown:"#A52A2A",gray:"#808080",grey:"#808080",white:"#FFFFFF",monochrome:"#000000","tri-color":"#FF1493",photo:"#4169E1",lc:"#00BFFF",lm:"#FFB6C1",ly:"#FFFFE0",pgi:"#000000",cli:"#00BFFF"},i=d.toLowerCase().trim();return r[i]?r[i]:i.includes("black")?"#000000":i.includes("cyan")?"#00BFFF":i.includes("magenta")?"#FF1493":i.includes("yellow")?"#FFD700":i.includes("red")?"#FF0000":i.includes("blue")?"#0000FF":i.includes("green")?"#008000":"#6B7280"},p=async()=>{try{const{data:d,error:r}=await L.from("product_clients").select(`
          id,
          product_id,
          client_id,
          quoted_price,
          margin_percentage,
          updated_at,
          created_at,
          products (
            name,
            sku,
            color
          ),
          clients (
            name
          )
        `).order("updated_at",{ascending:!1});if(r)throw r;const i=(d||[]).map(x=>{var P,C,m,_;return{id:x.id,product_id:x.product_id,client_id:x.client_id,quoted_price:x.quoted_price,margin_percentage:x.margin_percentage,product_name:((P=x.products)==null?void 0:P.name)||"Unknown Product",product_sku:((C=x.products)==null?void 0:C.sku)||"N/A",product_color:((m=x.products)==null?void 0:m.color)||null,client_name:((_=x.clients)==null?void 0:_.name)||"Unknown Client",updated_at:x.updated_at,created_at:x.created_at}});l(i)}catch(d){console.error("Error fetching client pricing:",d),N({title:"Error",description:"Failed to fetch client pricing data",variant:"destructive"})}finally{o(!1)}};n.useEffect(()=>{p()},[]);const h=c.filter(d=>d.product_name.toLowerCase().includes(s.toLowerCase())||d.product_sku.toLowerCase().includes(s.toLowerCase())||d.client_name.toLowerCase().includes(s.toLowerCase())),j=h.reduce((d,r)=>{const i=`${r.product_id}`;return d[i]||(d[i]={product_name:r.product_name,product_sku:r.product_sku,product_color:r.product_color,clients:[]}),d[i].clients.push(r),d},{}),F=d=>Math.max(...d.map(r=>r.quoted_price)),a=d=>Math.min(...d.map(r=>r.quoted_price)),b=d=>{S(d),f(!0)},w=async d=>{try{const{error:r}=await L.from("product_clients").delete().eq("id",d);if(r)throw r;N({title:"Success",description:"Client pricing deleted successfully"}),p()}catch{N({title:"Error",description:"Failed to delete client pricing",variant:"destructive"})}},T=()=>{f(!1),S(null)},M=()=>{p()};return t?e.jsx(fe,{message:"Loading client pricing"}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Client Pricing"}),e.jsxs(A,{size:"sm",onClick:()=>f(!0),className:"h-8 px-3",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Add"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search products, SKU, or clients...",value:s,onChange:d=>u(d.target.value),className:"pl-10 h-10 text-sm"})]})]}),e.jsx("div",{className:"space-y-3",children:Object.keys(j).length===0?e.jsx(O,{className:"border-gray-200",children:e.jsxs(U,{className:"p-6 text-center",children:[e.jsx(Pe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-base font-medium text-muted-foreground mb-2",children:s?"No pricing found":"No client pricing yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s?"Try adjusting your search terms":"Start by adding client pricing for your products"})]})}):Object.entries(j).map(([d,r])=>{const i=F(r.clients),x=a(r.clients),P=[...r.clients].sort((m,_)=>_.quoted_price-m.quoted_price),C=v(r.product_color);return e.jsxs(O,{className:"hover:shadow-md transition-shadow border-gray-200",children:[e.jsx(ce,{className:"pb-2 px-3 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0 border border-gray-300",style:{backgroundColor:C,boxShadow:C==="#FFFFFF"?"inset 0 0 0 1px #D1D5DB":"none"},title:r.product_color||"No color specified"}),e.jsx(le,{className:"text-sm truncate",children:r.product_name}),e.jsx(H,{variant:"outline",className:"text-xs flex-shrink-0",children:r.product_sku})]}),e.jsxs("div",{className:"text-right text-xs flex-shrink-0",children:[e.jsxs("div",{className:"text-green-600 font-semibold",children:["Best: ₱",i.toFixed(2)]}),r.clients.length>1&&e.jsxs("div",{className:"text-muted-foreground",children:["Range: ₱",(i-x).toFixed(2)]})]})]})}),e.jsx(U,{className:"pt-0 px-3 pb-3",children:e.jsx("div",{className:"space-y-2",children:P.map((m,_)=>{const E=m.quoted_price===i&&r.clients.length>1,R=m.quoted_price===x&&r.clients.length>1;return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"font-medium text-xs truncate",children:m.client_name}),E&&e.jsxs(H,{variant:"outline",className:"text-xs text-green-700 border-green-200 flex-shrink-0",children:[e.jsx(ye,{className:"h-2 w-2 mr-1"}),"Best"]}),R&&e.jsxs(H,{variant:"outline",className:"text-xs text-orange-700 border-orange-200 flex-shrink-0",children:[e.jsx(je,{className:"h-2 w-2 mr-1"}),"Low"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-semibold text-xs ${E?"text-green-600":""}`,children:["₱",m.quoted_price.toFixed(2)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:m.margin_percentage?`${m.margin_percentage}% margin`:"No margin"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(A,{size:"sm",variant:"ghost",onClick:()=>b(m),className:"h-6 w-6 p-0",children:e.jsx(Be,{className:"h-3 w-3"})}),e.jsxs(Ee,{children:[e.jsx(ts,{asChild:!0,children:e.jsx(A,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-destructive hover:text-destructive",children:e.jsx(ke,{className:"h-3 w-3"})})}),e.jsxs(Le,{className:"mx-4 max-w-sm",children:[e.jsxs(Me,{children:[e.jsx(Te,{className:"text-base",children:"Delete Client Pricing"}),e.jsxs(De,{className:"text-sm",children:["Are you sure you want to delete this pricing for ",m.client_name,"? This action cannot be undone."]})]}),e.jsxs(Re,{children:[e.jsx(qe,{className:"text-sm",children:"Cancel"}),e.jsx(Ie,{onClick:()=>w(m.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 text-sm",children:"Delete"})]})]})]})]})]})]},m.id)})})})]},d)})}),h.length>0&&e.jsxs(O,{className:"bg-blue-50 dark:bg-blue-950/30 border-blue-200",children:[e.jsx(ce,{className:"pb-2 px-3 pt-3",children:e.jsx(le,{className:"text-sm text-blue-700 dark:text-blue-400",children:"Revenue Analysis"})}),e.jsx(U,{className:"pt-0 px-3 pb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Clients:"}),e.jsx("span",{className:"font-semibold",children:new Set(h.map(d=>d.client_id)).size})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Avg Price:"}),e.jsxs("span",{className:"font-semibold",children:["₱",(h.reduce((d,r)=>d+r.quoted_price,0)/h.length).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Products:"}),e.jsx("span",{className:"font-semibold",children:new Set(h.map(d=>d.product_id)).size})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Avg Margin:"}),e.jsxs("span",{className:"font-semibold",children:[(h.reduce((d,r)=>d+(r.margin_percentage||0),0)/h.length).toFixed(1),"%"]})]})]})})]}),e.jsx(Ot,{isOpen:g,onClose:T,onSuccess:M,editData:y})]})},Vt=Hs,zt=Ws,bs=n.forwardRef(({className:c,...l},t)=>e.jsx(Xe,{className:se("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",c),...l,ref:t}));bs.displayName=Xe.displayName;const Kt=Gs("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),vs=n.forwardRef(({side:c="right",className:l,children:t,...o},s)=>e.jsxs(zt,{children:[e.jsx(bs,{}),e.jsxs(Ye,{ref:s,className:se(Kt({side:c}),l),...o,children:[t,e.jsxs(Ks,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));vs.displayName=Ye.displayName;const ws=({className:c,...l})=>e.jsx("div",{className:se("flex flex-col space-y-2 text-center sm:text-left",c),...l});ws.displayName="SheetHeader";const Ss=n.forwardRef(({className:c,...l},t)=>e.jsx(Ze,{ref:t,className:se("text-lg font-semibold text-foreground",c),...l}));Ss.displayName=Ze.displayName;const Ps=n.forwardRef(({className:c,...l},t)=>e.jsx(es,{ref:t,className:se("text-sm text-muted-foreground",c),...l}));Ps.displayName=es.displayName;const Wt=({isOpen:c,onClose:l,onSuccess:t,editData:o})=>{const[s,u]=n.useState([]),[g,f]=n.useState([]),[y,S]=n.useState(!1),[N,v]=n.useState({product_id:"",supplier_id:"",current_price:""}),{toast:p}=ue();n.useEffect(()=>{c&&(h(),j(),o&&v({product_id:o.product_id,supplier_id:o.supplier_id,current_price:o.current_price.toString()}))},[c,o]);const h=async()=>{const{data:a}=await L.from("products").select("id, name, sku").order("name");u(a||[])},j=async()=>{const{data:a}=await L.from("suppliers").select("id, name").order("name");f(a||[])},F=async a=>{a.preventDefault(),S(!0);try{const b={product_id:N.product_id,supplier_id:N.supplier_id,current_price:parseFloat(N.current_price)};if(o){const{error:w}=await L.from("product_suppliers").update(b).eq("id",o.id);if(w)throw w;p({title:"Success",description:"Supplier pricing updated successfully"})}else{const{error:w}=await L.from("product_suppliers").insert([b]);if(w)throw w;p({title:"Success",description:"Supplier pricing added successfully"})}v({product_id:"",supplier_id:"",current_price:""}),t==null||t(),l()}catch{p({title:"Error",description:o?"Failed to update supplier pricing":"Failed to add supplier pricing",variant:"destructive"})}finally{S(!1)}};return e.jsx(Vt,{open:c,onOpenChange:l,children:e.jsxs(vs,{side:"bottom",className:"h-[90vh]",children:[e.jsxs(ws,{className:"pb-4",children:[e.jsx(Ss,{children:o?"Edit Supplier Pricing":"Add Supplier Pricing"}),e.jsx(Ps,{children:o?"Update pricing information for this supplier":"Set pricing for a product and supplier combination"})]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"product",children:"Product"}),e.jsxs(re,{value:N.product_id,onValueChange:a=>v(b=>({...b,product_id:a})),disabled:y,children:[e.jsx(ae,{children:e.jsx(ie,{placeholder:"Select a product"})}),e.jsx(ne,{children:s.map(a=>e.jsxs(Q,{value:a.id,children:[a.name," (",a.sku,")"]},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"supplier",children:"Supplier"}),e.jsxs(re,{value:N.supplier_id,onValueChange:a=>v(b=>({...b,supplier_id:a})),disabled:y,children:[e.jsx(ae,{children:e.jsx(ie,{placeholder:"Select a supplier"})}),e.jsx(ne,{children:g.map(a=>e.jsx(Q,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"current_price",children:"Current Price (₱)"}),e.jsx(B,{id:"current_price",type:"number",step:"0.01",value:N.current_price,onChange:a=>v(b=>({...b,current_price:a.target.value})),disabled:y,required:!0})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(A,{type:"submit",disabled:y,className:"flex-1",children:[y&&e.jsx(as,{className:"mr-2 h-4 w-4 animate-spin"}),o?"Update Pricing":"Add Pricing"]}),e.jsx(A,{type:"button",variant:"outline",onClick:l,disabled:y,children:"Cancel"})]})]})]})})},Gt=()=>{const[c,l]=n.useState([]),[t,o]=n.useState(!0),[s,u]=n.useState(""),[g,f]=n.useState(!1),[y,S]=n.useState(null),{toast:N}=ue(),v=d=>{if(!d)return"#6B7280";const r={black:"#000000",cyan:"#00BFFF",magenta:"#FF1493",yellow:"#FFD700",red:"#FF0000",blue:"#0000FF",green:"#008000",orange:"#FFA500",purple:"#800080",pink:"#FFC0CB",brown:"#A52A2A",gray:"#808080",grey:"#808080",white:"#FFFFFF",monochrome:"#000000","tri-color":"#FF1493",photo:"#4169E1",lc:"#00BFFF",lm:"#FFB6C1",ly:"#FFFFE0",pgi:"#000000",cli:"#00BFFF"},i=d.toLowerCase().trim();return r[i]?r[i]:i.includes("black")?"#000000":i.includes("cyan")?"#00BFFF":i.includes("magenta")?"#FF1493":i.includes("yellow")?"#FFD700":i.includes("red")?"#FF0000":i.includes("blue")?"#0000FF":i.includes("green")?"#008000":"#6B7280"},p=async()=>{try{const{data:d,error:r}=await L.from("product_suppliers").select(`
          id,
          product_id,
          supplier_id,
          current_price,
          updated_at,
          created_at,
          products (
            name,
            sku,
            color
          ),
          suppliers (
            name
          )
        `).order("updated_at",{ascending:!1});if(r)throw r;const i=(d||[]).map(x=>{var P,C,m,_;return{id:x.id,product_id:x.product_id,supplier_id:x.supplier_id,current_price:x.current_price,product_name:((P=x.products)==null?void 0:P.name)||"Unknown Product",product_sku:((C=x.products)==null?void 0:C.sku)||"N/A",product_color:((m=x.products)==null?void 0:m.color)||null,supplier_name:((_=x.suppliers)==null?void 0:_.name)||"Unknown Supplier",updated_at:x.updated_at,created_at:x.created_at}});l(i)}catch(d){console.error("Error fetching supplier pricing:",d),N({title:"Error",description:"Failed to fetch supplier pricing data",variant:"destructive"})}finally{o(!1)}};n.useEffect(()=>{p()},[]);const h=c.filter(d=>d.product_name.toLowerCase().includes(s.toLowerCase())||d.product_sku.toLowerCase().includes(s.toLowerCase())||d.supplier_name.toLowerCase().includes(s.toLowerCase())),j=h.reduce((d,r)=>{const i=`${r.product_id}`;return d[i]||(d[i]={product_name:r.product_name,product_sku:r.product_sku,product_color:r.product_color,suppliers:[]}),d[i].suppliers.push(r),d},{}),F=d=>Math.min(...d.map(r=>r.current_price)),a=d=>Math.max(...d.map(r=>r.current_price)),b=d=>{S(d),f(!0)},w=async d=>{try{const{error:r}=await L.from("product_suppliers").delete().eq("id",d);if(r)throw r;N({title:"Success",description:"Supplier pricing deleted successfully"}),p()}catch{N({title:"Error",description:"Failed to delete supplier pricing",variant:"destructive"})}},T=()=>{f(!1),S(null)},M=()=>{p()};return t?e.jsx(fe,{message:"Loading supplier pricing"}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Supplier Pricing"}),e.jsxs(A,{size:"sm",onClick:()=>f(!0),className:"h-8 px-3",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Add"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search products, SKU, or suppliers...",value:s,onChange:d=>u(d.target.value),className:"pl-10 h-10 text-sm"})]})]}),e.jsx("div",{className:"space-y-3",children:Object.keys(j).length===0?e.jsx(O,{className:"border-gray-200",children:e.jsxs(U,{className:"p-6 text-center",children:[e.jsx(Ce,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-base font-medium text-muted-foreground mb-2",children:s?"No pricing found":"No supplier pricing yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s?"Try adjusting your search terms":"Start by adding supplier pricing for your products"})]})}):Object.entries(j).map(([d,r])=>{const i=F(r.suppliers),x=a(r.suppliers),P=[...r.suppliers].sort((m,_)=>m.current_price-_.current_price),C=v(r.product_color);return e.jsxs(O,{className:"hover:shadow-md transition-shadow border-gray-200",children:[e.jsx(ce,{className:"pb-2 px-3 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0 border border-gray-300",style:{backgroundColor:C,boxShadow:C==="#FFFFFF"?"inset 0 0 0 1px #D1D5DB":"none"},title:r.product_color||"No color specified"}),e.jsx(le,{className:"text-sm truncate",children:r.product_name}),e.jsx(H,{variant:"outline",className:"text-xs flex-shrink-0",children:r.product_sku})]}),e.jsxs("div",{className:"text-right text-xs flex-shrink-0",children:[e.jsxs("div",{className:"text-green-600 font-semibold",children:["Best: ₱",i.toFixed(2)]}),r.suppliers.length>1&&e.jsxs("div",{className:"text-muted-foreground",children:["Range: ₱",(x-i).toFixed(2)]})]})]})}),e.jsx(U,{className:"pt-0 px-3 pb-3",children:e.jsx("div",{className:"space-y-2",children:P.map((m,_)=>{const E=m.current_price===i&&r.suppliers.length>1,R=m.current_price===x&&r.suppliers.length>1;return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"font-medium text-xs truncate",children:m.supplier_name}),E&&e.jsxs(H,{variant:"outline",className:"text-xs text-green-700 border-green-200 flex-shrink-0",children:[e.jsx(je,{className:"h-2 w-2 mr-1"}),"Best"]}),R&&e.jsxs(H,{variant:"outline",className:"text-xs text-orange-700 border-orange-200 flex-shrink-0",children:[e.jsx(ye,{className:"h-2 w-2 mr-1"}),"High"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-semibold text-xs ${E?"text-green-600":""}`,children:["₱",m.current_price.toFixed(2)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(m.updated_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(A,{size:"sm",variant:"ghost",onClick:()=>b(m),className:"h-6 w-6 p-0",children:e.jsx(Be,{className:"h-3 w-3"})}),e.jsxs(Ee,{children:[e.jsx(ts,{asChild:!0,children:e.jsx(A,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-destructive hover:text-destructive",children:e.jsx(ke,{className:"h-3 w-3"})})}),e.jsxs(Le,{className:"mx-4 max-w-sm",children:[e.jsxs(Me,{children:[e.jsx(Te,{className:"text-base",children:"Delete Supplier Pricing"}),e.jsxs(De,{className:"text-sm",children:["Are you sure you want to delete this pricing for ",m.supplier_name,"? This action cannot be undone."]})]}),e.jsxs(Re,{children:[e.jsx(qe,{className:"text-sm",children:"Cancel"}),e.jsx(Ie,{onClick:()=>w(m.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 text-sm",children:"Delete"})]})]})]})]})]})]},m.id)})})})]},d)})}),h.length>0&&e.jsxs(O,{className:"bg-green-50 dark:bg-green-950/30 border-green-200",children:[e.jsx(ce,{className:"pb-2 px-3 pt-3",children:e.jsx(le,{className:"text-sm text-green-700 dark:text-green-400",children:"Cost Analysis"})}),e.jsx(U,{className:"pt-0 px-3 pb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Suppliers:"}),e.jsx("span",{className:"font-semibold",children:new Set(h.map(d=>d.supplier_id)).size})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Avg Cost:"}),e.jsxs("span",{className:"font-semibold",children:["₱",(h.reduce((d,r)=>d+r.current_price,0)/h.length).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Products:"}),e.jsx("span",{className:"font-semibold",children:new Set(h.map(d=>d.product_id)).size})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Records:"}),e.jsx("span",{className:"font-semibold",children:h.length})]})]})})]}),e.jsx(Wt,{isOpen:g,onClose:T,onSuccess:M,editData:y})]})},yr=()=>{Ys(),Qs();const[c,l]=n.useState(""),t=Js(),[o,s]=n.useState(!1),[u,g]=n.useState(!1),[f,y]=n.useState("products"),{data:S=[],isLoading:N,refetch:v}=Xs({queryKey:["products"],queryFn:()=>$.getProducts()}),{refreshProducts:p}=rt();return e.jsx(ct,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-purple-50",children:e.jsxs("div",{className:"w-full min-h-screen bg-white shadow-xl",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-gradient-to-r from-blue-100 to-purple-100 px-4 py-3 flex items-center justify-between border-b border-blue-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(te,{className:"w-6 h-6 text-blue-500 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-base font-semibold text-gray-900 truncate block",children:"Product Catalog"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Dashboard"})]})]}),e.jsx(A,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 flex-shrink-0",onClick:()=>t("/"),"aria-label":"Back",children:e.jsx(te,{className:"h-5 w-5 text-blue-500"})})]}),e.jsx("div",{className:"pb-20 overflow-y-auto",children:e.jsx(at,{onRefresh:p,children:e.jsxs("div",{className:"p-4",children:[f==="products"&&e.jsx($t,{isLoading:N,filteredData:S,searchQuery:c,onDataRefresh:v}),f==="client-pricing"&&S.length>0&&e.jsx(Ut,{product:{...S[0],price:S[0].price??0,brand:S[0].brand??"",quantityInStock:S[0].quantityInStock??0}}),f==="supplier-pricing"&&e.jsx(Gt,{})]})})}),e.jsx(jt,{activeTab:f,onTabChange:h=>y(h),tabs:[{id:"products",label:"Products",icon:te},{id:"client-pricing",label:"Client Pricing",icon:Pe},{id:"supplier-pricing",label:"Supplier Pricing",icon:Ce}],showBackButton:!0,onBackClick:()=>t("/"),rightButton:e.jsx(A,{onClick:()=>s(!0),className:"bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white rounded-full h-10 w-10 p-0 shadow-lg transition-all duration-200 active:scale-95","aria-label":"Add Product",children:e.jsx(J,{size:18})})}),e.jsx($e,{isOpen:o,onClose:()=>s(!1),onProductAdded:()=>{s(!1),v()},searchTerm:c}),e.jsx(Ns,{isOpen:u,onClose:()=>g(!1)})]})})})};export{yr as default};
//# sourceMappingURL=ProductDashboard-2BSGlCk2.js.map

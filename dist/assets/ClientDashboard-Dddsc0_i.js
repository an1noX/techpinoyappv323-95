import{c as hs,E as Ue,s as Q,u as it,r as h,j as t,D as Be,d as ze,e as We,f as He,P as Et,B as ce,o as nr,i as Ur,R as ve,S as Re,q as $e,v as Ze,w as qe,x as De,a as lt,z as Sa,C as fs,l as Ms,H as Pa,J as qs,I as gr,K as yr,T as vr,M as br,X as Br,F as _r,b as Da,g as ir,N as zr,A as Aa,O as Ea}from"./index-FgfazPn4.js";import{u as lr}from"./use-mobile-CasDpXHz.js";import{I as Ee}from"./input-Cc5DIsqr.js";import{T as Fs,L as Te,C as Ta}from"./label-C7AHjZf1.js";import{A as zt,a as Wt,b as Ht,c as Kt,e as Yt,f as Jt,g as Qt,C as Wr,S as La,E as Ma}from"./alert-dialog-a1roshmq.js";import{a as bs,S as Gt}from"./checkbox-De7F5xfH.js";import{a as Dt,A as Fa,d as Oa,B as Ks,h as Ia,S as Hr,f as Va,c as Ra,E as $a}from"./AddButtonNavigation-BUuDQXbT.js";import{u as Za,f as qa,A as or,P as Ua,a as Ba,b as za}from"./useRefreshFunctions-DaHXTbHG.js";import{p as Tt,c as qt,a as jr}from"./clientService-scOH6ADK.js";import{P as st,M as Wa}from"./printer-X5np4qGe.js";import{D as Ha,a as Ka,b as Ya,c as wr}from"./useSuppliers-CWirxHH7.js";import{C as Os,a as Is}from"./card-S-815Fh1.js";import{B as Le}from"./badge-PQ_Xgg0c.js";import{P as vt,U as cr,D as Ja}from"./users-7LwHL_dG.js";import{C as Ys}from"./circle-check-big-B5GuSQz3.js";import{B as Qa,S as _s}from"./settings-T9C6ttIn.js";import{M as js,H as Ga}from"./map-pin-Bd6tXVet.js";import{T as Xa,a as en,b as Nr,c as Cr}from"./tabs-CXhmf9qd.js";import{P as tn}from"./ProductDetailsModal-BJyiyVc3.js";import{A as sn}from"./AddPurchaseModal-DW33EB1L.js";import{U as rn}from"./upload-BCc2dJv1.js";import{S as an}from"./shopping-cart-Dlmx8wK6.js";import{L as nn}from"./loader-circle-HvrrQJfJ.js";import"./circle-alert-YIDi-HZf.js";import"./eye-BJula9yD.js";import"./chevron-right-BqyfOyy6.js";import"./trending-up-_gLokptJ.js";import"./usePurchaseOrdersEnhanced-5S0vZqYc.js";import"./file-text-hP0IkulY.js";import"./minus-QEom8Zbo.js";import"./user-L0Nw7dze.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=hs("CirclePause",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=hs("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=hs("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=hs("Move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=hs("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Ot=s=>Ue({queryKey:["departments",s],queryFn:async()=>{if(!s)return[];const{data:e,error:r}=await Q.from("departments").select(`
          *,
          locations:departments_location(*)
        `).eq("client_id",s).order("name");if(r)throw r;if(!e||e.length===0)return[];const{data:a,error:i}=await Q.from("printer_assignments").select(`
          id,
          printer_id,
          department_location_id,
          serial_number,
          status,
          deployment_date,
          monthly_price,
          usage_type,
          printer:printers(name, model, manufacturer, image_url, series)
        `).eq("client_id",s).eq("status","active");if(i)throw i;return e.map(l=>{const o=(l.locations||[]).map(c=>{const d=(a||[]).filter(f=>f.department_location_id===c.id).map(f=>{var C;return{id:f.id,printer_id:f.printer_id,serial_number:f.serial_number,status:f.status,deployment_date:f.deployment_date,usage_type:f.usage_type,monthly_price:f.monthly_price,image_url:(C=f.printer)==null?void 0:C.image_url,printer:f.printer,compatible_products:[]}});return{id:c.id,name:c.name,office_name:c.office_name,description:c.description,floor:c.floor,contact_person:c.contact_person,contact_number:c.contact_number,abbreviation:c.abbreviation,printer_count:d.length,department_id:c.department_id,client_id:c.client_id,printers:d,created_at:c.created_at,updated_at:c.updated_at}}),m=o.reduce((c,d)=>c+d.printer_count,0);return{id:l.id,name:l.name,description:l.description,client_id:l.client_id,total_printer_count:m,locations:o,created_at:l.created_at,updated_at:l.updated_at}}).sort((l,o)=>l.name.localeCompare(o.name))},enabled:!!s}),un=({isOpen:s,onClose:e,clientId:r,department:a,onDepartmentSaved:i})=>{const{toast:n}=it(),l=!!(a!=null&&a.id),[o,m]=h.useState(""),[c,d]=h.useState(""),[f,C]=h.useState(""),[A,M]=h.useState([]),[k,b]=h.useState(!1),[j,_]=h.useState({}),[B,z]=h.useState(null),[y,E]=h.useState(null),[H,X]=h.useState([]);h.useEffect(()=>{s&&(a?(m(a.name||""),d(a.contactPerson||""),C(a.description||""),M(a.locations||[])):(m(""),d(""),C(""),M([])),_({}))},[s,a]);const J=()=>{const F={};return o.trim()||(F.name="Department name is required"),r||(F.client="Client ID is required"),A.some(R=>!R.name.trim())&&(F.locations="All locations must have a name"),_(F),Object.keys(F).length===0},pe=()=>{M([...A,{name:"",floor:"",officeName:"",description:"",contactPerson:"",contactNumber:"",abbreviation:""}])},ye=F=>{const R=A[F];R.id&&X($=>[...$,R.id]),M(A.filter(($,Y)=>Y!==F))},S=(F,R,$)=>{M(A.map((Y,Ne)=>Ne===F?{...Y,[R]:$}:Y))},K=async F=>{if(F.preventDefault(),!!J()){b(!0);try{let R=a==null?void 0:a.id;if(l){const{error:$}=await Q.from("departments").update({name:o.trim(),contact_person:c.trim()||null,description:f.trim()||null}).eq("id",R);if($)throw console.error("Department update error:",$),new Error(`Failed to update department: ${$.message}`)}else{const{data:$,error:Y}=await Q.from("departments").insert({name:o.trim(),contact_person:c.trim()||null,description:f.trim()||null,client_id:r}).select("id").single();if(Y)throw console.error("Department creation error:",Y),new Error(`Failed to create department: ${Y.message}`);R=$.id}if(!R)throw new Error("Department ID is required for location operations");for(const $ of A)if($.id){const{error:Y}=await Q.from("departments_location").update({name:$.name.trim(),floor:$.floor.trim()||null,office_name:$.officeName.trim()||null,description:$.description.trim()||null,contact_person:$.contactPerson.trim()||null,contact_number:$.contactNumber.trim()||null,abbreviation:$.abbreviation.trim()||null}).eq("id",$.id);if(Y)throw console.error("Location update error:",Y),new Error(`Failed to update location "${$.name}": ${Y.message}`)}else{const{error:Y}=await Q.from("departments_location").insert({department_id:R,client_id:r,name:$.name.trim(),floor:$.floor.trim()||null,office_name:$.officeName.trim()||null,description:$.description.trim()||null,contact_person:$.contactPerson.trim()||null,contact_number:$.contactNumber.trim()||null,abbreviation:$.abbreviation.trim()||null});if(Y)throw console.error("Location insert error:",Y),new Error(`Failed to create location "${$.name}": ${Y.message}`)}for(const $ of H)await Q.from("departments_location").delete().eq("id",$);n({title:"Success",description:l?"Department updated successfully.":"Department created successfully."}),i(),e(),X([])}catch(R){console.error("Form submission error:",R);const $=R instanceof Error?R.message:"An unexpected error occurred";n({title:"Error",description:$,variant:"destructive"})}finally{b(!1)}}};return t.jsx(Be,{open:s,onOpenChange:e,children:t.jsxs(ze,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[t.jsx(We,{children:t.jsxs(He,{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:l?t.jsx(bs,{className:"h-5 w-5 text-white"}):t.jsx(Et,{className:"h-5 w-5 text-white"})}),t.jsx("span",{children:l?"Edit Department":"Add Department"})]})}),t.jsxs("form",{onSubmit:K,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department Name *"}),t.jsx(Ee,{value:o,onChange:F=>m(F.target.value),placeholder:"Enter department name",className:j.name?"border-red-300":""}),j.name&&t.jsx("p",{className:"text-red-600 text-sm mt-1",children:j.name})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Person"}),t.jsx(Ee,{value:c,onChange:F=>d(F.target.value),placeholder:"Department head or contact person"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),t.jsx(Fs,{value:f,onChange:F=>C(F.target.value),placeholder:"Brief description of the department...",className:"min-h-[80px]"})]}),t.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"font-medium text-gray-800",children:"Locations"}),t.jsxs(ce,{type:"button",variant:"outline",size:"sm",onClick:pe,children:[t.jsx(Et,{className:"h-4 w-4 mr-1"})," Add Location"]})]}),j.locations&&t.jsx("p",{className:"text-red-600 text-sm mb-2",children:j.locations}),A.length===0&&t.jsx("div",{className:"text-xs text-gray-500",children:"No locations added yet."}),A.map((F,R)=>{const $=!l||!F.name||B===R,Y=Array.isArray(F.printers)?F.printers:[],Ne=Y.length>0;return t.jsxs("div",{className:"border rounded-md p-3 mb-2 bg-white flex flex-col gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ee,{value:F.name,onChange:ue=>S(R,"name",ue.target.value),placeholder:"Office Name / Floor *",className:"text-sm flex-1",disabled:!$}),l&&F.name&&t.jsx(ce,{type:"button",variant:"ghost",size:"icon",onClick:()=>z(R),title:"Edit Location",children:t.jsx(bs,{className:"h-4 w-4 text-blue-500"})}),t.jsx(ce,{type:"button",variant:"ghost",size:"icon",onClick:()=>E(R),title:"Delete Location",children:t.jsx(nr,{className:"h-4 w-4 text-red-500"})})]}),l&&y===R&&t.jsx(zt,{open:!0,onOpenChange:()=>E(null),children:t.jsxs(Wt,{children:[t.jsx(Ht,{children:t.jsx(Kt,{children:"Unable to Delete Location"})}),Ne?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-sm text-red-600 mb-2",children:"There are still printers assigned to it."}),t.jsxs("div",{className:"mb-2",children:[t.jsx("div",{className:"flex font-semibold text-xs text-gray-700 border-b pb-1 mb-1",children:t.jsx("div",{className:"w-full",children:"Printer Names"})}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map((ue,we)=>{let ee=ue.name||ue.printer_name||ue.model||ue.id,ne=ue.serial_number||ue.printer&&ue.printer.serial_number||"";return!ee&&ue.printer&&(ee=ue.printer.name||ue.printer.printer_name||ue.printer.model||ue.printer.id),!ne&&ue.printer&&(ne=ue.printer.serial_number||""),t.jsxs("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs",children:[ee,ne?` (${ne})`:""]},we)})})]}),t.jsx("div",{className:"text-sm text-red-600 mb-2",children:"⚠️ You can only delete locations that have no associated printers."}),t.jsx(Yt,{children:t.jsx(Jt,{onClick:()=>E(null),children:"Close"})})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-sm text-gray-700 mb-2",children:"Are you sure you want to delete this location? This action cannot be undone."}),t.jsxs(Yt,{children:[t.jsx(Jt,{onClick:()=>E(null),children:"Cancel"}),t.jsx(Qt,{onClick:()=>{ye(R),E(null)},className:"bg-red-600 hover:bg-red-700 text-white",children:"Yes, Delete"})]})]})]})})]},R)})]}),t.jsx(Ur,{className:"flex-col sm:flex-row gap-2 sm:gap-0",children:t.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[t.jsx(ce,{type:"button",variant:"outline",onClick:e,disabled:k,className:"flex-1 sm:flex-none",children:"Cancel"}),t.jsx(ce,{type:"submit",disabled:k,className:"flex-1 sm:flex-none",children:k?l?"Saving...":"Creating...":l?"Save Changes":"Create Department"})]})})]})]})})},Kr=({isOpen:s,onClose:e,assignment:r,departments:a,currentDepartmentName:i="",currentLocationName:n=""})=>{var B,z,y;const[l,o]=h.useState((r==null?void 0:r.department_location_id)||""),[m,c]=h.useState((r==null?void 0:r.status)||"active"),[d,f]=h.useState(!1),{toast:C}=it(),A=a.flatMap(E=>E.locations.map(H=>({id:H.id,label:`${E.name} - ${H.name}`,departmentName:E.name,locationName:H.name}))),M=a.flatMap(E=>E.locations).find(E=>E.id===l),k=((B=a.find(E=>E.locations.some(H=>H.id===l)))==null?void 0:B.name)||"",b=(M==null?void 0:M.name)||"";ve.useEffect(()=>{r&&(o(r.department_location_id||""),c(r.status||"active"))},[r]);const j=()=>{f(!0)},_=async()=>{try{console.log("Transfer assignmentId:",r==null?void 0:r.id),console.log("Transfer newDepartmentLocationId:",l),await Dt.updateAssignment(r==null?void 0:r.id,{department_location_id:l}),f(!1),e(),C({title:"Printer Transferred",description:"The printer assignment has been successfully transferred.",variant:"default"})}catch(E){f(!1),C({title:"Transfer Failed",description:`Error: ${(E==null?void 0:E.message)||(E==null?void 0:E.toString())}`,variant:"destructive"}),console.error("Transfer error:",E)}};return r?t.jsxs(Be,{open:s,onOpenChange:e,children:[t.jsxs(ze,{className:"w-full max-w-[95vw] sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[t.jsx(We,{children:t.jsxs(He,{className:"text-lg sm:text-xl",children:[((z=r==null?void 0:r.printer)==null?void 0:z.name)||"Product",r.serial_number&&t.jsxs("span",{className:"text-xs text-gray-500 font-normal ml-2 align-middle",children:["- ",r.serial_number]})]})}),t.jsx("div",{className:"grid gap-4 py-4",children:m!=="undeployed"&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"text-sm font-medium mb-1",children:["Transfer to ",m==="active"&&t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs(Re,{value:l,onValueChange:o,children:[t.jsx($e,{className:"w-full",children:t.jsx(Ze,{placeholder:"Select department location"})}),t.jsx(qe,{children:A.map(E=>t.jsx(De,{value:E.id,children:E.label},E.id))})]})]})}),t.jsx(Ur,{className:"flex-col sm:flex-row gap-2 sm:gap-0",children:t.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[t.jsx(ce,{variant:"outline",onClick:e,className:"flex-1 sm:flex-none",children:"Cancel"}),t.jsx(ce,{onClick:j,className:"flex-1 sm:flex-none",children:"Transfer"})]})})]}),t.jsx(zt,{open:d,onOpenChange:f,children:t.jsxs(Wt,{children:[t.jsx(Ht,{children:t.jsx(Kt,{className:"text-base sm:text-lg font-semibold mb-2",children:"Confirm Printer Transfer"})}),t.jsxs("div",{className:"text-sm mb-4",children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("span",{className:"block mb-1 font-medium",children:"You're about to transfer printer assignment:"}),t.jsxs("div",{className:"rounded-lg bg-gray-50 p-3 flex flex-col gap-2",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1",children:[t.jsx("span",{className:"font-semibold text-gray-700",children:"Printer:"}),t.jsx("span",{className:"text-gray-900",children:((y=r==null?void 0:r.printer)==null?void 0:y.name)||""})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1",children:[t.jsx("span",{className:"font-semibold text-gray-700",children:"From:"}),t.jsx("span",{className:"text-gray-900",children:i&&n?`${i} - ${n}`:i||n||t.jsx("span",{className:"italic text-gray-400",children:"Unassigned"})})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1",children:[t.jsx("span",{className:"font-semibold text-gray-700",children:"To:"}),t.jsx("span",{className:"text-gray-900",children:k&&b?`${k} - ${b}`:t.jsx("span",{className:"italic text-gray-400",children:"Select a location"})})]})]})]}),t.jsx("div",{className:"mt-2 mb-1 text-gray-700",children:"Are you sure you want to continue?"}),t.jsxs("div",{className:"text-xs text-gray-500",children:["Click ",t.jsx("span",{className:"font-semibold text-blue-600",children:"Continue"})," to confirm the transfer or ",t.jsx("span",{className:"font-semibold",children:"Cancel"})," to go back."]})]}),t.jsxs(Yt,{children:[t.jsx(Jt,{className:"w-full sm:w-auto",onClick:()=>f(!1),children:"Cancel"}),t.jsx(Qt,{className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white",onClick:_,children:"Continue"})]})]})})]}):null},Yr=({isOpen:s,onClose:e,location:r,locations:a,departmentBaseName:i,clientId:n,onPrinterAssigned:l,departments:o=[],initialDepartmentId:m})=>{const[c,d]=h.useState({printerId:"",printerName:"",serialNumber:"",deploymentDate:"",usageType:"service_unit",monthlyPrice:"",hasSecurityDeposit:!1,securityDepositAmount:"",status:"active",notes:"",locationName:""}),[f,C]=h.useState(!1),{toast:A}=it(),[M,k]=h.useState(""),[b,j]=h.useState(!1),{printers:_,loading:B}=Za(!1),{data:z=[],isLoading:y,refetch:E}=Ot(n),[H,X]=h.useState(""),[J,pe]=h.useState({}),[ye,S]=h.useState({}),[K,F]=h.useState(null),R=ve.useMemo(()=>a&&a.length>0?a.map(g=>({id:g.id,label:`${i} - ${g.name}`})):(z||[]).flatMap(g=>(g.locations||[]).map(p=>({id:p.id,label:`${g.name} - ${p.name}`}))),[a,i,z]);h.useEffect(()=>{s&&(X(""),k(""),j(!1),d(g=>({...g,deploymentDate:g.deploymentDate||new Date().toISOString().split("T")[0]})))},[s]);const $=M.trim()===""?_:_.filter(g=>{const p=M.toLowerCase();return g.name.toLowerCase().includes(p)||g.manufacturer&&g.manufacturer.toLowerCase().includes(p)||g.model&&g.model.toLowerCase().includes(p)||g.series&&g.series.toLowerCase().includes(p)}),Y=async g=>{if(!J[g]){F(g);try{const p=await Tt.getProductsByPrinter(g);pe(se=>({...se,[g]:p}));const N={};await Promise.all(p.map(async se=>{const U=(await qt.getProductClients(se.id)).find(W=>W.client_id===n);U&&(N[se.id]=U.quoted_price)})),S(se=>({...se,[g]:N}))}catch{}finally{F(null)}}},Ne=async g=>{if(g.preventDefault(),!c.printerId||!H||!c.deploymentDate){A({title:"Error",description:"Please fill in all required fields (Printer, Department/Location, and Deployment Date).",variant:"destructive"});return}C(!0);try{const{error:p}=await Q.from("printer_assignments").insert({printer_id:c.printerId,client_id:n,department_location_id:H,serial_number:c.serialNumber||null,deployment_date:c.deploymentDate,usage_type:c.usageType,monthly_price:c.usageType==="rental"&&c.monthlyPrice?parseFloat(c.monthlyPrice):null,has_security_deposit:c.hasSecurityDeposit,security_deposit_amount:c.hasSecurityDeposit&&c.securityDepositAmount?parseFloat(c.securityDepositAmount):null,notes:c.notes||null,status:c.status});if(p)throw p;A({title:"Success",description:"Printer has been assigned to location successfully!"}),l(),ue()}catch(p){console.error("Failed to assign printer:",p),A({title:"Error",description:"Failed to assign printer. Please try again.",variant:"destructive"})}finally{C(!1)}},ue=()=>{d({printerId:"",printerName:"",serialNumber:"",deploymentDate:"",usageType:"service_unit",monthlyPrice:"",hasSecurityDeposit:!1,securityDepositAmount:"",status:"active",notes:"",locationName:""}),X(""),k(""),j(!1),e()},we=g=>{const p=g.manufacturer||"",N=g.series||"",se=g.model||"",re=g.name||"";return se?[p,N,se].filter(Boolean).join(" "):[p,N,re].filter(Boolean).join(" ")},ee=R.find(g=>g.id===H),ne=ee?ee.label:"";return t.jsx(t.Fragment,{children:t.jsx(Be,{open:s,onOpenChange:ue,children:t.jsxs(ze,{className:"max-w-md",children:[t.jsxs(We,{children:[t.jsxs(He,{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"bg-green-600 p-2 rounded-lg",children:t.jsx(st,{className:"h-5 w-5 text-white"})}),t.jsx("span",{children:"Assign Printer to Location"})]}),ne&&t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:ne})]}),t.jsxs("form",{onSubmit:Ne,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(Te,{className:"text-sm font-medium text-gray-700 flex items-center",children:"Department / Location *"}),t.jsxs(Re,{value:H||void 0,onValueChange:X,disabled:f||y||R.length===0,children:[t.jsx($e,{className:"w-full mt-1",children:t.jsx(Ze,{placeholder:"Select a department and location"})}),t.jsx(qe,{children:R.length===0?t.jsx("div",{className:"px-4 py-2 text-gray-500",children:"No departments or locations available"}):R.map(g=>t.jsx(De,{value:g.id,children:g.label},g.id))})]}),y&&t.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Loading departments..."}),R.length===0&&t.jsx("div",{className:"text-xs text-red-500 mt-1",children:"No departments or locations available. Please add one first."})]}),t.jsxs("div",{children:[t.jsx(Te,{children:"Printer *"}),t.jsxs("div",{className:"mb-4 relative",children:[t.jsx("input",{type:"text",value:c.printerName||M,onChange:g=>{k(g.target.value),d(p=>({...p,printerName:"",printerId:""})),j(!0)},onFocus:()=>{j(!0),k(M)},placeholder:"Search printers by name, model, or manufacturer...",className:"w-full pl-3 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoComplete:"off",disabled:f}),b&&M&&t.jsx("div",{className:"absolute left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto z-50 min-w-full",children:B?t.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading printers..."}):$.length===0?t.jsx("div",{className:"p-4 text-center text-gray-500",children:"No printers found"}):$.map(g=>{const p=J[g.id]||[];return t.jsx("button",{type:"button",className:"w-full text-left px-2 py-2 bg-white border border-gray-200 rounded-lg shadow-sm mb-2 hover:bg-blue-50 focus:bg-blue-100 transition-colors",onClick:()=>{d(N=>({...N,printerId:g.id,printerName:we(g)})),k(we(g)),j(!1)},onMouseEnter:()=>Y(g.id),onFocus:()=>{j(!0),k(M)},children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-10 h-10 flex-shrink-0 flex items-center justify-center bg-gray-100 rounded border overflow-hidden mr-3",children:g.image_url?t.jsx("img",{src:g.image_url,alt:g.name,className:"object-contain w-full h-full"}):t.jsx(st,{className:"h-7 w-7 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold text-sm truncate",style:{lineHeight:"1.2"},children:we(g)}),p&&p.length>0&&t.jsx("div",{className:"mt-1 space-y-0.5",children:p.map(N=>{const se=ye[g.id]&&ye[g.id][N.id]!==void 0?ye[g.id][N.id]:null;return t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-xs text-gray-700 truncate flex items-center",style:{lineHeight:"1.2"},children:[N.color&&t.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full mr-1.5 border border-gray-300",style:{background:N.color}}),"Toner: ",N.name,N.sku&&t.jsxs(t.Fragment,{children:[" (",N.sku,")"]})]}),se!==null?t.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full font-medium whitespace-nowrap",children:["₱",se.toLocaleString()]}):null]},N.id)})})]})]})},g.id)})})]})]}),t.jsxs("div",{children:[t.jsx(Te,{htmlFor:"serial_number",children:"Serial Number"}),t.jsx(Ee,{id:"serial_number",value:c.serialNumber,onChange:g=>d(p=>({...p,serialNumber:g.target.value})),disabled:f,placeholder:"Enter serial number",className:"mt-1"})]}),t.jsxs("div",{children:[t.jsx(Te,{htmlFor:"deployment_date",children:"Deployment Date *"}),t.jsx(Ee,{id:"deployment_date",type:"date",value:c.deploymentDate,onChange:g=>d(p=>({...p,deploymentDate:g.target.value})),disabled:f,className:"mt-1",required:!0})]}),t.jsxs("div",{children:[t.jsx(Te,{children:"Usage Type"}),t.jsxs(Re,{value:c.usageType,onValueChange:g=>d(p=>({...p,usageType:g})),disabled:f,children:[t.jsx($e,{className:"mt-1",children:t.jsx(Ze,{})}),t.jsxs(qe,{children:[t.jsx(De,{value:"service_unit",children:"Service Unit"}),t.jsx(De,{value:"client_owned",children:"Client Owned"}),t.jsx(De,{value:"rental",children:"Rental"})]})]})]}),c.usageType==="rental"&&t.jsxs("div",{children:[t.jsx(Te,{htmlFor:"monthly_price",children:"Monthly Rental Price"}),t.jsx(Ee,{id:"monthly_price",type:"number",min:"0",step:"0.01",value:c.monthlyPrice,onChange:g=>d(p=>({...p,monthlyPrice:g.target.value})),disabled:f,placeholder:"0.00",className:"mt-1"})]}),t.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[t.jsx(Te,{children:"Security Deposit"}),t.jsx("input",{type:"checkbox",checked:c.hasSecurityDeposit,onChange:g=>d(p=>({...p,hasSecurityDeposit:g.target.checked})),disabled:f,className:"ml-2"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Does this assignment require a security deposit?"})]}),c.hasSecurityDeposit&&t.jsxs("div",{children:[t.jsx(Te,{htmlFor:"security_deposit_amount",children:"Security Deposit Amount"}),t.jsx(Ee,{id:"security_deposit_amount",type:"number",min:"0",step:"0.01",value:c.securityDepositAmount,onChange:g=>d(p=>({...p,securityDepositAmount:g.target.value})),disabled:f,placeholder:"0.00",className:"mt-1"})]}),t.jsxs("div",{children:[t.jsx(Te,{children:"Status"}),t.jsxs(Re,{value:c.status,onValueChange:g=>d(p=>({...p,status:g})),disabled:f,children:[t.jsx($e,{className:"mt-1",children:t.jsx(Ze,{})}),t.jsxs(qe,{children:[t.jsx(De,{value:"active",children:"Active"}),t.jsx(De,{value:"inactive",children:"Inactive"}),t.jsx(De,{value:"returned",children:"Returned"})]})]})]}),t.jsxs("div",{children:[t.jsx(Te,{htmlFor:"notes",children:"Notes"}),t.jsx(Fs,{id:"notes",value:c.notes,onChange:g=>d(p=>({...p,notes:g.target.value})),disabled:f,placeholder:"Assignment notes...",className:"mt-1",rows:3})]}),t.jsxs("div",{className:"flex space-x-2 pt-4",children:[t.jsx(ce,{type:"button",variant:"outline",onClick:ue,disabled:f,className:"flex-1",children:"Cancel"}),t.jsx(ce,{type:"submit",disabled:f||!c.printerId||!H,className:"flex-1",children:f?"Assigning...":"Assign Printer"})]})]})]})})})},Ct=({printer:s,onManage:e,clientId:r,departmentName:a,locationName:i,showUndeployedStatus:n=!1,onDataRefresh:l})=>{var z,y,E,H,X;lt();const[o,m]=h.useState(!1),[c,d]=h.useState(""),[f,C]=h.useState(!1),[A,M]=h.useState(!1),[k,b]=h.useState(""),j=J=>{switch(J==null?void 0:J.toLowerCase()){case"active":return"bg-green-100 text-green-700 border-green-200";case"inactive":return"bg-gray-100 text-gray-700 border-gray-300";case"undeployed":return"bg-orange-100 text-orange-700 border-orange-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},_=((z=s.status)==null?void 0:z.toLowerCase())==="inactive",B=((y=s.status)==null?void 0:y.toLowerCase())==="active";return(E=s.status)==null||E.toLowerCase(),(H=s.status)==null||H.toLowerCase(),t.jsxs(t.Fragment,{children:[t.jsx(Os,{className:`hover:shadow-md transition-shadow ${_?"bg-gray-50 border-l-4 border-gray-400 opacity-80":""} ${B?"bg-white border-l-4 border-green-400":""}`,children:t.jsx(Is,{className:"p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"relative flex-shrink-0",children:t.jsx("img",{src:s.image_url||"/placeholder.svg",alt:s.name||"Printer",className:"w-24 h-24 object-cover rounded-md",onError:J=>{J.currentTarget.src="/placeholder.svg"}})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("h4",{className:`font-medium text-sm truncate ${_?"text-gray-500 italic":"text-gray-900"}`,children:s.name||((X=s.printer)==null?void 0:X.name)||"Unknown Printer"}),s.usage_type==="client_owned"&&t.jsx(Le,{className:"bg-blue-100 text-blue-700 border-blue-200 text-xs px-2 py-1",variant:"outline",children:"Client Owned"}),n&&t.jsxs(Le,{className:`text-xs px-2 py-1 ${j("undeployed")}`,variant:"outline",children:[t.jsx(vt,{className:"w-3 h-3 mr-1"}),"Undeployed"]}),!n&&s.status&&B&&t.jsxs(Le,{className:"bg-green-100 text-green-700 border-green-300 text-xs px-2 py-1 flex items-center gap-1",variant:"outline",children:[t.jsx(Ys,{className:"w-3 h-3 mr-1 text-green-500"}),"Active"]}),!n&&s.status&&!_&&!B&&t.jsx(Le,{className:`text-xs px-2 py-1 ${j(s.status)}`,variant:"outline",children:s.status}),_&&t.jsxs(Le,{className:"bg-gray-200 text-gray-700 border-gray-300 text-xs px-2 py-1 flex items-center gap-1",variant:"outline",children:[t.jsx(kr,{className:"w-3 h-3 mr-1 text-gray-400"}),"Inactive"]})]}),t.jsxs("div",{className:"space-y-1",children:[s.model&&t.jsxs("p",{className:`text-xs ${_?"text-gray-400 italic":"text-gray-600"}`,children:["Model: ",s.model]}),s.serial_number?t.jsxs("p",{className:`text-xs ${_?"text-gray-400 italic":"text-gray-600"}`,children:["S/N: ",s.serial_number]}):t.jsxs("p",{className:"text-xs text-orange-600 flex items-center gap-1",children:["S/N: Missing Serial No.",t.jsx(ce,{variant:"ghost",size:"icon",className:"p-0 h-4 w-4",onClick:()=>{d(""),m(!0)},title:"Edit Serial Number",children:t.jsx(dn,{className:"h-4 w-4 text-orange-600"})})]}),a&&i&&t.jsxs("div",{className:`flex items-center gap-4 text-xs ${_?"text-gray-400 italic":"text-gray-500"}`,children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Qa,{className:"w-3 h-3"}),t.jsx("span",{children:a})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(js,{className:"w-3 h-3"}),t.jsx("span",{children:i})]})]}),n&&t.jsxs("div",{className:"flex items-center gap-1 text-xs text-orange-600",children:[t.jsx(vt,{className:"w-3 h-3"}),t.jsx("span",{children:"Available for deployment to any location"})]}),_&&t.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400 italic mt-1",children:[t.jsx(kr,{className:"w-3 h-3"}),t.jsx("span",{children:"This printer is currently inactive and not deployed."})]})]}),t.jsx("hr",{className:"my-2 border-t border-orange-200/50"}),t.jsx(Wr,{printerId:s.printer_id,className:"text-xs flex flex-row flex-wrap gap-2 mt-1"})]}),t.jsx("div",{className:"flex flex-col items-end gap-2",children:t.jsx(ce,{variant:"ghost",size:"sm",onClick:e,className:"h-8 w-8 p-0 flex-shrink-0",title:"Transfer Printer",children:t.jsx(Fa,{className:"h-5 w-5 text-blue-600"})})})]})})}),t.jsx(zt,{open:o,onOpenChange:m,children:t.jsxs(Wt,{children:[t.jsx(Ht,{children:t.jsx(Kt,{children:"Update Serial Number"})}),t.jsx("input",{type:"text",className:"border rounded px-2 py-1 w-full mb-3",placeholder:"Enter Serial Number",value:c,onChange:J=>d(J.target.value),disabled:A}),k&&t.jsx("p",{className:"text-xs text-red-600 mb-2 text-center",children:k}),t.jsxs(Yt,{children:[t.jsx(Jt,{onClick:()=>m(!1),disabled:A,children:"Cancel"}),t.jsx(Qt,{disabled:A||!c.trim(),onClick:async()=>{M(!0),b("");try{const{error:J}=await Q.from("printer_assignments").update({serial_number:c.trim()}).eq("id",s.assignment_id);if(J)throw J;s.serial_number=c.trim(),m(!1),C(!0),l&&l()}catch{b("Failed to update serial number. Please try again.")}finally{M(!1)}},className:"bg-blue-600 hover:bg-blue-700 text-white",children:A?"Saving...":"Save"})]})]})}),f&&t.jsx(zt,{open:f,onOpenChange:C,children:t.jsxs(Wt,{children:[t.jsx(Ht,{children:t.jsx(Kt,{children:"Serial number has been updated."})}),t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(Ys,{className:"h-8 w-8 text-green-500 mb-2"}),t.jsx(ce,{variant:"default",size:"sm",onClick:()=>C(!1),children:"OK"})]})]})})]})},mn=s=>{const{queryKeys:e=[],showNotifications:r=!0}=s,a=Sa(),{toast:i}=it(),n=h.useCallback(l=>{e.forEach(o=>{a.invalidateQueries({queryKey:[o]})}),a.invalidateQueries({queryKey:["printers"]}),a.invalidateQueries({queryKey:["printer-assignments"]}),a.invalidateQueries({queryKey:["available-printers"]}),a.invalidateQueries({queryKey:["assigned-printers"]}),a.invalidateQueries({queryKey:["compatible-products"]}),r&&l&&i({title:"Data Updated",description:l,duration:3e3})},[a,e,r,i]);return h.useEffect(()=>{const l=Q.channel("printer-assignments-realtime").on("postgres_changes",{event:"*",schema:"public",table:"printer_assignments"},c=>{console.log("Printer assignment change detected:",c),n("Printer assignments updated")}).subscribe(),o=Q.channel("printers-realtime").on("postgres_changes",{event:"*",schema:"public",table:"printers"},c=>{console.log("Printer change detected:",c),n("Printer data updated")}).subscribe(),m=Q.channel("product-printers-realtime").on("postgres_changes",{event:"*",schema:"public",table:"product_printers"},c=>{console.log("Product-printer relationship change detected:",c),n("Compatible products updated")}).subscribe();return()=>{Q.removeChannel(l),Q.removeChannel(o),Q.removeChannel(m)}},[n]),{refreshData:()=>n("Data refreshed manually")}},hn=({clientId:s,filteredPrinters:e,onDepartmentDetailsView:r})=>{const{userProfile:a}=lt(),[i,n]=h.useState(!1),[l,o]=h.useState(null),[m,c]=h.useState(null),[d,f]=h.useState(null),[C,A]=h.useState(null),[M,k]=h.useState(!1),[b,j]=h.useState(!1),[_,B]=h.useState(!1),[z,y]=h.useState(null),[E,H]=h.useState(""),[X,J]=h.useState(""),{toast:pe}=it(),ye=a&&!["admin","sales_admin"].includes(a.role||""),{data:S=[],isLoading:K,refetch:F}=Ot(s),{data:R=[],isLoading:$,refetch:Y}=Ue({queryKey:["client-printer-pool",s],queryFn:()=>Dt.getClientPrinterPool(s),enabled:!!s}),{data:Ne=[],isLoading:ue,refetch:we}=Ue({queryKey:["client-inactive-printers",s],queryFn:()=>Dt.getClientInactiveAssignments(s),enabled:!!s}),{refreshData:ee}=mn({queryKeys:["departments","client-printer-pool","client-inactive-printers"],showNotifications:!1});h.useEffect(()=>{const w=()=>{console.log("🔄 AdminDashboardClientDepartments: Received refresh event, updating data..."),xe()};return window.addEventListener("refresh-printer-data",w),window.addEventListener("refresh-compatible-products",w),()=>{window.removeEventListener("refresh-printer-data",w),window.removeEventListener("refresh-compatible-products",w)}},[]);const ne={},g=[];Ne.forEach(w=>{let O=null,le=null;if(w.department_location_id&&typeof w.department_location_id=="object"){const q=w.department_location_id;O=q.department_id,le=q.id}O&&le?(ne[O]||(ne[O]={}),ne[O][le]||(ne[O][le]=[]),ne[O][le].push(w)):g.push(w)});const p=w=>{const O=document.getElementById(`department-${w}`);O&&O.scrollIntoView({behavior:"smooth",block:"start"})},N=w=>{c(w)},se=w=>{const O=q=>[...e||[],...R,...Ne].find(fe=>fe.id===q||fe.printer_id===q),le={id:w.id,name:w.name,abbreviation:w.abbreviation||"",floor:w.floor||"",location:w.location||"",contactPerson:w.contact_person||"",description:w.description||"",locations:w.locations.map(q=>{const je=q.printers||[],fe=ne[w.id]&&ne[w.id][q.id]||[],u=[...je,...fe.filter(x=>!je.some(v=>v.id===x.printer_id))].map(x=>x&&typeof x=="object"&&x.name?x:x&&typeof x=="object"&&x.printer?{...x,name:x.printer.name||x.printer.model||x.printer.id||"Unknown Printer"}:O(x)||{id:x,name:"Unknown Printer"});return{id:q.id,name:q.name,floor:q.floor||"",officeName:q.office_name||"",description:q.description||"",contactPerson:q.contact_person||"",contactNumber:q.contact_number||"",abbreviation:q.abbreviation||"",printers:u}})};o(le),n(!0)},re=w=>{y(w),w.locations&&w.locations.length>0?B(!0):B(!1),j(!0)},U=async()=>{if(z)try{await Dt.deleteDepartment(z.id),pe({title:"Department Deleted",description:"The department has been deleted successfully."}),j(!1),y(null),xe()}catch{pe({title:"Error",description:"Failed to delete department.",variant:"destructive"}),j(!1),y(null)}},W=()=>{o(null),n(!1),c(null),f(null),A(null),k(!1)},xe=()=>{console.log("🔄 AdminDashboardClientDepartments: Refreshing all data..."),F(),Y(),we(),ee()};if(h.useMemo(()=>S.reduce((w,O)=>w+O.locations.length,0),[S]),h.useMemo(()=>S.reduce((w,O)=>w+O.locations.reduce((le,q)=>le+(q.printer_count||0),0),0),[S]),e&&e.length>0){const w={};return e.forEach(O=>{const le=O.department_id||"unknown",q=O.location_id||"unknown";w[le]||(w[le]={departmentName:O.department_name||"",locations:{}}),w[le].locations[q]||(w[le].locations[q]={locationName:O.location_name||"",printers:[]}),w[le].locations[q].printers.push(O)}),t.jsxs("div",{className:"space-y-3",children:[Object.entries(w).map(([O,le])=>t.jsxs("div",{className:"border rounded-lg p-3 bg-white shadow-sm",children:[t.jsxs("h3",{className:"font-medium text-sm text-gray-900 mb-2 flex items-center gap-2",children:[t.jsx(js,{className:"h-4 w-4 text-blue-500"}),le.departmentName||"Department"]}),Object.entries(le.locations).map(([q,je])=>t.jsxs("div",{className:"space-y-2",children:[je.printers.map(fe=>t.jsx(Ct,{printer:fe,onManage:()=>{},clientId:s,departmentName:le.departmentName,locationName:je.locationName},fe.id)),ne[O]&&ne[O][q]&&ne[O][q].map(fe=>{var be,u;return t.jsx(Ct,{printer:{...fe,id:fe.printer_id,name:((be=fe.printer)==null?void 0:be.name)||"Unknown Printer",model:(u=fe.printer)==null?void 0:u.model,status:fe.status,department_name:le.departmentName,location_name:je.locationName},onManage:()=>N(fe),clientId:s,departmentName:le.departmentName,locationName:je.locationName},fe.id)})]},q))]},O)),g.length>0&&t.jsxs("div",{className:"border rounded-lg p-3 bg-white shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(vt,{className:"h-4 w-4 text-gray-400"}),t.jsx("h3",{className:"font-medium text-sm text-gray-900",children:"Inactive (No Department)"}),t.jsxs(Le,{variant:"secondary",className:"text-xs",children:[g.length," printer",g.length!==1?"s":""]})]}),t.jsx("div",{className:"space-y-2",children:g.map(O=>{var le,q;return t.jsx(Ct,{printer:{...O,id:O.printer_id,name:((le=O.printer)==null?void 0:le.name)||"Unknown Printer",model:(q=O.printer)==null?void 0:q.model,status:O.status,department_name:"Inactive",location_name:""},onManage:()=>N(O),clientId:s,departmentName:"Inactive",locationName:""},O.id)})})]})]})}return K||$||ue?t.jsx(fs,{message:"Loading departments"}):t.jsxs("div",{className:"space-y-3 pb-20",children:[" ",t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[S.length>1&&t.jsxs(Re,{onValueChange:p,children:[t.jsx($e,{className:"h-10 text-sm flex-1 max-w-[200px]",children:t.jsx(Ze,{placeholder:"Jump to department"})}),t.jsx(qe,{children:S.map(w=>t.jsx(De,{value:w.id,className:"text-sm",children:w.name},w.id))})]}),!ye&&t.jsx("div",{className:"flex gap-2",children:t.jsxs(ce,{onClick:()=>n(!0),size:"sm",variant:"outline",className:"h-10 px-3 text-xs whitespace-nowrap touch-target",children:[t.jsx(Et,{className:"w-3 h-3 mr-1"}),"Add Department"]})})]}),S.map(w=>t.jsxs("div",{className:"border rounded-lg p-3 bg-white shadow-sm",id:`department-${w.id}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("h3",{className:"font-medium text-sm text-gray-900 flex items-center gap-2",children:[t.jsx(js,{className:"h-4 w-4 text-blue-500"}),w.name]}),!ye&&t.jsxs(Ha,{children:[t.jsx(Ka,{asChild:!0,children:t.jsx(ce,{variant:"ghost",size:"icon",className:"h-8 w-8",children:t.jsx(ln,{className:"h-4 w-4"})})}),t.jsxs(Ya,{align:"end",className:"w-48",children:[t.jsxs(wr,{onClick:()=>se(w),children:[t.jsx(bs,{className:"h-4 w-4 mr-2"}),"Edit Department"]}),t.jsxs(wr,{onClick:()=>re(w),className:"text-red-600",children:[t.jsx(nr,{className:"h-4 w-4 mr-2"}),"Delete Department"]})]})]})]}),w.locations.map(O=>{const le=O.printers||[],q=ne[w.id]&&ne[w.id][O.id]||[],je=[...le,...q.filter(fe=>!le.some(be=>be.id===fe.printer_id))];return t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"font-semibold text-xs text-blue-700 mb-1",children:O.name}),je.length>0?je.map(fe=>{var be,u;return t.jsx(Ct,{printer:fe.status==="inactive"?{...fe,id:fe.printer_id,assignment_id:fe.id,name:((be=fe.printer)==null?void 0:be.name)||"Unknown Printer",model:(u=fe.printer)==null?void 0:u.model,status:fe.status,department_name:w.name,location_name:O.name}:{...fe,assignment_id:fe.id},onManage:()=>{c(fe),H(w.name),J(O.name)},clientId:s,departmentName:w.name,locationName:O.name},fe.id)}):t.jsx("p",{className:"text-xs text-gray-400 italic py-1 text-center",children:"No printers assigned"})]},O.id)})]},w.id)),R.length>0&&t.jsxs("div",{className:"border rounded-lg p-3 bg-white shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(vt,{className:"h-4 w-4 text-orange-500"}),t.jsx("h3",{className:"font-medium text-sm text-gray-900",children:"Available for Deployment"}),t.jsxs(Le,{variant:"secondary",className:"text-xs",children:[R.length," printer",R.length!==1?"s":""]})]}),t.jsx("div",{className:"space-y-2",children:R.map(w=>{var O,le;return t.jsx(Ct,{printer:{...w,id:w.printer_id,name:((O=w.printer)==null?void 0:O.name)||"Unknown Printer",model:(le=w.printer)==null?void 0:le.model,status:w.status,department_name:"Undeployed",location_name:"Available for Deployment",assignment_id:w.id},onManage:()=>N(w),clientId:s,departmentName:"Available for Deployment",locationName:"",showUndeployedStatus:!0},w.id)})})]}),g.length>0&&t.jsxs("div",{className:"border rounded-lg p-3 bg-white shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(vt,{className:"h-4 w-4 text-gray-400"}),t.jsx("h3",{className:"font-medium text-sm text-gray-900",children:"Inactive (No Department)"}),t.jsxs(Le,{variant:"secondary",className:"text-xs",children:[g.length," printer",g.length!==1?"s":""]})]}),t.jsx("div",{className:"space-y-2",children:g.map(w=>{var O,le;return t.jsx(Ct,{printer:{...w,id:w.printer_id,name:((O=w.printer)==null?void 0:O.name)||"Unknown Printer",model:(le=w.printer)==null?void 0:le.model,status:w.status,department_name:"Inactive",location_name:"",assignment_id:w.id},onManage:()=>N(w),clientId:s,departmentName:"Inactive",locationName:""},w.id)})})]}),t.jsx(un,{isOpen:i,onClose:W,clientId:s,department:l,onDepartmentSaved:xe}),m&&t.jsx(Kr,{isOpen:!!m,onClose:()=>{c(null),H(""),J("")},assignment:m,departments:S,currentDepartmentName:E,currentLocationName:X}),t.jsx(Yr,{isOpen:M,onClose:()=>k(!1),location:C,locations:(d==null?void 0:d.locations)||[],departmentBaseName:(d==null?void 0:d.name)||"",clientId:s,onPrinterAssigned:()=>{k(!1),f(null),A(null),xe()}}),t.jsx(zt,{open:b,onOpenChange:()=>j(!1),children:t.jsxs(Wt,{children:[t.jsx(Ht,{children:t.jsx(Kt,{children:"Delete Department"})}),z&&z.locations&&z.locations.length>0?z.locations.filter(O=>Array.isArray(O.printers)&&O.printers.length>0).length>0?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-sm text-red-600 mb-2",children:"⚠️ You cannot delete this department because some locations have printer assignments."}),t.jsxs("div",{className:"mb-2",children:[t.jsxs("div",{className:"flex font-semibold text-xs text-gray-700 border-b pb-1 mb-1",children:[t.jsx("div",{className:"w-2/3",children:"Location"}),t.jsx("div",{className:"w-1/3",children:"Printers"})]}),z.locations.map(O=>t.jsxs("div",{className:"flex text-xs py-1 border-b last:border-b-0",children:[t.jsx("div",{className:"w-2/3",children:O.name||t.jsx("span",{className:"italic text-gray-400",children:"Unnamed"})}),t.jsx("div",{className:"w-1/3",children:O.printers?O.printers.length:0})]},O.id))]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-sm text-yellow-700 mb-2",children:"These locations will also be deleted:"}),t.jsxs("div",{className:"mb-2",children:[t.jsxs("div",{className:"flex font-semibold text-xs text-gray-700 border-b pb-1 mb-1",children:[t.jsx("div",{className:"w-2/3",children:"Location"}),t.jsx("div",{className:"w-1/3",children:"Printers"})]}),z.locations.map(O=>t.jsxs("div",{className:"flex text-xs py-1 border-b last:border-b-0",children:[t.jsx("div",{className:"w-2/3",children:O.name||t.jsx("span",{className:"italic text-gray-400",children:"Unnamed"})}),t.jsx("div",{className:"w-1/3",children:O.printers?O.printers.length:0})]},O.id))]}),t.jsx("div",{className:"text-sm text-gray-700 mb-2",children:"Are you sure you want to delete this department? This action cannot be undone."})]}):t.jsx("div",{className:"text-sm text-gray-700 mb-2",children:"Are you sure you want to delete this department? This action cannot be undone."}),t.jsxs(Yt,{children:[t.jsx(Jt,{onClick:()=>j(!1),children:"Cancel"}),z&&z.locations&&z.locations.length>0&&!z.locations.some(w=>Array.isArray(w.printers)&&w.printers.length>0)&&t.jsx(Qt,{onClick:U,className:"bg-red-600 hover:bg-red-700 text-white",children:"Yes, Delete"}),z&&(!z.locations||z.locations.length===0)&&t.jsx(Qt,{onClick:U,className:"bg-red-600 hover:bg-red-700 text-white",children:"Yes, Delete"})]})]})})]})};var ps=s=>s.type==="checkbox",yt=s=>s instanceof Date,Fe=s=>s==null;const Jr=s=>typeof s=="object";var Pe=s=>!Fe(s)&&!Array.isArray(s)&&Jr(s)&&!yt(s),Qr=s=>Pe(s)&&s.target?ps(s.target)?s.target.checked:s.target.value:s,fn=s=>s.substring(0,s.search(/\.\d+(\.|$)/))||s,Gr=(s,e)=>s.has(fn(e)),pn=s=>{const e=s.constructor&&s.constructor.prototype;return Pe(e)&&e.hasOwnProperty("isPrototypeOf")},dr=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ie(s){let e;const r=Array.isArray(s);if(s instanceof Date)e=new Date(s);else if(s instanceof Set)e=new Set(s);else if(!(dr&&(s instanceof Blob||s instanceof FileList))&&(r||Pe(s)))if(e=r?[]:{},!r&&!pn(s))e=s;else for(const a in s)s.hasOwnProperty(a)&&(e[a]=Ie(s[a]));else return s;return e}var Vs=s=>Array.isArray(s)?s.filter(Boolean):[],Se=s=>s===void 0,L=(s,e,r)=>{if(!e||!Pe(s))return r;const a=Vs(e.split(/[,[\].]+?/)).reduce((i,n)=>Fe(i)?i:i[n],s);return Se(a)||a===s?Se(s[e])?r:s[e]:a},Ye=s=>typeof s=="boolean",ur=s=>/^\w*$/.test(s),Xr=s=>Vs(s.replace(/["|']|\]/g,"").split(/\.|\[/)),_e=(s,e,r)=>{let a=-1;const i=ur(e)?[e]:Xr(e),n=i.length,l=n-1;for(;++a<n;){const o=i[a];let m=r;if(a!==l){const c=s[o];m=Pe(c)||Array.isArray(c)?c:isNaN(+i[a+1])?{}:[]}if(o==="__proto__")return;s[o]=m,s=s[o]}return s};const ws={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Je={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ot={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},ea=ve.createContext(null),Rs=()=>ve.useContext(ea),xn=s=>{const{children:e,...r}=s;return ve.createElement(ea.Provider,{value:r},e)};var ta=(s,e,r,a=!0)=>{const i={defaultValues:e._defaultValues};for(const n in s)Object.defineProperty(i,n,{get:()=>{const l=n;return e._proxyFormState[l]!==Je.all&&(e._proxyFormState[l]=!a||Je.all),r&&(r[l]=!0),s[l]}});return i},Ve=s=>Pe(s)&&!Object.keys(s).length,sa=(s,e,r,a)=>{r(s);const{name:i,...n}=s;return Ve(n)||Object.keys(n).length>=Object.keys(e).length||Object.keys(n).find(l=>e[l]===(!a||Je.all))},Ut=s=>Array.isArray(s)?s:[s],ra=(s,e,r)=>!s||!e||s===e||Ut(s).some(a=>a&&(r?a===e:a.startsWith(e)||e.startsWith(a)));function mr(s){const e=ve.useRef(s);e.current=s,ve.useEffect(()=>{const r=!s.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{r&&r.unsubscribe()}},[s.disabled])}function gn(s){const e=Rs(),{control:r=e.control,disabled:a,name:i,exact:n}=s||{},[l,o]=ve.useState(r._formState),m=ve.useRef(!0),c=ve.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),d=ve.useRef(i);return d.current=i,mr({disabled:a,next:f=>m.current&&ra(d.current,f.name,n)&&sa(f,c.current,r._updateFormState)&&o({...r._formState,...f}),subject:r._subjects.state}),ve.useEffect(()=>(m.current=!0,c.current.isValid&&r._updateValid(!0),()=>{m.current=!1}),[r]),ta(l,r,c.current,!1)}var tt=s=>typeof s=="string",aa=(s,e,r,a,i)=>tt(s)?(a&&e.watch.add(s),L(r,s,i)):Array.isArray(s)?s.map(n=>(a&&e.watch.add(n),L(r,n))):(a&&(e.watchAll=!0),r);function yn(s){const e=Rs(),{control:r=e.control,name:a,defaultValue:i,disabled:n,exact:l}=s||{},o=ve.useRef(a);o.current=a,mr({disabled:n,subject:r._subjects.values,next:d=>{ra(o.current,d.name,l)&&c(Ie(aa(o.current,r._names,d.values||r._formValues,!1,i)))}});const[m,c]=ve.useState(r._getWatch(a,i));return ve.useEffect(()=>r._removeUnmounted()),m}function vn(s){const e=Rs(),{name:r,disabled:a,control:i=e.control,shouldUnregister:n}=s,l=Gr(i._names.array,r),o=yn({control:i,name:r,defaultValue:L(i._formValues,r,L(i._defaultValues,r,s.defaultValue)),exact:!0}),m=gn({control:i,name:r,exact:!0}),c=ve.useRef(i.register(r,{...s.rules,value:o,...Ye(s.disabled)?{disabled:s.disabled}:{}}));return ve.useEffect(()=>{const d=i._options.shouldUnregister||n,f=(C,A)=>{const M=L(i._fields,C);M&&M._f&&(M._f.mount=A)};if(f(r,!0),d){const C=Ie(L(i._options.defaultValues,r));_e(i._defaultValues,r,C),Se(L(i._formValues,r))&&_e(i._formValues,r,C)}return()=>{(l?d&&!i._state.action:d)?i.unregister(r):f(r,!1)}},[r,i,l,n]),ve.useEffect(()=>{L(i._fields,r)&&i._updateDisabledField({disabled:a,fields:i._fields,name:r,value:L(i._fields,r)._f.value})},[a,r,i]),{field:{name:r,value:o,...Ye(a)||m.disabled?{disabled:m.disabled||a}:{},onChange:ve.useCallback(d=>c.current.onChange({target:{value:Qr(d),name:r},type:ws.CHANGE}),[r]),onBlur:ve.useCallback(()=>c.current.onBlur({target:{value:L(i._formValues,r),name:r},type:ws.BLUR}),[r,i]),ref:ve.useCallback(d=>{const f=L(i._fields,r);f&&d&&(f._f.ref={focus:()=>d.focus(),select:()=>d.select(),setCustomValidity:C=>d.setCustomValidity(C),reportValidity:()=>d.reportValidity()})},[i._fields,r])},formState:m,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!L(m.errors,r)},isDirty:{enumerable:!0,get:()=>!!L(m.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!L(m.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!L(m.validatingFields,r)},error:{enumerable:!0,get:()=>L(m.errors,r)}})}}const bn=s=>s.render(vn(s));var na=(s,e,r,a,i)=>e?{...r[s],types:{...r[s]&&r[s].types?r[s].types:{},[a]:i||!0}}:{},Sr=s=>({isOnSubmit:!s||s===Je.onSubmit,isOnBlur:s===Je.onBlur,isOnChange:s===Je.onChange,isOnAll:s===Je.all,isOnTouch:s===Je.onTouched}),Pr=(s,e,r)=>!r&&(e.watchAll||e.watch.has(s)||[...e.watch].some(a=>s.startsWith(a)&&/^\.\w+/.test(s.slice(a.length))));const Bt=(s,e,r,a)=>{for(const i of r||Object.keys(s)){const n=L(s,i);if(n){const{_f:l,...o}=n;if(l){if(l.refs&&l.refs[0]&&e(l.refs[0],i)&&!a)return!0;if(l.ref&&e(l.ref,l.name)&&!a)return!0;if(Bt(o,e))break}else if(Pe(o)&&Bt(o,e))break}}};var _n=(s,e,r)=>{const a=Ut(L(s,r));return _e(a,"root",e[r]),_e(s,r,a),s},hr=s=>s.type==="file",dt=s=>typeof s=="function",Ns=s=>{if(!dr)return!1;const e=s?s.ownerDocument:0;return s instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},vs=s=>tt(s),fr=s=>s.type==="radio",Cs=s=>s instanceof RegExp;const Dr={value:!1,isValid:!1},Ar={value:!0,isValid:!0};var ia=s=>{if(Array.isArray(s)){if(s.length>1){const e=s.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:e,isValid:!!e.length}}return s[0].checked&&!s[0].disabled?s[0].attributes&&!Se(s[0].attributes.value)?Se(s[0].value)||s[0].value===""?Ar:{value:s[0].value,isValid:!0}:Ar:Dr}return Dr};const Er={isValid:!1,value:null};var la=s=>Array.isArray(s)?s.reduce((e,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:e,Er):Er;function Tr(s,e,r="validate"){if(vs(s)||Array.isArray(s)&&s.every(vs)||Ye(s)&&!s)return{type:r,message:vs(s)?s:"",ref:e}}var kt=s=>Pe(s)&&!Cs(s)?s:{value:s,message:""},Lr=async(s,e,r,a,i)=>{const{ref:n,refs:l,required:o,maxLength:m,minLength:c,min:d,max:f,pattern:C,validate:A,name:M,valueAsNumber:k,mount:b,disabled:j}=s._f,_=L(e,M);if(!b||j)return{};const B=l?l[0]:n,z=S=>{a&&B.reportValidity&&(B.setCustomValidity(Ye(S)?"":S||""),B.reportValidity())},y={},E=fr(n),H=ps(n),X=E||H,J=(k||hr(n))&&Se(n.value)&&Se(_)||Ns(n)&&n.value===""||_===""||Array.isArray(_)&&!_.length,pe=na.bind(null,M,r,y),ye=(S,K,F,R=ot.maxLength,$=ot.minLength)=>{const Y=S?K:F;y[M]={type:S?R:$,message:Y,ref:n,...pe(S?R:$,Y)}};if(i?!Array.isArray(_)||!_.length:o&&(!X&&(J||Fe(_))||Ye(_)&&!_||H&&!ia(l).isValid||E&&!la(l).isValid)){const{value:S,message:K}=vs(o)?{value:!!o,message:o}:kt(o);if(S&&(y[M]={type:ot.required,message:K,ref:B,...pe(ot.required,K)},!r))return z(K),y}if(!J&&(!Fe(d)||!Fe(f))){let S,K;const F=kt(f),R=kt(d);if(!Fe(_)&&!isNaN(_)){const $=n.valueAsNumber||_&&+_;Fe(F.value)||(S=$>F.value),Fe(R.value)||(K=$<R.value)}else{const $=n.valueAsDate||new Date(_),Y=we=>new Date(new Date().toDateString()+" "+we),Ne=n.type=="time",ue=n.type=="week";tt(F.value)&&_&&(S=Ne?Y(_)>Y(F.value):ue?_>F.value:$>new Date(F.value)),tt(R.value)&&_&&(K=Ne?Y(_)<Y(R.value):ue?_<R.value:$<new Date(R.value))}if((S||K)&&(ye(!!S,F.message,R.message,ot.max,ot.min),!r))return z(y[M].message),y}if((m||c)&&!J&&(tt(_)||i&&Array.isArray(_))){const S=kt(m),K=kt(c),F=!Fe(S.value)&&_.length>+S.value,R=!Fe(K.value)&&_.length<+K.value;if((F||R)&&(ye(F,S.message,K.message),!r))return z(y[M].message),y}if(C&&!J&&tt(_)){const{value:S,message:K}=kt(C);if(Cs(S)&&!_.match(S)&&(y[M]={type:ot.pattern,message:K,ref:n,...pe(ot.pattern,K)},!r))return z(K),y}if(A){if(dt(A)){const S=await A(_,e),K=Tr(S,B);if(K&&(y[M]={...K,...pe(ot.validate,K.message)},!r))return z(K.message),y}else if(Pe(A)){let S={};for(const K in A){if(!Ve(S)&&!r)break;const F=Tr(await A[K](_,e),B,K);F&&(S={...F,...pe(K,F.message)},z(F.message),r&&(y[M]=S))}if(!Ve(S)&&(y[M]={ref:B,...S},!r))return y}}return z(!0),y};function jn(s,e){const r=e.slice(0,-1).length;let a=0;for(;a<r;)s=Se(s)?a++:s[e[a++]];return s}function wn(s){for(const e in s)if(s.hasOwnProperty(e)&&!Se(s[e]))return!1;return!0}function Ae(s,e){const r=Array.isArray(e)?e:ur(e)?[e]:Xr(e),a=r.length===1?s:jn(s,r),i=r.length-1,n=r[i];return a&&delete a[n],i!==0&&(Pe(a)&&Ve(a)||Array.isArray(a)&&wn(a))&&Ae(s,r.slice(0,-1)),s}var Us=()=>{let s=[];return{get observers(){return s},next:i=>{for(const n of s)n.next&&n.next(i)},subscribe:i=>(s.push(i),{unsubscribe:()=>{s=s.filter(n=>n!==i)}}),unsubscribe:()=>{s=[]}}},Js=s=>Fe(s)||!Jr(s);function mt(s,e){if(Js(s)||Js(e))return s===e;if(yt(s)&&yt(e))return s.getTime()===e.getTime();const r=Object.keys(s),a=Object.keys(e);if(r.length!==a.length)return!1;for(const i of r){const n=s[i];if(!a.includes(i))return!1;if(i!=="ref"){const l=e[i];if(yt(n)&&yt(l)||Pe(n)&&Pe(l)||Array.isArray(n)&&Array.isArray(l)?!mt(n,l):n!==l)return!1}}return!0}var oa=s=>s.type==="select-multiple",Nn=s=>fr(s)||ps(s),Bs=s=>Ns(s)&&s.isConnected,ca=s=>{for(const e in s)if(dt(s[e]))return!0;return!1};function ks(s,e={}){const r=Array.isArray(s);if(Pe(s)||r)for(const a in s)Array.isArray(s[a])||Pe(s[a])&&!ca(s[a])?(e[a]=Array.isArray(s[a])?[]:{},ks(s[a],e[a])):Fe(s[a])||(e[a]=!0);return e}function da(s,e,r){const a=Array.isArray(s);if(Pe(s)||a)for(const i in s)Array.isArray(s[i])||Pe(s[i])&&!ca(s[i])?Se(e)||Js(r[i])?r[i]=Array.isArray(s[i])?ks(s[i],[]):{...ks(s[i])}:da(s[i],Fe(e)?{}:e[i],r[i]):r[i]=!mt(s[i],e[i]);return r}var Vt=(s,e)=>da(s,e,ks(e)),ua=(s,{valueAsNumber:e,valueAsDate:r,setValueAs:a})=>Se(s)?s:e?s===""?NaN:s&&+s:r&&tt(s)?new Date(s):a?a(s):s;function zs(s){const e=s.ref;if(!(s.refs?s.refs.every(r=>r.disabled):e.disabled))return hr(e)?e.files:fr(e)?la(s.refs).value:oa(e)?[...e.selectedOptions].map(({value:r})=>r):ps(e)?ia(s.refs).value:ua(Se(e.value)?s.ref.value:e.value,s)}var Cn=(s,e,r,a)=>{const i={};for(const n of s){const l=L(e,n);l&&_e(i,n,l._f)}return{criteriaMode:r,names:[...s],fields:i,shouldUseNativeValidation:a}},Rt=s=>Se(s)?s:Cs(s)?s.source:Pe(s)?Cs(s.value)?s.value.source:s.value:s;const Mr="AsyncFunction";var kn=s=>(!s||!s.validate)&&!!(dt(s.validate)&&s.validate.constructor.name===Mr||Pe(s.validate)&&Object.values(s.validate).find(e=>e.constructor.name===Mr)),Sn=s=>s.mount&&(s.required||s.min||s.max||s.maxLength||s.minLength||s.pattern||s.validate);function Fr(s,e,r){const a=L(s,r);if(a||ur(r))return{error:a,name:r};const i=r.split(".");for(;i.length;){const n=i.join("."),l=L(e,n),o=L(s,n);if(l&&!Array.isArray(l)&&r!==n)return{name:r};if(o&&o.type)return{name:n,error:o};i.pop()}return{name:r}}var Pn=(s,e,r,a,i)=>i.isOnAll?!1:!r&&i.isOnTouch?!(e||s):(r?a.isOnBlur:i.isOnBlur)?!s:(r?a.isOnChange:i.isOnChange)?s:!0,Dn=(s,e)=>!Vs(L(s,e)).length&&Ae(s,e);const An={mode:Je.onSubmit,reValidateMode:Je.onChange,shouldFocusError:!0};function En(s={}){let e={...An,...s},r={submitCount:0,isDirty:!1,isLoading:dt(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},a={},i=Pe(e.defaultValues)||Pe(e.values)?Ie(e.defaultValues||e.values)||{}:{},n=e.shouldUnregister?{}:Ie(i),l={action:!1,mount:!1,watch:!1},o={mount:new Set,unMount:new Set,array:new Set,watch:new Set},m,c=0;const d={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},f={values:Us(),array:Us(),state:Us()},C=Sr(e.mode),A=Sr(e.reValidateMode),M=e.criteriaMode===Je.all,k=u=>x=>{clearTimeout(c),c=setTimeout(u,x)},b=async u=>{if(!s.disabled&&(d.isValid||u)){const x=e.resolver?Ve((await X()).errors):await pe(a,!0);x!==r.isValid&&f.state.next({isValid:x})}},j=(u,x)=>{!s.disabled&&(d.isValidating||d.validatingFields)&&((u||Array.from(o.mount)).forEach(v=>{v&&(x?_e(r.validatingFields,v,x):Ae(r.validatingFields,v))}),f.state.next({validatingFields:r.validatingFields,isValidating:!Ve(r.validatingFields)}))},_=(u,x=[],v,I,T=!0,D=!0)=>{if(I&&v&&!s.disabled){if(l.action=!0,D&&Array.isArray(L(a,u))){const te=v(L(a,u),I.argA,I.argB);T&&_e(a,u,te)}if(D&&Array.isArray(L(r.errors,u))){const te=v(L(r.errors,u),I.argA,I.argB);T&&_e(r.errors,u,te),Dn(r.errors,u)}if(d.touchedFields&&D&&Array.isArray(L(r.touchedFields,u))){const te=v(L(r.touchedFields,u),I.argA,I.argB);T&&_e(r.touchedFields,u,te)}d.dirtyFields&&(r.dirtyFields=Vt(i,n)),f.state.next({name:u,isDirty:S(u,x),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else _e(n,u,x)},B=(u,x)=>{_e(r.errors,u,x),f.state.next({errors:r.errors})},z=u=>{r.errors=u,f.state.next({errors:r.errors,isValid:!1})},y=(u,x,v,I)=>{const T=L(a,u);if(T){const D=L(n,u,Se(v)?L(i,u):v);Se(D)||I&&I.defaultChecked||x?_e(n,u,x?D:zs(T._f)):R(u,D),l.mount&&b()}},E=(u,x,v,I,T)=>{let D=!1,te=!1;const me={name:u};if(!s.disabled){const oe=!!(L(a,u)&&L(a,u)._f&&L(a,u)._f.disabled);if(!v||I){d.isDirty&&(te=r.isDirty,r.isDirty=me.isDirty=S(),D=te!==me.isDirty);const Ce=oe||mt(L(i,u),x);te=!!(!oe&&L(r.dirtyFields,u)),Ce||oe?Ae(r.dirtyFields,u):_e(r.dirtyFields,u,!0),me.dirtyFields=r.dirtyFields,D=D||d.dirtyFields&&te!==!Ce}if(v){const Ce=L(r.touchedFields,u);Ce||(_e(r.touchedFields,u,v),me.touchedFields=r.touchedFields,D=D||d.touchedFields&&Ce!==v)}D&&T&&f.state.next(me)}return D?me:{}},H=(u,x,v,I)=>{const T=L(r.errors,u),D=d.isValid&&Ye(x)&&r.isValid!==x;if(s.delayError&&v?(m=k(()=>B(u,v)),m(s.delayError)):(clearTimeout(c),m=null,v?_e(r.errors,u,v):Ae(r.errors,u)),(v?!mt(T,v):T)||!Ve(I)||D){const te={...I,...D&&Ye(x)?{isValid:x}:{},errors:r.errors,name:u};r={...r,...te},f.state.next(te)}},X=async u=>{j(u,!0);const x=await e.resolver(n,e.context,Cn(u||o.mount,a,e.criteriaMode,e.shouldUseNativeValidation));return j(u),x},J=async u=>{const{errors:x}=await X(u);if(u)for(const v of u){const I=L(x,v);I?_e(r.errors,v,I):Ae(r.errors,v)}else r.errors=x;return x},pe=async(u,x,v={valid:!0})=>{for(const I in u){const T=u[I];if(T){const{_f:D,...te}=T;if(D){const me=o.array.has(D.name),oe=T._f&&kn(T._f);oe&&d.validatingFields&&j([I],!0);const Ce=await Lr(T,n,M,e.shouldUseNativeValidation&&!x,me);if(oe&&d.validatingFields&&j([I]),Ce[D.name]&&(v.valid=!1,x))break;!x&&(L(Ce,D.name)?me?_n(r.errors,Ce,D.name):_e(r.errors,D.name,Ce[D.name]):Ae(r.errors,D.name))}!Ve(te)&&await pe(te,x,v)}}return v.valid},ye=()=>{for(const u of o.unMount){const x=L(a,u);x&&(x._f.refs?x._f.refs.every(v=>!Bs(v)):!Bs(x._f.ref))&&se(u)}o.unMount=new Set},S=(u,x)=>!s.disabled&&(u&&x&&_e(n,u,x),!mt(ee(),i)),K=(u,x,v)=>aa(u,o,{...l.mount?n:Se(x)?i:tt(u)?{[u]:x}:x},v,x),F=u=>Vs(L(l.mount?n:i,u,s.shouldUnregister?L(i,u,[]):[])),R=(u,x,v={})=>{const I=L(a,u);let T=x;if(I){const D=I._f;D&&(!D.disabled&&_e(n,u,ua(x,D)),T=Ns(D.ref)&&Fe(x)?"":x,oa(D.ref)?[...D.ref.options].forEach(te=>te.selected=T.includes(te.value)):D.refs?ps(D.ref)?D.refs.length>1?D.refs.forEach(te=>(!te.defaultChecked||!te.disabled)&&(te.checked=Array.isArray(T)?!!T.find(me=>me===te.value):T===te.value)):D.refs[0]&&(D.refs[0].checked=!!T):D.refs.forEach(te=>te.checked=te.value===T):hr(D.ref)?D.ref.value="":(D.ref.value=T,D.ref.type||f.values.next({name:u,values:{...n}})))}(v.shouldDirty||v.shouldTouch)&&E(u,T,v.shouldTouch,v.shouldDirty,!0),v.shouldValidate&&we(u)},$=(u,x,v)=>{for(const I in x){const T=x[I],D=`${u}.${I}`,te=L(a,D);(o.array.has(u)||Pe(T)||te&&!te._f)&&!yt(T)?$(D,T,v):R(D,T,v)}},Y=(u,x,v={})=>{const I=L(a,u),T=o.array.has(u),D=Ie(x);_e(n,u,D),T?(f.array.next({name:u,values:{...n}}),(d.isDirty||d.dirtyFields)&&v.shouldDirty&&f.state.next({name:u,dirtyFields:Vt(i,n),isDirty:S(u,D)})):I&&!I._f&&!Fe(D)?$(u,D,v):R(u,D,v),Pr(u,o)&&f.state.next({...r}),f.values.next({name:l.mount?u:void 0,values:{...n}})},Ne=async u=>{l.mount=!0;const x=u.target;let v=x.name,I=!0;const T=L(a,v),D=()=>x.type?zs(T._f):Qr(u),te=me=>{I=Number.isNaN(me)||yt(me)&&isNaN(me.getTime())||mt(me,L(n,v,me))};if(T){let me,oe;const Ce=D(),et=u.type===ws.BLUR||u.type===ws.FOCUS_OUT,gs=!Sn(T._f)&&!e.resolver&&!L(r.errors,v)&&!T._f.deps||Pn(et,L(r.touchedFields,v),r.isSubmitted,A,C),wt=Pr(v,o,et);_e(n,v,Ce),et?(T._f.onBlur&&T._f.onBlur(u),m&&m(0)):T._f.onChange&&T._f.onChange(u);const Nt=E(v,Ce,et,!1),ys=!Ve(Nt)||wt;if(!et&&f.values.next({name:v,type:u.type,values:{...n}}),gs)return d.isValid&&(s.mode==="onBlur"?et&&b():b()),ys&&f.state.next({name:v,...wt?{}:Nt});if(!et&&wt&&f.state.next({...r}),e.resolver){const{errors:It}=await X([v]);if(te(Ce),I){const ka=Fr(r.errors,a,v),xr=Fr(It,a,ka.name||v);me=xr.error,v=xr.name,oe=Ve(It)}}else j([v],!0),me=(await Lr(T,n,M,e.shouldUseNativeValidation))[v],j([v]),te(Ce),I&&(me?oe=!1:d.isValid&&(oe=await pe(a,!0)));I&&(T._f.deps&&we(T._f.deps),H(v,oe,me,Nt))}},ue=(u,x)=>{if(L(r.errors,x)&&u.focus)return u.focus(),1},we=async(u,x={})=>{let v,I;const T=Ut(u);if(e.resolver){const D=await J(Se(u)?u:T);v=Ve(D),I=u?!T.some(te=>L(D,te)):v}else u?(I=(await Promise.all(T.map(async D=>{const te=L(a,D);return await pe(te&&te._f?{[D]:te}:te)}))).every(Boolean),!(!I&&!r.isValid)&&b()):I=v=await pe(a);return f.state.next({...!tt(u)||d.isValid&&v!==r.isValid?{}:{name:u},...e.resolver||!u?{isValid:v}:{},errors:r.errors}),x.shouldFocus&&!I&&Bt(a,ue,u?T:o.mount),I},ee=u=>{const x={...l.mount?n:i};return Se(u)?x:tt(u)?L(x,u):u.map(v=>L(x,v))},ne=(u,x)=>({invalid:!!L((x||r).errors,u),isDirty:!!L((x||r).dirtyFields,u),error:L((x||r).errors,u),isValidating:!!L(r.validatingFields,u),isTouched:!!L((x||r).touchedFields,u)}),g=u=>{u&&Ut(u).forEach(x=>Ae(r.errors,x)),f.state.next({errors:u?r.errors:{}})},p=(u,x,v)=>{const I=(L(a,u,{_f:{}})._f||{}).ref,T=L(r.errors,u)||{},{ref:D,message:te,type:me,...oe}=T;_e(r.errors,u,{...oe,...x,ref:I}),f.state.next({name:u,errors:r.errors,isValid:!1}),v&&v.shouldFocus&&I&&I.focus&&I.focus()},N=(u,x)=>dt(u)?f.values.subscribe({next:v=>u(K(void 0,x),v)}):K(u,x,!0),se=(u,x={})=>{for(const v of u?Ut(u):o.mount)o.mount.delete(v),o.array.delete(v),x.keepValue||(Ae(a,v),Ae(n,v)),!x.keepError&&Ae(r.errors,v),!x.keepDirty&&Ae(r.dirtyFields,v),!x.keepTouched&&Ae(r.touchedFields,v),!x.keepIsValidating&&Ae(r.validatingFields,v),!e.shouldUnregister&&!x.keepDefaultValue&&Ae(i,v);f.values.next({values:{...n}}),f.state.next({...r,...x.keepDirty?{isDirty:S()}:{}}),!x.keepIsValid&&b()},re=({disabled:u,name:x,field:v,fields:I,value:T})=>{if(Ye(u)&&l.mount||u){const D=u?void 0:Se(T)?zs(v?v._f:L(I,x)._f):T;_e(n,x,D),E(x,D,!1,!1,!0)}},U=(u,x={})=>{let v=L(a,u);const I=Ye(x.disabled)||Ye(s.disabled);return _e(a,u,{...v||{},_f:{...v&&v._f?v._f:{ref:{name:u}},name:u,mount:!0,...x}}),o.mount.add(u),v?re({field:v,disabled:Ye(x.disabled)?x.disabled:s.disabled,name:u,value:x.value}):y(u,!0,x.value),{...I?{disabled:x.disabled||s.disabled}:{},...e.progressive?{required:!!x.required,min:Rt(x.min),max:Rt(x.max),minLength:Rt(x.minLength),maxLength:Rt(x.maxLength),pattern:Rt(x.pattern)}:{},name:u,onChange:Ne,onBlur:Ne,ref:T=>{if(T){U(u,x),v=L(a,u);const D=Se(T.value)&&T.querySelectorAll&&T.querySelectorAll("input,select,textarea")[0]||T,te=Nn(D),me=v._f.refs||[];if(te?me.find(oe=>oe===D):D===v._f.ref)return;_e(a,u,{_f:{...v._f,...te?{refs:[...me.filter(Bs),D,...Array.isArray(L(i,u))?[{}]:[]],ref:{type:D.type,name:u}}:{ref:D}}}),y(u,!1,void 0,D)}else v=L(a,u,{}),v._f&&(v._f.mount=!1),(e.shouldUnregister||x.shouldUnregister)&&!(Gr(o.array,u)&&l.action)&&o.unMount.add(u)}}},W=()=>e.shouldFocusError&&Bt(a,ue,o.mount),xe=u=>{Ye(u)&&(f.state.next({disabled:u}),Bt(a,(x,v)=>{const I=L(a,v);I&&(x.disabled=I._f.disabled||u,Array.isArray(I._f.refs)&&I._f.refs.forEach(T=>{T.disabled=I._f.disabled||u}))},0,!1))},w=(u,x)=>async v=>{let I;v&&(v.preventDefault&&v.preventDefault(),v.persist&&v.persist());let T=Ie(n);if(f.state.next({isSubmitting:!0}),e.resolver){const{errors:D,values:te}=await X();r.errors=D,T=te}else await pe(a);if(Ae(r.errors,"root"),Ve(r.errors)){f.state.next({errors:{}});try{await u(T,v)}catch(D){I=D}}else x&&await x({...r.errors},v),W(),setTimeout(W);if(f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Ve(r.errors)&&!I,submitCount:r.submitCount+1,errors:r.errors}),I)throw I},O=(u,x={})=>{L(a,u)&&(Se(x.defaultValue)?Y(u,Ie(L(i,u))):(Y(u,x.defaultValue),_e(i,u,Ie(x.defaultValue))),x.keepTouched||Ae(r.touchedFields,u),x.keepDirty||(Ae(r.dirtyFields,u),r.isDirty=x.defaultValue?S(u,Ie(L(i,u))):S()),x.keepError||(Ae(r.errors,u),d.isValid&&b()),f.state.next({...r}))},le=(u,x={})=>{const v=u?Ie(u):i,I=Ie(v),T=Ve(u),D=T?i:I;if(x.keepDefaultValues||(i=v),!x.keepValues){if(x.keepDirtyValues){const te=new Set([...o.mount,...Object.keys(Vt(i,n))]);for(const me of Array.from(te))L(r.dirtyFields,me)?_e(D,me,L(n,me)):Y(me,L(D,me))}else{if(dr&&Se(u))for(const te of o.mount){const me=L(a,te);if(me&&me._f){const oe=Array.isArray(me._f.refs)?me._f.refs[0]:me._f.ref;if(Ns(oe)){const Ce=oe.closest("form");if(Ce){Ce.reset();break}}}}a={}}n=s.shouldUnregister?x.keepDefaultValues?Ie(i):{}:Ie(D),f.array.next({values:{...D}}),f.values.next({values:{...D}})}o={mount:x.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},l.mount=!d.isValid||!!x.keepIsValid||!!x.keepDirtyValues,l.watch=!!s.shouldUnregister,f.state.next({submitCount:x.keepSubmitCount?r.submitCount:0,isDirty:T?!1:x.keepDirty?r.isDirty:!!(x.keepDefaultValues&&!mt(u,i)),isSubmitted:x.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:T?{}:x.keepDirtyValues?x.keepDefaultValues&&n?Vt(i,n):r.dirtyFields:x.keepDefaultValues&&u?Vt(i,u):x.keepDirty?r.dirtyFields:{},touchedFields:x.keepTouched?r.touchedFields:{},errors:x.keepErrors?r.errors:{},isSubmitSuccessful:x.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},q=(u,x)=>le(dt(u)?u(n):u,x);return{control:{register:U,unregister:se,getFieldState:ne,handleSubmit:w,setError:p,_executeSchema:X,_getWatch:K,_getDirty:S,_updateValid:b,_removeUnmounted:ye,_updateFieldArray:_,_updateDisabledField:re,_getFieldArray:F,_reset:le,_resetDefaultValues:()=>dt(e.defaultValues)&&e.defaultValues().then(u=>{q(u,e.resetOptions),f.state.next({isLoading:!1})}),_updateFormState:u=>{r={...r,...u}},_disableForm:xe,_subjects:f,_proxyFormState:d,_setErrors:z,get _fields(){return a},get _formValues(){return n},get _state(){return l},set _state(u){l=u},get _defaultValues(){return i},get _names(){return o},set _names(u){o=u},get _formState(){return r},set _formState(u){r=u},get _options(){return e},set _options(u){e={...e,...u}}},trigger:we,register:U,handleSubmit:w,watch:N,setValue:Y,getValues:ee,reset:q,resetField:O,clearErrors:g,unregister:se,setError:p,setFocus:(u,x={})=>{const v=L(a,u),I=v&&v._f;if(I){const T=I.refs?I.refs[0]:I.ref;T.focus&&(T.focus(),x.shouldSelect&&T.select())}},getFieldState:ne}}function Tn(s={}){const e=ve.useRef(),r=ve.useRef(),[a,i]=ve.useState({isDirty:!1,isValidating:!1,isLoading:dt(s.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1,defaultValues:dt(s.defaultValues)?void 0:s.defaultValues});e.current||(e.current={...En(s),formState:a});const n=e.current.control;return n._options=s,mr({subject:n._subjects.state,next:l=>{sa(l,n._proxyFormState,n._updateFormState,!0)&&i({...n._formState})}}),ve.useEffect(()=>n._disableForm(s.disabled),[n,s.disabled]),ve.useEffect(()=>{if(n._proxyFormState.isDirty){const l=n._getDirty();l!==a.isDirty&&n._subjects.state.next({isDirty:l})}},[n,a.isDirty]),ve.useEffect(()=>{s.values&&!mt(s.values,r.current)?(n._reset(s.values,n._options.resetOptions),r.current=s.values,i(l=>({...l}))):n._resetDefaultValues()},[s.values,n]),ve.useEffect(()=>{s.errors&&n._setErrors(s.errors)},[s.errors,n]),ve.useEffect(()=>{n._state.mount||(n._updateValid(),n._state.mount=!0),n._state.watch&&(n._state.watch=!1,n._subjects.state.next({...n._formState})),n._removeUnmounted()}),ve.useEffect(()=>{s.shouldUnregister&&n._subjects.values.next({values:n._getWatch()})},[s.shouldUnregister,n]),ve.useEffect(()=>{e.current&&(e.current.watch=e.current.watch.bind({}))},[a]),e.current.formState=ta(a,n),e.current}const Ln=xn,ma=h.createContext({}),Or=({...s})=>t.jsx(ma.Provider,{value:{name:s.name},children:t.jsx(bn,{...s})}),$s=()=>{const s=h.useContext(ma),e=h.useContext(ha),{getFieldState:r,formState:a}=Rs(),i=r(s.name,a);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:n}=e;return{id:n,name:s.name,formItemId:`${n}-form-item`,formDescriptionId:`${n}-form-item-description`,formMessageId:`${n}-form-item-message`,...i}},ha=h.createContext({}),Qs=h.forwardRef(({className:s,...e},r)=>{const a=h.useId();return t.jsx(ha.Provider,{value:{id:a},children:t.jsx("div",{ref:r,className:Ms("space-y-2",s),...e})})});Qs.displayName="FormItem";const Gs=h.forwardRef(({className:s,...e},r)=>{const{error:a,formItemId:i}=$s();return t.jsx(Te,{ref:r,className:Ms(a&&"text-destructive",s),htmlFor:i,...e})});Gs.displayName="FormLabel";const Xs=h.forwardRef(({...s},e)=>{const{error:r,formItemId:a,formDescriptionId:i,formMessageId:n}=$s();return t.jsx(Pa,{ref:e,id:a,"aria-describedby":r?`${i} ${n}`:`${i}`,"aria-invalid":!!r,...s})});Xs.displayName="FormControl";const Mn=h.forwardRef(({className:s,...e},r)=>{const{formDescriptionId:a}=$s();return t.jsx("p",{ref:r,id:a,className:Ms("text-sm text-muted-foreground",s),...e})});Mn.displayName="FormDescription";const er=h.forwardRef(({className:s,children:e,...r},a)=>{const{error:i,formMessageId:n}=$s(),l=i?String(i==null?void 0:i.message):e;return l?t.jsx("p",{ref:a,id:n,className:Ms("text-sm font-medium text-destructive",s),...r,children:l}):null});er.displayName="FormMessage";var ge;(function(s){s.assertEqual=i=>i;function e(i){}s.assertIs=e;function r(i){throw new Error}s.assertNever=r,s.arrayToEnum=i=>{const n={};for(const l of i)n[l]=l;return n},s.getValidEnumValues=i=>{const n=s.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),l={};for(const o of n)l[o]=i[o];return s.objectValues(l)},s.objectValues=i=>s.objectKeys(i).map(function(n){return i[n]}),s.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const n=[];for(const l in i)Object.prototype.hasOwnProperty.call(i,l)&&n.push(l);return n},s.find=(i,n)=>{for(const l of i)if(n(l))return l},s.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function a(i,n=" | "){return i.map(l=>typeof l=="string"?`'${l}'`:l).join(n)}s.joinValues=a,s.jsonStringifyReplacer=(i,n)=>typeof n=="bigint"?n.toString():n})(ge||(ge={}));var tr;(function(s){s.mergeShapes=(e,r)=>({...e,...r})})(tr||(tr={}));const Z=ge.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ht=s=>{switch(typeof s){case"undefined":return Z.undefined;case"string":return Z.string;case"number":return isNaN(s)?Z.nan:Z.number;case"boolean":return Z.boolean;case"function":return Z.function;case"bigint":return Z.bigint;case"symbol":return Z.symbol;case"object":return Array.isArray(s)?Z.array:s===null?Z.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?Z.promise:typeof Map<"u"&&s instanceof Map?Z.map:typeof Set<"u"&&s instanceof Set?Z.set:typeof Date<"u"&&s instanceof Date?Z.date:Z.object;default:return Z.unknown}},P=ge.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Fn=s=>JSON.stringify(s,null,2).replace(/"([^"]+)":/g,"$1:");class Ke extends Error{constructor(e){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const r=e||function(n){return n.message},a={_errors:[]},i=n=>{for(const l of n.issues)if(l.code==="invalid_union")l.unionErrors.map(i);else if(l.code==="invalid_return_type")i(l.returnTypeError);else if(l.code==="invalid_arguments")i(l.argumentsError);else if(l.path.length===0)a._errors.push(r(l));else{let o=a,m=0;for(;m<l.path.length;){const c=l.path[m];m===l.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(l))):o[c]=o[c]||{_errors:[]},o=o[c],m++}}};return i(this),a}static assert(e){if(!(e instanceof Ke))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ge.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},a=[];for(const i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):a.push(e(i));return{formErrors:a,fieldErrors:r}}get formErrors(){return this.flatten()}}Ke.create=s=>new Ke(s);const Lt=(s,e)=>{let r;switch(s.code){case P.invalid_type:s.received===Z.undefined?r="Required":r=`Expected ${s.expected}, received ${s.received}`;break;case P.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(s.expected,ge.jsonStringifyReplacer)}`;break;case P.unrecognized_keys:r=`Unrecognized key(s) in object: ${ge.joinValues(s.keys,", ")}`;break;case P.invalid_union:r="Invalid input";break;case P.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ge.joinValues(s.options)}`;break;case P.invalid_enum_value:r=`Invalid enum value. Expected ${ge.joinValues(s.options)}, received '${s.received}'`;break;case P.invalid_arguments:r="Invalid function arguments";break;case P.invalid_return_type:r="Invalid function return type";break;case P.invalid_date:r="Invalid date";break;case P.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(r=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?r=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?r=`Invalid input: must end with "${s.validation.endsWith}"`:ge.assertNever(s.validation):s.validation!=="regex"?r=`Invalid ${s.validation}`:r="Invalid";break;case P.too_small:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:r="Invalid input";break;case P.too_big:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?r=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:r="Invalid input";break;case P.custom:r="Invalid input";break;case P.invalid_intersection_types:r="Intersection results could not be merged";break;case P.not_multiple_of:r=`Number must be a multiple of ${s.multipleOf}`;break;case P.not_finite:r="Number must be finite";break;default:r=e.defaultError,ge.assertNever(s)}return{message:r}};let fa=Lt;function On(s){fa=s}function Ss(){return fa}const Ps=s=>{const{data:e,path:r,errorMaps:a,issueData:i}=s,n=[...r,...i.path||[]],l={...i,path:n};if(i.message!==void 0)return{...i,path:n,message:i.message};let o="";const m=a.filter(c=>!!c).slice().reverse();for(const c of m)o=c(l,{data:e,defaultError:o}).message;return{...i,path:n,message:o}},In=[];function V(s,e){const r=Ss(),a=Ps({issueData:e,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,r,r===Lt?void 0:Lt].filter(i=>!!i)});s.common.issues.push(a)}class Me{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const a=[];for(const i of r){if(i.status==="aborted")return ie;i.status==="dirty"&&e.dirty(),a.push(i.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,r){const a=[];for(const i of r){const n=await i.key,l=await i.value;a.push({key:n,value:l})}return Me.mergeObjectSync(e,a)}static mergeObjectSync(e,r){const a={};for(const i of r){const{key:n,value:l}=i;if(n.status==="aborted"||l.status==="aborted")return ie;n.status==="dirty"&&e.dirty(),l.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(typeof l.value<"u"||i.alwaysSet)&&(a[n.value]=l.value)}return{status:e.value,value:a}}}const ie=Object.freeze({status:"aborted"}),Pt=s=>({status:"dirty",value:s}),Oe=s=>({status:"valid",value:s}),sr=s=>s.status==="aborted",rr=s=>s.status==="dirty",Xt=s=>s.status==="valid",es=s=>typeof Promise<"u"&&s instanceof Promise;function Ds(s,e,r,a){if(typeof e=="function"?s!==e||!a:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(s)}function pa(s,e,r,a,i){if(typeof e=="function"?s!==e||!i:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,r),r}var G;(function(s){s.errToObj=e=>typeof e=="string"?{message:e}:e||{},s.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(G||(G={}));var $t,Zt;class at{constructor(e,r,a,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=a,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ir=(s,e)=>{if(Xt(e))return{success:!0,data:e.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Ke(s.common.issues);return this._error=r,this._error}}};function de(s){if(!s)return{};const{errorMap:e,invalid_type_error:r,required_error:a,description:i}=s;if(e&&(r||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(l,o)=>{var m,c;const{message:d}=s;return l.code==="invalid_enum_value"?{message:d??o.defaultError}:typeof o.data>"u"?{message:(m=d??a)!==null&&m!==void 0?m:o.defaultError}:l.code!=="invalid_type"?{message:o.defaultError}:{message:(c=d??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}class he{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return ht(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Me,ctx:{common:e.parent.common,data:e.data,parsedType:ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(es(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const a=this.safeParse(e,r);if(a.success)return a.data;throw a.error}safeParse(e,r){var a;const i={common:{issues:[],async:(a=r==null?void 0:r.async)!==null&&a!==void 0?a:!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ht(e)},n=this._parseSync({data:e,path:i.path,parent:i});return Ir(i,n)}async parseAsync(e,r){const a=await this.safeParseAsync(e,r);if(a.success)return a.data;throw a.error}async safeParseAsync(e,r){const a={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ht(e)},i=this._parse({data:e,path:a.path,parent:a}),n=await(es(i)?i:Promise.resolve(i));return Ir(a,n)}refine(e,r){const a=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,n)=>{const l=e(i),o=()=>n.addIssue({code:P.custom,...a(i)});return typeof Promise<"u"&&l instanceof Promise?l.then(m=>m?!0:(o(),!1)):l?!0:(o(),!1)})}refinement(e,r){return this._refinement((a,i)=>e(a)?!0:(i.addIssue(typeof r=="function"?r(a,i):r),!1))}_refinement(e){return new Xe({schema:this,typeName:ae.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return rt.create(this,this._def)}nullable(){return gt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ge.create(this,this._def)}promise(){return Ft.create(this,this._def)}or(e){return as.create([this,e],this._def)}and(e){return ns.create(this,e,this._def)}transform(e){return new Xe({...de(this._def),schema:this,typeName:ae.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new ds({...de(this._def),innerType:this,defaultValue:r,typeName:ae.ZodDefault})}brand(){return new pr({typeName:ae.ZodBranded,type:this,...de(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new us({...de(this._def),innerType:this,catchValue:r,typeName:ae.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return xs.create(this,e)}readonly(){return ms.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Vn=/^c[^\s-]{8,}$/i,Rn=/^[0-9a-z]+$/,$n=/^[0-9A-HJKMNP-TV-Z]{26}$/,Zn=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,qn=/^[a-z0-9_-]{21}$/i,Un=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Bn=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,zn="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Ws;const Wn=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Hn=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Kn=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,xa="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Yn=new RegExp(`^${xa}$`);function ga(s){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return s.precision?e=`${e}\\.\\d{${s.precision}}`:s.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Jn(s){return new RegExp(`^${ga(s)}$`)}function ya(s){let e=`${xa}T${ga(s)}`;const r=[];return r.push(s.local?"Z?":"Z"),s.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function Qn(s,e){return!!((e==="v4"||!e)&&Wn.test(s)||(e==="v6"||!e)&&Hn.test(s))}class Qe extends he{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Z.string){const n=this._getOrReturnCtx(e);return V(n,{code:P.invalid_type,expected:Z.string,received:n.parsedType}),ie}const a=new Me;let i;for(const n of this._def.checks)if(n.kind==="min")e.data.length<n.value&&(i=this._getOrReturnCtx(e,i),V(i,{code:P.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="max")e.data.length>n.value&&(i=this._getOrReturnCtx(e,i),V(i,{code:P.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="length"){const l=e.data.length>n.value,o=e.data.length<n.value;(l||o)&&(i=this._getOrReturnCtx(e,i),l?V(i,{code:P.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):o&&V(i,{code:P.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),a.dirty())}else if(n.kind==="email")Bn.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"email",code:P.invalid_string,message:n.message}),a.dirty());else if(n.kind==="emoji")Ws||(Ws=new RegExp(zn,"u")),Ws.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"emoji",code:P.invalid_string,message:n.message}),a.dirty());else if(n.kind==="uuid")Zn.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"uuid",code:P.invalid_string,message:n.message}),a.dirty());else if(n.kind==="nanoid")qn.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"nanoid",code:P.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid")Vn.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"cuid",code:P.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid2")Rn.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"cuid2",code:P.invalid_string,message:n.message}),a.dirty());else if(n.kind==="ulid")$n.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"ulid",code:P.invalid_string,message:n.message}),a.dirty());else if(n.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),V(i,{validation:"url",code:P.invalid_string,message:n.message}),a.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"regex",code:P.invalid_string,message:n.message}),a.dirty())):n.kind==="trim"?e.data=e.data.trim():n.kind==="includes"?e.data.includes(n.value,n.position)||(i=this._getOrReturnCtx(e,i),V(i,{code:P.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),a.dirty()):n.kind==="toLowerCase"?e.data=e.data.toLowerCase():n.kind==="toUpperCase"?e.data=e.data.toUpperCase():n.kind==="startsWith"?e.data.startsWith(n.value)||(i=this._getOrReturnCtx(e,i),V(i,{code:P.invalid_string,validation:{startsWith:n.value},message:n.message}),a.dirty()):n.kind==="endsWith"?e.data.endsWith(n.value)||(i=this._getOrReturnCtx(e,i),V(i,{code:P.invalid_string,validation:{endsWith:n.value},message:n.message}),a.dirty()):n.kind==="datetime"?ya(n).test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{code:P.invalid_string,validation:"datetime",message:n.message}),a.dirty()):n.kind==="date"?Yn.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{code:P.invalid_string,validation:"date",message:n.message}),a.dirty()):n.kind==="time"?Jn(n).test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{code:P.invalid_string,validation:"time",message:n.message}),a.dirty()):n.kind==="duration"?Un.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"duration",code:P.invalid_string,message:n.message}),a.dirty()):n.kind==="ip"?Qn(e.data,n.version)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"ip",code:P.invalid_string,message:n.message}),a.dirty()):n.kind==="base64"?Kn.test(e.data)||(i=this._getOrReturnCtx(e,i),V(i,{validation:"base64",code:P.invalid_string,message:n.message}),a.dirty()):ge.assertNever(n);return{status:a.value,value:e.data}}_regex(e,r,a){return this.refinement(i=>e.test(i),{validation:r,code:P.invalid_string,...G.errToObj(a)})}_addCheck(e){return new Qe({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...G.errToObj(e)})}url(e){return this._addCheck({kind:"url",...G.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...G.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...G.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...G.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...G.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...G.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...G.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...G.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...G.errToObj(e)})}datetime(e){var r,a;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(r=e==null?void 0:e.offset)!==null&&r!==void 0?r:!1,local:(a=e==null?void 0:e.local)!==null&&a!==void 0?a:!1,...G.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...G.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...G.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...G.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...G.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...G.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...G.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...G.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...G.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...G.errToObj(r)})}nonempty(e){return this.min(1,G.errToObj(e))}trim(){return new Qe({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Qe({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Qe({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Qe.create=s=>{var e;return new Qe({checks:[],typeName:ae.ZodString,coerce:(e=s==null?void 0:s.coerce)!==null&&e!==void 0?e:!1,...de(s)})};function Gn(s,e){const r=(s.toString().split(".")[1]||"").length,a=(e.toString().split(".")[1]||"").length,i=r>a?r:a,n=parseInt(s.toFixed(i).replace(".","")),l=parseInt(e.toFixed(i).replace(".",""));return n%l/Math.pow(10,i)}class ft extends he{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Z.number){const n=this._getOrReturnCtx(e);return V(n,{code:P.invalid_type,expected:Z.number,received:n.parsedType}),ie}let a;const i=new Me;for(const n of this._def.checks)n.kind==="int"?ge.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),V(a,{code:P.invalid_type,expected:"integer",received:"float",message:n.message}),i.dirty()):n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(a=this._getOrReturnCtx(e,a),V(a,{code:P.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(a=this._getOrReturnCtx(e,a),V(a,{code:P.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):n.kind==="multipleOf"?Gn(e.data,n.value)!==0&&(a=this._getOrReturnCtx(e,a),V(a,{code:P.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):n.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),V(a,{code:P.not_finite,message:n.message}),i.dirty()):ge.assertNever(n);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,G.toString(r))}gt(e,r){return this.setLimit("min",e,!1,G.toString(r))}lte(e,r){return this.setLimit("max",e,!0,G.toString(r))}lt(e,r){return this.setLimit("max",e,!1,G.toString(r))}setLimit(e,r,a,i){return new ft({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:G.toString(i)}]})}_addCheck(e){return new ft({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:G.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:G.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:G.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:G.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:G.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:G.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:G.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:G.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:G.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ge.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(r===null||a.value>r)&&(r=a.value):a.kind==="max"&&(e===null||a.value<e)&&(e=a.value)}return Number.isFinite(r)&&Number.isFinite(e)}}ft.create=s=>new ft({checks:[],typeName:ae.ZodNumber,coerce:(s==null?void 0:s.coerce)||!1,...de(s)});class pt extends he{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==Z.bigint){const n=this._getOrReturnCtx(e);return V(n,{code:P.invalid_type,expected:Z.bigint,received:n.parsedType}),ie}let a;const i=new Me;for(const n of this._def.checks)n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(a=this._getOrReturnCtx(e,a),V(a,{code:P.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(a=this._getOrReturnCtx(e,a),V(a,{code:P.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):n.kind==="multipleOf"?e.data%n.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),V(a,{code:P.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):ge.assertNever(n);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,G.toString(r))}gt(e,r){return this.setLimit("min",e,!1,G.toString(r))}lte(e,r){return this.setLimit("max",e,!0,G.toString(r))}lt(e,r){return this.setLimit("max",e,!1,G.toString(r))}setLimit(e,r,a,i){return new pt({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:G.toString(i)}]})}_addCheck(e){return new pt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:G.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:G.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:G.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:G.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:G.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}pt.create=s=>{var e;return new pt({checks:[],typeName:ae.ZodBigInt,coerce:(e=s==null?void 0:s.coerce)!==null&&e!==void 0?e:!1,...de(s)})};class ts extends he{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Z.boolean){const a=this._getOrReturnCtx(e);return V(a,{code:P.invalid_type,expected:Z.boolean,received:a.parsedType}),ie}return Oe(e.data)}}ts.create=s=>new ts({typeName:ae.ZodBoolean,coerce:(s==null?void 0:s.coerce)||!1,...de(s)});class _t extends he{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Z.date){const n=this._getOrReturnCtx(e);return V(n,{code:P.invalid_type,expected:Z.date,received:n.parsedType}),ie}if(isNaN(e.data.getTime())){const n=this._getOrReturnCtx(e);return V(n,{code:P.invalid_date}),ie}const a=new Me;let i;for(const n of this._def.checks)n.kind==="min"?e.data.getTime()<n.value&&(i=this._getOrReturnCtx(e,i),V(i,{code:P.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),a.dirty()):n.kind==="max"?e.data.getTime()>n.value&&(i=this._getOrReturnCtx(e,i),V(i,{code:P.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),a.dirty()):ge.assertNever(n);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new _t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:G.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:G.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}_t.create=s=>new _t({checks:[],coerce:(s==null?void 0:s.coerce)||!1,typeName:ae.ZodDate,...de(s)});class As extends he{_parse(e){if(this._getType(e)!==Z.symbol){const a=this._getOrReturnCtx(e);return V(a,{code:P.invalid_type,expected:Z.symbol,received:a.parsedType}),ie}return Oe(e.data)}}As.create=s=>new As({typeName:ae.ZodSymbol,...de(s)});class ss extends he{_parse(e){if(this._getType(e)!==Z.undefined){const a=this._getOrReturnCtx(e);return V(a,{code:P.invalid_type,expected:Z.undefined,received:a.parsedType}),ie}return Oe(e.data)}}ss.create=s=>new ss({typeName:ae.ZodUndefined,...de(s)});class rs extends he{_parse(e){if(this._getType(e)!==Z.null){const a=this._getOrReturnCtx(e);return V(a,{code:P.invalid_type,expected:Z.null,received:a.parsedType}),ie}return Oe(e.data)}}rs.create=s=>new rs({typeName:ae.ZodNull,...de(s)});class Mt extends he{constructor(){super(...arguments),this._any=!0}_parse(e){return Oe(e.data)}}Mt.create=s=>new Mt({typeName:ae.ZodAny,...de(s)});class bt extends he{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Oe(e.data)}}bt.create=s=>new bt({typeName:ae.ZodUnknown,...de(s)});class ut extends he{_parse(e){const r=this._getOrReturnCtx(e);return V(r,{code:P.invalid_type,expected:Z.never,received:r.parsedType}),ie}}ut.create=s=>new ut({typeName:ae.ZodNever,...de(s)});class Es extends he{_parse(e){if(this._getType(e)!==Z.undefined){const a=this._getOrReturnCtx(e);return V(a,{code:P.invalid_type,expected:Z.void,received:a.parsedType}),ie}return Oe(e.data)}}Es.create=s=>new Es({typeName:ae.ZodVoid,...de(s)});class Ge extends he{_parse(e){const{ctx:r,status:a}=this._processInputParams(e),i=this._def;if(r.parsedType!==Z.array)return V(r,{code:P.invalid_type,expected:Z.array,received:r.parsedType}),ie;if(i.exactLength!==null){const l=r.data.length>i.exactLength.value,o=r.data.length<i.exactLength.value;(l||o)&&(V(r,{code:l?P.too_big:P.too_small,minimum:o?i.exactLength.value:void 0,maximum:l?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),a.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(V(r,{code:P.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),a.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(V(r,{code:P.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),a.dirty()),r.common.async)return Promise.all([...r.data].map((l,o)=>i.type._parseAsync(new at(r,l,r.path,o)))).then(l=>Me.mergeArray(a,l));const n=[...r.data].map((l,o)=>i.type._parseSync(new at(r,l,r.path,o)));return Me.mergeArray(a,n)}get element(){return this._def.type}min(e,r){return new Ge({...this._def,minLength:{value:e,message:G.toString(r)}})}max(e,r){return new Ge({...this._def,maxLength:{value:e,message:G.toString(r)}})}length(e,r){return new Ge({...this._def,exactLength:{value:e,message:G.toString(r)}})}nonempty(e){return this.min(1,e)}}Ge.create=(s,e)=>new Ge({type:s,minLength:null,maxLength:null,exactLength:null,typeName:ae.ZodArray,...de(e)});function St(s){if(s instanceof ke){const e={};for(const r in s.shape){const a=s.shape[r];e[r]=rt.create(St(a))}return new ke({...s._def,shape:()=>e})}else return s instanceof Ge?new Ge({...s._def,type:St(s.element)}):s instanceof rt?rt.create(St(s.unwrap())):s instanceof gt?gt.create(St(s.unwrap())):s instanceof nt?nt.create(s.items.map(e=>St(e))):s}class ke extends he{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=ge.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==Z.object){const c=this._getOrReturnCtx(e);return V(c,{code:P.invalid_type,expected:Z.object,received:c.parsedType}),ie}const{status:a,ctx:i}=this._processInputParams(e),{shape:n,keys:l}=this._getCached(),o=[];if(!(this._def.catchall instanceof ut&&this._def.unknownKeys==="strip"))for(const c in i.data)l.includes(c)||o.push(c);const m=[];for(const c of l){const d=n[c],f=i.data[c];m.push({key:{status:"valid",value:c},value:d._parse(new at(i,f,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof ut){const c=this._def.unknownKeys;if(c==="passthrough")for(const d of o)m.push({key:{status:"valid",value:d},value:{status:"valid",value:i.data[d]}});else if(c==="strict")o.length>0&&(V(i,{code:P.unrecognized_keys,keys:o}),a.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const d of o){const f=i.data[d];m.push({key:{status:"valid",value:d},value:c._parse(new at(i,f,i.path,d)),alwaysSet:d in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const d of m){const f=await d.key,C=await d.value;c.push({key:f,value:C,alwaysSet:d.alwaysSet})}return c}).then(c=>Me.mergeObjectSync(a,c)):Me.mergeObjectSync(a,m)}get shape(){return this._def.shape()}strict(e){return G.errToObj,new ke({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,a)=>{var i,n,l,o;const m=(l=(n=(i=this._def).errorMap)===null||n===void 0?void 0:n.call(i,r,a).message)!==null&&l!==void 0?l:a.defaultError;return r.code==="unrecognized_keys"?{message:(o=G.errToObj(e).message)!==null&&o!==void 0?o:m}:{message:m}}}:{}})}strip(){return new ke({...this._def,unknownKeys:"strip"})}passthrough(){return new ke({...this._def,unknownKeys:"passthrough"})}extend(e){return new ke({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ke({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ae.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new ke({...this._def,catchall:e})}pick(e){const r={};return ge.objectKeys(e).forEach(a=>{e[a]&&this.shape[a]&&(r[a]=this.shape[a])}),new ke({...this._def,shape:()=>r})}omit(e){const r={};return ge.objectKeys(this.shape).forEach(a=>{e[a]||(r[a]=this.shape[a])}),new ke({...this._def,shape:()=>r})}deepPartial(){return St(this)}partial(e){const r={};return ge.objectKeys(this.shape).forEach(a=>{const i=this.shape[a];e&&!e[a]?r[a]=i:r[a]=i.optional()}),new ke({...this._def,shape:()=>r})}required(e){const r={};return ge.objectKeys(this.shape).forEach(a=>{if(e&&!e[a])r[a]=this.shape[a];else{let n=this.shape[a];for(;n instanceof rt;)n=n._def.innerType;r[a]=n}}),new ke({...this._def,shape:()=>r})}keyof(){return va(ge.objectKeys(this.shape))}}ke.create=(s,e)=>new ke({shape:()=>s,unknownKeys:"strip",catchall:ut.create(),typeName:ae.ZodObject,...de(e)});ke.strictCreate=(s,e)=>new ke({shape:()=>s,unknownKeys:"strict",catchall:ut.create(),typeName:ae.ZodObject,...de(e)});ke.lazycreate=(s,e)=>new ke({shape:s,unknownKeys:"strip",catchall:ut.create(),typeName:ae.ZodObject,...de(e)});class as extends he{_parse(e){const{ctx:r}=this._processInputParams(e),a=this._def.options;function i(n){for(const o of n)if(o.result.status==="valid")return o.result;for(const o of n)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;const l=n.map(o=>new Ke(o.ctx.common.issues));return V(r,{code:P.invalid_union,unionErrors:l}),ie}if(r.common.async)return Promise.all(a.map(async n=>{const l={...r,common:{...r.common,issues:[]},parent:null};return{result:await n._parseAsync({data:r.data,path:r.path,parent:l}),ctx:l}})).then(i);{let n;const l=[];for(const m of a){const c={...r,common:{...r.common,issues:[]},parent:null},d=m._parseSync({data:r.data,path:r.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!n&&(n={result:d,ctx:c}),c.common.issues.length&&l.push(c.common.issues)}if(n)return r.common.issues.push(...n.ctx.common.issues),n.result;const o=l.map(m=>new Ke(m));return V(r,{code:P.invalid_union,unionErrors:o}),ie}}get options(){return this._def.options}}as.create=(s,e)=>new as({options:s,typeName:ae.ZodUnion,...de(e)});const ct=s=>s instanceof ls?ct(s.schema):s instanceof Xe?ct(s.innerType()):s instanceof os?[s.value]:s instanceof xt?s.options:s instanceof cs?ge.objectValues(s.enum):s instanceof ds?ct(s._def.innerType):s instanceof ss?[void 0]:s instanceof rs?[null]:s instanceof rt?[void 0,...ct(s.unwrap())]:s instanceof gt?[null,...ct(s.unwrap())]:s instanceof pr||s instanceof ms?ct(s.unwrap()):s instanceof us?ct(s._def.innerType):[];class Zs extends he{_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==Z.object)return V(r,{code:P.invalid_type,expected:Z.object,received:r.parsedType}),ie;const a=this.discriminator,i=r.data[a],n=this.optionsMap.get(i);return n?r.common.async?n._parseAsync({data:r.data,path:r.path,parent:r}):n._parseSync({data:r.data,path:r.path,parent:r}):(V(r,{code:P.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),ie)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,a){const i=new Map;for(const n of r){const l=ct(n.shape[e]);if(!l.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of l){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,n)}}return new Zs({typeName:ae.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:i,...de(a)})}}function ar(s,e){const r=ht(s),a=ht(e);if(s===e)return{valid:!0,data:s};if(r===Z.object&&a===Z.object){const i=ge.objectKeys(e),n=ge.objectKeys(s).filter(o=>i.indexOf(o)!==-1),l={...s,...e};for(const o of n){const m=ar(s[o],e[o]);if(!m.valid)return{valid:!1};l[o]=m.data}return{valid:!0,data:l}}else if(r===Z.array&&a===Z.array){if(s.length!==e.length)return{valid:!1};const i=[];for(let n=0;n<s.length;n++){const l=s[n],o=e[n],m=ar(l,o);if(!m.valid)return{valid:!1};i.push(m.data)}return{valid:!0,data:i}}else return r===Z.date&&a===Z.date&&+s==+e?{valid:!0,data:s}:{valid:!1}}class ns extends he{_parse(e){const{status:r,ctx:a}=this._processInputParams(e),i=(n,l)=>{if(sr(n)||sr(l))return ie;const o=ar(n.value,l.value);return o.valid?((rr(n)||rr(l))&&r.dirty(),{status:r.value,value:o.data}):(V(a,{code:P.invalid_intersection_types}),ie)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([n,l])=>i(n,l)):i(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}ns.create=(s,e,r)=>new ns({left:s,right:e,typeName:ae.ZodIntersection,...de(r)});class nt extends he{_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==Z.array)return V(a,{code:P.invalid_type,expected:Z.array,received:a.parsedType}),ie;if(a.data.length<this._def.items.length)return V(a,{code:P.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ie;!this._def.rest&&a.data.length>this._def.items.length&&(V(a,{code:P.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const n=[...a.data].map((l,o)=>{const m=this._def.items[o]||this._def.rest;return m?m._parse(new at(a,l,a.path,o)):null}).filter(l=>!!l);return a.common.async?Promise.all(n).then(l=>Me.mergeArray(r,l)):Me.mergeArray(r,n)}get items(){return this._def.items}rest(e){return new nt({...this._def,rest:e})}}nt.create=(s,e)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new nt({items:s,typeName:ae.ZodTuple,rest:null,...de(e)})};class is extends he{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==Z.object)return V(a,{code:P.invalid_type,expected:Z.object,received:a.parsedType}),ie;const i=[],n=this._def.keyType,l=this._def.valueType;for(const o in a.data)i.push({key:n._parse(new at(a,o,a.path,o)),value:l._parse(new at(a,a.data[o],a.path,o)),alwaysSet:o in a.data});return a.common.async?Me.mergeObjectAsync(r,i):Me.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(e,r,a){return r instanceof he?new is({keyType:e,valueType:r,typeName:ae.ZodRecord,...de(a)}):new is({keyType:Qe.create(),valueType:e,typeName:ae.ZodRecord,...de(r)})}}class Ts extends he{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==Z.map)return V(a,{code:P.invalid_type,expected:Z.map,received:a.parsedType}),ie;const i=this._def.keyType,n=this._def.valueType,l=[...a.data.entries()].map(([o,m],c)=>({key:i._parse(new at(a,o,a.path,[c,"key"])),value:n._parse(new at(a,m,a.path,[c,"value"]))}));if(a.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const m of l){const c=await m.key,d=await m.value;if(c.status==="aborted"||d.status==="aborted")return ie;(c.status==="dirty"||d.status==="dirty")&&r.dirty(),o.set(c.value,d.value)}return{status:r.value,value:o}})}else{const o=new Map;for(const m of l){const c=m.key,d=m.value;if(c.status==="aborted"||d.status==="aborted")return ie;(c.status==="dirty"||d.status==="dirty")&&r.dirty(),o.set(c.value,d.value)}return{status:r.value,value:o}}}}Ts.create=(s,e,r)=>new Ts({valueType:e,keyType:s,typeName:ae.ZodMap,...de(r)});class jt extends he{_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==Z.set)return V(a,{code:P.invalid_type,expected:Z.set,received:a.parsedType}),ie;const i=this._def;i.minSize!==null&&a.data.size<i.minSize.value&&(V(a,{code:P.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&a.data.size>i.maxSize.value&&(V(a,{code:P.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());const n=this._def.valueType;function l(m){const c=new Set;for(const d of m){if(d.status==="aborted")return ie;d.status==="dirty"&&r.dirty(),c.add(d.value)}return{status:r.value,value:c}}const o=[...a.data.values()].map((m,c)=>n._parse(new at(a,m,a.path,c)));return a.common.async?Promise.all(o).then(m=>l(m)):l(o)}min(e,r){return new jt({...this._def,minSize:{value:e,message:G.toString(r)}})}max(e,r){return new jt({...this._def,maxSize:{value:e,message:G.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}jt.create=(s,e)=>new jt({valueType:s,minSize:null,maxSize:null,typeName:ae.ZodSet,...de(e)});class At extends he{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==Z.function)return V(r,{code:P.invalid_type,expected:Z.function,received:r.parsedType}),ie;function a(o,m){return Ps({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Ss(),Lt].filter(c=>!!c),issueData:{code:P.invalid_arguments,argumentsError:m}})}function i(o,m){return Ps({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Ss(),Lt].filter(c=>!!c),issueData:{code:P.invalid_return_type,returnTypeError:m}})}const n={errorMap:r.common.contextualErrorMap},l=r.data;if(this._def.returns instanceof Ft){const o=this;return Oe(async function(...m){const c=new Ke([]),d=await o._def.args.parseAsync(m,n).catch(A=>{throw c.addIssue(a(m,A)),c}),f=await Reflect.apply(l,this,d);return await o._def.returns._def.type.parseAsync(f,n).catch(A=>{throw c.addIssue(i(f,A)),c})})}else{const o=this;return Oe(function(...m){const c=o._def.args.safeParse(m,n);if(!c.success)throw new Ke([a(m,c.error)]);const d=Reflect.apply(l,this,c.data),f=o._def.returns.safeParse(d,n);if(!f.success)throw new Ke([i(d,f.error)]);return f.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new At({...this._def,args:nt.create(e).rest(bt.create())})}returns(e){return new At({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,a){return new At({args:e||nt.create([]).rest(bt.create()),returns:r||bt.create(),typeName:ae.ZodFunction,...de(a)})}}class ls extends he{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}ls.create=(s,e)=>new ls({getter:s,typeName:ae.ZodLazy,...de(e)});class os extends he{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return V(r,{received:r.data,code:P.invalid_literal,expected:this._def.value}),ie}return{status:"valid",value:e.data}}get value(){return this._def.value}}os.create=(s,e)=>new os({value:s,typeName:ae.ZodLiteral,...de(e)});function va(s,e){return new xt({values:s,typeName:ae.ZodEnum,...de(e)})}class xt extends he{constructor(){super(...arguments),$t.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),a=this._def.values;return V(r,{expected:ge.joinValues(a),received:r.parsedType,code:P.invalid_type}),ie}if(Ds(this,$t)||pa(this,$t,new Set(this._def.values)),!Ds(this,$t).has(e.data)){const r=this._getOrReturnCtx(e),a=this._def.values;return V(r,{received:r.data,code:P.invalid_enum_value,options:a}),ie}return Oe(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return xt.create(e,{...this._def,...r})}exclude(e,r=this._def){return xt.create(this.options.filter(a=>!e.includes(a)),{...this._def,...r})}}$t=new WeakMap;xt.create=va;class cs extends he{constructor(){super(...arguments),Zt.set(this,void 0)}_parse(e){const r=ge.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(e);if(a.parsedType!==Z.string&&a.parsedType!==Z.number){const i=ge.objectValues(r);return V(a,{expected:ge.joinValues(i),received:a.parsedType,code:P.invalid_type}),ie}if(Ds(this,Zt)||pa(this,Zt,new Set(ge.getValidEnumValues(this._def.values))),!Ds(this,Zt).has(e.data)){const i=ge.objectValues(r);return V(a,{received:a.data,code:P.invalid_enum_value,options:i}),ie}return Oe(e.data)}get enum(){return this._def.values}}Zt=new WeakMap;cs.create=(s,e)=>new cs({values:s,typeName:ae.ZodNativeEnum,...de(e)});class Ft extends he{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==Z.promise&&r.common.async===!1)return V(r,{code:P.invalid_type,expected:Z.promise,received:r.parsedType}),ie;const a=r.parsedType===Z.promise?r.data:Promise.resolve(r.data);return Oe(a.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}}Ft.create=(s,e)=>new Ft({type:s,typeName:ae.ZodPromise,...de(e)});class Xe extends he{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ae.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:a}=this._processInputParams(e),i=this._def.effect||null,n={addIssue:l=>{V(a,l),l.fatal?r.abort():r.dirty()},get path(){return a.path}};if(n.addIssue=n.addIssue.bind(n),i.type==="preprocess"){const l=i.transform(a.data,n);if(a.common.async)return Promise.resolve(l).then(async o=>{if(r.value==="aborted")return ie;const m=await this._def.schema._parseAsync({data:o,path:a.path,parent:a});return m.status==="aborted"?ie:m.status==="dirty"||r.value==="dirty"?Pt(m.value):m});{if(r.value==="aborted")return ie;const o=this._def.schema._parseSync({data:l,path:a.path,parent:a});return o.status==="aborted"?ie:o.status==="dirty"||r.value==="dirty"?Pt(o.value):o}}if(i.type==="refinement"){const l=o=>{const m=i.refinement(o,n);if(a.common.async)return Promise.resolve(m);if(m instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(a.common.async===!1){const o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return o.status==="aborted"?ie:(o.status==="dirty"&&r.dirty(),l(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>o.status==="aborted"?ie:(o.status==="dirty"&&r.dirty(),l(o.value).then(()=>({status:r.value,value:o.value}))))}if(i.type==="transform")if(a.common.async===!1){const l=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Xt(l))return l;const o=i.transform(l.value,n);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(l=>Xt(l)?Promise.resolve(i.transform(l.value,n)).then(o=>({status:r.value,value:o})):l);ge.assertNever(i)}}Xe.create=(s,e,r)=>new Xe({schema:s,typeName:ae.ZodEffects,effect:e,...de(r)});Xe.createWithPreprocess=(s,e,r)=>new Xe({schema:e,effect:{type:"preprocess",transform:s},typeName:ae.ZodEffects,...de(r)});class rt extends he{_parse(e){return this._getType(e)===Z.undefined?Oe(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}rt.create=(s,e)=>new rt({innerType:s,typeName:ae.ZodOptional,...de(e)});class gt extends he{_parse(e){return this._getType(e)===Z.null?Oe(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}gt.create=(s,e)=>new gt({innerType:s,typeName:ae.ZodNullable,...de(e)});class ds extends he{_parse(e){const{ctx:r}=this._processInputParams(e);let a=r.data;return r.parsedType===Z.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}ds.create=(s,e)=>new ds({innerType:s,typeName:ae.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...de(e)});class us extends he{_parse(e){const{ctx:r}=this._processInputParams(e),a={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return es(i)?i.then(n=>({status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Ke(a.common.issues)},input:a.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ke(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}}us.create=(s,e)=>new us({innerType:s,typeName:ae.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...de(e)});class Ls extends he{_parse(e){if(this._getType(e)!==Z.nan){const a=this._getOrReturnCtx(e);return V(a,{code:P.invalid_type,expected:Z.nan,received:a.parsedType}),ie}return{status:"valid",value:e.data}}}Ls.create=s=>new Ls({typeName:ae.ZodNaN,...de(s)});const Xn=Symbol("zod_brand");class pr extends he{_parse(e){const{ctx:r}=this._processInputParams(e),a=r.data;return this._def.type._parse({data:a,path:r.path,parent:r})}unwrap(){return this._def.type}}class xs extends he{_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.common.async)return(async()=>{const n=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return n.status==="aborted"?ie:n.status==="dirty"?(r.dirty(),Pt(n.value)):this._def.out._parseAsync({data:n.value,path:a.path,parent:a})})();{const i=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?ie:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:a.path,parent:a})}}static create(e,r){return new xs({in:e,out:r,typeName:ae.ZodPipeline})}}class ms extends he{_parse(e){const r=this._def.innerType._parse(e),a=i=>(Xt(i)&&(i.value=Object.freeze(i.value)),i);return es(r)?r.then(i=>a(i)):a(r)}unwrap(){return this._def.innerType}}ms.create=(s,e)=>new ms({innerType:s,typeName:ae.ZodReadonly,...de(e)});function ba(s,e={},r){return s?Mt.create().superRefine((a,i)=>{var n,l;if(!s(a)){const o=typeof e=="function"?e(a):typeof e=="string"?{message:e}:e,m=(l=(n=o.fatal)!==null&&n!==void 0?n:r)!==null&&l!==void 0?l:!0,c=typeof o=="string"?{message:o}:o;i.addIssue({code:"custom",...c,fatal:m})}}):Mt.create()}const ei={object:ke.lazycreate};var ae;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(ae||(ae={}));const ti=(s,e={message:`Input not instance of ${s.name}`})=>ba(r=>r instanceof s,e),_a=Qe.create,ja=ft.create,si=Ls.create,ri=pt.create,wa=ts.create,ai=_t.create,ni=As.create,ii=ss.create,li=rs.create,oi=Mt.create,ci=bt.create,di=ut.create,ui=Es.create,mi=Ge.create,hi=ke.create,fi=ke.strictCreate,pi=as.create,xi=Zs.create,gi=ns.create,yi=nt.create,vi=is.create,bi=Ts.create,_i=jt.create,ji=At.create,wi=ls.create,Ni=os.create,Ci=xt.create,ki=cs.create,Si=Ft.create,Vr=Xe.create,Pi=rt.create,Di=gt.create,Ai=Xe.createWithPreprocess,Ei=xs.create,Ti=()=>_a().optional(),Li=()=>ja().optional(),Mi=()=>wa().optional(),Fi={string:s=>Qe.create({...s,coerce:!0}),number:s=>ft.create({...s,coerce:!0}),boolean:s=>ts.create({...s,coerce:!0}),bigint:s=>pt.create({...s,coerce:!0}),date:s=>_t.create({...s,coerce:!0})},Oi=ie;var Hs=Object.freeze({__proto__:null,defaultErrorMap:Lt,setErrorMap:On,getErrorMap:Ss,makeIssue:Ps,EMPTY_PATH:In,addIssueToContext:V,ParseStatus:Me,INVALID:ie,DIRTY:Pt,OK:Oe,isAborted:sr,isDirty:rr,isValid:Xt,isAsync:es,get util(){return ge},get objectUtil(){return tr},ZodParsedType:Z,getParsedType:ht,ZodType:he,datetimeRegex:ya,ZodString:Qe,ZodNumber:ft,ZodBigInt:pt,ZodBoolean:ts,ZodDate:_t,ZodSymbol:As,ZodUndefined:ss,ZodNull:rs,ZodAny:Mt,ZodUnknown:bt,ZodNever:ut,ZodVoid:Es,ZodArray:Ge,ZodObject:ke,ZodUnion:as,ZodDiscriminatedUnion:Zs,ZodIntersection:ns,ZodTuple:nt,ZodRecord:is,ZodMap:Ts,ZodSet:jt,ZodFunction:At,ZodLazy:ls,ZodLiteral:os,ZodEnum:xt,ZodNativeEnum:cs,ZodPromise:Ft,ZodEffects:Xe,ZodTransformer:Xe,ZodOptional:rt,ZodNullable:gt,ZodDefault:ds,ZodCatch:us,ZodNaN:Ls,BRAND:Xn,ZodBranded:pr,ZodPipeline:xs,ZodReadonly:ms,custom:ba,Schema:he,ZodSchema:he,late:ei,get ZodFirstPartyTypeKind(){return ae},coerce:Fi,any:oi,array:mi,bigint:ri,boolean:wa,date:ai,discriminatedUnion:xi,effect:Vr,enum:Ci,function:ji,instanceof:ti,intersection:gi,lazy:wi,literal:Ni,map:bi,nan:si,nativeEnum:ki,never:di,null:li,nullable:Di,number:ja,object:hi,oboolean:Mi,onumber:Li,optional:Pi,ostring:Ti,pipeline:Ei,preprocess:Ai,promise:Si,record:vi,set:_i,strictObject:fi,string:_a,symbol:ni,transformer:Vr,tuple:yi,undefined:ii,union:pi,unknown:ci,void:ui,NEVER:Oi,ZodIssueCode:P,quotelessJson:Fn,ZodError:Ke});const Rr=(s,e,r)=>{if(s&&"reportValidity"in s){const a=L(r,e);s.setCustomValidity(a&&a.message||""),s.reportValidity()}},Na=(s,e)=>{for(const r in e.fields){const a=e.fields[r];a&&a.ref&&"reportValidity"in a.ref?Rr(a.ref,r,s):a.refs&&a.refs.forEach(i=>Rr(i,r,s))}},Ii=(s,e)=>{e.shouldUseNativeValidation&&Na(s,e);const r={};for(const a in s){const i=L(e.fields,a),n=Object.assign(s[a]||{},{ref:i&&i.ref});if(Vi(e.names||Object.keys(s),a)){const l=Object.assign({},L(r,a));_e(l,"root",n),_e(r,a,l)}else _e(r,a,n)}return r},Vi=(s,e)=>s.some(r=>r.startsWith(e+"."));var Ri=function(s,e){for(var r={};s.length;){var a=s[0],i=a.code,n=a.message,l=a.path.join(".");if(!r[l])if("unionErrors"in a){var o=a.unionErrors[0].errors[0];r[l]={message:o.message,type:o.code}}else r[l]={message:n,type:i};if("unionErrors"in a&&a.unionErrors.forEach(function(d){return d.errors.forEach(function(f){return s.push(f)})}),e){var m=r[l].types,c=m&&m[a.code];r[l]=na(l,e,r,i,c?[].concat(c,a.message):a.message)}s.shift()}return r},$i=function(s,e,r){return r===void 0&&(r={}),function(a,i,n){try{return Promise.resolve(function(l,o){try{var m=Promise.resolve(s[r.mode==="sync"?"parse":"parseAsync"](a,e)).then(function(c){return n.shouldUseNativeValidation&&Na({},n),{errors:{},values:r.raw?a:c}})}catch(c){return o(c)}return m&&m.then?m.then(void 0,o):m}(0,function(l){if(function(o){return Array.isArray(o==null?void 0:o.errors)}(l))return{values:{},errors:Ii(Ri(l.errors,!n.shouldUseNativeValidation&&n.criteriaMode==="all"),n)};throw l}))}catch(l){return Promise.reject(l)}}};function Ca({open:s,onOpenChange:e,availableClients:r,onSave:a,initialClientId:i="",initialPrice:n=0,productId:l}){const[o,m]=h.useState([]),[c,d]=h.useState(!1),f=Hs.object({clientId:Hs.string().min(1,"Client is required"),price:Hs.coerce.number().min(0,"Price cannot be negative")}),C=Tn({resolver:$i(f),defaultValues:{clientId:i,price:n},values:{clientId:i,price:n}}),A=async()=>{if(l){d(!0);try{const{data:b,error:j}=await Q.from("client_price_history").select(`
          id,
          price,
          timestamp,
          note,
          product_clients!inner(
            client:clients(name)
          )
        `).eq("product_clients.product_id",l).order("timestamp",{ascending:!1});if(j)throw j;const _=(b||[]).map(B=>{var z,y;return{id:B.id,date:B.timestamp,price:B.price,client_name:((y=(z=B.product_clients)==null?void 0:z.client)==null?void 0:y.name)||"Unknown Client",note:B.note||void 0}});m(_)}catch(b){console.error("Error fetching client price history:",b),qs.error("Failed to load price history")}finally{d(!1)}}};h.useEffect(()=>{s&&l&&A()},[s,l]);const M=async b=>{try{let{data:j,error:_}=await Q.from("product_clients").select("id, quoted_price").eq("product_id",l).eq("client_id",b.clientId).maybeSingle();if(_)throw _;if(j){const{error:B}=await Q.from("product_clients").update({quoted_price:b.price,updated_at:new Date().toISOString()}).eq("id",j.id);if(B)throw B}else{const{error:B}=await Q.from("product_clients").insert({product_id:l,client_id:b.clientId,quoted_price:b.price});if(B)throw B}qs.success("Client price saved successfully"),a(b.clientId,b.price),C.reset(),A()}catch(j){console.error("Error saving client price:",j),qs.error("Failed to save client price")}},k=b=>new Date(b).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return t.jsx(Be,{open:s,onOpenChange:e,children:t.jsxs(ze,{className:"w-full max-w-[95vw] sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col",children:[t.jsx(We,{className:"flex-shrink-0",children:t.jsx(He,{className:"text-lg sm:text-xl",children:"Manage Client Pricing"})}),t.jsxs(Xa,{defaultValue:"client",className:"flex-1 flex flex-col overflow-hidden",children:[t.jsxs(en,{className:"grid w-full grid-cols-2 flex-shrink-0",children:[t.jsxs(Nr,{value:"client",className:"flex items-center gap-1 text-xs sm:text-sm",children:[t.jsx(cr,{className:"h-3 w-3 sm:h-4 sm:w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Client Pricing"}),t.jsx("span",{className:"sm:hidden",children:"Price"})]}),t.jsxs(Nr,{value:"history",className:"flex items-center gap-1 text-xs sm:text-sm",children:[t.jsx(Ga,{className:"h-3 w-3 sm:h-4 sm:w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"History"})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto mt-4",children:[t.jsx(Cr,{value:"client",className:"mt-0",children:t.jsx(Ln,{...C,children:t.jsxs("form",{onSubmit:C.handleSubmit(M),className:"space-y-4",children:[t.jsx(Or,{control:C.control,name:"clientId",render:({field:b})=>t.jsxs(Qs,{children:[t.jsx(Gs,{children:"Client"}),t.jsxs(Re,{onValueChange:b.onChange,value:b.value,defaultValue:b.value,children:[t.jsx(Xs,{children:t.jsx($e,{className:"bg-white",children:t.jsx(Ze,{placeholder:"Select a client"})})}),t.jsx(qe,{className:"bg-white max-h-[200px]",children:r.map(j=>t.jsx(De,{value:j.id,children:j.name},j.id))})]}),t.jsx(er,{})]})}),t.jsx(Or,{control:C.control,name:"price",render:({field:b})=>t.jsxs(Qs,{children:[t.jsx(Gs,{children:"Price"}),t.jsx(Xs,{children:t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"₱"}),t.jsx(Ee,{type:"number",step:"0.01",className:"pl-8",placeholder:"0.00",...b})]})}),t.jsx(er,{})]})}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-4",children:[t.jsx(ce,{type:"button",variant:"outline",className:"flex-1 sm:flex-none",onClick:()=>e(!1),children:"Cancel"}),t.jsxs(ce,{type:"submit",className:"flex-1 sm:flex-none",children:[t.jsx(La,{className:"h-4 w-4 mr-2"})," Save Price"]})]})]})})}),t.jsx(Cr,{value:"history",className:"mt-0",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-sm text-gray-600 mb-3",children:"Client Price History"}),c?t.jsx("div",{className:"text-gray-400 text-sm text-center py-8",children:"Loading price history..."}):o.length===0?t.jsx("div",{className:"text-gray-400 text-sm text-center py-8",children:"No client price history available."}):t.jsx("div",{className:"space-y-2",children:o.map(b=>t.jsxs("div",{className:"bg-gray-50 p-3 rounded border",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"font-medium text-sm",children:qa(b.price)}),t.jsxs("span",{className:"text-xs text-gray-500",children:[b.client_name," • ",k(b.date)]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("span",{className:"text-xs px-2 py-1 rounded bg-blue-100 text-blue-700",children:"Client"})})]}),b.note&&t.jsx("div",{className:"text-xs text-gray-600 mt-2",children:b.note})]},b.id))})]})})]})]})]})})}const Zi=({isOpen:s,onClose:e,assignment:r,currentClientId:a,onTransferCompleted:i,assignments:n=[],onSelectAssignment:l})=>{const[o,m]=h.useState(""),c=n.length>0?n.find(y=>y.id===o)||n[0]:r,[d,f]=h.useState({newDepartment:"",newLocation:"",notes:""}),[C,A]=h.useState(!1),{toast:M}=it(),{data:k=[]}=Ot(a);h.useEffect(()=>{if(s&&k.length>0&&c){let y=null,E=null;for(const H of k){for(const X of H.locations)if(`${H.name} ${X.name}`===c.department){y=H.name,E=X.name;break}if(y)break}f({newDepartment:y||"",newLocation:E||"",notes:""}),n.length>0&&!o&&m(n[0].id)}},[s,k,c,n,o]);const b=async()=>{if(!c||!d.newDepartment||!d.newLocation){M({title:"Error",description:"Please select a printer, department and location for transfer.",variant:"destructive"});return}const y=k.find(H=>H.name===d.newDepartment),E=y==null?void 0:y.locations.find(H=>H.name===d.newLocation);if(!E){M({title:"Error",description:"Could not find the selected location.",variant:"destructive"});return}if(`${d.newDepartment} ${d.newLocation}`===c.department){M({title:"Error",description:"Cannot transfer to the same department/location. Use edit to change details.",variant:"destructive"});return}A(!0);try{const{error:H}=await Q.from("printer_assignments").update({department_location_id:E.id,status:"active"}).eq("id",c.id);if(H)throw H;const{error:X}=await Q.from("printer_history").insert({printer_id:c.printer_id,action_type:"transferred",description:`Transferred to department: ${d.newDepartment} ${d.newLocation}${d.notes?`. Notes: ${d.notes}`:""}`,performed_by:"System User",related_assignment_id:c.id});M({title:"Success",description:"Printer transferred successfully."}),i(),j()}catch{M({title:"Error",description:"Failed to transfer printer. Please try again.",variant:"destructive"})}finally{A(!1)}},j=()=>{f({newDepartment:"",newLocation:"",notes:""}),m(""),e()},_=k.map(y=>({value:y.name,label:y.name})),B=k.find(y=>y.name===d.newDepartment),z=B?B.locations.map(y=>({value:y.name,label:y.name,abbreviation:y.abbreviation,floor:y.floor})):[];return t.jsx(Be,{open:s,onOpenChange:j,children:t.jsxs(ze,{className:"max-w-md",children:[t.jsxs(We,{children:[t.jsxs(He,{className:"flex items-center space-x-2",children:[t.jsx(cn,{className:"h-5 w-5 text-orange-600"}),t.jsx("span",{children:"Transfer Printer"})]}),n.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx(Te,{children:"Select Printer *"}),t.jsxs(Re,{value:o,onValueChange:y=>{m(y);const E=n.find(H=>H.id===y);E&&l&&l(E)},disabled:C,children:[t.jsx($e,{className:"w-full mt-1",children:t.jsx(Ze,{placeholder:"Select a printer to transfer"})}),t.jsx(qe,{children:n.map(y=>t.jsxs(De,{value:y.id,children:[y.printer.name," ",y.printer.model&&`(${y.printer.model})`," - SN: ",y.serial_number||"N/A"," | ",y.department]},y.id))})]})]}),t.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Transfer ",c==null?void 0:c.printer.name," to another department or location"]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[t.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Current Assignment"}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Department: ",c==null?void 0:c.department]}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Serial: ",(c==null?void 0:c.serial_number)||"Not provided"]})]}),t.jsxs("div",{children:[t.jsx(Te,{children:"Transfer to Department *"}),t.jsxs(Re,{value:d.newDepartment,onValueChange:y=>f(E=>({...E,newDepartment:y,newLocation:""})),disabled:C,children:[t.jsx($e,{className:"mt-1",children:t.jsx(Ze,{placeholder:"Select target department"})}),t.jsx(qe,{children:_.map(y=>t.jsx(De,{value:y.value,children:y.label},y.value))})]}),_.length===0&&t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"No departments found for this client"})]}),d.newDepartment&&z.length>0&&t.jsxs("div",{children:[t.jsx(Te,{children:"Transfer to Location *"}),t.jsxs(Re,{value:d.newLocation,onValueChange:y=>f(E=>({...E,newLocation:y})),disabled:C,children:[t.jsx($e,{className:"mt-1",children:t.jsx(Ze,{placeholder:"Select target location"})}),t.jsx(qe,{children:z.map(y=>t.jsxs(De,{value:y.value,children:[y.label,y.abbreviation&&` (${y.abbreviation})`,y.floor&&` - ${y.floor}`]},y.value))})]})]}),t.jsxs("div",{children:[t.jsx(Te,{htmlFor:"transfer_notes",children:"Transfer Notes"}),t.jsx(Fs,{id:"transfer_notes",value:d.notes,onChange:y=>f(E=>({...E,notes:y.target.value})),disabled:C,placeholder:"Reason for transfer or additional notes...",className:"mt-1",rows:3})]}),d.newDepartment&&d.newLocation&&t.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:t.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[t.jsxs("span",{className:"text-gray-600",children:["Current: ",c==null?void 0:c.department]}),t.jsx(Oa,{className:"h-4 w-4 text-blue-600"}),t.jsxs("span",{className:"text-blue-700 font-medium",children:[d.newDepartment," ",d.newLocation]})]})}),t.jsxs("div",{className:"flex space-x-2 pt-4",children:[t.jsx(ce,{type:"button",variant:"outline",onClick:j,disabled:C,className:"flex-1",children:"Cancel"}),t.jsx(ce,{type:"button",onClick:b,disabled:C||!c||!d.newDepartment||!d.newLocation,className:"flex-1 bg-orange-600 text-white hover:bg-orange-700",children:"Transfer"})]})]})]})})},qi={black:"bg-black",cyan:"bg-cyan-500",magenta:"bg-pink-500",yellow:"bg-yellow-400"},$r=({color:s})=>{const e=qi[s==null?void 0:s.toLowerCase()]||"bg-gray-400";return t.jsx("div",{className:`w-3 h-3 rounded-full ${e}`})},Ui=({clientId:s})=>{const e=lr(),{userProfile:r}=lt(),[a,i]=h.useState(""),[n,l]=h.useState({});h.useState(null);const[o,m]=h.useState(!1),[c,d]=h.useState(!1),[f,C]=h.useState(null),[A,M]=h.useState(null),[k,b]=h.useState(!1),[j,_]=h.useState(!1),[B,z]=h.useState(!1),[y,E]=h.useState(null),{data:H=[]}=Ot(s),X=r&&!["admin","sales_admin"].includes(r.role||""),{data:J=[],isLoading:pe}=Ue({queryKey:["client-printer-assignments",s],queryFn:async()=>{const{data:g,error:p}=await Q.from("printer_assignments").select(`
          *,
          printer:printers(name, model, manufacturer, image_url, series),
          department_location:departments_location(
            name,
            department:departments(name)
          )
        `).eq("client_id",s).eq("status","active").order("created_at");if(p)throw p;return g||[]}});h.useEffect(()=>{const g=async()=>{const p={};for(const N of J)try{const se=await Tt.getProductsByPrinter(N.printer_id);if(se.length>0){const re=se.map(w=>w.id),{data:U,error:W}=await Q.from("product_clients").select("product_id, quoted_price").eq("client_id",s).in("product_id",re);if(W)throw W;const xe=se.map(w=>{const O=U==null?void 0:U.find(le=>le.product_id===w.id);return{...w,client_price:O==null?void 0:O.quoted_price}});p[N.id]=xe}else p[N.id]=se}catch{p[N.id]=[]}l(p)};J&&J.length>0&&g()},[J,s]);const ye=J.filter(g=>g.printer.name.toLowerCase().includes(a.toLowerCase())||(g.serial_number||"").toLowerCase().includes(a.toLowerCase())||(g.printer.model||"").toLowerCase().includes(a.toLowerCase())||(g.printer.manufacturer||"").toLowerCase().includes(a.toLowerCase())),S={};ye.forEach(g=>{S[g.printer_id]||(S[g.printer_id]={printer:g.printer,assignments:[]}),S[g.printer_id].assignments.push(g)});const K=Object.entries(S),F=g=>g.department_location?`${g.department_location.department.name} - ${g.department_location.name}`:"Unassigned",R=g=>{X||(C(g),m(!0))},$=(g,p)=>{X||(g.stopPropagation(),C(p),d(!0))},Y=async(g,p)=>{console.log("Price saved successfully:",{clientId:g,price:p,productId:f==null?void 0:f.id}),d(!1),(async()=>{const se={};for(const re of J)try{const U=await Tt.getProductsByPrinter(re.printer_id);if(U.length>0){const W=U.map(le=>le.id),{data:xe,error:w}=await Q.from("product_clients").select("product_id, quoted_price").eq("client_id",s).in("product_id",W);if(w)throw w;const O=U.map(le=>{const q=xe==null?void 0:xe.find(je=>je.product_id===le.id);return{...le,client_price:q==null?void 0:q.quoted_price}});se[re.id]=O}else se[re.id]=U}catch{se[re.id]=[]}l(se)})()},Ne=()=>{b(!0)},ue=()=>{_(!0)},we=g=>{E(g),z(!0)},ee=({printerId:g,printer:p,assignments:N})=>{const se={};return N.forEach(re=>{(n[re.id]||[]).forEach(W=>{const xe=`${W.type}-${W.name}`;se[xe]||(se[xe]={name:W.name,sku:W.sku,colors:[],product:W}),W.color&&!se[xe].colors.includes(W.color)&&se[xe].colors.push(W.color)})}),t.jsx(Os,{className:"bg-white/80 backdrop-blur-sm border border-gray-200/50 shadow-sm hover:shadow-md transition-all duration-200",children:t.jsxs(Is,{className:"p-6",children:[t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsxs("div",{className:"flex flex-col items-center min-w-[120px] w-32",children:[t.jsx("div",{className:"bg-blue-50 rounded-lg flex items-center justify-center w-28 h-24",children:p.image_url?t.jsx("img",{src:p.image_url,alt:p.name,className:"object-contain w-full h-full rounded-lg"}):t.jsx(st,{className:"w-16 h-16 text-blue-400"})}),t.jsxs("span",{className:"inline-block bg-gray-100 rounded-full px-3 py-1 text-xs font-medium text-gray-800 mt-2 text-center",children:[N.length," unit",N.length!==1?"s":""]})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-bold text-xl text-gray-900 leading-tight mb-1",children:p.series?p.model?`${p.series} ${p.model}`:`${p.series} ${p.name}`:p.model||p.name}),t.jsx("div",{className:"text-sm text-gray-500 mb-3",children:p.manufacturer}),t.jsxs("div",{className:"mb-3",children:[t.jsx("div",{className:"text-sm text-gray-600 mb-2 font-medium",children:"Assigned To:"}),t.jsx("ul",{className:"list-disc pl-5 text-sm text-gray-700 space-y-1",children:N.map((re,U)=>t.jsxs("li",{className:"leading-tight flex items-center justify-between",children:[t.jsxs("span",{children:[F(re),re.serial_number?` (SN: ${re.serial_number})`:t.jsxs(gr,{children:[t.jsx(yr,{asChild:!0,children:t.jsxs("span",{className:"ml-1 text-orange-500 cursor-help flex items-center",children:[t.jsx(vr,{className:"h-4 w-4 mr-1 text-orange-500"}),t.jsx("span",{className:"sr-only",children:"Missing serial number"})]})}),t.jsx(br,{children:"Missing serial number"})]})]}),!X&&t.jsx("button",{className:"ml-2 p-1 text-gray-400 hover:text-gray-600 transition-colors",onClick:W=>{W.stopPropagation(),we(re)},title:"Edit printer assignment",children:t.jsx(_s,{className:"h-4 w-4"})})]},re.id||U))})]})]})]}),A===g&&t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:t.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(se).map(([re,U])=>t.jsxs(Le,{variant:"outline",className:`flex items-center space-x-2 py-1 px-2 text-xs ${X?"cursor-default":"cursor-pointer hover:bg-gray-50"}`,onClick:W=>{W.stopPropagation(),R(U.product)},title:X?"Product information":"Click to edit product info",children:[t.jsx($r,{color:U.colors[0]}),t.jsxs("span",{className:"font-medium",children:[U.name,U.sku&&t.jsxs("span",{className:"text-gray-500",children:[" (",U.sku,")"]})]}),!X&&typeof U.product.client_price=="number"&&t.jsxs("span",{className:"font-semibold text-blue-600 ml-2 underline decoration-dotted cursor-pointer hover:text-blue-800",onClick:W=>{W.stopPropagation(),$(W,U.product)},title:"Click to manage pricing",children:[": ₱",U.product.client_price.toFixed(2)]})]},re))})})]})},g)},ne=({printerId:g,printer:p,assignments:N})=>{const se={};return N.forEach(re=>{(n[re.id]||[]).forEach(W=>{const xe=`${W.type}-${W.name}`;se[xe]||(se[xe]={name:W.name,sku:W.sku,colors:[],product:W}),W.color&&!se[xe].colors.includes(W.color)&&se[xe].colors.push(W.color)})}),t.jsxs("div",{className:"bg-white rounded-lg border shadow-sm p-4 mb-3 w-full cursor-pointer hover:bg-gray-50 transition-colors",style:{minHeight:0},onClick:()=>M(A===g?null:g),children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex flex-col items-center min-w-[96px] w-28",children:[t.jsx("div",{className:"bg-blue-50 rounded-lg flex items-center justify-center w-24 h-20",children:p.image_url?t.jsx("img",{src:p.image_url,alt:p.name,className:"object-contain w-full h-full rounded-lg"}):t.jsx(st,{className:"w-12 h-12 text-blue-400"})}),t.jsxs("span",{className:"inline-block bg-gray-100 rounded-full px-3 py-0.5 text-xs font-medium text-gray-800 mt-2 text-center",children:[N.length," unit",N.length!==1?"s":""]})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-bold text-lg text-gray-900 leading-tight mb-0",children:p.series?p.model?`${p.series} ${p.model}`:`${p.series} ${p.name}`:p.model||p.name}),t.jsx("div",{className:"text-sm text-gray-500 mb-1",children:p.manufacturer}),t.jsxs("div",{className:"mt-1 mb-2",children:[t.jsx("div",{className:"text-xs text-gray-600 mb-1 pl-0",children:"Assigned To:"}),t.jsx("ul",{className:"list-disc pl-5 text-xs text-gray-700 space-y-0.5 mb-0",children:N.map((re,U)=>t.jsxs("li",{className:"leading-tight flex items-center justify-between",children:[t.jsxs("span",{children:[F(re),re.serial_number?` (SN: ${re.serial_number})`:t.jsxs(gr,{children:[t.jsx(yr,{asChild:!0,children:t.jsxs("span",{className:"ml-1 text-orange-500 cursor-help flex items-center",children:[t.jsx(vr,{className:"h-3 w-3 mr-0.5 text-orange-500"}),t.jsx("span",{className:"sr-only",children:"Missing serial number"})]})}),t.jsx(br,{children:"Missing serial number"})]})]}),!X&&t.jsx("button",{className:"ml-2 p-1 text-gray-400 hover:text-gray-600 transition-colors",onClick:W=>{W.stopPropagation(),we(re)},title:"Edit printer assignment",children:t.jsx(_s,{className:"h-3 w-3"})})]},re.id||U))})]})]})]}),A===g&&t.jsxs(t.Fragment,{children:[t.jsx("hr",{className:"my-2 border-gray-200"}),t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Object.entries(se).map(([re,U])=>t.jsxs(Le,{variant:"outline",className:`flex items-center space-x-2 py-1 px-2 text-xs ${X?"cursor-default":"cursor-pointer hover:bg-gray-50"}`,onClick:W=>{W.stopPropagation(),R(U.product)},title:X?"Product information":"Click to edit product info",children:[t.jsx($r,{color:U.colors[0]}),t.jsxs("span",{className:"font-medium",children:[U.name,U.sku&&t.jsxs("span",{className:"text-gray-500",children:[" (",U.sku,")"]})]}),!X&&typeof U.product.client_price=="number"&&t.jsxs("span",{className:"font-semibold text-blue-600 ml-2 underline decoration-dotted cursor-pointer hover:text-blue-800",onClick:W=>{W.stopPropagation(),$(W,U.product)},title:"Click to manage pricing",children:[": ₱",U.product.client_price.toFixed(2)]})]},re))})]})]},g)};return t.jsxs("div",{className:"space-y-6",children:[e?t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(Gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),t.jsx(Ee,{type:"text",placeholder:"Search printers...",value:a,onChange:g=>i(g.target.value),className:"pl-10"})]}),!X&&t.jsx(ce,{type:"button",variant:"outline",size:"sm",onClick:Ne,children:"Assign"}),!X&&t.jsx(ce,{type:"button",variant:"outline",size:"sm",onClick:ue,children:"Transfer"})]}):t.jsxs("div",{className:"bg-white/60 backdrop-blur-xl rounded-2xl p-6 shadow-lg animate-fade-in",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Client Printers"}),t.jsxs("div",{className:"flex items-center space-x-3",children:[!X&&t.jsxs(ce,{type:"button",variant:"outline",onClick:Ne,className:"flex items-center space-x-2",children:[t.jsx(vt,{className:"h-4 w-4"}),"Assign Printer"]}),!X&&t.jsxs(ce,{type:"button",variant:"outline",onClick:ue,className:"flex items-center space-x-2",children:[t.jsx(js,{className:"h-4 w-4"}),"Transfer Printer"]})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(Gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),t.jsx(Ee,{type:"text",placeholder:"Search printers by name, model, manufacturer, or serial number...",value:a,onChange:g=>i(g.target.value),className:"pl-10"})]})]}),t.jsx("div",{className:"space-y-4",children:pe?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading printers..."})]}):K.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(st,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"No printers found."})]}):K.map(([g,{printer:p,assignments:N}])=>e?t.jsx(ne,{printerId:g,printer:p,assignments:N},g):t.jsx(ee,{printerId:g,printer:p,assignments:N},g))}),f&&t.jsx(or,{isOpen:o,onClose:()=>{m(!1),C(null)},product:f,onProductUpdated:()=>{m(!1),C(null)}}),f&&s&&t.jsx(Ca,{open:c,onOpenChange:g=>{d(g),g||C(null)},availableClients:[{id:s,name:"Current Client"}],onSave:Y,initialClientId:s,initialPrice:f.client_price||0,productId:f.id}),k&&t.jsx(Yr,{isOpen:k,onClose:()=>b(!1),location:null,departmentBaseName:"",clientId:s,departments:H,onPrinterAssigned:()=>{b(!1),window.location.reload()}}),j&&t.jsx(Zi,{isOpen:j,onClose:()=>_(!1),assignment:null,currentClientId:s,onTransferCompleted:()=>{_(!1),window.location.reload()}}),B&&y&&t.jsx(Kr,{isOpen:B,onClose:()=>{z(!1),E(null)},assignment:y,departments:H,onAssignmentUpdated:()=>{z(!1),E(null),window.location.reload()}})]})},Bi=s=>Ue({queryKey:["client-products-enhanced",s],queryFn:async()=>{const{data:e,error:r}=await Q.from("product_clients").select(`
          id,
          product_id,
          quoted_price,
          margin_percentage,
          product:products(
            id,
            name,
            category,
            sku,
            color
          )
        `).eq("client_id",s);if(r)throw r;const{data:a,error:i}=await Q.from("printer_assignments").select(`
          printer_id,
          status,
          department_location_id,
          printer:printers(
            id,
            name,
            model,
            manufacturer,
            series,
            product_printers(
              product:products(id)
            )
          ),
          departments_location:department_location_id(
            id,
            name,
            department:departments(
              id,
              name,
              client:clients(
                id,
                name
              )
            )
          )
        `).eq("client_id",s).eq("status","active");if(i)throw i;const n=new Map,l=new Map;a==null||a.forEach(m=>{var A,M,k,b;const c=m.printer,d=m.departments_location;if(!c||!d)return;const f={id:c.id,name:c.name,model:c.model,manufacturer:c.manufacturer,series:c.series},C={clientName:((M=(A=d.department)==null?void 0:A.client)==null?void 0:M.name)||"Unknown Client",departmentName:((k=d.department)==null?void 0:k.name)||"Unknown Department"};(b=c.product_printers)==null||b.forEach(j=>{var _;(_=j.product)!=null&&_.id&&(n.has(j.product.id)||n.set(j.product.id,new Set),l.has(j.product.id)||l.set(j.product.id,new Set),n.get(j.product.id).add(JSON.stringify(f)),l.get(j.product.id).add(JSON.stringify(C)))})});const o=[];return e==null||e.forEach(m=>{if(!m.product)return;const c=m.product,d=Array.from(n.get(c.id)||[]).map(C=>JSON.parse(C)),f=Array.from(l.get(c.id)||[]).map(C=>JSON.parse(C));o.push({id:m.id,product_id:c.id,name:c.name,category:c.category,sku:c.sku,color:c.color,quoted_price:m.quoted_price,margin_percentage:m.margin_percentage,priceType:"custom",status:"active",supportedPrinters:d,departmentsSupplied:f})}),o}}),zi=s=>{const e=s.match(/^CE(\d+)[A-Z]$/i);if(e)return{320:"128A",321:"128A",322:"128A",323:"128A"}[e[1]]||`${e[1]}A`;const r=[/[_-](BK|BLACK|K)$/i,/[_-](C|CYAN)$/i,/[_-](M|MAGENTA)$/i,/[_-](Y|YELLOW)$/i,/[_-](R|RED)$/i,/[_-](B|BLUE)$/i,/[_-](G|GREEN)$/i,/[A-Z]$/];let a=s;return r.forEach(i=>{const n=a.replace(i,"");n.length>0&&(a=n)}),a},Wi=s=>{const e={};return s.forEach(r=>{var n;const a=zi(r.sku),i=a;e[i]||(e[i]={name:r.name,category:r.category,baseSku:a,colors:[],priceType:r.priceType,status:r.status,supportedPrinters:[...r.supportedPrinters],departmentsSupplied:((n=r.departmentsSupplied)==null?void 0:n.map(l=>({clientName:l.clientName,departmentName:l.departmentName||l.clientName||"",locationName:l.locationName||l.departmentName||l.clientName||""})))||[],customPricing:r.quoted_price?{quoted_price:r.quoted_price,margin_percentage:r.margin_percentage}:void 0,allProducts:[],skus:[],productSkus:[]}),r.color&&!e[i].colors.includes(r.color)&&e[i].colors.push(r.color),e[i].skus.includes(r.sku)||(e[i].skus.push(r.sku),e[i].productSkus.push({sku:r.sku,color:r.color})),r.supportedPrinters.forEach(l=>{e[i].supportedPrinters.some(o=>o.id===l.id)||e[i].supportedPrinters.push(l)}),r.departmentsSupplied.forEach(l=>{const o={clientName:l.clientName,departmentName:l.departmentName||l.clientName||"",locationName:l.locationName||l.departmentName||l.clientName||""};e[i].departmentsSupplied.find(c=>c.departmentName===o.departmentName&&c.locationName===o.locationName&&c.clientName===o.clientName)||e[i].departmentsSupplied.push(o)}),e[i].allProducts.push(r)}),e},Hi=(s,e,r,a)=>s.filter(i=>{const n=i.name.toLowerCase().includes(e.toLowerCase())||i.sku.toLowerCase().includes(e.toLowerCase())||i.category.toLowerCase().includes(e.toLowerCase()),l=r==="all"||i.status===r,o=a==="all"||i.priceType===a;return n&&l&&o}),Ki=({clientId:s})=>{lr();const{userProfile:e}=lt(),[r,a]=h.useState(""),[i,n]=h.useState("all"),[l,o]=h.useState("all"),[m,c]=h.useState(null),[d,f]=h.useState(!1);h.useState("grid");const C=e&&!["admin","sales_admin"].includes(e.role||""),{data:A=[],isLoading:M,refetch:k}=Bi(s),b=Hi(A,r,i,l),j=Wi(b),_=Object.entries(j),B=y=>{const E=y.allProducts[0];console.log("ClientProduct object:",E),console.log("product_id:",E.product_id),console.log("id:",E.id);const H={id:E.product_id,name:E.name,sku:E.sku,category:E.category,color:E.color,created_at:"",updated_at:""};console.log("Created Product object:",H),c(H),f(!0)},z=()=>{f(!1),c(null),k()};return M?t.jsx(fs,{message:"Loading products"}):t.jsxs("div",{className:"space-y-4 pb-20",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(Gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),t.jsx("input",{type:"text",value:r,onChange:y=>a(y.target.value),className:"w-full pl-10 pr-4 h-10 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white",placeholder:"Search products..."})]}),!C&&t.jsxs(ce,{size:"sm",variant:"outline",className:"h-10 px-3 text-xs whitespace-nowrap touch-target",children:[t.jsx(Et,{className:"w-3 h-3 mr-1"}),"Add"]})]}),_.length===0?t.jsx(Os,{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:t.jsxs(Is,{className:"p-8 text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:t.jsx(vt,{className:"h-8 w-8 text-gray-400"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),t.jsx("p",{className:"text-gray-600 text-sm mb-6 max-w-sm mx-auto",children:r||i!=="all"||l!=="all"?"Try adjusting your search or filters to find products.":"Products will appear automatically based on assigned printers and their compatibility."})]})}):t.jsx("div",{className:"grid grid-cols-1 gap-3",children:_.map(([y,E])=>t.jsx(Ua,{productGroup:E,onEdit:B},y))}),m&&t.jsx(or,{isOpen:d,onClose:()=>{f(!1),c(null)},product:m,variants:m&&j[m.sku]?j[m.sku].allProducts.map(y=>({id:y.product_id,name:y.name,sku:y.sku,category:y.category,color:y.color,alias:"",description:"",created_at:"",updated_at:""})):[],onProductUpdated:z})]})},Yi=({isOpen:s,onClose:e})=>{const{userProfile:r,user:a}=lt(),{toast:i}=it(),[n,l]=h.useState((r==null?void 0:r.email)||""),[o,m]=h.useState(!1),[c,d]=h.useState(""),[f,C]=h.useState(""),[A,M]=h.useState(""),[k,b]=h.useState(""),[j,_]=h.useState(""),B=async()=>{if(a){m(!0);try{const{error:y}=await Q.auth.updateUser({email:n.trim()});if(y)throw y;i({title:"Success",description:"Email update confirmation has been sent to your new email."})}catch{i({title:"Error",description:"Failed to update email.",variant:"destructive"})}finally{m(!1)}}},z=async y=>{if(y.preventDefault(),b(""),_(""),!c||!f||!A){b("All password fields are required.");return}if(f!==A){b("New passwords do not match.");return}try{const{error:E}=await Q.auth.signInWithPassword({email:(r==null?void 0:r.email)||"",password:c});if(E){b("Current password is incorrect.");return}const{error:H}=await Q.auth.updateUser({password:f});if(H)throw H;_("Password updated successfully."),d(""),C(""),M("")}catch{b("Failed to update password.")}};return t.jsx(Be,{open:s,onOpenChange:e,children:t.jsxs(ze,{className:"sm:max-w-md",children:[t.jsx(We,{children:t.jsxs(He,{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:t.jsx(bs,{className:"h-5 w-5 text-white"})}),t.jsx("span",{children:"Update Profile"})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"Email Address"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(Ee,{type:"email",value:n,onChange:y=>l(y.target.value),placeholder:"Enter new email"}),t.jsx(ce,{onClick:B,disabled:o||n===(r==null?void 0:r.email),children:o?"Updating...":"Update"})]})]}),t.jsxs("div",{className:"space-y-2 pt-4 border-t",children:[t.jsx("h4",{className:"font-medium",children:"Change Password"}),t.jsxs("form",{onSubmit:z,className:"space-y-2",children:[t.jsx(Ee,{type:"password",value:c,onChange:y=>d(y.target.value),placeholder:"Current Password"}),t.jsx(Ee,{type:"password",value:f,onChange:y=>C(y.target.value),placeholder:"New Password"}),t.jsx(Ee,{type:"password",value:A,onChange:y=>M(y.target.value),placeholder:"Confirm New Password"}),k&&t.jsx("p",{className:"text-red-600 text-sm",children:k}),j&&t.jsx("p",{className:"text-green-600 text-sm",children:j}),t.jsx(ce,{type:"submit",className:"w-full",variant:"secondary",children:"Change Password"})]})]})]})]})})},Ji=({clientId:s})=>{const[e,r]=h.useState("departments"),[a,i]=h.useState(!1),[n,l]=h.useState(!1),{data:o,isLoading:m,error:c,refetch:d}=Ue({queryKey:["client",s],queryFn:async()=>{if(!s)throw new Error("Client ID required");const C=await qt.getClientById(s);if(!C)throw new Error("Client not found");return C},enabled:!!s}),f=h.useCallback(C=>{d(),i(!1)},[d]);return{client:o,isLoading:m,error:c,refetch:d,activeTab:e,setActiveTab:r,isDepartmentDetailsView:n,setIsDepartmentDetailsView:l,showEditModal:a,setShowEditModal:i,handleClientUpdated:f}};function Qi(s){const e=s.length,r=s.reduce((i,n)=>{var l;return i+(((l=n.locations)==null?void 0:l.length)||0)},0),a=s.reduce((i,n)=>{var l;return i+(((l=n.locations)==null?void 0:l.reduce((o,m)=>o+(m.printer_count||0),0))||0)},0);return{departmentCount:e,locationCount:r,printerCount:a}}const Gi={black:"bg-black",cyan:"bg-cyan-500",magenta:"bg-pink-500",yellow:"bg-yellow-400"},Zr=({color:s})=>{const e=Gi[s==null?void 0:s.toLowerCase()];return e?t.jsx("div",{className:`w-3 h-3 rounded-full ${e}`}):null},Xi=({printer:s,onManage:e,clientId:r,departmentName:a,locationName:i})=>{var J,pe,ye,S,K,F,R,$,Y,Ne,ue,we;const[n,l]=h.useState([]),[o,m]=h.useState(!1);h.useState(null);const[c,d]=h.useState(!1),[f,C]=h.useState(!1),[A,M]=h.useState(null),[k,b]=h.useState(!1),{userProfile:j}=lt(),_=j&&!["admin","sales_admin"].includes(j.role||"");h.useEffect(()=>{(async()=>{if(s.printer_id){m(!0);try{const ne=await Tt.getProductsByPrinter(s.printer_id);if(r&&ne.length>0){const g=ne.map(re=>re.id),{data:p,error:N}=await Q.from("product_clients").select("product_id, quoted_price").eq("client_id",r).in("product_id",g);if(N)throw N;const se=ne.map(re=>{const U=p==null?void 0:p.find(W=>W.product_id===re.id);return{...re,client_price:U==null?void 0:U.quoted_price}});l(se)}else l(ne)}catch(ne){console.error("Failed to fetch compatible products:",ne),l([])}m(!1)}})()},[s.printer_id,r]);const B=ee=>{switch(ee==null?void 0:ee.toLowerCase()){case"active":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},z=ee=>{_||(M(ee),d(!0))},y=(ee,ne)=>{_||(ee.stopPropagation(),M(ne),C(!0))},E=async(ee,ne)=>{console.log("Price saved successfully:",{clientId:ee,price:ne,productId:A==null?void 0:A.id}),C(!1),(async()=>{if(s.printer_id)try{const p=await Tt.getProductsByPrinter(s.printer_id);if(r&&p.length>0){const N=p.map(W=>W.id),{data:se,error:re}=await Q.from("product_clients").select("product_id, quoted_price").eq("client_id",r).in("product_id",N);if(re)throw re;const U=p.map(W=>{const xe=se==null?void 0:se.find(w=>w.product_id===W.id);return{...W,client_price:xe==null?void 0:xe.quoted_price}});l(U)}}catch(p){console.error("Failed to refresh products:",p)}})()},H=ee=>{ee.target.closest(".printer-settings-dropdown")||ee.target.closest(".modal")||b(ne=>!ne)},X=!!e;return t.jsxs("div",{className:"bg-orange-50/50 border border-orange-200/80 rounded-lg p-3 my-2 shadow-sm select-none "+(X?"cursor-pointer":"cursor-default"),...X?{onClick:H}:{},children:[t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("img",{src:((J=s.printer)==null?void 0:J.image_url)||"/placeholder.svg",alt:((pe=s.printer)==null?void 0:pe.name)||"Printer",className:"w-24 h-24 object-cover rounded-md flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[i&&t.jsx("p",{className:"text-sm font-medium text-blue-600 mb-1",children:i}),t.jsx("h4",{className:"font-bold text-gray-800",children:[(ye=s.printer)==null?void 0:ye.manufacturer,(S=s.printer)==null?void 0:S.series,((K=s.printer)==null?void 0:K.model)||((F=s.printer)==null?void 0:F.name)].filter(Boolean).join(" ")}),((R=s.printer)==null?void 0:R.sku)&&t.jsxs("div",{className:"text-xs text-gray-500 font-mono mb-1",children:["SKU: ",s.printer.sku]}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Serial: ",s.serial_number||"N/A"]}),(($=s.printer)==null?void 0:$.color)&&t.jsx(Zr,{color:s.printer.color}),((Ne=(Y=s.printer)==null?void 0:Y.color)==null?void 0:Ne.toLowerCase())==="black"&&t.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 text-xs rounded-full bg-gray-200 text-gray-800 font-semibold",children:"Monochrome"}),((we=(ue=s.printer)==null?void 0:ue.color)==null?void 0:we.toLowerCase())==="color"&&t.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 text-xs rounded-full bg-blue-200 text-blue-800 font-semibold",children:"Colored"})]}),t.jsx("div",{className:"flex flex-col items-center space-y-2 printer-settings-dropdown",children:t.jsx(Le,{variant:"outline",className:`capitalize text-xs ${B(s.status)}`,children:s.status||"Unknown"})})]}),(!X||!k)&&t.jsx("div",{className:"mt-3 pt-3 border-t border-orange-200/50",children:o?t.jsx("p",{className:"text-xs text-gray-500 italic",children:"Loading products..."}):n.length>0?t.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(ee=>t.jsxs(Le,{variant:"outline",className:`flex items-center space-x-2 py-1 px-2 text-xs ${_?"cursor-default":"cursor-pointer hover:bg-gray-50"}`,onClick:()=>z(ee),title:_?"Product information":"Click to edit product info",children:[ee.color&&t.jsx(Zr,{color:ee.color}),t.jsxs("span",{className:"font-medium",children:[ee.name,ee.sku&&t.jsxs("span",{className:"text-gray-500",children:[" (",ee.sku,")"]})]}),!_&&t.jsxs("span",{className:"font-semibold text-blue-600 ml-2 underline decoration-dotted cursor-pointer hover:text-blue-800",onClick:ne=>y(ne,ee),title:"Click to manage pricing",children:[": ₱",typeof ee.client_price=="number"?ee.client_price.toFixed(2):"0.00"]})]},ee.id))}):t.jsx("p",{className:"text-xs text-gray-500 italic",children:"No compatible products found."})}),A&&t.jsx(or,{isOpen:c,onClose:()=>{d(!1),M(null)},product:A,onProductUpdated:()=>{d(!1),M(null)}}),A&&r&&t.jsx(Ca,{open:f,onOpenChange:ee=>{C(ee),ee||M(null)},availableClients:[{id:r,name:"Current Client"}],onSave:E,initialClientId:r,initialPrice:A.client_price||0,productId:A.id})]})};function qr(){const[s,e]=h.useState([]),[r,a]=h.useState(!0),[i,n]=h.useState(null),l="c716cb3b-0765-4271-b88f-e1ecff73ec24";return h.useEffect(()=>{async function o(){a(!0),n(null);const{data:m,error:c}=await Q.from("printer_visibility").select("printer_id").eq("client_id",l);if(c){n("Failed to load printer visibility data."),a(!1);return}const d=(m||[]).map(A=>A.printer_id);if(d.length===0){e([]),a(!1);return}const{data:f,error:C}=await Q.from("printers").select("id, name, manufacturer, model, series, image_url, color, status").in("id",d);if(C){n("Failed to load printer details."),a(!1);return}e(f||[]),a(!1)}o()},[l]),r?t.jsx("div",{className:"py-12 text-center text-gray-500",children:"Loading printers..."}):i?t.jsx("div",{className:"py-12 text-center text-red-500",children:i}):s.length===0?t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"bg-blue-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6",children:t.jsx("svg",{className:"w-10 h-10 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Printers Found"}),t.jsxs("p",{className:"text-gray-600 mb-4",children:["There are currently no printers visible to your account.",t.jsx("br",{}),"Please contact support if you believe this is an error."]})]})}):t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Printers Visible to You"}),t.jsx("div",{className:"space-y-4",children:s.map(o=>t.jsx(Xi,{printer:{printer:o,printer_id:o.id,serial_number:void 0,status:o.status},clientId:l},o.id))})]})}function el(){return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"bg-orange-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6",children:t.jsxs("svg",{className:"w-10 h-10 text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"🚧 We're Still Working on This Section"}),t.jsxs("p",{className:"text-gray-600 mb-2",children:["Hi there! ",t.jsx("span",{role:"img","aria-label":"wave",children:"👋"})]}),t.jsxs("p",{className:"text-gray-600 mb-4",children:["This part of the site is still under construction — but don't worry, we're here to help if you need support right away.",t.jsx("br",{}),t.jsx("br",{}),t.jsxs("span",{className:"block my-2",children:["📞 ",t.jsx("span",{className:"font-semibold",children:"Call us at 0977 11 88880"})," to schedule assistance."]}),t.jsxs("span",{className:"block my-2",children:["🕒 ",t.jsx("span",{className:"font-semibold",children:"Support Hours:"})," 8:00 AM – 4:00 PM"]}),t.jsxs("span",{className:"block my-2",children:["If you reach out before ",t.jsx("span",{className:"font-semibold",children:"10:00 AM"}),", we'll do our best to fit you in the same afternoon, depending on our current queue."]}),t.jsxs("span",{className:"block my-2",children:["We aim to resolve all issues within ",t.jsx("span",{className:"font-semibold",children:"48 hours"}),"."]})]}),t.jsx("p",{className:"text-gray-500 italic",children:"Thanks for your patience and understanding!"})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[t.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[t.jsx("span",{role:"img","aria-label":"printer",className:"mr-2",children:"🖨️"}),"Common Details Needed for Printer Issue Reports"]}),t.jsx("p",{className:"text-gray-600 mb-4",children:"To help us assist you faster and more efficiently, please provide the following details when reporting a printer issue:"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"Error Message (if any)"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Exact wording or a screenshot of the message displayed."})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"Printer Model"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Example: HP LaserJet Pro M404dn"})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"Serial Number or Asset Tag"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Found on a sticker on the back or bottom of the printer."})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"Issue Description"}),t.jsx("p",{className:"text-sm text-gray-600",children:"What's happening? (e.g., paper jam, not printing, blank pages)"})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"When Did the Issue Start?"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Approximate date and time the issue began."})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"Steps Already Taken"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Any troubleshooting you've tried (e.g., restarted printer, replaced toner, checked cables)"})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"Connection Type"}),t.jsx("p",{className:"text-sm text-gray-600",children:"USB / Network / Wi-Fi"})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"Printer Location"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Office name, floor, or room number to help us locate the unit."})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"Contact Person"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Name and number of the person we can contact for further details."})]})]})]})]})}function tl(s,e){const r=h.useRef(null);return h.useCallback((...a)=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>s(...a),e)},[s,e])}const sl=s=>{const[e,r]=h.useState(!1),[a,i]=h.useState(null),n=h.useCallback(async(o,m=0)=>{r(!0),i(null);try{const{data:c,error:d}=await Q.from("printers").select(`
          id,
          name,
          manufacturer,
          model,
          created_at,
          updated_at,
          status,
          printer_assignments(
            id,
            client_id,
            status,
            serial_number,
            clients(id, name)
          ),
          product_printers:product_printers(
            product:products(id, name, sku, color)
          )
        `).eq("status","active").ilike("name",`%${o}%`).range(m*50,m*50+49);if(!d&&c){const f=c.map(C=>({...C,compatibleProducts:(C.product_printers||[]).map(A=>A.product).filter(Boolean)}));s(f)}else i("Failed to fetch printers")}catch(c){i(c instanceof Error?c.message:"Failed to fetch printers")}finally{r(!1)}},[s]),l=tl(n,300);return{performSearch:n,debouncedPerformSearch:l,loading:e,error:a}},rl=({isOpen:s,onClose:e,onPrinterSelected:r})=>{const[a,i]=h.useState(""),[n,l]=h.useState(""),[o,m]=h.useState({}),{data:c=[],isLoading:d}=Ue({queryKey:["available-printers"],queryFn:async()=>{const{data:k,error:b}=await Q.from("printers").select(`
          id,
          name,
          manufacturer,
          model,
          series,
          color,
          printer_assignments!left(id, status),
          image_url
        `).order("name");if(b)throw b;return k||[]},enabled:s}),f=c.filter(k=>{const b=k.name.toLowerCase().includes(a.toLowerCase())||k.model&&k.model.toLowerCase().includes(a.toLowerCase())||k.manufacturer&&k.manufacturer.toLowerCase().includes(a.toLowerCase()),_=(o[k.id]||[]).some(B=>B.name&&B.name.toLowerCase().includes(a.toLowerCase())||B.sku&&B.sku.toLowerCase().includes(a.toLowerCase()));return b||_});h.useEffect(()=>{if(!s)return;(async()=>{const b={};for(const j of c)try{const _=await Tt.getProductsByPrinter(j.id);b[j.id]=_}catch{b[j.id]=[]}m(b)})()},[c,s]);const C=()=>{const k=c.find(b=>b.id===n);k&&(r(k.id,k.name),A())},A=()=>{i(""),l(""),e()},M=k=>{var j;return(((j=k.printer_assignments)==null?void 0:j.filter(_=>_.status==="active"))||[]).length===0?{status:"available",label:"Available",color:"bg-green-100 text-green-700"}:{status:"assigned",label:"Currently Assigned",color:"bg-blue-100 text-blue-700"}};return t.jsx(Be,{open:s,onOpenChange:A,children:t.jsxs(ze,{className:"sm:max-w-md max-h-[80vh] overflow-y-auto",children:[t.jsx(We,{children:t.jsxs(He,{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:t.jsx(st,{className:"h-5 w-5 text-white"})}),t.jsx("span",{children:"Select Printer"})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx(Gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),t.jsx(Ee,{type:"text",placeholder:"Search printers...",value:a,onChange:k=>i(k.target.value),className:"pl-10"})]}),d?t.jsx(fs,{message:"Loading printers"}):f.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(st,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"No printers found"})]}):t.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:f.map(k=>{const b=M(k),j=n===k.id;return t.jsx(Os,{className:`cursor-pointer transition-colors ${j?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>l(k.id),children:t.jsx(Is,{className:"p-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"w-14 h-14 flex-shrink-0 flex items-center justify-center bg-gray-100 rounded border overflow-hidden mr-3",children:k.image_url?t.jsx("img",{src:k.image_url,alt:k.name,className:"object-contain w-full h-full"}):t.jsx(st,{className:"h-8 w-8 text-gray-400"})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx("h4",{className:"font-medium text-sm",children:k.name}),j&&t.jsx(Ys,{className:"h-4 w-4 text-blue-600"})]}),t.jsxs("div",{className:"space-y-1",children:[k.model&&t.jsxs("p",{className:"text-xs text-gray-600",children:["Model: ",k.model]}),k.manufacturer&&t.jsxs("p",{className:"text-xs text-gray-600",children:["Manufacturer: ",k.manufacturer]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Le,{variant:"secondary",className:`text-xs ${b.color}`,children:b.label}),k.color&&t.jsx(Le,{variant:"outline",className:"text-xs",children:k.color})]})]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[t.jsx("span",{className:"font-semibold",children:"Toner:"})," ",o[k.id]&&o[k.id].length>0?o[k.id].map((_,B)=>t.jsxs("span",{className:"inline-block mr-2",children:[_.name,_.sku?` (${_.sku})`:""]},_.id||B)):t.jsx("span",{className:"text-gray-400 ml-1",children:"None"})]})]})]})})},k.id)})}),t.jsxs("div",{className:"flex space-x-3 pt-4",children:[t.jsx(ce,{type:"button",variant:"outline",onClick:A,className:"flex-1",children:"Cancel"}),t.jsx(ce,{onClick:C,disabled:!n,className:"flex-1",children:"Select Printer"})]})]})]})})},al=({isOpen:s,onClose:e,printerId:r,printerName:a,onAssignmentCreated:i,preSelectedClientId:n})=>{const[l,o]=h.useState([]),[m,c]=h.useState(null),[d,f]=h.useState({clientId:n||"",departmentLocationId:"",deploymentDate:"",usageType:"service_unit",monthlyPrice:"",hasSecurityDeposit:!1,securityDepositAmount:"",notes:""}),[C,A]=h.useState(null),[M,k]=h.useState(null),[b,j]=h.useState(!1),[_,B]=h.useState(!1),[z,y]=h.useState(""),[E,H]=h.useState(!1),[X,J]=h.useState([]),[pe,ye]=h.useState(""),{toast:S}=it(),[K,F]=h.useState([]),[R,$]=h.useState(!1);h.useEffect(()=>{(async()=>{if(!d.clientId){F([]);return}$(!0);try{const N=await qt.getDepartmentsByClient(d.clientId);F(N)}catch{F([])}$(!1)})()},[d.clientId]),h.useEffect(()=>{if(s){Y(),Ne(),ue();const p=new Date().toISOString().split("T")[0];f(N=>({...N,deploymentDate:p,clientId:n||""}))}},[s,n,r]),h.useEffect(()=>{s&&!n&&Y()},[s,n]);const Y=async()=>{try{const p=await qt.getClients();o(p)}catch(p){console.error("Failed to load clients:",p),S({title:"Error",description:"Failed to load clients. Please try again.",variant:"destructive"})}},Ne=async()=>{try{const{data:p,error:N}=await Q.from("printers").select("id, name, manufacturer, model, series, image_url").eq("id",r).single();if(N)throw N;c(p)}catch(p){console.error("Failed to load printer details:",p)}},ue=async()=>{try{const{data:p,error:N}=await Q.from("printer_assignments").select("id, serial_number, usage_type").eq("printer_id",r).eq("status","available").order("serial_number");if(N)throw N;J(p||[]),p&&p.length>0&&ye(p[0].id)}catch(p){console.error("Failed to load available assignments:",p)}},we=async()=>{if(!z.trim()||!d.clientId){S({title:"Error",description:"Please enter a department name.",variant:"destructive"});return}H(!0);try{const{data:p,error:N}=await Q.from("departments").insert({client_id:d.clientId,name:z.trim()}).select().single();if(N)throw N;const{data:se,error:re}=await Q.from("departments_location").insert({department_id:p.id,client_id:d.clientId,name:"Main",is_primary:!0}).select().single();if(re)throw re;S({title:"Success",description:"Department created successfully!"});const U=await qt.getDepartmentsByClient(d.clientId);F(U),f(W=>({...W,departmentLocationId:se.id})),y(""),B(!1)}catch(p){console.error("Failed to create department:",p),S({title:"Error",description:"Failed to create department. Please try again.",variant:"destructive"})}finally{H(!1)}},ee=async p=>{if(p.preventDefault(),!d.clientId||!d.departmentLocationId||!d.deploymentDate||!pe){S({title:"Error",description:"Please fill in all required fields (Client, Department Location, Deployment Date, and Serial Number).",variant:"destructive"});return}j(!0);try{const{error:N}=await Q.from("printer_assignments").update({client_id:d.clientId,department_location_id:d.departmentLocationId,deployment_date:d.deploymentDate,usage_type:d.usageType,monthly_price:d.usageType==="rental"&&d.monthlyPrice?parseFloat(d.monthlyPrice):null,has_security_deposit:d.hasSecurityDeposit,security_deposit_amount:d.hasSecurityDeposit&&d.securityDepositAmount?parseFloat(d.securityDepositAmount):null,notes:d.notes||null,status:"active"}).eq("id",pe);if(N)throw N;S({title:"Success",description:"Printer assigned to client successfully!"}),i(),ne()}catch(N){console.error("Failed to assign printer:",N),S({title:"Error",description:"Failed to assign printer. Please try again.",variant:"destructive"})}finally{j(!1)}},ne=()=>{f({clientId:n||"",departmentLocationId:"",deploymentDate:"",usageType:"service_unit",monthlyPrice:"",hasSecurityDeposit:!1,securityDepositAmount:"",notes:""}),A(null),k(null),B(!1),y(""),J([]),ye(""),e()},g=(p,N)=>{N==="contract"?A(p):k(p)};return l.find(p=>p.id===d.clientId),s?t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-h-[95vh] sm:max-w-lg sm:rounded-2xl sm:shadow-2xl flex flex-col",children:[t.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 sm:rounded-t-2xl",children:t.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"bg-blue-100 p-2.5 rounded-xl",children:t.jsx(Et,{className:"h-5 w-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Assign Printer"}),t.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Assigning printer to client"})]})]}),t.jsx("button",{onClick:ne,className:"p-2 -m-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-100",children:t.jsx(Br,{className:"h-5 w-5"})})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto",children:[m&&t.jsx("div",{className:"p-4 sm:p-6 border-b border-gray-100 bg-gradient-to-br from-blue-50 to-indigo-50",children:t.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-blue-100",children:t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("div",{className:"w-16 h-16 flex-shrink-0 flex items-center justify-center bg-gray-50 rounded-xl border-2 border-gray-200 overflow-hidden",children:m.image_url?t.jsx("img",{src:m.image_url,alt:m.name,className:"object-contain w-full h-full"}):t.jsx(st,{className:"h-8 w-8 text-gray-400"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-bold text-gray-900 text-lg mb-2",children:m.name}),t.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[m.manufacturer&&t.jsx(Le,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:m.manufacturer}),m.model&&t.jsx(Le,{variant:"outline",className:"text-xs",children:m.model}),m.series&&t.jsx(Le,{variant:"outline",className:"text-xs",children:m.series})]}),t.jsx(Wr,{printerId:m.id,className:"mb-4"}),X.length>0&&t.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[t.jsx("label",{className:"text-sm font-semibold text-red-600 mb-3 block",children:"Select Serial Number *"}),t.jsxs(Re,{value:pe,onValueChange:ye,children:[t.jsx($e,{className:"w-full h-12 text-left",children:t.jsx(Ze,{placeholder:"Choose a serial number"})}),t.jsx(qe,{children:X.map(p=>t.jsx(De,{value:p.id,children:p.serial_number||`Assignment ID: ${p.id.slice(0,8)}...`},p.id))})]})]})]})]})})}),t.jsxs("form",{onSubmit:ee,className:"p-4 sm:p-6 space-y-6",children:[!n&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center",children:[t.jsx(cr,{className:"h-4 w-4 mr-2 text-blue-500"}),"Client *"]}),t.jsxs(Re,{value:d.clientId,onValueChange:p=>f(N=>({...N,clientId:p,departmentLocationId:""})),children:[t.jsx($e,{className:"w-full h-12 text-left",children:t.jsx(Ze,{placeholder:"Select a client"})}),t.jsx(qe,{children:l.map(p=>t.jsx(De,{value:p.id,children:p.name},p.id))})]})]}),d.clientId&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center",children:[t.jsx(Ks,{className:"h-4 w-4 mr-2 text-blue-500"}),"Department / Location *"]}),R?t.jsx(fs,{message:"Loading departments"}):t.jsxs(t.Fragment,{children:[t.jsxs(Re,{value:d.departmentLocationId,onValueChange:p=>f(N=>({...N,departmentLocationId:p})),disabled:_,children:[t.jsx($e,{className:"w-full h-12 text-left",children:t.jsx(Ze,{placeholder:"Select a department and location"})}),t.jsx(qe,{children:K.map(p=>t.jsx(De,{value:p.id,children:p.name},p.id))})]}),t.jsxs(ce,{type:"button",variant:"outline",size:"sm",className:"w-full sm:w-auto text-sm h-10",onClick:()=>B(!_),children:[t.jsx(Et,{className:"h-4 w-4 mr-2"}),_?"Cancel":"Create New Department"]})]})]}),_&&t.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 rounded-xl border border-gray-200",children:[t.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"New Department Name"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx(Ee,{type:"text",placeholder:"Enter department name",value:z,onChange:p=>y(p.target.value),className:"flex-1 h-12"}),t.jsx(ce,{type:"button",onClick:we,disabled:E||!z.trim(),className:"h-12 px-4",children:E?"Creating...":"Create"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{htmlFor:"deploymentDate",className:"text-sm font-semibold text-gray-700 flex items-center",children:[t.jsx(Ta,{className:"h-4 w-4 mr-2 text-blue-500"}),"Deployment Date *"]}),t.jsx("input",{type:"date",id:"deploymentDate",value:d.deploymentDate,onChange:p=>f(N=>({...N,deploymentDate:p.target.value})),required:!0,disabled:b,className:"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 text-base"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Usage Type"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select the usage type for this assignment."})]}),t.jsxs(Re,{value:d.usageType,onValueChange:p=>f(N=>({...N,usageType:p})),disabled:b,children:[t.jsx($e,{className:"w-full sm:w-48 h-12 text-left",children:t.jsx(Ze,{})}),t.jsxs(qe,{children:[t.jsx(De,{value:"service_unit",children:"Service Unit"}),t.jsx(De,{value:"client_owned",children:"Client Owned"}),t.jsx(De,{value:"rental",children:"Rental"})]})]})]}),d.usageType==="rental"&&t.jsxs("div",{className:"space-y-3 p-4 bg-yellow-50 rounded-xl border border-yellow-200",children:[t.jsxs("label",{htmlFor:"monthlyPrice",className:"text-sm font-semibold text-gray-700 flex items-center",children:[t.jsx(Ja,{className:"h-4 w-4 mr-2 text-yellow-600"}),"Monthly Rental Price"]}),t.jsx("input",{type:"number",id:"monthlyPrice",value:d.monthlyPrice,onChange:p=>f(N=>({...N,monthlyPrice:p.target.value})),disabled:b,min:"0",step:"0.01",className:"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 text-base",placeholder:"0.00"})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ia,{className:"h-5 w-5 text-gray-600"}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Security Deposit"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Does this assignment require a security deposit?"})]})]}),t.jsx(Hr,{checked:d.hasSecurityDeposit,onCheckedChange:p=>f(N=>({...N,hasSecurityDeposit:p})),disabled:b})]}),d.hasSecurityDeposit&&t.jsxs("div",{className:"space-y-3 p-4 bg-red-50 rounded-xl border border-red-200",children:[t.jsx("label",{htmlFor:"securityDepositAmount",className:"text-sm font-semibold text-gray-700",children:"Security Deposit Amount"}),t.jsx("input",{type:"number",id:"securityDepositAmount",value:d.securityDepositAmount,onChange:p=>f(N=>({...N,securityDepositAmount:p.target.value})),disabled:b,min:"0",step:"0.01",className:"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 text-base",placeholder:"0.00"})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h4",{className:"text-sm font-semibold text-gray-700 flex items-center",children:[t.jsx(rn,{className:"h-4 w-4 mr-2 text-blue-500"}),"Documents (Optional)"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Contract Agreement"}),t.jsx("div",{className:"relative",children:t.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:p=>{var N;return((N=p.target.files)==null?void 0:N[0])&&g(p.target.files[0],"contract")},disabled:b,className:"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})}),C&&t.jsxs("p",{className:"text-xs text-green-600 flex items-center",children:[t.jsx(_r,{className:"h-3 w-3 mr-1"}),"Selected: ",C.name]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Accountability Agreement"}),t.jsx("div",{className:"relative",children:t.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:p=>{var N;return((N=p.target.files)==null?void 0:N[0])&&g(p.target.files[0],"accountability")},disabled:b,className:"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})}),M&&t.jsxs("p",{className:"text-xs text-green-600 flex items-center",children:[t.jsx(_r,{className:"h-3 w-3 mr-1"}),"Selected: ",M.name]})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{htmlFor:"notes",className:"text-sm font-semibold text-gray-700",children:"Notes (Optional)"}),t.jsx(Fs,{id:"notes",value:d.notes,onChange:p=>f(N=>({...N,notes:p.target.value})),disabled:b,placeholder:"Additional notes about this assignment...",className:"w-full min-h-[100px] resize-none text-base",rows:4})]})]})]}),t.jsx("div",{className:"sticky bottom-0 z-10 bg-white border-t border-gray-200 sm:rounded-b-2xl",children:t.jsx("div",{className:"p-4 sm:p-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3",children:[t.jsx(ce,{type:"button",variant:"outline",onClick:ne,disabled:b,className:"w-full sm:w-auto h-12 text-base font-medium",children:"Cancel"}),t.jsx(ce,{onClick:ee,disabled:b,className:"w-full sm:w-auto h-12 text-base font-medium bg-blue-600 hover:bg-blue-700 text-white",children:b?t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Assigning..."]}):"Assign Printer"})]})})})]})}):null},nl=({isOpen:s,onClose:e,onPrinterAdded:r,clientId:a})=>{const{toast:i}=it(),{userProfile:n}=lt(),[l,o]=h.useState(""),[m,c]=h.useState([]),[d,f]=h.useState(""),[C,A]=h.useState([]),[M,k]=h.useState([]),[b,j]=h.useState(""),[_,B]=h.useState(""),[z,y]=h.useState(!1),[E,H]=h.useState(!1),[X,J]=h.useState(!0);h.useEffect(()=>{s&&((n==null?void 0:n.role)==="admin"?J(!1):J(!0))},[s,n==null?void 0:n.role]),h.useEffect(()=>{s&&a&&(Q.from("departments").select("id, name, departments_location(id, name)").eq("client_id",a).then(({data:S})=>A(S||[])),o(""),c([]),f(""),j(""),B(""))},[s,a]),h.useEffect(()=>{b?Q.from("departments_location").select("id, name").eq("department_id",b).then(({data:S})=>k(S||[])):(k([]),B(""))},[b]),h.useEffect(()=>{if(l.length<2){c([]);return}let S=!1;return H(!0),jr.searchPrinters(l).then(K=>{S||(c(K.map(F=>F.name)),H(!1))}),()=>{S=!0}},[l]);const pe=S=>{if(!S){j(""),B("");return}const K=S.replace("loc-",""),F=C.find(R=>R.departments_location.some($=>$.id===K));j(F?F.id:""),B(K)},ye=async S=>{if(S.preventDefault(),!l.trim()||!d.trim()){i({title:"Error",description:"Printer name and serial number are required.",variant:"destructive"});return}y(!0);try{const F={printer_id:(await jr.findOrCreatePrinter(l.trim())).id,serial_number:d.trim(),usage_type:X?"client_owned":"service_unit",status:!b&&!_?"undeployed":"active",is_client_owned:X,client_id:a};_&&(F.department_location_id=_);const{error:R}=await Q.from("printer_assignments").insert(F);if(R)throw R;i({title:"Success",description:"Company printer added successfully."}),r(),e()}catch(K){i({title:"Error",description:K.message||"Failed to add company printer.",variant:"destructive"})}finally{y(!1)}};return t.jsx(Be,{open:s,onOpenChange:e,children:t.jsxs(ze,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto",children:[t.jsx(We,{children:t.jsx(He,{children:"Add Company Printer"})}),t.jsxs("form",{onSubmit:ye,className:"space-y-5",children:[t.jsxs("div",{children:[t.jsx(Te,{htmlFor:"printerName",children:"Printer Name *"}),t.jsx(Ee,{id:"printerName",value:l,onChange:S=>o(S.target.value),autoComplete:"off",placeholder:"Type or select printer name",list:"printer-catalog-list",required:!0}),t.jsx("datalist",{id:"printer-catalog-list",children:m.map(S=>t.jsx("option",{value:S},S))}),E&&t.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Searching..."})]}),t.jsxs("div",{children:[t.jsx(Te,{htmlFor:"serialNumber",children:"Serial Number *"}),t.jsx(Ee,{id:"serialNumber",value:d,onChange:S=>f(S.target.value),required:!0,placeholder:"Enter serial number"})]}),t.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[t.jsx("span",{className:`font-semibold ${X?"text-gray-400":"text-green-600"}`,children:"Service Unit"}),t.jsx(Hr,{id:"company_owned_toggle",checked:X,onCheckedChange:J,"aria-label":"Toggle Company Owned"}),t.jsx("span",{className:`font-semibold ${X?"text-green-600":"text-gray-400"}`,children:"Company Owned"})]}),t.jsxs("div",{children:[t.jsx(Te,{htmlFor:"deptLoc",children:"Department / Location"}),t.jsxs(Re,{value:_?`loc-${_}`:"",onValueChange:pe,children:[t.jsx($e,{children:t.jsx(Ze,{placeholder:"Select department or location (optional)"})}),t.jsx(qe,{children:C.flatMap(S=>(S.departments_location||[]).map(K=>t.jsxs(De,{value:`loc-${K.id}`,children:[S.name," / ",K.name]},`loc-${K.id}`)))})]})]}),t.jsxs("div",{className:"flex space-x-3 pt-4",children:[t.jsx(ce,{type:"button",variant:"outline",onClick:e,className:"flex-1",disabled:z,children:"Cancel"}),t.jsx(ce,{type:"submit",className:"flex-1",disabled:z,children:z?"Adding...":"Add Printer"})]})]})]})})},il=({searchQuery:s,onSearchChange:e,placeholder:r,departments:a,onDepartmentSelect:i,onFocus:n,onBlur:l})=>{const[o,m]=h.useState(!1),[c,d]=h.useState(!1),f=h.useRef(null),C=j=>/[a-zA-Z1-9]/.test(j);h.useEffect(()=>{o&&!C(s)&&a.length>1?d(!0):d(!1)},[o,s,a.length]);const A=()=>{m(!0),n()},M=()=>{setTimeout(()=>{m(!1),d(!1),l()},150)},k=j=>{const _=j.target.value;e(_),C(_)&&d(!1)},b=j=>{i(j),d(!1),f.current&&f.current.blur()};return t.jsxs("div",{className:"relative w-full",children:[t.jsx(Gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4 z-10"}),t.jsx(Ee,{ref:f,placeholder:r,value:s,onChange:k,onFocus:A,onBlur:M,className:"w-full pl-10 pr-10 py-2.5 text-sm bg-white/90 border-gray-200 rounded-lg focus:border-orange-400 focus:ring-2 focus:ring-orange-200 transition-all duration-200"}),s&&t.jsx("button",{type:"button",onClick:()=>e(""),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 rounded-full hover:bg-gray-100 transition-colors",children:t.jsx(Br,{className:"h-4 w-4 text-gray-400"})}),c&&t.jsx("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white border border-gray-200 rounded-lg shadow-xl z-[60] max-h-60 overflow-y-auto backdrop-blur-sm",children:t.jsxs("div",{className:"p-3",children:[t.jsxs("div",{className:"text-xs font-medium text-gray-500 mb-3 px-2 flex items-center gap-2",children:[t.jsx(Ks,{className:"h-3 w-3"}),"Jump to a department..."]}),t.jsx("div",{className:"space-y-1",children:a.map(j=>t.jsxs("button",{type:"button",onClick:()=>b(j.id),className:"w-full text-left px-3 py-2.5 text-sm hover:bg-blue-50 rounded-md flex items-center gap-3 transition-all duration-150 group",children:[t.jsx(Ks,{className:"h-4 w-4 text-gray-400 group-hover:text-blue-500 transition-colors"}),t.jsx("span",{className:"font-medium text-gray-700 group-hover:text-blue-700",children:j.name}),j.locations&&j.locations.length>0&&t.jsxs("span",{className:"text-xs text-gray-500 ml-auto bg-gray-100 px-2 py-1 rounded-full group-hover:bg-blue-100 transition-colors",children:[j.locations.length," location",j.locations.length!==1?"s":""]})]},j.id))})]})})]})},ll=({activeTab:s,setActiveTab:e,onFilteredDataChange:r,client:a,onClientUpdated:i})=>{const[n,l]=h.useState(""),[o,m]=h.useState(null),[c,d]=h.useState(!1),[f,C]=h.useState(!1),[A,M]=h.useState(!1),[k,b]=h.useState(!1),[j,_]=h.useState(null),[B,z]=h.useState(!1),[y,E]=h.useState(!1),[H,X]=h.useState(!1),[J,pe]=h.useState(!1),[ye,S]=h.useState(null);h.useState(!1);const[K,F]=h.useState(!1);Da();const R=ir();sl(r);const{clientId:$}=zr(),{userProfile:Y}=lt(),{data:Ne=[]}=Ot($);h.useEffect(()=>{if(!n.trim()){r==null||r([]);return}let U=!1;return(async()=>{const{data:W}=await Q.from("products").select("id").or([`name.ilike.%${n}%`,`sku.ilike.%${n}%`,`alias.ilike.%${n}%`].join(",")),xe=(W||[]).map(oe=>oe.id);let w=[];if(xe.length>0){const{data:oe}=await Q.from("product_printers").select("printer_id").in("product_id",xe);w=(oe||[]).map(Ce=>Ce.printer_id)}const O=[`name.ilike.%${n}%`,`model.ilike.%${n}%`].join(","),{data:le}=await Q.from("printers").select("id").or(O),q=(le||[]).map(oe=>oe.id);console.log("Printer search query:",n,"Printer IDs found:",q);const{data:je}=await Q.from("departments").select("id").ilike("name",`%${n}%`),fe=(je||[]).map(oe=>oe.id);let be=[];if(fe.length>0){const{data:oe}=await Q.from("departments_location").select("id").in("department_id",fe);be=(oe||[]).map(Ce=>Ce.id)}const{data:u}=await Q.from("departments_location").select("id").ilike("name",`%${n}%`),x=(u||[]).map(oe=>oe.id),v=Array.from(new Set([...be,...x])),I=Array.from(new Set([...w,...q])),T=[];I.length&&T.push(`printer_id.in.(${I.join(",")})`),v.length&&T.push(`department_location_id.in.(${v.join(",")})`),T.push(`serial_number.ilike.%${n}%`);const D=T.length>1?T.join(","):T[0];console.log("Printer assignment search .or() clause:",D);const{data:te}=await Q.from("printer_assignments").select(`
          *,
          printer:printers(*),
          location:departments_location(*, department:departments(*))
        `).or(D).eq("status","active").eq("client_id",$),me=(te||[]).map(oe=>{var Ce,et,gs,wt,Nt,ys,It;return{...oe.printer,printer_id:(Ce=oe.printer)==null?void 0:Ce.id,serial_number:oe.serial_number,status:oe.status,printer:oe.printer,assignment_id:oe.id,department_id:(gs=(et=oe.location)==null?void 0:et.department)==null?void 0:gs.id,department_name:(Nt=(wt=oe.location)==null?void 0:wt.department)==null?void 0:Nt.name,location_id:(ys=oe.location)==null?void 0:ys.id,location_name:(It=oe.location)==null?void 0:It.name,assignment_status:oe.status,assignment_notes:oe.notes,compatibleProducts:[],printer_assignments:[{id:oe.id,status:oe.status}]}});U||r==null||r(me)})(),()=>{U=!0}},[n,r]);const ue=()=>{d(!1),m(null)},we=(U,W)=>{_({id:U,name:W}),M(!1),b(!0)},ee=()=>{b(!1),_(null)},ne=()=>{M(!0)},g=()=>{C(!0)},p=()=>{F(!0)},N=U=>{if(s==="products")e("departments"),S(U);else{const W=document.getElementById(`department-${U}`);W&&W.scrollIntoView({behavior:"smooth",block:"start"})}};h.useEffect(()=>{if(s==="departments"&&ye){const U=document.getElementById(`department-${ye}`);U&&(U.scrollIntoView({behavior:"smooth",block:"start"}),S(null))}},[s,ye]),n.trim().length>0,h.useEffect(()=>{n.trim().length>0&&E(!1)},[n]);const se=()=>{z(!0)},re=()=>{setTimeout(()=>{n.trim()||z(!1)},200)};return t.jsxs(t.Fragment,{children:[t.jsx("nav",{className:"fixed bottom-0 left-0 w-full z-50 bg-white/95 backdrop-blur-lg border-t border-gray-200 shadow-2xl transition-all",children:t.jsxs("div",{className:"flex items-center px-2 py-2 min-h-[60px]",children:[t.jsx("div",{className:"flex-shrink-0 w-12 flex justify-center",children:t.jsx("button",{type:"button","aria-label":"Back",className:"h-12 w-12 rounded-lg flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-50 transition-all duration-200",onClick:()=>R("/"),children:t.jsx(Aa,{className:"h-5 w-5"})})}),t.jsx("div",{className:`flex-1 flex items-center justify-center min-w-0 px-2 ${(Y==null?void 0:Y.role)==="admin"||(Y==null?void 0:Y.role)==="client"?"pr-0":"pr-12"}`,children:t.jsxs("div",{className:"flex items-center gap-2 w-full max-w-full",children:[t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx(il,{searchQuery:n,onSearchChange:l,placeholder:"Search printers, models...",departments:Ne,onDepartmentSelect:N,onFocus:se,onBlur:re})}),t.jsx("div",{className:"flex gap-1 flex-shrink-0",children:[{key:"departments",label:"Printers",icon:st},{key:"products",label:"Products",icon:an}].map(({key:U,label:W,icon:xe})=>{const w=s===U;return t.jsx("button",{type:"button",onClick:()=>e(U),className:`flex items-center justify-center px-3 py-2 min-w-[60px] rounded-lg transition-all duration-200
                        ${w?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
                      `,"aria-pressed":w,"aria-label":W,children:t.jsx(xe,{className:"h-4 w-4"})},U)})})]})}),((Y==null?void 0:Y.role)==="admin"||(Y==null?void 0:Y.role)==="client")&&t.jsx("div",{className:"flex-shrink-0 flex justify-center ml-2",children:t.jsx(Va,{onAssignPrinter:ne,onAddPrinter:g,onAddToInventory:()=>{},onAddCompanyPrinter:p})})]})}),c&&o&&t.jsx(tn,{isOpen:c,onClose:ue,product:o}),f&&t.jsx(Ra,{isOpen:f,onClose:()=>C(!1),onPrinterAdded:()=>{}}),A&&t.jsx(rl,{isOpen:A,onClose:()=>M(!1),onPrinterSelected:we}),k&&j&&t.jsx(al,{isOpen:k,onClose:()=>b(!1),printerId:j.id,printerName:j.name,onAssignmentCreated:ee}),H&&t.jsx(sn,{isOpen:H,onClose:()=>X(!1)}),K&&t.jsx(nl,{isOpen:K,onClose:()=>F(!1),onPrinterAdded:()=>F(!1),clientId:$}),t.jsx(Be,{open:J,onOpenChange:pe,children:t.jsxs(ze,{children:[t.jsx(We,{children:t.jsx(He,{children:"Menu"})}),t.jsxs("div",{className:"py-4 text-center text-gray-600 flex flex-col gap-4",children:[t.jsx(ce,{variant:"outline",className:"w-full",onClick:()=>{pe(!1)},children:"Settings"}),t.jsx(ce,{variant:"destructive",className:"w-full",onClick:async()=>{await Q.auth.signOut(),window.location.href="/auth"},children:"Logout"})]})]})})]})},ol=()=>{const{user:s,userProfile:e,signOut:r}=lt(),a=ir(),[i,n]=h.useState(!1),[l,o]=h.useState(!1),m=e==null?void 0:e.role;return{userRole:m,handleBackButtonClick:()=>{switch(console.log("🔄 Role-based back button clicked, user role:",m),m){case"admin":case"sales_admin":a(-1);break;case"client":n(!0);break;default:o(!0);break}},showClientSettingsModal:i,setShowClientSettingsModal:n,showRestrictedModal:l,setShowRestrictedModal:o,handleClientSettings:()=>{console.log("⚙️ Client settings clicked"),n(!1)},handleClientLogout:async()=>{console.log("🚪 Client logout clicked"),n(!1),await r(),a("/auth")},handleRestrictedModalClose:()=>{o(!1)}}},$l=()=>{lr();const{clientId:s}=zr(),e=ir();lt();const{client:r,isLoading:a,error:i,activeTab:n,setActiveTab:l,isDepartmentDetailsView:o,setIsDepartmentDetailsView:m,showEditModal:c,setShowEditModal:d,handleClientUpdated:f}=Ji({clientId:s}),{userRole:C,handleBackButtonClick:A,showClientSettingsModal:M,setShowClientSettingsModal:k,showRestrictedModal:b,setShowRestrictedModal:j,handleClientSettings:_,handleClientLogout:B,handleRestrictedModalClose:z}=ol(),y=n,E=l,{data:H=[],isLoading:X}=Ot(s);Qi(H);const{data:J=[],isLoading:pe}=Ue({queryKey:["assignments",s],queryFn:()=>Dt.getAssignmentsByClient(s),enabled:!!s}),ye=J.filter(q=>q.status==="active"),S=J.filter(q=>q.status==="inactive"||q.status==="repair");J.filter(q=>q.usage_type==="rental"),Ue({queryKey:["maintenance",s,J],queryFn:async()=>{if(!J.length)return 0;let q=0;for(const je of J){const fe=await Dt.getMaintenanceHistory(je.printer_id);q+=fe.length}return q},enabled:!!s&&J.length>0}),Ue({queryKey:["client-documents",s],queryFn:async()=>{const{data:q,error:je}=await Q.from("client_documents").select("id").eq("client_id",s);return je?0:q.length},enabled:!!s}),Ue({queryKey:["client-compatible-products",s,J],queryFn:async()=>{if(!J.length)return 0;const q=new Set;for(const je of J){const{data:fe,error:be}=await Q.from("product_printers").select("product_id").eq("printer_id",je.printer_id);be||fe.forEach(u=>q.add(u.product_id))}return q.size},enabled:!!s&&J.length>0}),h.useState(!1),h.useState(!1),h.useState(!1),h.useState(!1),J[0],h.useState("transfer"),Ue({queryKey:["recent-printer-activities",s],queryFn:async()=>{const{data:q}=await Q.from("printer_history").select("id, action_type, description, performed_by, timestamp, printer:printers (name, printer_assignments!inner (client_id))").eq("printer.printer_assignments.client_id",s).order("timestamp",{ascending:!1}).limit(30),{data:je}=await Q.from("maintenance_history").select("id, maintenance_type, action_description, performed_by, performed_at, printer:printers (name, printer_assignments!inner (client_id))").eq("printer.printer_assignments.client_id",s).order("performed_at",{ascending:!1}).limit(30);return[...(q||[]).map(be=>{var u;return{id:be.id,type:"history",timestamp:be.timestamp,description:be.description,printerName:((u=be.printer)==null?void 0:u.name)||"Unknown Printer",actionType:be.action_type,performedBy:be.performed_by}}),...(je||[]).map(be=>{var u;return{id:be.id,type:"maintenance",timestamp:be.performed_at,description:be.action_description,printerName:((u=be.printer)==null?void 0:u.name)||"Unknown Printer",maintenanceType:be.maintenance_type,performedBy:be.performed_by}})].sort((be,u)=>new Date(u.timestamp).getTime()-new Date(be.timestamp).getTime())},enabled:!!s});const{data:K=0}=Ue({queryKey:["available-printers-count",s],queryFn:async()=>{if(!s)return 0;const{count:q,error:je}=await Q.from("printer_visibility").select("printer_id",{count:"exact"}).eq("client_id",s);return je?0:q??0},enabled:!!s});console.log("🔢 availablePrintersCount:",K);const[F,R]=h.useState(!1),[$,Y]=h.useState([]),[Ne,ue]=h.useState(!1),[we,ee]=h.useState(!1),[ne,g]=h.useState(!1),[p,N]=h.useState(!1),[se,re]=h.useState(""),{toast:U}=it(),{refreshClientData:W}=Ba(),xe=async()=>{s&&await W(s)};h.useEffect(()=>{const q=()=>{xe()};return window.addEventListener("refresh-printer-data",q),()=>{window.removeEventListener("refresh-printer-data",q)}},[s]);const w=async()=>{if(!s)return;ee(!0);const{data:q,error:je}=await Q.from("departments").select("id").eq("client_id",s);if(je){ee(!1),re("Error checking departments."),g(!0);return}if(q&&q.length>0){ee(!1),re("Client with active departments can't be deleted. Please delete all departments first."),g(!0);return}ee(!1),N(!0)},O=async()=>{ee(!0);const{error:q}=await Q.from("clients").delete().eq("id",s);if(ee(!1),N(!1),q){re("Error deleting client."),g(!0);return}U({title:"Client has been fully removed from the database.",status:"success"}),e("/")};if(a)return t.jsx(fs,{message:"Loading client details",fullscreen:!0});if(i||!r)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-gray-600 text-sm mb-4",children:$a.CLIENT_NOT_FOUND}),t.jsx(ce,{onClick:()=>e("/admin-dashboard"),size:"sm",children:"Back to Dashboard"})]})});const le=()=>{switch(n){case"departments":return t.jsx("div",{className:"space-y-3",children:t.jsx(hn,{clientId:s,onDepartmentDetailsView:m,filteredPrinters:$})});case"printers":return t.jsx("div",{className:"space-y-3",children:t.jsx(Ui,{clientId:s})});case"products":return t.jsx(Ki,{clientId:s});case"support":return t.jsx(el,{});case"available-printers":return t.jsx(qr,{});default:return null}};return t.jsx(Ma,{children:t.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-blue-50 to-indigo-50",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},children:[t.jsx("div",{className:"sticky top-0 z-20 bg-blue-100/95 backdrop-blur-sm border-b border-blue-200 px-4 py-3",children:t.jsxs("div",{className:"flex items-center gap-3 justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(cr,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h1",{className:"text-base font-semibold text-gray-900 truncate",children:"Client Dashboard"}),r&&t.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[t.jsx("p",{className:"text-xs text-gray-600 truncate",children:r.name}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[t.jsxs("span",{children:["Total Printers (",ye.length+S.length,")"]}),t.jsx("span",{children:"|"}),t.jsxs("span",{children:["Active (",ye.length,")"]}),t.jsx("span",{children:"|"}),t.jsxs("span",{children:["Inactive (",S.length,")"]})]})]})]})]}),t.jsx("div",{className:"flex items-center gap-2",children:(C==="admin"||C==="superadmin")&&t.jsxs(t.Fragment,{children:[t.jsx(ce,{variant:"ghost",size:"icon",onClick:()=>e(`/clients/${s}/manage`),className:"ml-auto",children:t.jsx(_s,{className:"h-5 w-5"})}),C==="superadmin"&&t.jsx(ce,{variant:"outline",size:"icon",className:"text-red-600 border-red-300",onClick:w,disabled:we,title:"Delete Client",children:t.jsx(nr,{className:"h-5 w-5"})})]})})]})}),t.jsx(Be,{open:ne,onOpenChange:g,children:t.jsxs(ze,{children:[t.jsx(We,{children:t.jsx(He,{children:"Cannot Delete Client"})}),t.jsx("div",{className:"py-2 text-center text-gray-700",children:se}),t.jsx(ce,{variant:"default",onClick:()=>g(!1),children:"OK"})]})}),t.jsx(Be,{open:p,onOpenChange:N,children:t.jsxs(ze,{children:[t.jsx(We,{children:t.jsx(He,{children:"Confirm Client Deletion"})}),t.jsx("div",{className:"py-2 text-center text-gray-700",children:"Deleting this client will permanently remove its record from the database. Proceed with caution."}),t.jsxs("div",{className:"flex justify-center gap-3 mt-4",children:[t.jsx(ce,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),t.jsxs(ce,{variant:"destructive",onClick:O,disabled:we,children:[we?t.jsx(nn,{className:"animate-spin h-4 w-4 mr-2"}):null,"Confirm Delete"]})]})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto px-1 py-3 space-y-4",children:t.jsx(za,{onRefresh:xe,children:le()})}),!o&&t.jsx("footer",{className:"sticky bottom-0 z-30 w-full bg-white/95 backdrop-blur-sm border-t border-gray-200",children:t.jsx(ll,{activeTab:y,setActiveTab:E,onFilteredDataChange:Y,client:r,onClientUpdated:f})}),F&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/40 backdrop-blur-sm",children:t.jsxs("div",{className:"relative w-full max-h-[85vh] rounded-t-2xl shadow-2xl bg-white border-t border-gray-200 animate-in slide-in-from-bottom-4 duration-300",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-t-2xl",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:t.jsx(Wa,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-base font-bold text-white",children:"Available Printers"}),t.jsx("p",{className:"text-xs text-white/80",children:"Special deals for you!"})]})]}),t.jsx("button",{className:"text-white hover:text-gray-200 p-2 rounded-full hover:bg-white/10 transition-colors touch-target",onClick:()=>R(!1),"aria-label":"Close",children:"✕"})]}),t.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(85vh-80px)]",children:t.jsx(qr,{})})]})}),M&&t.jsx(Be,{open:M,onOpenChange:k,children:t.jsxs(ze,{className:"w-[95vw] max-w-md rounded-xl",children:[t.jsx(We,{children:t.jsx(He,{className:"text-base",children:"Client Menu"})}),t.jsxs("div",{className:"space-y-3 pt-2",children:[t.jsxs(ce,{variant:"outline",className:"w-full h-12 justify-start text-sm touch-target",onClick:_,children:[t.jsx(_s,{className:"mr-3 h-4 w-4"}),"Settings"]}),t.jsxs(ce,{variant:"outline",className:"w-full h-12 justify-start text-sm touch-target",onClick:B,children:[t.jsx(on,{className:"mr-3 h-4 w-4"}),"Logout"]})]})]})}),t.jsx(Ea,{open:b,onOpenChange:z}),t.jsx(Yi,{isOpen:c,onClose:()=>d(!1),client:r,onClientUpdated:f}),t.jsx(Be,{open:Ne,onOpenChange:ue,children:t.jsxs(ze,{className:"w-[95vw] max-w-md rounded-xl",children:[t.jsx(We,{children:t.jsx(He,{className:"text-base",children:"Navigation"})}),t.jsx("div",{className:"py-4 text-center text-gray-600 text-sm",children:"This is a placeholder modal for navigation actions."})]})})]})})};export{$l as default};
//# sourceMappingURL=ClientDashboard-Dddsc0_i.js.map

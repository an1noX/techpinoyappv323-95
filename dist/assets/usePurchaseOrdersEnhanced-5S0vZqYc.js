import{s as d,r as p,J as n}from"./index-FgfazPn4.js";const i={async getAllPurchaseOrders(){const{data:e,error:s}=await d.from("purchase_orders").select("*").order("created_at",{ascending:!1});if(s)throw s;return e||[]},async getPurchaseOrderWithItems(e){const{data:s,error:u}=await d.from("purchase_orders").select(`
        *,
        purchase_order_items (*)
      `).eq("id",e).single();if(u)throw u;return s},async createPurchaseOrder(e){const{data:s,error:u}=await d.from("purchase_orders").insert({supplier_name:e.supplier_name,supplier_client_id:e.supplier_client_id,status:e.status||"pending",payment_status:e.payment_status||"unpaid",notes:e.notes,client_po:e.client_po}).select().single();if(u)throw u;if(e.items&&e.items.length>0){const c=e.items.map(o=>({purchase_order_id:s.id,product_id:o.product_id,model:o.model||"",quantity:o.quantity,unit_price:o.unit_price})),{error:l}=await d.from("purchase_order_items").insert(c);if(l)throw l}return s},async updatePurchaseOrder(e,s){const{data:u,error:c}=await d.from("purchase_orders").update(s).eq("id",e).select().single();if(c)throw c;return u},async deletePurchaseOrder(e){const{error:s}=await d.from("purchase_orders").delete().eq("id",e);if(s)throw s},async getPurchaseOrderById(e){return this.getPurchaseOrderWithItems(e)},async updatePurchaseOrderStatus(e){const{error:s}=await d.from("purchase_orders").update({status:"partial"}).eq("id",e);if(s)throw s}},w=()=>{const[e,s]=p.useState([]),[u,c]=p.useState(!1),[l,o]=p.useState(null),f=async()=>{c(!0),o(null);try{const a=await i.getAllPurchaseOrders();s(a)}catch(a){const r=a instanceof Error?a.message:"Failed to fetch purchase orders";o(r),n.error(r)}finally{c(!1)}},m=async a=>{c(!0),o(null);try{const r=await i.createPurchaseOrder(a);return s(t=>[r,...t]),n.success("Purchase order created successfully"),r}catch(r){const t=r instanceof Error?r.message:"Failed to create purchase order";throw o(t),n.error(t),r}finally{c(!1)}},_=async(a,r)=>{c(!0),o(null);try{const t=await i.updatePurchaseOrder(a,r);return s(h=>h.map(y=>y.id===a?t:y)),n.success("Purchase order updated successfully"),t}catch(t){const h=t instanceof Error?t.message:"Failed to update purchase order";throw o(h),n.error(h),t}finally{c(!1)}},g=async a=>{c(!0),o(null);try{await i.deletePurchaseOrder(a),s(r=>r.filter(t=>t.id!==a)),n.success("Purchase order deleted successfully")}catch(r){const t=r instanceof Error?r.message:"Failed to delete purchase order";throw o(t),n.error(t),r}finally{c(!1)}},P=async a=>{try{return await i.getPurchaseOrderById(a)}catch(r){const t=r instanceof Error?r.message:"Failed to fetch purchase order details";return n.error(t),null}};return p.useEffect(()=>{f()},[]),{purchaseOrders:e,loading:u,error:l,createPurchaseOrder:m,updatePurchaseOrder:_,deletePurchaseOrder:g,getPurchaseOrderWithDetails:P,refetch:f}};export{i as p,w as u};
//# sourceMappingURL=usePurchaseOrdersEnhanced-5S0vZqYc.js.map

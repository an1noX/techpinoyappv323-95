import{r as x,j as e,D as y,d as b,e as H,f as A,B as z,P as G,G as J}from"./index-FgfazPn4.js";import{B as E}from"./badge-PQ_Xgg0c.js";import{C as m,b as o,c as h,a as u}from"./card-S-815Fh1.js";import{u as K}from"./usePurchaseOrdersEnhanced-5S0vZqYc.js";import{c as V,C as X,d as Y}from"./SalesTab-BzpiJPMf.js";import{F as Z}from"./file-text-hP0IkulY.js";import{T as O}from"./checkbox-De7F5xfH.js";import{C as I}from"./chevron-right-BqyfOyy6.js";import{C as ee}from"./label-C7AHjZf1.js";import{P as se}from"./users-7LwHL_dG.js";import"./SalesOverview-Blys1nif.js";import"./circle-alert-YIDi-HZf.js";import"./trending-up-_gLokptJ.js";import"./clock-UXFbK2OM.js";import"./circle-x-7G5sk1I3.js";import"./circle-check-big-B5GuSQz3.js";import"./printer-X5np4qGe.js";import"./input-Cc5DIsqr.js";import"./shopping-cart-Dlmx8wK6.js";import"./tabs-CXhmf9qd.js";import"./minus-QEom8Zbo.js";import"./eye-BJula9yD.js";import"./upload-BCc2dJv1.js";const _e=({purchaseOrderId:j,onClose:p})=>{var S,P,q,k;const{getPurchaseOrderWithDetails:g}=K(),{getDeliveriesByPurchaseOrder:f}=V(),[a,w]=x.useState(null),[d,D]=x.useState([]),[T,L]=x.useState(!0),[R,N]=x.useState(!1),[v,_]=x.useState(new Set),[c,B]=x.useState({}),[Q,C]=x.useState(new Set);x.useEffect(()=>{(async()=>{try{const[t,r]=await Promise.all([g(j),f(j)]);w(t),D(r)}catch(t){console.error("Error fetching PO details:",t)}finally{L(!1)}})()},[j,g,f]);const F=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"partial":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},M=s=>{switch(s){case"unpaid":return"bg-red-100 text-red-800";case"partial":return"bg-orange-100 text-orange-800";case"paid":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},U=async()=>{const s=await f(j);D(s);const t=await g(j);w(t),N(!1)},W=async s=>{const t=new Set(v);if(t.has(s))t.delete(s),_(t);else if(t.add(s),_(t),!c[s]){C(r=>new Set(r).add(s));try{const r=await Y.getDeliveryWithItems(s);r&&B(i=>({...i,[s]:r.delivery_items||[]}))}catch(r){console.error("Error fetching delivery items:",r)}finally{C(r=>{const i=new Set(r);return i.delete(s),i})}}};return T?e.jsx(y,{open:!0,onOpenChange:p,children:e.jsx(b,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{children:"Loading purchase order details..."})})})}):a?e.jsxs(e.Fragment,{children:[e.jsx(y,{open:!0,onOpenChange:p,children:e.jsxs(b,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(H,{children:e.jsxs(A,{className:"flex items-center space-x-2",children:[e.jsx(Z,{size:20}),e.jsxs("span",{children:["Purchase Order #",a.id.slice(0,8)]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(m,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(h,{className:"text-sm",children:"Order Information"})}),e.jsxs(u,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Supplier:"}),e.jsx("span",{className:"font-medium",children:a.supplier_name||"Not specified"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx(E,{className:F(a.status),children:a.status})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Payment:"}),e.jsx(E,{className:M(a.payment_status),children:a.payment_status})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Created:"}),e.jsx("span",{className:"text-sm",children:new Date(a.created_at).toLocaleDateString()})]})]})]}),a.total_ordered&&e.jsxs(m,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(h,{className:"text-sm",children:"Delivery Progress"})}),e.jsxs(u,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Ordered:"}),e.jsx("span",{className:"font-medium",children:a.total_ordered})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Delivered:"}),e.jsx("span",{className:"font-medium",children:a.total_delivered||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Remaining:"}),e.jsx("span",{className:"font-medium",children:a.remaining_items||0})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${a.completion_percentage||0}%`}})}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[a.completion_percentage||0,"% Complete"]})]})]})]}),e.jsxs(m,{children:[e.jsx(o,{children:e.jsxs(h,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{size:16}),e.jsx("span",{children:"Deliveries"})]}),e.jsxs(z,{size:"sm",onClick:()=>N(!0),children:[e.jsx(G,{size:14,className:"mr-1"}),"Record Delivery"]})]})}),e.jsx(u,{children:d.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No deliveries recorded yet"}):e.jsx("div",{className:"space-y-3",children:d.map(s=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("div",{className:"flex justify-between items-start mb-2 cursor-pointer hover:bg-gray-100 p-2 rounded transition-colors",onClick:()=>W(s.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[v.has(s.id)?e.jsx(J,{size:16,className:"text-gray-500"}):e.jsx(I,{size:16,className:"text-gray-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.delivery_receipt_number||`Delivery #${s.id.slice(0,8)}`}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[e.jsx(ee,{size:12,className:"mr-1"}),new Date(s.delivery_date).toLocaleDateString()]})]})]})}),v.has(s.id)&&e.jsx("div",{className:"mt-3 border-t pt-3",children:Q.has(s.id)?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Loading delivery items..."})]}):c[s.id]&&c[s.id].length>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Delivered Products:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs text-gray-500 mb-2 px-2",children:[e.jsx("div",{children:"Model"}),e.jsx("div",{children:"Date"}),e.jsx("div",{className:"text-right",children:"Qty"})]}),e.jsx("div",{className:"space-y-2",children:c[s.id].map((t,r)=>{var i,n,l;return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-white rounded border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:((i=t.products)==null?void 0:i.name)||((n=t.products)==null?void 0:n.sku)||"Unknown Product"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[((l=t.products)==null?void 0:l.category)&&`${t.products.category} • `,"Delivered: ",new Date(s.delivery_date).toLocaleDateString()]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-medium text-sm",children:["Qty: ",t.quantity_delivered]})})]},t.id||r)})})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No delivery items found"})}),s.notes&&e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("strong",{children:"Notes:"})," ",s.notes]})]},s.id))})})]}),a.notes&&e.jsxs(m,{children:[e.jsx(o,{children:e.jsx(h,{children:"Notes"})}),e.jsx(u,{children:e.jsx("p",{className:"text-gray-700",children:a.notes})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(o,{children:e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(se,{size:16}),e.jsx("span",{children:"Items to be Delivered"})]})}),e.jsx(u,{children:a.items&&a.items.length>0?e.jsxs("div",{className:"space-y-3",children:[a.items.map(s=>{const t=d.reduce((i,n)=>{if(c[n.id]){const l=c[n.id].find($=>$.product_id===s.product_id);return i+((l==null?void 0:l.quantity_delivered)||0)}return i},0),r=s.quantity-t;return r>0?e.jsxs("div",{className:"flex justify-between items-center p-3 bg-yellow-50 rounded border-l-4 border-yellow-400",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.model||"Unknown Product"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Ordered: ",s.quantity," • Delivered: ",t," • Remaining: ",r]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-sm",children:["₱",s.unit_price]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Remaining: ",r]})]})]},s.id):null}),a.items.every(s=>{const t=d.reduce((r,i)=>{if(c[i.id]){const n=c[i.id].find(l=>l.product_id===s.product_id);return r+((n==null?void 0:n.quantity_delivered)||0)}return r},0);return s.quantity-t<=0})&&e.jsx("div",{className:"text-center py-4 text-green-600 text-sm",children:"✓ All items have been delivered"})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No items to deliver"})})]}),e.jsxs(m,{children:[e.jsx(o,{children:e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(O,{size:16}),e.jsx("span",{children:"Items Delivered"})]})}),e.jsx(u,{children:d.length>0?e.jsxs("div",{className:"space-y-3",children:[(S=a.items)==null?void 0:S.map(s=>{const t=d.reduce((r,i)=>{if(c[i.id]){const n=c[i.id].find(l=>l.product_id===s.product_id);return r+((n==null?void 0:n.quantity_delivered)||0)}return r},0);return t>0?e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded border-l-4 border-green-400",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.model||"Unknown Product"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Total Delivered: ",t," of ",s.quantity]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-sm",children:["₱",s.unit_price]}),e.jsx("div",{className:"text-xs text-green-600",children:t===s.quantity?"✓ Complete":"Partial"})]})]},s.id):null}),((P=a.items)==null?void 0:P.every(s=>d.reduce((r,i)=>{if(c[i.id]){const n=c[i.id].find(l=>l.product_id===s.product_id);return r+((n==null?void 0:n.quantity_delivered)||0)}return r},0)===0))&&e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No items delivered yet"})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No deliveries recorded"})})]}),e.jsxs(m,{children:[e.jsx(o,{children:e.jsx(h,{className:"text-sm",children:"Delivery Summary"})}),e.jsxs(u,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Items:"}),e.jsx("span",{className:"font-medium",children:((q=a.items)==null?void 0:q.reduce((s,t)=>s+t.quantity,0))||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Delivered:"}),e.jsx("span",{className:"font-medium text-green-600",children:d.reduce((s,t)=>c[t.id]?s+c[t.id].reduce((r,i)=>r+i.quantity_delivered,0):s,0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Remaining:"}),e.jsx("span",{className:"font-medium text-yellow-600",children:(((k=a.items)==null?void 0:k.reduce((s,t)=>s+t.quantity,0))||0)-d.reduce((s,t)=>c[t.id]?s+c[t.id].reduce((r,i)=>r+i.quantity_delivered,0):s,0)})]})]})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx(z,{variant:"outline",onClick:p,children:"Close"})})]})}),R&&e.jsx(X,{purchaseOrderId:j,onClose:()=>N(!1),onSuccess:U})]}):e.jsx(y,{open:!0,onOpenChange:p,children:e.jsx(b,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{children:"Purchase order not found"})})})})};export{_e as PurchaseOrderDetailModal};
//# sourceMappingURL=PurchaseOrderDetailModal-B4HPrhzj.js.map

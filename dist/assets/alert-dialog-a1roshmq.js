var ve=Object.defineProperty;var ye=(t,s,a)=>s in t?ve(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var O=(t,s,a)=>ye(t,typeof s!="symbol"?s+"":s,a);import{c as Ne,r as o,j as e,T as be,B as w,D as F,d as z,e as B,f as H,s as P,a as je,P as we,Q as Ae,at as V,au as Ce,a3 as De,V as K,av as ke,a4 as Ee,Z as Pe,aw as Se,a6 as _e,a7 as Re,a5 as U,aa as Te,a8 as $e,l as A,ax as q}from"./index-FgfazPn4.js";import{C as Le,a as Me}from"./card-S-815Fh1.js";import{p as G}from"./clientService-scOH6ADK.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=Ne("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);class it extends o.Component{constructor(a){super(a);O(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,l){console.error("ErrorBoundary caught an error:",a,l),this.setState({error:a,errorInfo:l}),this.props.onError&&this.props.onError(a,l)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center p-4",children:e.jsx(Le,{className:"max-w-md w-full",children:e.jsxs(Me,{className:"p-6 text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx(be,{className:"h-12 w-12 text-red-500 mx-auto"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"We encountered an unexpected error. Please try refreshing the page or contact support if the problem persists."}),!1,e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(w,{onClick:this.handleRetry,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:"Try Again"}),e.jsx(w,{variant:"outline",onClick:()=>window.location.reload(),className:"flex-1",children:"Refresh Page"})]})]})})}):this.props.children}}const Oe=({printerId:t,isOpen:s,onClose:a,compatibleProducts:l})=>{const[i,N]=o.useState([]),[p,b]=o.useState(""),[f,u]=o.useState([]),[x,c]=o.useState(null),[m,h]=o.useState(!1),[k,C]=o.useState(null),[pe,_]=o.useState(!1),[R,T]=o.useState(!1),[$,S]=o.useState(null),[d,j]=o.useState({name:"",sku:"",category:"",description:"",color:"",alias:"",aliases:""}),L=o.useRef(null);o.useEffect(()=>{s&&(he(),b(""),c(null),u([]),C(null),setTimeout(()=>{var r;return(r=L.current)==null?void 0:r.focus()},200))},[s,l]);const he=async()=>{C(null);try{const r=await G.getProducts(),n=l.map(v=>v.id),g=r.filter(v=>!n.includes(v.id));N(g),u(g)}catch{C("Failed to fetch products."),N([]),u([])}};o.useEffect(()=>{if(!p){u(i);return}const r=p.toLowerCase();u(i.filter(n=>n.name.toLowerCase().includes(r)||n.sku&&n.sku.toLowerCase().includes(r)))},[p,i]);const ge=r=>{c(r);const n=i.find(g=>g.id===r);n&&b(`${n.name} (${n.sku})`)},fe=async()=>{if(!(!x||!t)){h(!0),C(null);try{const{error:r}=await P.from("product_printers").insert({printer_id:t,product_id:x});if(r)throw r;E(),window.dispatchEvent(new CustomEvent("refresh-compatible-products",{detail:{printerId:t}}))}catch{C("Failed to link product.")}h(!1)}},xe=async()=>{if(!d.name.trim()||!d.sku.trim()){S("Name and SKU are required.");return}T(!0),S(null);try{const r={name:d.name.trim(),sku:d.sku.trim(),category:d.category.trim()||null,description:d.description.trim()||null,color:d.color.trim()||null,alias:d.alias.trim()||null,aliases:d.aliases.trim()||null};console.log("Creating product with authenticated role:",r);const{data:n,error:g}=await P.from("products").insert(r).select().single();if(g)throw console.error("Insert error:",g),g.message.includes("already exists")?new Error(g.message):g;console.log("Product created successfully:",n);const{error:v}=await P.from("product_printers").insert({printer_id:t,product_id:n.id});if(v)throw console.error("Link error:",v),v.code==="42501"?new Error("Permission denied for linking products."):v.code==="23505"?new Error("This product is already linked to this printer."):new Error(`Failed to link product to printer: ${v.message}`);console.log("Product linked successfully to printer"),M(),E(),window.dispatchEvent(new CustomEvent("refresh-compatible-products",{detail:{printerId:t}}))}catch(r){console.error("Product creation error:",r),S(r.message||"Failed to create product.")}T(!1)},M=()=>{_(!1),j({name:"",sku:"",category:"",description:"",color:"",alias:"",aliases:""}),S(null)},E=()=>{c(null),C(null),b(""),u(i),a()};return e.jsxs(e.Fragment,{children:[e.jsx(F,{open:s,onOpenChange:r=>{r||E()},children:e.jsxs(z,{children:[e.jsxs(B,{children:[e.jsx(H,{children:"Add Compatible Product"}),e.jsx("button",{onClick:E,className:"absolute right-4 top-4 text-gray-400 hover:text-gray-600",tabIndex:-1})]}),k&&e.jsx("div",{className:"text-red-500 text-sm mb-4",children:k}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"product-search",className:"block text-sm font-medium mb-1",children:"Search Product"}),e.jsx("input",{id:"product-search",ref:L,type:"text",className:"w-full border rounded-md shadow-sm p-2",placeholder:"Type product name or SKU...",value:p,onChange:r=>{b(r.target.value),c(null)},autoComplete:"off"}),f.length>0&&p!==""&&e.jsx("div",{className:"border rounded-md shadow-sm mt-1 bg-white max-h-56 overflow-auto z-10 absolute w-full",children:f.map(r=>e.jsx("div",{className:`flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-gray-100 ${x===r.id?"bg-gray-200":""}`,onClick:()=>ge(r.id),children:e.jsxs("span",{className:"flex items-center",children:[r.name,r.sku&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1 flex items-center",children:["(",r.sku,")",r.color&&e.jsx("span",{className:"inline-block w-3 h-3 rounded-full ml-2",style:{backgroundColor:r.color},title:r.color_name||""})]})]})},r.id))}),f.length===0&&p!==""&&e.jsx("div",{className:"text-sm text-gray-400 mt-2",children:"No matching products found."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(w,{variant:"outline",onClick:E,children:"Cancel"}),e.jsx(w,{variant:"outline",onClick:()=>_(!0),children:"Add New Product"}),e.jsx(w,{onClick:fe,disabled:!x||m,children:m?"Linking...":"Link Product"})]})]})]})}),e.jsx(F,{open:pe,onOpenChange:_,children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(B,{children:e.jsx(H,{children:"Add New Product"})}),$&&e.jsx("div",{className:"text-red-500 text-sm mb-4",children:$}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Product Name *"}),e.jsx("input",{type:"text",className:"w-full border rounded-md shadow-sm p-2",placeholder:"Enter product name",value:d.name,onChange:r=>j(n=>({...n,name:r.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"SKU *"}),e.jsx("input",{type:"text",className:"w-full border rounded-md shadow-sm p-2",placeholder:"Enter SKU",value:d.sku,onChange:r=>j(n=>({...n,sku:r.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Category"}),e.jsx("input",{type:"text",className:"w-full border rounded-md shadow-sm p-2",placeholder:"Enter category",value:d.category,onChange:r=>j(n=>({...n,category:r.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{className:"w-full border rounded-md shadow-sm p-2",placeholder:"Enter description",rows:3,value:d.description,onChange:r=>j(n=>({...n,description:r.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Color"}),e.jsx("input",{type:"text",className:"w-full border rounded-md shadow-sm p-2",placeholder:"Enter color (e.g., #FF0000)",value:d.color,onChange:r=>j(n=>({...n,color:r.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Alias"}),e.jsx("input",{type:"text",className:"w-full border rounded-md shadow-sm p-2",placeholder:"Enter alias",value:d.alias,onChange:r=>j(n=>({...n,alias:r.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Aliases (comma-separated)"}),e.jsx("input",{type:"text",className:"w-full border rounded-md shadow-sm p-2",placeholder:"Enter aliases separated by commas",value:d.aliases,onChange:r=>j(n=>({...n,aliases:r.target.value}))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(w,{variant:"outline",onClick:M,children:"Cancel"}),e.jsx(w,{onClick:xe,disabled:R||!d.name.trim()||!d.sku.trim(),children:R?"Creating...":"Create & Link Product"})]})]})]})})]})},ct=({printerId:t,className:s=""})=>{const{userProfile:a}=je(),[l,i]=o.useState([]),[N,p]=o.useState(!1),[b,f]=o.useState(!1),u=async()=>{if(t){p(!0);try{const c=await G.getProductsByPrinter(t);i(c)}catch(c){console.error("Failed to fetch compatible products:",c),i([])}finally{p(!1)}}};o.useEffect(()=>{u()},[t]),o.useEffect(()=>{if(!t)return;const c=P.channel(`compatible-products-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"product_printers",filter:`printer_id=eq.${t}`},h=>{u()}).subscribe(),m=h=>{var k;((k=h.detail)==null?void 0:k.printerId)===t&&u()};return window.addEventListener("refresh-compatible-products",m),()=>{P.removeChannel(c),window.removeEventListener("refresh-compatible-products",m)}},[t]);const x=l.reduce((c,m)=>{const h=`${m.name}-${m.sku}`;return c[h]||(c[h]={name:m.name,sku:m.sku,colors:[],allProducts:[]}),m.color&&!c[h].colors.includes(m.color)&&c[h].colors.push(m.color),c[h].allProducts.push(m),c},{});return e.jsxs("div",{className:s,children:[N?e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Loading..."}):e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[l.length===0?e.jsx("p",{className:"text-xs text-gray-500 italic",children:"No compatible products found."}):Object.values(x).map((c,m)=>e.jsxs("div",{className:"flex items-center gap-1 mr-4",children:[e.jsx("span",{className:"text-sm text-gray-800 font-medium truncate",children:c.name}),c.sku&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",c.sku,")"]}),c.colors.map(h=>e.jsx("span",{className:"inline-block w-3 h-3 rounded-full border border-gray-300 ml-1",style:{backgroundColor:h}},h))]},m)),((a==null?void 0:a.role)==="admin"||(a==null?void 0:a.role)==="superadmin")&&e.jsx(w,{variant:"ghost",size:"icon",className:"p-1",title:"Add compatible product",onClick:()=>f(!0),children:e.jsx(we,{className:"w-4 h-4 text-gray-600"})})]}),e.jsx(Oe,{printerId:t,isOpen:b,onClose:()=>f(!1),compatibleProducts:l})]})};var W="AlertDialog",[Fe,dt]=Ae(W,[V]),y=V(),Y=t=>{const{__scopeAlertDialog:s,...a}=t,l=y(s);return e.jsx(Te,{...l,...a,modal:!0})};Y.displayName=W;var ze="AlertDialogTrigger",I=o.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,i=y(a);return e.jsx(Ce,{...i,...l,ref:s})});I.displayName=ze;var Be="AlertDialogPortal",Q=t=>{const{__scopeAlertDialog:s,...a}=t,l=y(s);return e.jsx($e,{...l,...a})};Q.displayName=Be;var He="AlertDialogOverlay",Z=o.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,i=y(a);return e.jsx(De,{...i,...l,ref:s})});Z.displayName=He;var D="AlertDialogContent",[Ve,Ke]=Fe(D),J=o.forwardRef((t,s)=>{const{__scopeAlertDialog:a,children:l,...i}=t,N=y(a),p=o.useRef(null),b=K(s,p),f=o.useRef(null);return e.jsx(ke,{contentName:D,titleName:X,docsSlug:"alert-dialog",children:e.jsx(Ve,{scope:a,cancelRef:f,children:e.jsxs(Ee,{role:"alertdialog",...N,...i,ref:b,onOpenAutoFocus:Pe(i.onOpenAutoFocus,u=>{var x;u.preventDefault(),(x=f.current)==null||x.focus({preventScroll:!0})}),onPointerDownOutside:u=>u.preventDefault(),onInteractOutside:u=>u.preventDefault(),children:[e.jsx(Se,{children:l}),e.jsx(qe,{contentRef:p})]})})})});J.displayName=D;var X="AlertDialogTitle",ee=o.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,i=y(a);return e.jsx(_e,{...i,...l,ref:s})});ee.displayName=X;var te="AlertDialogDescription",ae=o.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,i=y(a);return e.jsx(Re,{...i,...l,ref:s})});ae.displayName=te;var Ue="AlertDialogAction",se=o.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,i=y(a);return e.jsx(U,{...i,...l,ref:s})});se.displayName=Ue;var re="AlertDialogCancel",oe=o.forwardRef((t,s)=>{const{__scopeAlertDialog:a,...l}=t,{cancelRef:i}=Ke(re,a),N=y(a),p=K(s,i);return e.jsx(U,{...N,...l,ref:p})});oe.displayName=re;var qe=({contentRef:t})=>{const s=`\`${D}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${D}\` by passing a \`${te}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${D}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return o.useEffect(()=>{var l;document.getElementById((l=t.current)==null?void 0:l.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},Ge=Y,We=I,Ye=Q,le=Z,ne=J,ie=se,ce=oe,de=ee,ue=ae;const ut=Ge,mt=We,Ie=Ye,me=o.forwardRef(({className:t,...s},a)=>e.jsx(le,{className:A("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:a}));me.displayName=le.displayName;const Qe=o.forwardRef(({className:t,...s},a)=>e.jsxs(Ie,{children:[e.jsx(me,{}),e.jsx(ne,{ref:a,className:A("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s})]}));Qe.displayName=ne.displayName;const Ze=({className:t,...s})=>e.jsx("div",{className:A("flex flex-col space-y-2 text-center sm:text-left",t),...s});Ze.displayName="AlertDialogHeader";const Je=({className:t,...s})=>e.jsx("div",{className:A("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});Je.displayName="AlertDialogFooter";const Xe=o.forwardRef(({className:t,...s},a)=>e.jsx(de,{ref:a,className:A("text-lg font-semibold",t),...s}));Xe.displayName=de.displayName;const et=o.forwardRef(({className:t,...s},a)=>e.jsx(ue,{ref:a,className:A("text-sm text-muted-foreground",t),...s}));et.displayName=ue.displayName;const tt=o.forwardRef(({className:t,...s},a)=>e.jsx(ie,{ref:a,className:A(q(),t),...s}));tt.displayName=ie.displayName;const at=o.forwardRef(({className:t,...s},a)=>e.jsx(ce,{ref:a,className:A(q({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));at.displayName=ce.displayName;export{ut as A,ct as C,it as E,nt as S,Qe as a,Ze as b,Xe as c,et as d,Je as e,at as f,tt as g,mt as h};
//# sourceMappingURL=alert-dialog-a1roshmq.js.map

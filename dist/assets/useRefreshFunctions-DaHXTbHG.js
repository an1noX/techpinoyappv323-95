import{c as A,r as i,u as Y,s as K,j as e,D as B,d as U,e as V,f as J,i as O,B as D,J as M,a as X,o as Q,z as W}from"./index-FgfazPn4.js";import{I as L}from"./input-Cc5DIsqr.js";import{L as _,T as Z}from"./label-C7AHjZf1.js";import{a as z,p as I,u as G}from"./clientService-scOH6ADK.js";import{C as ee,a as se}from"./card-S-815Fh1.js";import{D as te,a as ae,b as re,c as q,u as ie}from"./useSuppliers-CWirxHH7.js";import{C as le}from"./alert-dialog-a1roshmq.js";import{P as ne}from"./users-7LwHL_dG.js";import{a as $}from"./checkbox-De7F5xfH.js";import{E as ce}from"./eye-BJula9yD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=A("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=A("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=A("Merge",[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]]),H=(t=!1)=>{const[r,l]=i.useState([]),[p,u]=i.useState(!1),[o,m]=i.useState(null),{toast:y}=Y(),h=async()=>{u(!0),m(null);try{let n;if(t){const{data:d,error:f}=await K.from("printers").select(`
            *,
            printer_assignments!inner(
              id, 
              client_id, 
              status, 
              serial_number,
              is_unassigned,
              department_location_id,
              assignment_effective_date,
              condition,
              usage_type,
              reason_for_change,
              notes,
              created_at,
              updated_at,
              maintenance_status,
              last_maintenance_date,
              clients(id, name),
              departments_location(
                id,
                name,
                department:departments(id, name)
              )
            )
          `).eq("status","active").eq("printer_assignments.is_unassigned",!1).eq("printer_assignments.status","active").order("name");if(f)throw f;n=d||[]}else{const{data:d,error:f}=await K.from("printers").select(`
            *,
            printer_assignments(
              id, 
              client_id, 
              status, 
              serial_number,
              is_unassigned,
              department_location_id,
              assignment_effective_date,
              condition,
              usage_type,
              reason_for_change,
              notes,
              created_at,
              updated_at,
              clients(id, name),
              departments_location(
                id,
                name,
                department:departments(id, name)
              )
            )
          `).eq("status","active").order("name");if(f){m("Failed to fetch printers"),y({title:"Error",description:"Failed to fetch printers",variant:"destructive"}),u(!1);return}n=d||[]}l(n)}catch(n){m(n instanceof Error?n.message:"Failed to fetch printers"),y({title:"Error",description:"Failed to fetch printers",variant:"destructive"})}finally{u(!1)}};return i.useEffect(()=>{h()},[t]),{printers:r,loading:p,error:o,loadPrinters:h}},me=[{name:"Cyan",value:"cyan",bgClass:"bg-cyan-500"},{name:"Yellow",value:"yellow",bgClass:"bg-yellow-500"},{name:"Magenta",value:"magenta",bgClass:"bg-fuchsia-500"},{name:"Black",value:"black",bgClass:"bg-black"}],he=({selectedColor:t,selectedColors:r,onColorChange:l,size:p="md",showLabel:u=!0,multiSelect:o=!1})=>{const y={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"}[p],h=n=>{if(o){const d=r||[];d.includes(n)?l(d.filter(f=>f!==n)):l([...d,n])}else l(n)};return e.jsxs("div",{className:"space-y-2",children:[u&&e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Color Variation"}),e.jsx("div",{className:"flex space-x-2",children:me.map(n=>{const d=o?(r||[]).includes(n.value):t===n.value;return e.jsx("button",{type:"button",onClick:()=>h(n.value),className:`
                ${y} ${n.bgClass} rounded border-2 transition-all duration-200 hover:scale-110
                ${d?"border-gray-800 ring-2 ring-gray-300":"border-gray-300 hover:border-gray-400"}
              `,title:n.name},n.value)})})]})},Pe=({isOpen:t,onClose:r,product:l,onProductUpdated:p,variants:u=[]})=>{const[o,m]=i.useState(l),[y,h]=i.useState(l.name||""),[n,d]=i.useState(l.sku||""),[f,v]=i.useState(l.alias||""),[w,c]=i.useState(l.category||""),[g,k]=i.useState(l.color||""),[S,P]=i.useState(""),[j,s]=i.useState(!1);i.useEffect(()=>{const a=o||l;h(a.name||""),d(a.sku||""),c(a.category||""),k(a.color||""),v(a.alias||""),(async()=>{try{const N=await z.getProductPrinters(a.id);P(N.map(R=>R.name).join(", "))}catch(N){console.error("Failed to fetch product printers",N),P("")}})()},[o,l]),i.useEffect(()=>{m(l)},[l]);const b=async()=>{if(o){s(!0);try{const a={name:y,sku:n,category:w,color:g,alias:f};await I.updateProduct(o.id,a);const C=S.split(",").map(N=>N.trim()).filter(Boolean);await z.addPrintersToProduct(o.id,C),M.success("Product updated successfully."),p(),r()}catch(a){M.error("Failed to update product."),console.error("Failed to update product",a)}finally{s(!1)}}},F=async()=>{if(o){s(!0);try{await I.deleteProduct(o.id),M.success("Product deleted successfully."),p(),r()}catch(a){M.error("Failed to delete product."),console.error("Failed to delete product",a)}finally{s(!1)}}};return e.jsx(B,{open:t,onOpenChange:r,children:e.jsxs(U,{className:"w-full max-w-[95vw] sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsx(V,{children:e.jsx(J,{className:"text-lg sm:text-xl",children:"Edit Product"})}),u.length>1&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Variant"}),e.jsx("select",{className:"w-full rounded border border-gray-300 px-3 py-2",value:o.id,onChange:a=>{const C=u.find(N=>N.id===a.target.value);C&&m(C)},children:u.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (SKU: ",a.sku,") ",a.color?`- ${a.color}`:""]},a.id))})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"name",className:"text-sm font-medium",children:"Product Name *"}),e.jsx(L,{id:"name",value:y,onChange:a=>h(a.target.value),className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"sku",className:"text-sm font-medium",children:"SKU *"}),e.jsx(L,{id:"sku",value:n,onChange:a=>d(a.target.value),className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"alias",className:"text-sm font-medium",children:"Alias"}),e.jsx(L,{id:"alias",value:f,onChange:a=>v(a.target.value),className:"w-full",placeholder:"e.g., 128A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"category",className:"text-sm font-medium",children:"Category *"}),e.jsx(L,{id:"category",value:w,onChange:a=>c(a.target.value),className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Color Variation"}),e.jsx(he,{selectedColor:g,onColorChange:a=>k(Array.isArray(a)?a[0]:a)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"printers",className:"text-sm font-medium",children:"Supported Printers"}),e.jsx(Z,{id:"printers",value:S,onChange:a=>P(a.target.value),placeholder:"e.g., HP LaserJet Pro M404n, Canon PIXMA G3260",className:"min-h-[80px]"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tip: Use exact model names separated by commas. New printers will be automatically added to the database."})]})]}),e.jsxs(O,{className:"flex-col sm:flex-row gap-2 sm:gap-0",children:[e.jsx(D,{variant:"destructive",onClick:F,disabled:j,className:"w-full sm:w-auto order-last sm:order-first",children:"Delete Product"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(D,{variant:"outline",onClick:r,disabled:j,className:"flex-1 sm:flex-none",children:"Cancel"}),e.jsx(D,{onClick:b,disabled:j,className:"flex-1 sm:flex-none",children:j?"Updating...":"Update Product"})]})]})]})})},Ce=t=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(t),ke=({productGroup:t,onEdit:r,onDelete:l,onViewDetails:p,onClone:u,onMerge:o})=>{var P,j;const{userProfile:m}=X(),[y,h]=i.useState(!1),[n,d]=i.useState(!1),f=m&&!["admin","sales_admin","owner"].includes(m.role||""),v=s=>s&&{black:"#000000",cyan:"#00FFFF",magenta:"#FF00FF",yellow:"#FFFF00",red:"#FF0000",blue:"#0000FF",green:"#00FF00"}[s.toLowerCase()]||"#6B7280",w=s=>{s.target.closest(".sku-area")||s.target.closest(".action-area")||h(!y)},c=s=>{s.stopPropagation(),r==null||r(t)},g=s=>{s.stopPropagation(),r==null||r(t)},k=s=>{s.stopPropagation(),t.allProducts.length===1?l==null||l(t):d(!0)},S=s=>{d(!1);const b={...t,allProducts:[s]};l==null||l(b)};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"relative cursor-pointer hover:shadow-md transition-all duration-200 active:scale-[0.98]",onClick:w,children:e.jsx(se,{className:"p-3",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-[80px] w-20",children:[e.jsx("div",{className:"font-semibold text-xs text-gray-900 leading-tight mb-2 text-center sku-area cursor-pointer hover:text-blue-600 hover:underline transition-colors p-1 rounded touch-target",onClick:c,title:"Tap to edit",children:Array.from(new Set(t.allProducts.map(s=>s.sku))).join(" / ")}),e.jsx("div",{className:"bg-blue-50 rounded-lg flex items-center justify-center w-16 h-16 mb-2",children:e.jsx(ne,{className:"w-8 h-8 text-blue-400"})}),!f&&e.jsxs("div",{className:"flex gap-1 w-full action-area",children:[e.jsx(D,{variant:"outline",size:"sm",className:"h-6 px-2 text-xs flex-1",onClick:g,title:"Edit product",children:e.jsx($,{className:"h-3 w-3"})}),e.jsx(D,{variant:"outline",size:"sm",className:"h-6 px-2 text-xs flex-1 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:k,title:"Delete product",children:e.jsx(Q,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"mb-2",children:e.jsx(le,{printerId:((P=t.allProducts[0])==null?void 0:P.printer_id)||((j=t.supportedPrinters[0])==null?void 0:j.id),className:"text-xs flex flex-row flex-wrap gap-2"})}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Supplied To:"}),t.departmentsSupplied.length>0?e.jsxs("div",{className:"text-xs text-gray-700 space-y-0.5",children:[t.departmentsSupplied.slice(0,2).map((s,b)=>e.jsxs("div",{className:"truncate",children:[s.clientName,s.departmentName&&` - ${s.departmentName}`]},b)),t.departmentsSupplied.length>2&&e.jsxs("div",{className:"text-gray-500",children:["+",t.departmentsSupplied.length-2," more"]})]}):e.jsx("div",{className:"text-xs text-gray-400 italic",children:"None"})]}),t.supportedPrinters.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Printers:"}),e.jsxs("div",{className:"text-xs text-gray-700",children:[t.supportedPrinters.slice(0,2).map((s,b)=>e.jsx("span",{className:"block truncate",children:[s.manufacturer,s.series,s.model||s.name].filter(Boolean).join(" ")},s.id||b)),t.supportedPrinters.length>2&&e.jsxs("span",{className:"text-gray-500",children:["+",t.supportedPrinters.length-2," more"]})]})]})]}),!f&&e.jsx("div",{className:"action-area flex-shrink-0",children:e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",className:"h-8 w-8 p-0 touch-target",onClick:s=>s.stopPropagation(),children:e.jsx(de,{className:"h-4 w-4"})})}),e.jsxs(re,{align:"end",className:"w-40",children:[e.jsxs(q,{onClick:s=>{s.stopPropagation(),p&&p(t)},children:[e.jsx(ce,{className:"mr-2 h-3 w-3"}),"View Details"]}),e.jsxs(q,{onClick:s=>{s.stopPropagation(),r&&r(t)},children:[e.jsx($,{className:"mr-2 h-3 w-3"}),"Edit Product"]}),e.jsxs(q,{onClick:s=>{s.stopPropagation(),u&&u(t)},children:[e.jsx(oe,{className:"mr-2 h-3 w-3"}),"Clone"]}),e.jsxs(q,{onClick:s=>{s.stopPropagation(),o&&o(t)},children:[e.jsx(ue,{className:"mr-2 h-3 w-3"}),"Merge"]})]})]})})]})})}),e.jsx(B,{open:n,onOpenChange:d,children:e.jsxs(U,{className:"w-[95vw] max-w-md h-[85vh] max-h-[600px] rounded-xl p-0 flex flex-col",children:[e.jsx(V,{className:"sticky top-0 bg-white z-10 p-4 border-b rounded-t-xl",children:e.jsx(J,{className:"text-base text-red-600",children:"Select Product to Delete"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:t.allProducts.map((s,b)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-red-200 rounded-lg hover:bg-red-50 cursor-pointer transition-colors active:scale-[0.98] touch-target",onClick:()=>S(s),tabIndex:0,role:"button","aria-label":`Delete ${s.name}`,onKeyDown:F=>{(F.key==="Enter"||F.key===" ")&&S(s)},children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("span",{className:"w-4 h-4 rounded-full border border-gray-300 flex-shrink-0",style:{backgroundColor:v(s.color)}}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 truncate",children:s.name}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:["SKU: ",s.sku]}),e.jsx("div",{className:"text-xs text-red-600 truncate",children:"⚠️ This action cannot be undone"})]})]}),e.jsx(Q,{className:"h-4 w-4 text-red-600 flex-shrink-0"})]},b))})]})})]})},Se=({onRefresh:t,children:r,threshold:l=80,maxPullDistance:p=120,holdDuration:u=300,className:o=""})=>{const[m,y]=i.useState(!1),[h,n]=i.useState(0),[d,f]=i.useState(!1),[v,w]=i.useState(!1),[c,g]=i.useState(!1),k=i.useRef(null),S=i.useRef(0),P=i.useRef(0),j=i.useRef(!1),s=i.useRef(null),b=i.useRef(0),F=i.useCallback(async()=>{if(!m){y(!0);try{await t()}catch(x){console.error("Pull to refresh failed:",x)}finally{y(!1),n(0),w(!1),g(!1)}}},[t,m]),a=i.useCallback(x=>{var T;(((T=k.current)==null?void 0:T.scrollTop)||0)<=0&&(S.current=x.touches[0].clientY,P.current=x.touches[0].clientY,j.current=!0,b.current=Date.now(),s.current=setTimeout(()=>{w(!0),g(!0)},u))},[u]),C=i.useCallback(x=>{if(!j.current||m)return;P.current=x.touches[0].clientY;const E=P.current-S.current;if(E>0&&v){x.preventDefault();const T=Math.min(E*.5,p);n(T),f(T>0)}else E>0&&!v&&g(!0)},[m,p,v]),N=i.useCallback(()=>{j.current&&(s.current&&(clearTimeout(s.current),s.current=null),j.current=!1,h>=l&&v?F():(n(0),f(!1),w(!1),g(!1)))},[h,l,v,F]),R=i.useCallback(()=>{s.current&&(clearTimeout(s.current),s.current=null),j.current=!1,n(0),f(!1),w(!1),g(!1)},[]);return i.useEffect(()=>{const x=k.current;if(x)return x.addEventListener("touchstart",a,{passive:!1}),x.addEventListener("touchmove",C,{passive:!1}),x.addEventListener("touchend",N,{passive:!1}),x.addEventListener("touchcancel",R,{passive:!1}),()=>{x.removeEventListener("touchstart",a),x.removeEventListener("touchmove",C),x.removeEventListener("touchend",N),x.removeEventListener("touchcancel",R),s.current&&clearTimeout(s.current)}},[a,C,N,R]),e.jsxs("div",{ref:k,className:`relative overflow-hidden ${o}`,style:{transform:`translateY(${h}px)`,transition:d?"none":"transform 0.3s ease-out"},children:[c&&!v&&e.jsx("div",{className:"absolute top-0 left-0 right-0 flex items-center justify-center bg-gradient-to-b from-yellow-50 to-transparent transition-opacity duration-200 opacity-100",style:{height:"60px",transform:"translateY(-60px)"},children:e.jsx("div",{className:"flex items-center gap-2 text-yellow-600",children:e.jsx("span",{className:"text-sm font-medium",children:"Hold to enable pull-to-refresh"})})}),e.jsx("div",{className:`absolute top-0 left-0 right-0 flex items-center justify-center bg-gradient-to-b from-blue-50 to-transparent transition-opacity duration-200 ${d&&v?"opacity-100":"opacity-0"}`,style:{height:`${Math.max(h,60)}px`,transform:`translateY(-${Math.max(h,60)}px)`},children:e.jsx("div",{className:"flex items-center gap-2 text-blue-600",children:e.jsx("span",{className:"text-sm font-medium",children:h>=l?"Release to refresh":"Pull to refresh"})})}),e.jsx("div",{className:"relative",children:r}),m&&e.jsx("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsx("div",{className:"flex items-center gap-3 text-blue-600",children:e.jsx("span",{className:"text-sm font-medium",children:"Refreshing..."})})})]})},Fe=()=>{const t=W(),{toast:r}=Y(),{loadClients:l}=G(),{loadSuppliers:p}=ie(),{loadPrinters:u}=H(!0),{loadPrinters:o}=H(!1);return{refreshAllData:async()=>{try{await t.invalidateQueries(),await Promise.all([l(),p(),u(),o()]),r({title:"Data Refreshed",description:"All data has been updated successfully."})}catch(c){console.error("Refresh failed:",c),r({title:"Refresh Failed",description:"Some data may not have been updated. Please try again.",variant:"destructive"})}},refreshClients:async()=>{try{await t.invalidateQueries({queryKey:["clients"]}),await l(),r({title:"Clients Refreshed",description:"Client data has been updated."})}catch(c){console.error("Client refresh failed:",c),r({title:"Refresh Failed",description:"Failed to refresh client data.",variant:"destructive"})}},refreshSuppliers:async()=>{try{await t.invalidateQueries({queryKey:["suppliers"]}),await p(),r({title:"Suppliers Refreshed",description:"Supplier data has been updated."})}catch(c){console.error("Supplier refresh failed:",c),r({title:"Refresh Failed",description:"Failed to refresh supplier data.",variant:"destructive"})}},refreshPrinters:async()=>{try{await t.invalidateQueries({queryKey:["printers"]}),await Promise.all([u(),o()]),r({title:"Printers Refreshed",description:"Printer data has been updated."})}catch(c){console.error("Printer refresh failed:",c),r({title:"Refresh Failed",description:"Failed to refresh printer data.",variant:"destructive"})}},refreshProducts:async()=>{try{await t.invalidateQueries({queryKey:["products"]}),r({title:"Products Refreshed",description:"Product data has been updated."})}catch(c){console.error("Product refresh failed:",c),r({title:"Refresh Failed",description:"Failed to refresh product data.",variant:"destructive"})}},refreshDashboardStats:async()=>{try{await t.invalidateQueries({queryKey:["dashboard-stats"]}),r({title:"Dashboard Refreshed",description:"Dashboard statistics have been updated."})}catch(c){console.error("Dashboard refresh failed:",c),r({title:"Refresh Failed",description:"Failed to refresh dashboard data.",variant:"destructive"})}},refreshClientData:async c=>{try{await t.invalidateQueries({queryKey:["client",c]}),await t.invalidateQueries({queryKey:["assignments",c]}),await t.invalidateQueries({queryKey:["departments",c]}),r({title:"Client Data Refreshed",description:"Client information has been updated."})}catch(g){console.error("Client data refresh failed:",g),r({title:"Refresh Failed",description:"Failed to refresh client data.",variant:"destructive"})}},refreshSupplierData:async c=>{try{await t.invalidateQueries({queryKey:["supplier",c]}),await t.invalidateQueries({queryKey:["supplier-products",c]}),r({title:"Supplier Data Refreshed",description:"Supplier information has been updated."})}catch(g){console.error("Supplier data refresh failed:",g),r({title:"Refresh Failed",description:"Failed to refresh supplier data.",variant:"destructive"})}}}};export{Pe as A,he as C,ke as P,Fe as a,Se as b,Ce as f,H as u};
//# sourceMappingURL=useRefreshFunctions-DaHXTbHG.js.map

var Qs=Object.defineProperty;var Xs=(t,l,s)=>l in t?Qs(t,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[l]=s;var Xe=(t,l,s)=>Xs(t,typeof l!="symbol"?l+"":l,s);import{c as Se,a as ns,r as a,s as M,j as e,u as xe,X as Ae,C as hs,D as de,d as me,e as ve,f as ue,B as L,g as Ye,o as Ie,R as ls,p as Ze,T as Ts,S as gs,q as fs,v as ps,w as bs,x as ss,P as Ls,U as js,i as ys,h as vs,y as Fs,z as ws,E as Ns,A as Is,F as Zs,l as et,b as st}from"./index-FgfazPn4.js";import{u as $s}from"./use-mobile-CasDpXHz.js";import{C as Je,A as tt,a as at,b as nt,c as lt,d as it,e as rt,f as ct,g as ot,E as dt}from"./alert-dialog-a1roshmq.js";import{B as ne}from"./badge-PQ_Xgg0c.js";import{a as oe,c as Fe,p as _s}from"./clientService-scOH6ADK.js";import{C as ce}from"./circle-check-big-B5GuSQz3.js";import{C as mt}from"./clock-UXFbK2OM.js";import{C as He}from"./circle-alert-YIDi-HZf.js";import{U as ye}from"./user-L0Nw7dze.js";import{B as Be,S as ut}from"./settings-T9C6ttIn.js";import{M as Us,H as xt}from"./map-pin-Bd6tXVet.js";import{L as ke}from"./loader-circle-HvrrQJfJ.js";import{A as zs,S as Le,v as ht,a as ts,b as Re,B as gt,c as Ss,d as ft,e as ge,f as pt,g as as}from"./AddButtonNavigation-BUuDQXbT.js";import{T as Cs,a as ks,b as Ne,c as _e}from"./tabs-CXhmf9qd.js";import{C as Ue,a as ze}from"./card-S-815Fh1.js";import{P as De,M as bt}from"./printer-X5np4qGe.js";import{I as ie}from"./input-Cc5DIsqr.js";import{L as X,T as jt,C as cs}from"./label-C7AHjZf1.js";import{a as Ke,C as Bs,S as us}from"./checkbox-De7F5xfH.js";import{E as qs}from"./eye-BJula9yD.js";import{U as Os}from"./upload-BCc2dJv1.js";import{S as yt}from"./scroll-area-DzmqWWKn.js";import{P as Ee,U as vt,D as es}from"./users-7LwHL_dG.js";import{F as Ve}from"./file-text-hP0IkulY.js";import{P as wt}from"./ProductDetailsModal-BJyiyVc3.js";import{C as Nt,D as _t}from"./ClientListModal-BmJzvTJR.js";import{M as St}from"./MobileFilterButtons-DfOhOMAv.js";import"./trending-up-_gLokptJ.js";import"./database-RojKuwWx.js";import"./chevron-right-BqyfOyy6.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=Se("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=Se("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=Se("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=Se("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=Se("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=Se("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=Se("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=Se("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=Se("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=Se("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);function Mt(t,l){if(t==="Done")if(l){const s=new Date(l),u=Math.floor((new Date().getTime()-s.getTime())/(1e3*60*60*24));return u>=61?{icon:e.jsx(ce,{className:"h-[13px] w-[13px] text-red-600"})}:u>=31?{icon:e.jsx(ce,{className:"h-[13px] w-[13px] text-orange-500"})}:{icon:e.jsx(ce,{className:"h-[13px] w-[13px] text-green-600"})}}else return{icon:e.jsx(ce,{className:"h-[13px] w-[13px] text-green-600"})};switch(t){case"For Repair":case"For Pullout":return{icon:e.jsx(He,{className:"h-[13px] w-[13px] text-red-600"})};case"Need Drumkit Replacement":case"Need Cleaning":return{icon:e.jsx(He,{className:"h-[13px] w-[13px] text-orange-500"})};default:return{icon:e.jsx(mt,{className:"h-[13px] w-[13px] text-gray-400"})}}}const Tt=({printerId:t})=>{const{user:l,userProfile:s}=ns(),[r,u]=a.useState([]),[n,d]=a.useState([]),[i,x]=a.useState(!0);a.useEffect(()=>{(s==null?void 0:s.role)==="client"&&(l!=null&&l.id)&&M.from("client_access").select("client_id").eq("user_id",l.id).then(({data:c})=>{d(c?c.map(g=>g.client_id):[])})},[l,s]);const m=a.useCallback(async()=>{try{const{data:c,error:g}=await M.from("printer_assignments").select(`
          *,
          clients (
            name
          ),
          departments_location (
            name,
            department:departments (
              name
            )
          )
        `).eq("printer_id",t).in("status",["active","inactive","undeployed"]);if(g)throw g;u(c||[])}catch(c){console.error("Error fetching assignments:",c),u([])}finally{x(!1)}},[t]),o=a.useCallback(()=>{m()},[m]);if(a.useEffect(()=>{const c=()=>{o()};return window.addEventListener(`refresh-assignments-${t}`,c),()=>{window.removeEventListener(`refresh-assignments-${t}`,c)}},[t,o]),a.useEffect(()=>{m()},[m]),a.useEffect(()=>{const c=M.channel(`printer-assignments-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"printer_assignments",filter:`printer_id=eq.${t}`},g=>{setTimeout(()=>{m()},200)}).subscribe(g=>{});return()=>{M.removeChannel(c)}},[t]),i)return e.jsxs("div",{className:"mt-3 pt-3 border-t border-orange-200/50",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Assigned To:"}),e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Loading..."})]});const h=(s==null?void 0:s.role)==="client"?r.filter(c=>c.client_id&&n.includes(c.client_id)):r;return e.jsxs("div",{className:"mt-3 border-t border-orange-200/50",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Assigned To:"}),h.length>0?e.jsx("div",{children:h.map(c=>{var f,k;const g=((f=c.clients)==null?void 0:f.name)||c.client_name||"Unknown Client";let w="";if(c.departments_location){const q=((k=c.departments_location.department)==null?void 0:k.name)||c.department||"",y=c.departments_location.name||c.location||"";w=[q,y].filter(Boolean).join(" - ")}else(c.department||c.location)&&(w=[c.department,c.location].filter(Boolean).join(" - "));const{icon:E}=Mt(c.maintenance_status,c.last_maintenance_date);let N="",j="",T="";c.status==="inactive"?(N="Inactive",j="bg-gray-200 text-gray-700 border-gray-300",T="text-gray-500 italic"):c.status==="undeployed"?(N="For Assignment",j="bg-orange-100 text-orange-700 border-orange-200",T="text-orange-700"):c.status==="active"?(N="Active",j="bg-green-100 text-green-700 border-green-300",T="text-green-700"):(j="bg-gray-100 text-gray-700 border-gray-200",T="text-gray-700");let p=g;return w&&(p+=` (${w})`),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${T}`,children:[e.jsx("span",{"aria-label":`Maintenance Status: ${c.maintenance_status||"No Status"}`,title:`Maintenance Status: ${c.maintenance_status||"No Status"}`,className:"flex items-center justify-center mr-1",children:E}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded border text-xs font-medium ${j} mr-2`,children:N}),e.jsx("span",{className:c.is_client_owned?"text-blue-600":void 0,children:p})]},c.id)})}):e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Not currently assigned to any clients."})]})},Lt=({isOpen:t,onClose:l,printerId:s,onUnassigned:r})=>{var b,A,F,_;const{toast:u}=xe(),[n,d]=a.useState(1),[i,x]=a.useState(null),[m,o]=a.useState(null),[h,c]=a.useState(!1),[g,w]=a.useState(null),[E,N]=a.useState([]),[j,T]=a.useState(!1),[p,f]=a.useState(null),[k,q]=a.useState(""),[y,U]=a.useState({name:"",manufacturer:"",series:"",model:""});a.useEffect(()=>{t&&s&&I()},[t,s]),a.useEffect(()=>{t&&s&&(async()=>{const{data:P,error:v}=await M.from("printers").select("name").eq("id",s).single();!v&&(P!=null&&P.name)&&q(P.name)})()},[t,s]),a.useEffect(()=>{t&&s&&(async()=>{const{data:P,error:v}=await M.from("printers").select("name, manufacturer, series, model").eq("id",s).single();!v&&P&&U(P)})()},[t,s]);const I=async()=>{T(!0);try{const{data:P,error:v}=await M.from("printers").select("*").eq("id",s).single();if(v)throw v;f(P);const{data:J,error:Z}=await M.from("printer_assignments").select(`
          id,
          client_id,
          department_location_id,
          department,
          location,
          serial_number,
          printer_id,
          clients!inner(id, name),
          departments_location(
            id,
            name,
            departments(id, name)
          ),
          is_client_owned,
          status
        `).eq("printer_id",s);if(Z)throw Z;const te=(J||[]).map(Y=>{var G,re;return{id:Y.id,client_id:Y.client_id,client:{id:((G=Y.clients)==null?void 0:G.id)||"",name:((re=Y.clients)==null?void 0:re.name)||""},departments_location:Y.departments_location?{id:Y.departments_location.id||"",name:Y.departments_location.name||"",department:Y.departments_location.departments?{id:Y.departments_location.departments.id||"",name:Y.departments_location.departments.name||""}:void 0}:void 0,department:Y.department||"",location:Y.location||"",serial_number:Y.serial_number||"",status:Y.status||"N/A",department_location_id:Y.department_location_id}});N(te),te.length===1?(x(te[0]),d(2)):d(1)}catch(P){console.error("Failed to fetch assignments:",P),w("Failed to load assignment data")}finally{T(!1)}};if(!t)return null;const C=P=>{x(P),d(2),w(null)},H=P=>{o(P),d(3)},O=async()=>{var P;if(!(!i||!m)){c(!0),w(null);try{let v="";switch(m){case"location":await oe.unassignFromLocation(i.id),v="Printer successfully unassigned from location";break;case"department":await oe.unassignFromDepartment(i.id),v="Printer successfully unassigned from department";break;case"client":await oe.unassignFromClient(i.id),v=`Printer successfully unassigned from ${((P=i.client)==null?void 0:P.name)||"client"}`;break;default:throw new Error("Invalid unassignment level")}u({title:"Success",description:v}),window.dispatchEvent(new CustomEvent(`refresh-assignments-${s}`)),r(),l()}catch(v){console.error("Unassignment failed:",v),w(v.message||"Failed to unassign printer."),u({title:"Error",description:v.message||"Failed to unassign printer.",variant:"destructive"})}finally{c(!1)}}},z=()=>{n===3?(d(2),o(null)):(d(1),x(null)),w(null)},K=()=>{d(1),x(null),o(null),w(null),l()},W=()=>{w(null),c(!1)},ee=P=>{var v;if(P.departments_location){const J=((v=P.departments_location.department)==null?void 0:v.name)||"Unknown Department",Z=P.departments_location.name||"Unknown Location";return`${J} - ${Z}`}return P.department||P.location?[P.department,P.location].filter(Boolean).join(" - "):"No specific location"},B=()=>{var Z,te;if(!i||!m)return"";const P=((Z=i.client)==null?void 0:Z.name)||"Unknown Client",v=i.department||"Unknown Department",J=((te=i.departments_location)==null?void 0:te.name)||i.location||"Unknown Location";switch(m){case"location":return`Unassign printer from location "${J}"? The printer will remain assigned to the ${v} department.`;case"department":return`Unassign printer from department "${v}"? The printer will remain assigned to ${P} client only.`;case"client":return`Unassign printer from client "${P}"? The printer will become available but retain reference to the last client for visibility.`;default:return""}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg max-w-lg w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full",children:e.jsx(ye,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n===1?"Unassign Printer":n===2?"Select Assignment Level":"Confirm Unassignment"})]}),e.jsx("button",{onClick:K,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:h,children:e.jsx(Ae,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[n===1&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-700 mb-4",children:["Select an assignment to unassign for printer ",e.jsx("b",{children:[y.manufacturer,y.series,y.model||y.name].filter(Boolean).join(" ")}),":"]}),j?e.jsx(hs,{message:"Loading assignments"}):E.length===0?e.jsx("div",{className:"text-gray-500 italic",children:"No active assignments found."}):e.jsx("ul",{className:"space-y-3 mb-4",children:E.map(P=>{var v;return e.jsxs("li",{className:"border rounded-lg p-3 flex flex-col cursor-pointer hover:bg-blue-50 transition",onClick:()=>C(P),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ye,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:((v=P.client)==null?void 0:v.name)||"Unknown Client"}),P.serial_number&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:["SN: ",P.serial_number]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-1",children:[e.jsx(Be,{className:"h-3 w-3"}),e.jsx("span",{children:ee(P)})]}),P.deployment_date&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Deployed: ",new Date(P.deployment_date).toLocaleDateString()]}),P.condition&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Condition: ",e.jsx("span",{className:"capitalize",children:P.condition})]})]},P.id)})})]}),n===2&&i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 p-3 rounded-md bg-gray-50 border flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ye,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"font-medium",children:((b=i.client)==null?void 0:b.name)||i.client_id}),i.serial_number&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["SN: ",i.serial_number]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{children:"Printer:"}),e.jsx("span",{className:"font-semibold",children:[y.manufacturer,y.series,y.model||y.name].filter(Boolean).join(" ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:"font-semibold",children:i.status||"N/A"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"Current Assignment Hierarchy"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Click the unlink icon next to any level to unassign the printer from that level:"}),e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:((A=i.client)==null?void 0:A.name)||"Unknown Client"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Client"})]})]}),e.jsx("button",{onClick:()=>H("client"),disabled:h,className:"flex items-center gap-2 px-3 py-1 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Unassign from client (printer becomes available)",children:e.jsx(ms,{className:"h-4 w-4"})})]}),((F=i.client)==null?void 0:F.name)&&i.department&&i.department.trim()!==""&&e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Be,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:i.department}),e.jsx("div",{className:"text-xs text-gray-500",children:"Department"})]})]}),e.jsx("button",{onClick:()=>H("department"),disabled:h,className:"flex items-center gap-2 px-3 py-1 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Unassign from department (remains with client)",children:e.jsx(ms,{className:"h-4 w-4"})})]}),(i.department_location_id||i.departments_location)&&e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-200 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Us,{className:"h-5 w-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:((_=i.departments_location)==null?void 0:_.name)||i.location||"Unknown Location"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Location"})]})]}),e.jsx("button",{onClick:()=>H("location"),disabled:h,className:"flex items-center gap-2 px-3 py-1 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Unassign from location (remains with department)",children:e.jsx(ms,{className:"h-4 w-4"})})]})]}),i.serial_number&&e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:["Serial Number: ",e.jsx("span",{className:"font-mono",children:i.serial_number})]})]}),g&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 mb-2",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Error"})]}),e.jsx("div",{className:"text-sm text-red-700 mb-2",children:g}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:W,className:"text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",children:"Try Again"}),e.jsx("button",{onClick:z,className:"text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors",children:"Go Back"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:z,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:h,children:"Back"}),e.jsx("button",{onClick:K,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:h,children:"Cancel"})]})]}),n===3&&i&&m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"bg-yellow-100 p-2 rounded-full",children:e.jsx(He,{className:"h-5 w-5 text-yellow-600"})}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"Confirm Unassignment"})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-gray-700",children:B()})}),i.serial_number&&e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:["Serial Number: ",e.jsx("span",{className:"font-mono",children:i.serial_number})]})]}),g&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 mb-2",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Error"})]}),e.jsx("div",{className:"text-sm text-red-700 mb-2",children:g}),e.jsx("button",{onClick:W,className:"text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",children:"Try Again"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:z,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:h,children:"Back"}),e.jsx("button",{onClick:O,disabled:h,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"h-4 w-4 animate-spin"}),"Processing..."]}):"Proceed"})]})]})]})]})})},Ft=({isOpen:t,onClose:l,printerId:s,clients:r,getDepartmentsByClient:u,onTransfer:n})=>{var B,b,A,F,_,P;const[d,i]=a.useState(1),[x,m]=a.useState(null),[o,h]=a.useState(""),[c,g]=a.useState([]),[w,E]=a.useState(""),[N,j]=a.useState(!1),[T,p]=a.useState(null),[f,k]=a.useState([]),[q,y]=a.useState(!1),[U,I]=a.useState(null),[C,H]=a.useState({name:"",manufacturer:"",series:"",model:""});a.useEffect(()=>{t&&s&&O()},[t,s]),a.useEffect(()=>{t&&s&&(async()=>{const{data:v,error:J}=await M.from("printers").select("name, manufacturer, series, model").eq("id",s).single();!J&&v&&H(v)})()},[t,s]),a.useEffect(()=>{if(d===2&&o){g([]);const v=w;u(o).then(J=>{g(J),v&&J.some(Z=>Z.id===v)?E(v):E("")})}},[d,o,u]);const O=async()=>{y(!0);try{const{data:v,error:J}=await M.from("printers").select("*").eq("id",s).single();if(J)throw J;I(v);const{data:Z,error:te}=await M.from("printer_assignments").select(`
          id,
          client_id,
          department_location_id,
          serial_number,
          printer_id,
          clients!inner(id, name),
          departments_location(
            id,
            name,
            departments(id, name)
          ),
          is_client_owned,
          status
        `).eq("printer_id",s);if(te)throw te;const Y=(Z||[]).map(G=>{var fe,we,Pe,le,Ce;const re=((we=(fe=G.departments_location)==null?void 0:fe.departments)==null?void 0:we.name)||"",Me=((Pe=G.departments_location)==null?void 0:Pe.name)||"";return{id:G.id,client_id:G.client_id,client:{id:((le=G.clients)==null?void 0:le.id)||"",name:((Ce=G.clients)==null?void 0:Ce.name)||""},departments_location:G.departments_location?{id:G.departments_location.id||"",name:G.departments_location.name||"",department:G.departments_location.departments?{id:G.departments_location.departments.id||"",name:G.departments_location.departments.name||""}:void 0}:void 0,department:re,location:Me,serial_number:G.serial_number||"",status:G.status||"N/A",department_location_id:G.department_location_id}});k(Y),Y.length===1?(m(Y[0]),h(Y[0].client_id),E(Y[0].department_location_id||""),i(2)):i(1)}catch(v){console.error("Failed to fetch assignments:",v),p("Failed to load assignment data")}finally{y(!1)}};if(!t)return null;const z=v=>{m(v),h(v.client_id),E(v.department_location_id||""),i(2),p(null)},K=async()=>{if(!(!x||!o||!w)){j(!0),p(null);try{await n(x,o,w),window.dispatchEvent(new CustomEvent(`refresh-assignments-${s}`)),j(!1),l()}catch(v){console.error("Transfer failed:",v),p(v.message||"Failed to transfer printer."),j(!1)}}},W=()=>{i(1),m(null),p(null)},ee=()=>{i(1),m(null),p(null),l()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg max-w-lg w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-purple-100 p-2 rounded-full",children:e.jsx(zs,{className:"h-5 w-5 text-purple-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:d===1?"Transfer Printer":"Transfer Options"})]}),e.jsx("button",{onClick:ee,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:N,children:e.jsx(Ae,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[d===1&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-700 mb-4",children:["Select an assignment to transfer for printer ",e.jsx("b",{children:[C.manufacturer,C.series,C.model||C.name].filter(Boolean).join(" ")}),":"]}),q?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ke,{className:"h-6 w-6 animate-spin text-purple-600"}),e.jsx("span",{className:"ml-2",children:"Loading assignments..."})]}):f.length===0?e.jsx("div",{className:"text-gray-500 italic",children:"No active assignments found."}):e.jsx("ul",{className:"space-y-3 mb-4",children:f.map(v=>{var J,Z,te,Y,G,re;return e.jsxs("li",{className:"border rounded-lg p-3 flex flex-col cursor-pointer hover:bg-purple-50 transition",onClick:()=>z(v),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"font-medium",children:((J=v.client)==null?void 0:J.name)||v.client_id}),v.serial_number&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["SN: ",v.serial_number]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-600",children:(((te=(Z=v.departments_location)==null?void 0:Z.department)==null?void 0:te.name)||v.department)&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-3 w-3"}),((G=(Y=v.departments_location)==null?void 0:Y.department)==null?void 0:G.name)||v.department,((re=v.departments_location)==null?void 0:re.name)&&` - ${v.departments_location.name}`]})})]},v.id)})})]}),d===2&&x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:"Current Assignment"}),e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 text-sm",children:[e.jsx(ye,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{children:((B=x.client)==null?void 0:B.name)||x.client_id})]}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:(((A=(b=x.departments_location)==null?void 0:b.department)==null?void 0:A.name)||x.department)&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-3 w-3"}),((_=(F=x.departments_location)==null?void 0:F.department)==null?void 0:_.name)||x.department,((P=x.departments_location)==null?void 0:P.name)&&` - ${x.departments_location.name}`]})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:"Transfer To"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Client"}),e.jsx("select",{className:"w-full border rounded-lg px-3 py-2",value:o,onChange:v=>{h(v.target.value),E(""),g([])},disabled:N,children:r.map(v=>e.jsx("option",{value:v.id,children:v.name},v.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Department"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2",value:w,onChange:v=>E(v.target.value),disabled:N||c.length===0,children:[e.jsx("option",{value:"",children:"Select Department"}),c.map(v=>e.jsxs("option",{value:v.id,children:[v.name,v.location?` - ${v.location}`:""]},v.id))]})]})]})]}),T&&e.jsx("div",{className:"text-red-600 mb-2",children:T}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:W,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:N,children:"Back"}),e.jsxs("button",{onClick:K,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center disabled:bg-purple-400",disabled:N||!o||!w,children:[N?e.jsx(ke,{className:"h-5 w-5 animate-spin mr-2"}):null,"Transfer"]})]})]})]})]})})},Q=({label:t,value:l,type:s="text",variant:r="default"})=>{if(!l&&l!==!1)return null;const u=()=>{switch(s){case"boolean":return e.jsx(ne,{variant:l?"default":"secondary",children:l?"Yes":"No"});case"link":return e.jsxs("a",{href:l,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline flex items-center gap-1",children:["View ",e.jsx(kt,{className:"h-3 w-3"})]});case"badge":return e.jsx(ne,{variant:r,children:l});default:return e.jsx("span",{className:"text-gray-900",children:l})}};return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3 py-2 border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-600 min-w-0 sm:min-w-[120px]",children:t}),e.jsx("div",{className:"min-w-0 flex-1",children:u()})]})};function Rs({isOpen:t,onClose:l,printer:s}){const[r,u]=a.useState("overview");if(!s)return null;const n=i=>i?"default":"secondary",d=i=>i?i.toLowerCase().includes("laser")?"default":i.toLowerCase().includes("inkjet")?"secondary":"outline":"outline";return e.jsx(de,{open:t,onOpenChange:i=>!i&&l(),children:e.jsxs(me,{className:"max-w-full sm:max-w-2xl p-0 max-h-[95vh] flex flex-col","aria-describedby":"printer-details-description",children:[e.jsx(ve,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(De,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(ue,{className:"text-lg sm:text-xl font-semibold text-gray-900 truncate",children:s.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[s.manufacturer&&e.jsx("span",{className:"text-sm text-gray-600",children:s.manufacturer}),s.model&&e.jsx(ne,{variant:"outline",className:"text-xs",children:s.model}),s.series&&e.jsx(ne,{variant:"outline",className:"text-xs",children:s.series})]})]})]})}),e.jsxs("div",{id:"printer-details-description",className:"sr-only",children:["Detailed information about ",s.name," printer including specifications, connectivity, and support resources."]}),e.jsxs(Cs,{value:r,onValueChange:u,className:"flex-1 flex flex-col min-h-0",children:[e.jsxs(ks,{className:"grid w-full grid-cols-4 mx-4 sm:mx-6 mt-4 h-auto",children:[e.jsx(Ne,{value:"overview",className:"text-xs sm:text-sm py-2",children:"Overview"}),e.jsx(Ne,{value:"specs",className:"text-xs sm:text-sm py-2",children:"Specs"}),e.jsx(Ne,{value:"connectivity",className:"text-xs sm:text-sm py-2",children:"Network"}),e.jsx(Ne,{value:"support",className:"text-xs sm:text-sm py-2",children:"Support"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx(_e,{value:"overview",className:"mt-0",children:e.jsx(Ue,{className:"mx-4 sm:mx-6 mt-4 mb-4",children:e.jsx(ze,{className:"p-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Q,{label:"Status",value:s.is_available?"Available":"In Use",type:"badge",variant:n(s.is_available)}),e.jsx(Q,{label:"Type",value:s.printer_type,type:"badge",variant:d(s.printer_type)}),e.jsx(Q,{label:"Color Capability",value:s.color}),e.jsx(Q,{label:"Release Year",value:s.release_year}),e.jsx(Q,{label:"Functions",value:s.functions}),e.jsx(Q,{label:"Description",value:s.description}),e.jsx(Q,{label:"Aliases",value:s.aliases})]})})})}),e.jsx(_e,{value:"specs",className:"mt-0",children:e.jsx(Ue,{className:"mx-4 sm:mx-6 mt-4 mb-4",children:e.jsx(ze,{className:"p-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Q,{label:"Print Resolution",value:s.resolution}),e.jsx(Q,{label:"Print Speed",value:s.print_speed}),e.jsx(Q,{label:"Processor",value:s.processor}),e.jsx(Q,{label:"RAM",value:s.ram}),e.jsx(Q,{label:"Dimensions",value:s.dimensions}),e.jsx(Q,{label:"Weight",value:s.weight}),e.jsx(Q,{label:"Duplex Printing",value:s.duplex_printing,type:"boolean"}),e.jsx(Q,{label:"ADF",value:s.adf,type:"boolean"}),e.jsx(Q,{label:"Paper Sizes",value:s.paper_sizes}),e.jsx(Q,{label:"Paper Types",value:s.paper_types}),e.jsx(Q,{label:"Input Capacity",value:s.input_capacity})]})})})}),e.jsx(_e,{value:"connectivity",className:"mt-0",children:e.jsx(Ue,{className:"mx-4 sm:mx-6 mt-4 mb-4",children:e.jsx(ze,{className:"p-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Q,{label:"Wired Connectivity",value:s.connectivity_wired}),e.jsx(Q,{label:"Wireless Options",value:s.connectivity_wireless}),e.jsx(Q,{label:"Network Printing",value:s.network_printing,type:"boolean"})]})})})}),e.jsx(_e,{value:"support",className:"mt-0",children:e.jsx(Ue,{className:"mx-4 sm:mx-6 mt-4 mb-4",children:e.jsx(ze,{className:"p-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Q,{label:"Compatible Cartridges",value:s.compatible_cartridges}),e.jsx(Q,{label:"Page Yield",value:s.page_yield}),e.jsx(Q,{label:"Drivers",value:s.drivers_url,type:"link"}),e.jsx(Q,{label:"User Manual",value:s.manual_url,type:"link"}),e.jsx(Q,{label:"Setup Guide",value:s.setup_guide_url,type:"link"}),e.jsx(Q,{label:"Troubleshooting",value:s.troubleshooting_url,type:"link"})]})})})})]})]}),e.jsx("div",{className:"border-t bg-gray-50 px-4 sm:px-6 py-4",children:e.jsx(L,{variant:"outline",onClick:l,className:"w-full sm:w-auto sm:ml-auto sm:block",children:"Close"})})]})})}const It=({isOpen:t,onClose:l,currentClientId:s,currentDepartmentId:r,onSave:u})=>{const[n,d]=a.useState([]),[i,x]=a.useState([]),[m,o]=a.useState(s||""),[h,c]=a.useState(r||""),[g,w]=a.useState(!1);a.useEffect(()=>{t&&(o(s||""),c(r||""),x([]),w(!0),Fe.getClients().then(N=>{d(N.map(j=>({id:j.id,name:j.name}))),w(!1)}))},[t,s,r]),a.useEffect(()=>{m?(w(!0),Fe.getDepartmentsByClient(m).then(N=>{x(N.map(j=>({id:j.id,name:j.name}))),w(!1)})):(x([]),c(""))},[m]);const E=()=>{m&&h&&u(m,h)};return e.jsx(de,{open:t,onOpenChange:l,children:e.jsxs(me,{className:"w-full max-w-[95vw] sm:max-w-[400px]",children:[e.jsx(ve,{children:e.jsx(ue,{children:"Change Client & Department"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Client"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:m,onChange:N=>o(N.target.value),disabled:g,children:[e.jsx("option",{value:"",children:"Select Client"}),n.map(N=>e.jsx("option",{value:N.id,children:N.name},N.id))]})]}),m&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Department/Location"}),e.jsxs("select",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:h,onChange:N=>c(N.target.value),disabled:g||i.length===0,children:[e.jsx("option",{value:"",children:"Select Department/Location"}),i.map(N=>e.jsx("option",{value:N.id,children:N.name},N.id))]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(L,{variant:"outline",onClick:l,className:"flex-1",children:"Cancel"}),e.jsx(L,{onClick:E,disabled:!m||!h,className:"flex-1",children:"Save"})]})]})})},As=({isOpen:t,onClose:l,printerId:s,onAssignmentUpdated:r,isLoading:u=!1})=>{const{toast:n}=xe(),[d,i]=a.useState(1),[x,m]=a.useState([]),[o,h]=a.useState(""),c=x.find(D=>D.id===o),[g,w]=a.useState(!1),[E,N]=a.useState(""),[j,T]=a.useState(""),[p,f]=a.useState(""),[k,q]=a.useState(""),[y,U]=a.useState(""),[I,C]=a.useState(!1),[H,O]=a.useState([]),[z,K]=a.useState([]),[W,ee]=a.useState(!1),[B,b]=a.useState(!1),[A,F]=a.useState(""),[_,P]=a.useState(""),[v,J]=a.useState(!1),[Z,te]=a.useState(""),[Y,G]=a.useState({name:"",manufacturer:"",series:"",model:""});a.useEffect(()=>{t&&s&&(async()=>{const{data:D,error:S}=await M.from("printers").select("name, manufacturer, series, model").eq("id",s).single();!S&&D&&G(D)})()},[t,s]),a.useEffect(()=>{t&&s&&re()},[t,s]),a.useEffect(()=>{t&&s&&(async()=>{const{data:D,error:S}=await M.from("printers").select("name").eq("id",s).single();!S&&(D!=null&&D.name)&&N(D.name)})()},[t,s]);const re=async()=>{w(!0);try{const{data:D,error:S}=await M.from("printer_assignments").select(`
          id,
          client_id,
          department_location_id,
          serial_number,
          printer_id,
          clients!inner(name),
          departments_location(
            name,
            departments(name)
          ),
          is_client_owned,
          status
        `).eq("printer_id",s);if(S)throw console.error("❌ Error fetching assignments:",S),S;const R=(D||[]).map(se=>{var Ge,Qe,qe,Oe;const pe=((Qe=(Ge=se.departments_location)==null?void 0:Ge.departments)==null?void 0:Qe.name)||"",he=((qe=se.departments_location)==null?void 0:qe.name)||"";return{id:se.id,client_id:se.client_id,client_name:((Oe=se.clients)==null?void 0:Oe.name)||"",department_location_id:se.department_location_id,department_name:pe,location_name:he,serial_number:se.serial_number||"",printer_id:se.printer_id,is_client_owned:se.is_client_owned,status:se.status||"N/A"}});m(R),R.length>0&&h(R[0].id),R.length===1?i(2):i(1)}catch(D){console.error("❌ Error fetching assignment data:",D),n({title:"Error",description:"Failed to load assignment data",variant:"destructive"})}finally{w(!1)}};a.useEffect(()=>{Fe.getClients().then(D=>{O(D.map(S=>({id:S.id,name:S.name})))})},[]),a.useEffect(()=>{j?(f(""),K([]),Fe.getDepartmentsByClient(j).then(D=>{let S=D.map(R=>({id:R.id,name:R.name}));c&&c.department_location_id&&!S.some(R=>R.id===c.department_location_id)&&(S=[...S,{id:c.department_location_id,name:[c.department_name,c.location_name].filter(Boolean).join(" - ")||"Unknown Department/Location"}]),K(S)})):(K([]),f(""))},[j,c]),a.useEffect(()=>{if(c){const D=c.client_id,S=c.department_location_id||"",R=c.serial_number||"";b(!!c.is_client_owned),T(D),q(R),U(R),F(D),P(S),C(!1),setTimeout(()=>{f(S)},100)}},[c]);const Me=D=>{h(D),i(2)},fe=D=>{const S=H.find(R=>R.id===D);return(S==null?void 0:S.name)||""},we=D=>{const S=z.find(R=>R.id===D);return(S==null?void 0:S.name)||""},Pe=()=>c?[c.department_name,c.location_name].filter(Boolean).join(" - ")||"No Department/Location":"Select Department + Location",le=async()=>{try{ee(!0);const D={};if(j&&j!==A&&(D.client_id=j),p&&p!==_&&(D.department_location_id=p),k!==y&&(D.serial_number=k),B!==c.is_client_owned&&(D.is_client_owned=B),(j&&j!==A||p&&p!==_)&&(D.status="active"),Object.keys(D).length===0){n({title:"No Changes",description:"No changes were made to save."});return}const{error:S}=await M.from("printer_assignments").update(D).eq("id",o);if(S)throw console.error("❌ Update error:",S),S;await r(),window.dispatchEvent(new CustomEvent(`refresh-assignments-${s}`));const R=fe(A),se=fe(j),pe=we(_),he=we(p);k!==y&&(j!==A||p!==_)?n({title:"Assignment Updated Successfully",description:`Client: ${R} → ${se}
Department: ${pe} → ${he}
Serial: "${y}" → "${k}"`}):k!==y?n({title:"Serial Number Updated Successfully",description:`Serial number changed from "${y}" to "${k}"`}):(j!==A||p!==_)&&n({title:"Assignment Updated Successfully",description:`Old:
Client: ${R}
Department: ${pe}

New:
Client: ${se}
Department: ${he}

Successfully Updated`}),l()}catch(D){console.error("❌ Save operation failed:",D),n({title:"Error",description:"Failed to update assignment. Please try again.",variant:"destructive"})}finally{ee(!1)}},Ce=()=>j!==A||p!==_||k!==y||B!==!!(c!=null&&c.is_client_owned),$e=async(D,S)=>{T(D),f(S),J(!1),ee(!0);try{let R=await Fe.getDepartmentsByClient(D),se="";const pe=R.find(he=>he.id===S);pe?se=pe.name:c&&(se=[c.department_name,c.location_name].filter(Boolean).join(" - ")||"Unknown Department/Location"),te(se),S&&!R.some(he=>he.id===S)&&(R=[...R,{id:S,name:se}]),K(R.map(he=>({id:he.id,name:he.name})))}finally{ee(!1)}};return t?g?e.jsx(de,{open:t,onOpenChange:l,children:e.jsxs(me,{className:"max-w-md",children:[e.jsx(ve,{children:e.jsxs(ue,{className:"flex items-center space-x-2",children:[e.jsx(ds,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading latest assignment data..."})]})}),e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ke,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading latest assignment data..."})]})]})}):e.jsxs(de,{open:t,onOpenChange:l,children:[e.jsxs(me,{className:"max-w-md",children:[e.jsx(ve,{children:e.jsxs(ue,{className:"flex items-center space-x-2",children:[e.jsx(ds,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-base font-semibold",children:"Edit Assignment"})]})}),e.jsxs("div",{className:"space-y-4",children:[d===1&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-700 mb-4",children:["Select an assignment to edit for printer ",e.jsx("b",{children:[Y.manufacturer,Y.series,Y.model||Y.name].filter(Boolean).join(" ")}),":"]}),g?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ke,{className:"h-6 w-6 animate-spin text-purple-600"}),e.jsx("span",{className:"ml-2",children:"Loading assignments..."})]}):x.length===0?e.jsx("div",{className:"text-gray-500 italic",children:"No active assignments found."}):e.jsx("ul",{className:"space-y-3 mb-4",children:x.map(D=>e.jsxs("li",{className:`border rounded-lg p-3 flex flex-col cursor-pointer hover:bg-purple-50 transition ${o===D.id?"ring-2 ring-purple-400":""}`,onClick:()=>Me(D.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"font-medium",children:D.client_name||D.client_id}),D.serial_number&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["SN: ",D.serial_number]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-600",children:D.department_name&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-3 w-3"}),D.department_name,D.location_name&&` - ${D.location_name}`]})})]},D.id))})]}),d===2&&c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 p-3 rounded-md bg-gray-50 border flex flex-col gap-1 relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs",children:"Service Unit"}),e.jsx(Le,{id:"isClientOwned",checked:B,onCheckedChange:b,disabled:W,className:"h-5 w-9"}),e.jsx("span",{className:"text-xs",children:"Client Owned"})]}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 px-3 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-gray-300",style:{minWidth:"60px"},onClick:()=>J(!0),children:"Change"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ye,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"font-medium",children:fe(j)||j})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{children:"Department/Location:"}),e.jsx("span",{className:"font-semibold",children:Z||we(p)||c.department_name||Pe()})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{children:"Printer:"}),e.jsx("span",{className:"font-semibold",children:E||s})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:"font-semibold",children:c.status||"N/A"})]})]}),e.jsx("div",{className:"mb-2 text-sm text-gray-700",children:"Edit assignment details:"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx(X,{children:"Serial Number:"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[I?e.jsx(ie,{value:k,onChange:D=>q(D.target.value),disabled:W,className:"flex-1",placeholder:"Enter serial number...",autoFocus:!0}):e.jsx("span",{className:"text-base text-gray-900 font-mono",children:k||"—"}),e.jsx(L,{type:"button",variant:"ghost",size:"icon",onClick:()=>C(!I),disabled:W,title:"Edit Serial Number",children:e.jsx(ds,{className:"h-4 w-4 text-blue-500"})})]})]})}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx(L,{onClick:()=>i(1),variant:"outline",disabled:W,children:"Back"}),e.jsxs(L,{onClick:le,disabled:W||!Ce(),className:"flex-1",children:[W?e.jsx(ke,{className:"h-5 w-5 animate-spin mr-2"}):null,"Save"]})]})]})]})]}),e.jsx(It,{isOpen:v,onClose:()=>J(!1),currentClientId:j,currentDepartmentId:p,onSave:$e})]}):null},$t=["For Repair","For Pullout","Need Drumkit Replacement","Need Cleaning","Done"];function Ut({assignment:t,printerId:l,onSuccess:s,onError:r}){const[u,n]=a.useState(t.maintenance_status||""),[d,i]=a.useState(""),[x,m]=a.useState(!1),o=async h=>{h.preventDefault(),m(!0);try{const{error:c}=await M.from("printer_assignments").update({maintenance_status:u}).eq("id",t.id);if(c)throw c;if(u==="Done"){const{error:g}=await M.from("maintenance_history").insert([{printer_id:l,assignment_id:t.id,maintenance_type:"General",action_description:d||"Maintenance completed",status_before:t.maintenance_status||null,status_after:"Done",performed_by:"Technician",performed_at:new Date().toISOString(),completed_date:new Date().toISOString().split("T")[0]}]);if(g)throw g}s&&s(),alert("Maintenance status updated!")}catch(c){r&&r(c),alert("Error: "+c.message)}finally{m(!1)}};return e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Maintenance Status"}),e.jsxs("select",{className:"border rounded px-2 py-1 w-full",value:u,onChange:h=>n(h.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select status"}),$t.map(h=>e.jsx("option",{value:h,children:h},h))]})]}),u==="Done"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Maintenance Details"}),e.jsx("textarea",{className:"border rounded px-2 py-1 w-full",value:d,onChange:h=>i(h.target.value),placeholder:"Describe what was done (optional)",rows:3})]}),e.jsx(L,{type:"submit",disabled:x,children:x?"Updating...":"Update Maintenance Status"})]})}const zt=({isOpen:t,onClose:l,printerId:s,onStatusUpdated:r})=>{var T;const[u,n]=a.useState(1),[d,i]=a.useState([]),[x,m]=a.useState(null),[o,h]=a.useState(!1),[c,g]=a.useState(""),[w,E]=a.useState({name:"",manufacturer:"",series:"",model:""});a.useEffect(()=>{(async()=>{if(t&&s){h(!0);try{const{data:f}=await M.from("printer_assignments").select(`
              id,
              client_id,
              department_location_id,
              department,
              location,
              serial_number,
              status,
              clients!inner (
                id,
                name
              ),
              departments_location (
                id,
                name,
                department:departments (
                  id,
                  name
                )
              )
            `).eq("printer_id",s).eq("status","active");i(f||[]),(f==null?void 0:f.length)===1?(m(f[0]),n(2)):n(1)}finally{h(!1)}}else i([]),m(null),n(1)})()},[t,s]),a.useEffect(()=>{t&&s&&(async()=>{const{data:p,error:f}=await M.from("printers").select("name, manufacturer, series, model").eq("id",s).single();!f&&p&&E(p)})()},[t,s]),a.useEffect(()=>{t&&s&&(async()=>{const{data:p,error:f}=await M.from("printers").select("name").eq("id",s).single();!f&&(p!=null&&p.name)&&g(p.name)})()},[t,s]);const N=p=>{m(p),n(2)},j=()=>{r==null||r(),window.dispatchEvent(new Event(`refresh-assignments-${s}`)),l()};return e.jsx(de,{open:t,onOpenChange:l,children:e.jsxs(me,{className:"rounded-lg",children:[e.jsx(ve,{children:e.jsx(ue,{children:"Update Maintenance Status"})}),u===1&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-700 mb-4",children:["Select an assignment to update maintenance status for printer ",e.jsx("b",{children:[w.manufacturer,w.series,w.model||w.name].filter(Boolean).join(" ")}),":"]}),o?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("span",{className:"ml-2",children:"Loading assignments..."})}):d.length===0?e.jsx("div",{className:"text-gray-500 italic",children:"No active assignments found."}):e.jsx("ul",{className:"space-y-3 mb-4",children:d.map(p=>{var f,k,q,y,U,I;return e.jsxs("li",{className:"border rounded-lg p-3 flex flex-col cursor-pointer hover:bg-orange-50 transition",onClick:()=>N(p),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"font-medium",children:((f=p.clients)==null?void 0:f.name)||p.client_id}),p.serial_number&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["SN: ",p.serial_number]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-600",children:(((q=(k=p.departments_location)==null?void 0:k.department)==null?void 0:q.name)||p.department)&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-3 w-3"}),((U=(y=p.departments_location)==null?void 0:y.department)==null?void 0:U.name)||p.department,((I=p.departments_location)==null?void 0:I.name)&&` - ${p.departments_location.name}`]})})]},p.id)})})]}),u===2&&x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 p-3 rounded-md bg-gray-50 border flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ye,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"font-medium",children:((T=x.clients)==null?void 0:T.name)||x.client_id}),x.serial_number&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["SN: ",x.serial_number]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{children:"Printer:"}),e.jsx("span",{className:"font-semibold",children:[w.manufacturer,w.series,w.model||w.name].filter(Boolean).join(" ")})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:"font-semibold",children:x.status||"N/A"})]})]}),e.jsx(Ut,{assignment:x,printerId:s,onSuccess:j,onError:l})]})]})})},Bt=({printer:t,onEdit:l,onDelete:s,onTransfer:r,onEditAssignment:u=void 0,debug:n=!1})=>{var H;const{userProfile:d}=ns(),[i,x]=a.useState(!1),[m,o]=a.useState(!1),[h,c]=a.useState([]),[g,w]=a.useState(!1),[E,N]=a.useState(!1),[j,T]=a.useState(!1);Ye();const[p,f]=a.useState(null);a.useEffect(()=>{t.product_name||(async()=>{try{const O=await _s.getProductsByPrinter(t.id);O&&O.length>0&&f(O[0])}catch{f(null)}})()},[t.product_name,t.id]),a.useEffect(()=>{m&&h.length===0&&Fe.getClients().then(c)},[m,h.length]);const k=async O=>await Fe.getDepartmentsByClient(O),q=async(O,z,K)=>{try{const{error:W}=await M.from("printer_assignments").update({client_id:z,department_location_id:K,updated_at:new Date().toISOString()}).eq("id",O.id);if(W)throw console.error("Transfer failed:",W),W;o(!1)}catch(W){throw console.error("Transfer error:",W),W}};(t.printer_assignments||[]).reduce((O,z)=>{var W;const K=((W=z.clients)==null?void 0:W.name)||"Unknown Client";return O[K]=(O[K]||0)+1,O},{});const y=()=>{x(!0)},U=()=>{o(!0)},I=()=>{typeof u=="function"?u(t):N(!0)};t.printer_assignments;const C=t.assigned_count||0;return e.jsxs("div",{className:"bg-orange-50/80 border border-orange-200/80 rounded-lg shadow-sm w-full max-w-full hover:shadow-md transition-shadow touch-manipulation",children:[n&&e.jsxs("details",{className:"mb-2",children:[e.jsx("summary",{className:"text-xs font-medium text-yellow-800 cursor-pointer p-2 bg-yellow-100 rounded-t",children:"Debug Info (tap to expand)"}),e.jsx("div",{className:"p-2 bg-yellow-50 border border-yellow-200 rounded-b text-xs text-yellow-900 max-h-48 overflow-y-auto",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Printer ID:"})," ",t.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Name:"})," ",t.name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Manufacturer:"})," ",t.manufacturer]}),e.jsxs("div",{children:[e.jsx("b",{children:"Model:"})," ",t.model]}),e.jsxs("div",{children:[e.jsx("b",{children:"Series:"})," ",t.series]}),e.jsxs("div",{children:[e.jsx("b",{children:"Assignments:"})," ",((H=t.printer_assignments)==null?void 0:H.length)||0]})]})})]}),e.jsxs("div",{className:"p-3 w-full max-w-full flex flex-col",children:[e.jsx("div",{className:"mb-1",children:e.jsx("span",{className:"font-bold text-base text-gray-900 truncate",children:[t.manufacturer,t.series,t.model||t.name].filter(Boolean).join(" ")})}),e.jsxs("div",{className:"flex items-start gap-3 mb-1",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:t.image_url||"/placeholder.svg",alt:t.name||"Printer",className:"w-24 h-24 object-cover rounded-md",onError:O=>{O.currentTarget.src="/placeholder.svg"}}),(d==null?void 0:d.role)!=="client"&&C>1&&e.jsx(ne,{variant:"secondary",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs bg-blue-500 text-white",children:C})]}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-start h-16",children:[(d==null?void 0:d.role)!=="client"&&e.jsxs("div",{className:"flex gap-2 mb-1 justify-start",children:[e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Update Assignment",onClick:I,children:e.jsx(Ke,{className:"h-4 w-4 text-green-600"})}),(d==null?void 0:d.role)==="superadmin"&&e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:y,title:"Delete",children:e.jsx(Ie,{className:"h-4 w-4 text-red-500"})}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"View",onClick:O=>{O.stopPropagation(),w(!0)},children:e.jsx(qs,{className:"h-4 w-4 text-gray-600"})}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Transfer",onClick:U,children:e.jsx(zs,{className:"h-4 w-4 text-blue-500"})}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Maintenance",onClick:()=>T(!0),children:e.jsx(Et,{className:"h-4 w-4 text-orange-500"})})]}),e.jsx(Je,{printerId:t.id,className:"text-xs flex flex-row flex-wrap gap-2 mt-1"})]})]}),e.jsx("hr",{className:"my-2 border-t border-orange-200/50"}),e.jsx("div",{children:e.jsx(Tt,{printerId:t.id})})]}),e.jsx(Lt,{isOpen:i,onClose:()=>x(!1),printerId:t.id,onUnassigned:async()=>{x(!1),l&&l()}}),e.jsx(Ft,{isOpen:m,onClose:()=>o(!1),printerId:t.id,clients:h,getDepartmentsByClient:k,onTransfer:q}),e.jsx(Rs,{isOpen:g,onClose:()=>w(!1),printer:t}),E&&e.jsx(As,{isOpen:E,onClose:()=>N(!1),printerId:t.id,onAssignmentUpdated:async()=>{try{N(!1),l&&l()}catch(O){console.error("Failed to refresh after assignment update:",O)}}}),e.jsx(zt,{isOpen:j,onClose:()=>T(!1),printerId:t.id,onStatusUpdated:l})]})},qt=({formData:t,onInputChange:l})=>{const s=["A4","A3","A5","Letter","Legal","Executive","Folio"],r=t.supported_paper_sizes?t.supported_paper_sizes.split(",").map(n=>n.trim()).filter(n=>n):[],u=(n,d)=>{let i=[...r];d?i.includes(n)||i.push(n):i=i.filter(m=>m!==n);const x=i.join(", ");l("supported_paper_sizes",x)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Paper Specifications"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(X,{className:"text-sm font-semibold text-gray-700",children:"Supported Paper Sizes"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 p-4 bg-gray-50 rounded-lg border",children:s.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Bs,{id:`paper-${n}`,checked:r.includes(n),onCheckedChange:d=>u(n,d)}),e.jsx(X,{htmlFor:`paper-${n}`,className:"text-sm font-medium cursor-pointer",children:n})]},n))}),r.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:"Selected Paper Sizes:"}),e.jsx("p",{className:"text-sm text-blue-700",children:r.join(", ")})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Connectivity Options"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{htmlFor:"connectivity_usb",children:"USB"}),e.jsx(Le,{id:"connectivity_usb",checked:t.connectivity_usb||!1,onCheckedChange:n=>l("connectivity_usb",n)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{htmlFor:"connectivity_wifi",children:"Wi-Fi"}),e.jsx(Le,{id:"connectivity_wifi",checked:t.connectivity_wifi||!1,onCheckedChange:n=>l("connectivity_wifi",n)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{htmlFor:"connectivity_wifi_direct",children:"Wi-Fi Direct"}),e.jsx(Le,{id:"connectivity_wifi_direct",checked:t.connectivity_wifi_direct||!1,onCheckedChange:n=>l("connectivity_wifi_direct",n)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{htmlFor:"connectivity_ethernet",children:"Ethernet"}),e.jsx(Le,{id:"connectivity_ethernet",checked:t.connectivity_ethernet||!1,onCheckedChange:n=>l("connectivity_ethernet",n)})]})]})]})]})},is=({isOpen:t,onClose:l,printer:s,onPrinterUpdated:r,isLoading:u=!1})=>{var k,q;const[n,d]=a.useState({name:s.name||"",manufacturer:s.manufacturer||"",model:s.model||"",series:s.series||"",color:s.color||"",description:s.description||"",image_url:s.image_url||"",is_available:s.is_available??!0,rental_eligible:s.rental_eligible??!1,rental_price_per_month:((k=s.rental_price_per_month)==null?void 0:k.toString())||"",purchase_price:((q=s.purchase_price)==null?void 0:q.toString())||"",aliases:s.aliases||"",print_resolution:s.print_resolution||"",print_speed_bw:s.print_speed_bw||"",print_speed_color:s.print_speed_color||"",first_page_out_time:s.first_page_out_time||"",input_tray_capacity:s.input_tray_capacity||"",output_tray_capacity:s.output_tray_capacity||"",supported_paper_sizes:s.supported_paper_sizes||"",supported_paper_types:s.supported_paper_types||"",automatic_duplex:s.automatic_duplex??!1,connectivity_usb:s.connectivity_usb??!1,connectivity_wifi:s.connectivity_wifi??!1,connectivity_wifi_direct:s.connectivity_wifi_direct??!1,connectivity_ethernet:s.connectivity_ethernet??!1,connectivity_bluetooth:s.connectivity_bluetooth??!1,connectivity_nfc:s.connectivity_nfc??!1,cloud_printing_support:s.cloud_printing_support||"",driver_download_url:s.driver_download_url||"",software_download_url:s.software_download_url||"",user_manual_url:s.user_manual_url||"",supported_os:s.supported_os||""}),[i,x]=a.useState(null),[m,o]=a.useState(s.image_url||""),[h,c]=a.useState(!1),[g,w]=a.useState(!1),[E,N]=a.useState(null);ls.useEffect(()=>{(async()=>{var U,I;if(t&&(s!=null&&s.id)){c(!0);const{data:C,error:H}=await M.from("printers").select("*").eq("id",s.id).single();C&&(d({name:C.name||"",manufacturer:C.manufacturer||"",model:C.model||"",series:C.series||"",color:C.color||"",description:C.description||"",image_url:C.image_url||"",is_available:C.is_available??!0,rental_eligible:C.rental_eligible??!1,rental_price_per_month:((U=C.rental_price_per_month)==null?void 0:U.toString())||"",purchase_price:((I=C.purchase_price)==null?void 0:I.toString())||"",aliases:C.aliases||"",print_resolution:C.print_resolution||"",print_speed_bw:C.print_speed_bw||"",print_speed_color:C.print_speed_color||"",first_page_out_time:C.first_page_out_time||"",input_tray_capacity:C.input_tray_capacity||"",output_tray_capacity:C.output_tray_capacity||"",supported_paper_sizes:C.supported_paper_sizes||"",supported_paper_types:C.supported_paper_types||"",automatic_duplex:C.automatic_duplex??!1,connectivity_usb:C.connectivity_usb??!1,connectivity_wifi:C.connectivity_wifi??!1,connectivity_wifi_direct:C.connectivity_wifi_direct??!1,connectivity_ethernet:C.connectivity_ethernet??!1,connectivity_bluetooth:C.connectivity_bluetooth??!1,connectivity_nfc:C.connectivity_nfc??!1,cloud_printing_support:C.cloud_printing_support||"",driver_download_url:C.driver_download_url||"",software_download_url:C.software_download_url||"",user_manual_url:C.user_manual_url||"",supported_os:C.supported_os||""}),o(C.image_url||""),x(null)),c(!1)}})()},[s==null?void 0:s.id,t]);const j=async y=>{var I;const U=(I=y.target.files)==null?void 0:I[0];if(U){x(U),N(null),w(!0);try{const C=U.name.split(".").pop(),H=`${ht()}.${C}`,{data:O,error:z}=await M.storage.from("printer-images").upload(H,U,{cacheControl:"3600",upsert:!1,contentType:U.type});if(z){N(`Image upload failed: ${z.message||z}`),w(!1);return}const{data:K}=M.storage.from("printer-images").getPublicUrl(H),W=(K==null?void 0:K.publicUrl)||"";o(W),d(ee=>({...ee,image_url:W})),x(null)}catch(C){N(`Image upload failed. ${(C==null?void 0:C.message)||C}`)}w(!1)}},T=()=>{x(null),o(""),d(y=>({...y,image_url:""}))},p=(y,U)=>{d(I=>({...I,[y]:U}))},f=async y=>{if(y.preventDefault(),N(null),g)return;const U={name:n.name,manufacturer:n.manufacturer,model:n.model,series:n.series,color:n.color,description:n.description,image_url:n.image_url,is_available:n.is_available,rental_eligible:n.rental_eligible,aliases:n.aliases,rental_price_per_month:n.rental_price_per_month?parseFloat(n.rental_price_per_month.toString()):null,purchase_price:n.purchase_price?parseFloat(n.purchase_price.toString()):null,print_resolution:n.print_resolution,print_speed_bw:n.print_speed_bw,print_speed_color:n.print_speed_color,first_page_out_time:n.first_page_out_time,input_tray_capacity:n.input_tray_capacity,output_tray_capacity:n.output_tray_capacity,supported_paper_sizes:n.supported_paper_sizes,supported_paper_types:n.supported_paper_types,automatic_duplex:n.automatic_duplex,connectivity_usb:n.connectivity_usb,connectivity_wifi:n.connectivity_wifi,connectivity_wifi_direct:n.connectivity_wifi_direct,connectivity_ethernet:n.connectivity_ethernet,connectivity_bluetooth:n.connectivity_bluetooth,connectivity_nfc:n.connectivity_nfc,cloud_printing_support:n.cloud_printing_support,driver_download_url:n.driver_download_url,software_download_url:n.software_download_url,user_manual_url:n.user_manual_url,supported_os:n.supported_os};try{const{error:I}=await M.from("printers").update(U).eq("id",s.id);if(I)throw I;r(U)}catch{N("Failed to update printer. Please try again.")}};return t?h?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500 text-lg",children:"Loading printer info..."})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Printer"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ae,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6",children:[e.jsxs(Cs,{defaultValue:"basic",className:"w-full",children:[e.jsxs(ks,{className:"grid w-full grid-cols-2",children:[e.jsx(Ne,{value:"basic",children:"Basic Information"}),e.jsx(Ne,{value:"specifications",children:"Specifications"})]}),e.jsxs(_e,{value:"basic",className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(X,{htmlFor:"name",children:"Name *"}),e.jsx(ie,{id:"name",value:n.name,onChange:y=>p("name",y.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"manufacturer",children:"Manufacturer"}),e.jsx(ie,{id:"manufacturer",value:n.manufacturer,onChange:y=>p("manufacturer",y.target.value)})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"model",children:"Model"}),e.jsx(ie,{id:"model",value:n.model,onChange:y=>p("model",y.target.value)})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"series",children:"Series"}),e.jsx(ie,{id:"series",value:n.series,onChange:y=>p("series",y.target.value)})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"color",children:"Color"}),e.jsx(ie,{id:"color",value:n.color,onChange:y=>p("color",y.target.value)})]}),e.jsxs("div",{children:[e.jsx(X,{children:"Printer Image"}),e.jsx("div",{className:"flex items-center gap-4 mt-1",children:m?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:m,alt:"Printer Preview",className:"w-24 h-24 object-cover rounded border"}),e.jsx("button",{type:"button",className:"absolute top-0 right-0 bg-white bg-opacity-80 rounded-full p-1 text-gray-600 hover:text-red-600",onClick:T,title:"Remove image",children:e.jsx(Ae,{className:"h-4 w-4"})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center w-24 h-24 border-2 border-dashed rounded cursor-pointer hover:border-blue-400",children:[e.jsx(Os,{className:"h-6 w-6 text-gray-400 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Upload"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:j})]})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:i?"Image will be uploaded on save.":"Current image will be kept unless changed."}),e.jsx(X,{htmlFor:"image_url",className:"mt-2",children:"Or Image URL"}),e.jsx(ie,{id:"image_url",value:n.image_url,onChange:y=>p("image_url",y.target.value),placeholder:"https://...",disabled:!!i})]})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"description",children:"Description"}),e.jsx(jt,{id:"description",value:n.description,onChange:y=>p("description",y.target.value),rows:3})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"aliases",children:"Aliases (comma-separated)"}),e.jsx(ie,{id:"aliases",value:n.aliases,onChange:y=>p("aliases",y.target.value),placeholder:"Alternative names, separated by commas"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(X,{htmlFor:"rental_price_per_month",children:"Monthly Rental Price"}),e.jsx(ie,{id:"rental_price_per_month",type:"number",step:"0.01",value:n.rental_price_per_month,onChange:y=>p("rental_price_per_month",y.target.value)})]}),e.jsxs("div",{children:[e.jsx(X,{htmlFor:"purchase_price",children:"Purchase Price"}),e.jsx(ie,{id:"purchase_price",type:"number",step:"0.01",value:n.purchase_price,onChange:y=>p("purchase_price",y.target.value)})]})]}),e.jsxs("div",{className:"flex flex-col space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{htmlFor:"is_available",children:"Available for Assignment"}),e.jsx(Le,{id:"is_available",checked:n.is_available,onCheckedChange:y=>p("is_available",y)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{htmlFor:"rental_eligible",children:"Rental Eligible"}),e.jsx(Le,{id:"rental_eligible",checked:n.rental_eligible,onCheckedChange:y=>p("rental_eligible",y)})]})]})]}),e.jsx(_e,{value:"specifications",className:"mt-6",children:e.jsx(qt,{formData:n,onInputChange:p})})]}),E&&e.jsx("div",{className:"text-red-500 text-sm mb-2",children:E}),e.jsxs("div",{className:"flex space-x-3 pt-6 border-t mt-6",children:[e.jsx(L,{type:"button",variant:"outline",onClick:l,className:"flex-1",children:"Cancel"}),e.jsx(L,{type:"submit",disabled:u||g,className:"flex-1",children:u||g?"Updating...":"Update Printer"})]})]})]})}):null},Ot=()=>{const{toast:t}=xe(),[l,s]=a.useState(!1),[r,u]=a.useState(null);return{createPrinter:async o=>{s(!0),u(null);try{return await oe.createPrinter(o),t({title:"Success",description:"Printer created successfully!"}),!0}catch(h){const c=Ze(h);return u(c),t({title:"Error",description:`Failed to create printer: ${c}`,variant:"destructive"}),!1}finally{s(!1)}},updatePrinter:async(o,h)=>{s(!0),u(null);try{return await oe.updatePrinter(o,h),t({title:"Success",description:"Printer updated successfully!"}),!0}catch(c){const g=Ze(c);return u(g),t({title:"Error",description:`Failed to update printer: ${g}`,variant:"destructive"}),!1}finally{s(!1)}},deletePrinter:async(o,h)=>{s(!0),u(null);try{return await oe.deletePrinter(o),t({title:"Success",description:`Printer "${h}" deleted successfully!`}),!0}catch(c){const g=Ze(c);return u(g),t({title:"Error",description:`Failed to delete printer: ${g}`,variant:"destructive"}),!1}finally{s(!1)}},unassignPrinter:async(o,h)=>{s(!0),u(null);try{if(await oe.unassignPrinter(o))return t({title:"Success",description:`Successfully unassigned printer ${h}.`}),!0;throw new Error("Unassignment failed for an unknown reason.")}catch(c){const g=Ze(c);return u(g),t({title:"Error",description:`Failed to unassign printer: ${g}`,variant:"destructive"}),!1}finally{s(!1)}},updatePrinterAssignment:async(o,h)=>(console.log("Updating assignment",o,h),t({title:"In Progress",description:"Update functionality for printer assignments is not yet implemented."}),Promise.resolve(!0)),isLoading:l,error:r}},Vs=({assignmentId:t,isOpen:l,onClose:s,onDeleted:r,itemName:u})=>{const[n,d]=a.useState(!1),{toast:i}=xe(),x=async()=>{if(t){d(!0);try{console.log("DeleteAssignmentConfirmDialog: Starting deletion process..."),console.log("Assignment ID:",t),console.log("Item Name:",u),await ts.deleteAssignment(t),i({title:"Success",description:"Assignment deleted successfully"}),r()}catch(m){console.error("DeleteAssignmentConfirmDialog: Error during deletion:",m),console.error("Full error details:",JSON.stringify(m,null,2));let o="Failed to delete assignment";m!=null&&m.message?o=m.message:m!=null&&m.code&&(o=`Database error (${m.code}): ${m.message||"Unknown error"}`),i({title:"Error",description:o,variant:"destructive"})}finally{d(!1)}}};return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-red-100 p-2 rounded-full",children:e.jsx(Ts,{className:"h-5 w-5 text-red-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Remove Printer Assignment"})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Ae,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to decommission this printer assignment?"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-6",children:e.jsxs("p",{className:"text-red-800 font-medium",children:['"',u,'"']})}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"This action cannot be undone. The assignment will be marked as decommissioned in the system."}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:n,children:"Cancel"}),e.jsx("button",{onClick:x,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center disabled:bg-red-400",disabled:n,children:n?e.jsx(ke,{className:"h-5 w-5 animate-spin"}):"Decommission Assignment"})]})]})]})}):null},Ms=({label:t,placeholder:l,options:s,value:r,onValueChange:u,newItemValue:n,onNewItemChange:d,showNewItemInput:i,onShowNewItemInput:x,newItemPlaceholder:m,disabled:o=!1})=>{const h=c=>{c==="add_new"?(x(!0),u("")):(x(!1),u(c),d(""))};return i?e.jsxs("div",{children:[e.jsxs(X,{children:[t," *"]}),e.jsx(ie,{value:n,onChange:c=>d(c.target.value),placeholder:m,disabled:o,className:"mt-1"}),e.jsx("button",{type:"button",onClick:()=>{x(!1),d("")},className:"text-sm text-gray-500 mt-1 hover:text-gray-700",disabled:o,children:"Cancel"})]}):e.jsxs("div",{children:[e.jsxs(X,{children:[t," *"]}),e.jsxs(gs,{value:r,onValueChange:h,disabled:o,children:[e.jsx(fs,{className:"mt-1",children:e.jsx(ps,{placeholder:l})}),e.jsxs(bs,{children:[s.map(c=>e.jsx(ss,{value:c.id,children:c.name},c.id)),e.jsx(ss,{value:"add_new",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ls,{className:"h-4 w-4"}),e.jsxs("span",{children:["Add New ",t]})]})})]})]})]})},Rt=({isOpen:t,onClose:l,printerId:s,printerName:r,onAssignmentComplete:u,assignmentId:n})=>{const{toast:d}=xe(),[i,x]=a.useState(!1),[m,o]=a.useState(!1),[h,c]=a.useState([]),[g,w]=a.useState([]),[E,N]=a.useState(""),[j,T]=a.useState(""),[p,f]=a.useState(!1),[k,q]=a.useState(""),[y,U]=a.useState(""),[I,C]=a.useState(!1);a.useEffect(()=>{t&&H()},[t]),a.useEffect(()=>{k&&!I?O(k):(w([]),N(""))},[k,I]);const H=async()=>{o(!0);try{const{data:B,error:b}=await M.from("clients").select("id, name").order("name");if(b)throw b;c(B||[])}catch(B){console.error("Failed to fetch clients:",B),d({title:"Error",description:"Failed to load clients",variant:"destructive"})}finally{o(!1)}},O=async B=>{o(!0);try{const{data:b,error:A}=await M.from("departments_location").select("id, name, department:departments(name)").eq("client_id",B).order("name");if(A)throw A;const F=(b||[]).map(_=>{var P;return{id:_.id,name:`${((P=_.department)==null?void 0:P.name)||""} - ${_.name}`.replace(/^ - /,"").trim()}});w(F)}catch{d({title:"Error",description:"Failed to load department/locations",variant:"destructive"})}finally{o(!1)}},z=()=>{q(""),U(""),C(!1),c([]),w([]),N(""),T(""),f(!1),l()},K=async B=>{if(!B.trim())return null;const{data:b}=await M.from("clients").select("id").ilike("name",B.trim()).single();if(b)return b.id;const{data:A,error:F}=await M.from("clients").insert({name:B.trim()}).select("id").single();if(F)throw F;return A.id},W=async()=>{var b;const B=I?y:(b=h.find(A=>A.id===k))==null?void 0:b.name;if(!(B!=null&&B.trim())){d({title:"Error",description:"Please select or enter a client name",variant:"destructive"});return}x(!0);try{const A=I?await K(y):k;if(!A)throw new Error("Failed to create/find client");let F=null;if(p&&j.trim()){d({title:"Error",description:"Adding new department/location not implemented.",variant:"destructive"}),x(!1);return}else F=E;let _;if(n?{error:_}=await M.from("printer_assignments").update({client_id:A,department_location_id:F,status:"active",condition:"good",assignment_effective_date:new Date().toISOString().split("T")[0]}).eq("id",n):{error:_}=await M.from("printer_assignments").insert({printer_id:s,client_id:A,department_location_id:F,status:"active",condition:"good",assignment_effective_date:new Date().toISOString().split("T")[0]}),_)throw _;d({title:"Success",description:`Printer assigned successfully to ${B}`}),u(),z()}catch(A){console.error("Failed to assign printer:",A),d({title:"Error",description:"Failed to assign printer. Please try again.",variant:"destructive"})}finally{x(!1)}};if(!t)return null;const ee=(I?y.trim():k)&&E;return e.jsx(de,{open:t,onOpenChange:z,children:e.jsxs(me,{className:"max-w-md",children:[e.jsx(ve,{children:e.jsxs(ue,{className:"flex items-center space-x-2",children:[e.jsx(js,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{children:"Assign Printer"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:["Assigning: ",e.jsx("span",{className:"font-medium",children:r})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ms,{label:"Client",placeholder:"Select a client",options:h,value:k,onValueChange:q,newItemValue:y,onNewItemChange:U,showNewItemInput:I,onShowNewItemInput:C,newItemPlaceholder:"Enter new client name",disabled:i||m}),e.jsx(Ms,{label:"Department/Location",placeholder:"Select a department/location",options:g,value:E,onValueChange:N,newItemValue:j,onNewItemChange:T,showNewItemInput:p,onShowNewItemInput:f,newItemPlaceholder:"Enter new department/location",disabled:i||m||!k&&!I})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx(L,{onClick:z,variant:"outline",disabled:i,className:"flex-1",children:"Cancel"}),e.jsxs(L,{onClick:W,disabled:i||!ee,className:"flex-1",children:[i?e.jsx(ke,{className:"h-5 w-5 animate-spin mr-2"}):null,"Assign Printer"]})]})]})]})})},Vt=({assignmentId:t,isOpen:l,onClose:s,onSerialUpdated:r})=>{const[u,n]=a.useState(""),[d,i]=a.useState(!1),[x,m]=a.useState(null),{toast:o}=xe();a.useEffect(()=>{if(!t||!l)return;(async()=>{i(!0),m(null);try{const{data:g,error:w}=await M.from("printer_assignments").select("serial_number").eq("id",t).single();w?(console.error("Error fetching serial number:",w),m("Failed to fetch serial number")):n((g==null?void 0:g.serial_number)||"")}catch(g){console.error("Error fetching serial number:",g),m("Failed to fetch serial number")}finally{i(!1)}})()},[t,l]);const h=async()=>{if(t){i(!0),m(null);try{const{error:c}=await M.from("printer_assignments").update({serial_number:u,updated_at:new Date().toISOString()}).eq("id",t);c?(console.error("Error updating serial number:",c),m("Failed to update serial number"),o({title:"Error",description:"Failed to update serial number",variant:"destructive"})):(o({title:"Success",description:"Serial number updated successfully"}),r(u))}catch(c){console.error("Error updating serial number:",c),m("Failed to update serial number"),o({title:"Error",description:"Failed to update serial number",variant:"destructive"})}finally{i(!1)}}};return e.jsx(de,{open:l,onOpenChange:s,children:e.jsxs(me,{children:[e.jsx(ve,{children:e.jsx(ue,{children:"Edit Serial Number"})}),x&&e.jsx("div",{className:"text-red-500 text-sm mb-2",children:x}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Serial Number"}),e.jsx(ie,{value:u,onChange:c=>n(c.target.value),disabled:d,placeholder:"Enter serial number",autoFocus:!0})]}),e.jsxs(ys,{children:[e.jsx(L,{variant:"outline",onClick:s,disabled:d,children:"Cancel"}),e.jsx(L,{onClick:h,disabled:d||!u.trim(),children:d?"Saving...":"Save"})]})]})})},Hs=({isOpen:t,onClose:l,printer:s,onAssignmentSelected:r,title:u,description:n})=>{const[d,i]=a.useState(null);if(!s||!s.printer_assignments)return null;const x=()=>{d&&r(d)};return e.jsx(de,{open:t,onOpenChange:l,children:e.jsxs(me,{className:"w-full max-w-[95vw] sm:max-w-[500px]",children:[e.jsxs(ve,{children:[e.jsx(ue,{children:u}),e.jsx("p",{className:"text-sm text-gray-600",children:n})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Printer Model"}),e.jsx("p",{className:"text-sm font-medium",children:[s.manufacturer,s.series,s.model||s.name].filter(Boolean).join(" ")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Select Assignment:"}),s.printer_assignments.map(m=>{var o;return e.jsx("div",{className:`border rounded-lg p-3 cursor-pointer transition-colors ${d===m.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>i(m.id),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-16 h-16 flex-shrink-0 flex items-center justify-center bg-gray-100 rounded-xl border-2 border-gray-200 overflow-hidden",children:(o=m.printer)!=null&&o.image_url?e.jsx("img",{src:m.printer.image_url,alt:m.printer.name,className:"object-contain w-full h-full"}):e.jsxs("svg",{className:"h-8 w-8 text-gray-400",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[e.jsx("rect",{x:"6",y:"9",width:"12",height:"7",rx:"2"}),e.jsx("path",{d:"M6 18h12M9 18v1a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-1"}),e.jsx("path",{d:"M6 14v-4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v4"})]})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 font-medium",children:["Serial: ",m.serial_number||"Not set"]}),m.client&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Client: ",m.client.name]}),m.department_location_id&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Location: ",m.department_location_id]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx(ne,{variant:"outline",className:"text-xs",children:m.status}),m.usage_type&&e.jsx(ne,{variant:"outline",className:"text-xs",children:m.usage_type})]})]}),e.jsx("div",{className:"flex items-center pl-2",children:e.jsx("input",{type:"radio",checked:d===m.id,onChange:()=>i(m.id),className:"h-4 w-4 text-blue-600"})})]})},m.id)})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(L,{variant:"outline",onClick:l,className:"flex-1",children:"Cancel"}),e.jsx(L,{onClick:x,disabled:!d,className:"flex-1",children:"Continue"})]})]})})},Ht=({printer:t,onEditVisibility:l,onDelete:s,onPrinterUpdated:r})=>{const{user:u,userProfile:n}=ns(),[d,i]=a.useState([]),[x,m]=a.useState(!1),[o,h]=a.useState(!1),[c,g]=a.useState(!1);a.useState(!1);const[w,E]=a.useState(!1);a.useState(!1);const[N,j]=a.useState([]),[T,p]=a.useState(!1),[f,k]=a.useState(!1),[q,y]=a.useState(null),[U,I]=a.useState(null),[C,H]=a.useState(!1),[O,z]=a.useState("assign"),{updatePrinter:K,deletePrinter:W,isLoading:ee}=Ot(),{toast:B}=xe(),[b,A]=a.useState(null),[F,_]=a.useState(!1),[P,v]=a.useState(!1),[J,Z]=a.useState(null);a.useEffect(()=>{te(),Y(),(!t.sku||!t.color)&&(async()=>{try{const S=await _s.getProductsByPrinter(t.id);S&&S.length>0&&A(S[0])}catch{A(null)}})()},[t.id,t.sku,t.color]),a.useEffect(()=>{const S=M.channel(`printer-available-${t.id}`).on("postgres_changes",{event:"*",schema:"public",table:"printer_assignments",filter:`printer_id=eq.${t.id}`},R=>{r&&r()}).on("postgres_changes",{event:"*",schema:"public",table:"printers",filter:`id=eq.${t.id}`},R=>{r&&r()}).subscribe(R=>{});return()=>{M.removeChannel(S)}},[t.id,r]);const te=async()=>{try{m(!0);const{data:S,error:R}=await M.from("printer_visibility").select(`
          client_id,
          clients:client_id (
            id,
            name
          )
        `).eq("printer_id",t.id);if(R)throw R;const se=(S==null?void 0:S.map(pe=>pe.clients).filter(Boolean))||[];i(se)}catch(S){console.error("Error loading visible clients:",S),i([])}finally{m(!1)}},Y=async()=>{try{const{data:S,error:R}=await M.from("clients").select("id, name").order("name");if(R)throw R;j(S||[])}catch(S){console.error("Error loading clients:",S)}},G=async()=>{_(!0);try{await ts.deleteAssignment(J.id),B({title:"Success",description:"Assignment permanently deleted."}),v(!1),r&&r()}catch(S){B({title:"Error",description:`Failed to delete assignment ${J.id}: ${(S==null?void 0:S.message)||JSON.stringify(S)}`,variant:"destructive"}),console.error("Delete error details:",S)}finally{_(!1)}},re=async()=>{try{m(!0);const{data:S,error:R}=await M.from("printer_assignments").select("id, serial_number, printer_id").eq("printer_id",t.id).eq("status","available").maybeSingle();if(R)throw R;S?(Z(S),v(!0)):B({title:"Error",description:"No available assignment found for this printer.",variant:"destructive"})}catch(S){console.error("Error loading assignment:",S),B({title:"Error",description:"Failed to load printer assignment.",variant:"destructive"})}finally{m(!1)}},Me=async S=>{await K(t.id,S)&&(h(!1),r&&r())},fe=()=>{z("assign"),H(!0)},we=()=>{E(!1),B({title:"Success",description:"Printer assigned successfully"}),r&&r()},Pe=()=>{z("edit_serial"),H(!0)},le=()=>{g(!1),B({title:"Success",description:"Assignment decommissioned successfully"}),r&&r()},Ce=()=>{k(!1),B({title:"Success",description:"Serial number updated successfully"}),r&&r()},$e=S=>{switch(y(S),H(!1),O){case"assign":E(!0);break;case"decommission":Z({id:S}),v(!0);break;case"edit_serial":k(!0);break}},D=()=>{switch(O){case"assign":return{title:"Select Assignment to Assign",description:"Choose which available unit you want to assign to a client."};case"decommission":return{title:"Select Assignment to Decommission",description:"Choose which assignment you want to decommission."};case"edit_serial":return{title:"Select Assignment to Edit",description:"Choose which assignment's serial number you want to edit."};default:return{title:"Select Assignment",description:"Choose an assignment to continue."}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-green-50/80 border border-green-200/80 rounded-lg shadow-sm w-full hover:shadow-md transition-shadow touch-manipulation",children:e.jsxs("div",{className:"p-3 w-full max-w-full flex flex-col",children:[e.jsx("div",{className:"mb-1",children:e.jsx("span",{className:"font-bold text-base text-gray-900 truncate",children:[t.manufacturer,t.series,t.model||t.name].filter(Boolean).join(" ")})}),e.jsxs("div",{className:"flex items-start gap-3 mb-1",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:t.image_url||"/placeholder.svg",alt:t.name,className:"w-24 h-24 object-cover rounded-md"}),t.available_count&&t.available_count>1&&e.jsx(ne,{variant:"secondary",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs bg-blue-500 text-white",children:t.available_count})]}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-start h-16",children:[(n==null?void 0:n.role)!=="client"&&e.jsxs("div",{className:"flex gap-2 mb-1 justify-start",children:[e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:fe,title:"Assign",children:e.jsx(js,{className:"h-4 w-4 text-green-600"})}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:Pe,title:"Edit",children:e.jsx(Ke,{className:"h-4 w-4 text-green-600"})}),(n==null?void 0:n.role)==="superadmin"&&e.jsx(L,{variant:"ghost",size:"sm",className:"h-8 w-8",onClick:re,disabled:F,title:"Delete Record",children:e.jsx(Ie,{className:"h-4 w-4 text-red-500"})})]}),e.jsx(Je,{printerId:t.id,className:"text-xs flex flex-row flex-wrap gap-2 mt-1"})]})]}),e.jsx("hr",{className:"my-2 border-t border-green-200/50"}),e.jsxs("div",{className:"mb-3 pb-3 border-b border-green-200/50",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-1",children:"Visible to Clients:"}),x?e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Loading..."}):d.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[d.slice(0,3).map(S=>e.jsx(ne,{variant:"outline",className:"text-xs bg-gray-50",children:S.name},S.id)),d.length>3&&e.jsxs(ne,{variant:"outline",className:"text-xs bg-gray-50",children:["+",d.length-3," more"]})]}):e.jsx("p",{className:"text-xs text-gray-500 italic",children:"No visibility set"})]})]})}),e.jsx(Hs,{isOpen:C,onClose:()=>H(!1),printer:t,onAssignmentSelected:$e,...D()}),e.jsx(is,{isOpen:o,onClose:()=>h(!1),printer:t,onPrinterUpdated:Me,isLoading:ee}),e.jsx(Vs,{assignmentId:U||"",isOpen:c,onClose:()=>g(!1),onDeleted:le,itemName:t.name}),e.jsx(Rt,{isOpen:w,onClose:()=>E(!1),printerId:t.id,printerName:[t.manufacturer,t.series,t.model||t.name].filter(Boolean).join(" "),onAssignmentComplete:we,assignmentId:q}),e.jsx(As,{isOpen:T,onClose:()=>p(!1),printerId:t.id,onAssignmentUpdated:()=>{p(!1),r&&r()}}),e.jsx(Vt,{assignmentId:q||"",isOpen:f,onClose:()=>k(!1),onSerialUpdated:Ce}),e.jsx(de,{open:P,onOpenChange:v,children:e.jsxs(me,{children:[e.jsx(ue,{children:"Delete Record"}),e.jsxs(vs,{children:["Are you sure you want to permanently delete this record? This action cannot be undone.",e.jsx("br",{}),e.jsx("b",{children:"Assignment ID:"})," ",J==null?void 0:J.id]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-4",children:[e.jsx(Fs,{asChild:!0,children:e.jsx(L,{variant:"outline",disabled:F,children:"Cancel"})}),e.jsx(L,{variant:"destructive",onClick:()=>{J!=null&&J.id&&(console.log("Attempting to delete assignment with ID:",J.id),G())},disabled:F,children:F?"Deleting...":"Delete Record"})]})]})})]})},Kt=({isOpen:t,onClose:l,printer:s,onAdded:r})=>{const[u,n]=a.useState(""),[d,i]=a.useState("available"),[x,m]=a.useState(!1),{toast:o}=xe(),h=async c=>{c.preventDefault(),m(!0);const{error:g}=await M.from("printer_assignments").insert({printer_id:s.id,client_id:null,serial_number:u,usage_type:"service_unit",status:d});m(!1),g?o({title:"Error",description:g.message,variant:"destructive"}):(r(),o({title:"Success",description:"Printer added to inventory."}))};return t?e.jsx(de,{open:t,onOpenChange:l,children:e.jsxs(me,{children:[e.jsx(ve,{children:e.jsx(ue,{children:"Add Printer to Inventory"})}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Serial Number"}),e.jsx("input",{type:"text",value:u,onChange:c=>n(c.target.value),className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs("select",{value:d,onChange:c=>i(c.target.value),className:"w-full border rounded px-2 py-1",children:[e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"decommissioned",children:"Decommissioned"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{type:"button",variant:"outline",onClick:l,disabled:x,children:"Cancel"}),e.jsx(L,{type:"submit",disabled:x,children:"Add to Inventory"})]})]})]})}):null},Wt=({isOpen:t,onClose:l,printer:s,onSuccess:r})=>{const[u,n]=a.useState(!1),{toast:d}=xe(),i=async()=>{if(s!=null&&s.id){n(!0);try{await oe.deletePrinter(s.id,"System","Deleted from printer catalog via dashboard"),d({title:"Success",description:"Printer deleted successfully"}),l(),r==null||r()}catch(o){console.error("Delete error:",o);const h=o instanceof Error?o.message:"Unknown error";d({title:"Error",description:h,variant:"destructive"})}finally{n(!1)}}},x=()=>{u||l()};if(!t)return null;const m=`${(s==null?void 0:s.manufacturer)||""} ${(s==null?void 0:s.series)||""} ${(s==null?void 0:s.model)||(s==null?void 0:s.name)||""}`.trim();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg max-w-md w-full mx-4 animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-red-100 p-2 rounded-full",children:e.jsx(Ts,{className:"h-5 w-5 text-red-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Delete Printer"})]}),e.jsx("button",{onClick:x,disabled:u,className:"text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50",children:e.jsx(Ae,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to permanently delete this printer? This action cannot be undone."}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ie,{className:"h-5 w-5 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:m}),e.jsxs("p",{className:"text-red-600 text-sm",children:["ID: ",s==null?void 0:s.id]})]})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-6",children:e.jsxs("p",{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"Warning:"})," This will permanently remove the printer from the catalog. All associated data and product compatibility information will be lost."]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(L,{onClick:x,variant:"outline",className:"flex-1",disabled:u,children:"Cancel"}),e.jsx(L,{onClick:i,variant:"destructive",className:"flex-1",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"h-4 w-4 animate-spin mr-2"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Delete Printer"]})})]})]})]})})},Yt=({isOpen:t,onClose:l,printer:s,onUpdated:r})=>{const[u,n]=a.useState([]),[d,i]=a.useState(new Set),[x,m]=a.useState(""),[o,h]=a.useState(!1),[c,g]=a.useState(!1),{toast:w}=xe();a.useEffect(()=>{t&&(s!=null&&s.id)&&(E(),N())},[t,s==null?void 0:s.id]);const E=async()=>{h(!0);try{const{data:f,error:k}=await M.from("products").select("id, name, sku, alias, category, description").order("name");if(k)throw k;n(f||[])}catch(f){console.error("Error loading products:",f),w({title:"Error",description:"Failed to load products",variant:"destructive"})}finally{h(!1)}},N=async()=>{try{const{data:f,error:k}=await M.from("product_printers").select("product_id").eq("printer_id",s.id);if(k)throw k;const q=new Set((f==null?void 0:f.map(y=>y.product_id))||[]);i(q)}catch(f){console.error("Error loading compatible products:",f)}},j=f=>{const k=new Set(d);k.has(f)?k.delete(f):k.add(f),i(k)},T=async()=>{g(!0);try{const{error:f}=await M.from("product_printers").delete().eq("printer_id",s.id);if(f)throw f;if(d.size>0){const y=Array.from(d).map(I=>({printer_id:s.id,product_id:I})),{error:U}=await M.from("product_printers").insert(y);if(U)throw U}w({title:"Success",description:`Compatible products updated for ${s.name}`});const k=new CustomEvent("refresh-compatible-products",{detail:{printerId:s.id}});window.dispatchEvent(k);const q=new CustomEvent("refresh-printer-data");window.dispatchEvent(q),r&&r(),l()}catch(f){console.error("Error updating compatible products:",f),w({title:"Error",description:"Failed to update compatible products",variant:"destructive"})}finally{g(!1)}},p=u.filter(f=>f.name.toLowerCase().includes(x.toLowerCase())||f.sku&&f.sku.toLowerCase().includes(x.toLowerCase())||f.alias&&f.alias.toLowerCase().includes(x.toLowerCase())||f.category&&f.category.toLowerCase().includes(x.toLowerCase()));return e.jsx(de,{open:t,onOpenChange:l,children:e.jsxs(me,{className:"max-w-2xl max-h-[80vh]",children:[e.jsx(ve,{children:e.jsxs(ue,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"Update Compatible Products for ",s==null?void 0:s.name]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(us,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{placeholder:"Search products by name, SKU, or alias...",value:x,onChange:f=>m(f.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(X,{children:["Select Compatible Products (",d.size," selected)"]}),e.jsx(yt,{className:"h-80 border rounded-md p-4",children:o?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading products..."}):p.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:x?"No products found matching your search":"No products available"}):e.jsx("div",{className:"space-y-3",children:p.map(f=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 rounded-md hover:bg-muted/50",children:[e.jsx(Bs,{id:`product-${f.id}`,checked:d.has(f.id),onCheckedChange:()=>j(f.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:`product-${f.id}`,className:"text-sm font-medium cursor-pointer block",children:f.name}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[f.sku&&e.jsxs("div",{children:["SKU: ",f.sku]}),f.alias&&e.jsxs("div",{children:["Alias: ",f.alias]}),(f.category||f.description)&&e.jsx("div",{children:[f.category,f.description].filter(Boolean).join(" • ")})]})]})]},f.id))})})]})]}),e.jsxs(ys,{children:[e.jsx(L,{variant:"outline",onClick:l,disabled:c,children:"Cancel"}),e.jsx(L,{onClick:T,disabled:o||c,children:c?"Saving...":"Save Changes"})]})]})})},Jt=({printer:t,onEdit:l,onDelete:s,debug:r=!1})=>{const[u,n]=a.useState(!1),[d,i]=a.useState(!1),[x,m]=a.useState(!1),[o,h]=a.useState(!1),[c,g]=a.useState(!1);Ye();const w=()=>{h(!0)},E=()=>{s&&s(t)};return e.jsxs("div",{className:"bg-orange-50/50 border border-orange-200/80 rounded-lg p-3 my-2 shadow-sm w-full hover:bg-orange-100/60 transition",children:[r&&e.jsx("div",{className:"mb-3 p-3 bg-yellow-100 border border-yellow-300 rounded text-xs text-yellow-900 max-h-96 overflow-y-auto",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Printer ID:"})," ",t.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Printer Name:"})," ",t.name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Manufacturer:"})," ",t.manufacturer]}),e.jsxs("div",{children:[e.jsx("b",{children:"Model:"})," ",t.model]}),e.jsxs("div",{children:[e.jsx("b",{children:"Series:"})," ",t.series]}),e.jsxs("div",{children:[e.jsx("b",{children:"Image URL:"})," ",t.image_url||"No image URL"]}),e.jsxs("div",{className:"border-t pt-2 mt-2",children:[e.jsx("b",{children:"Raw Printer Object Keys:"}),e.jsx("div",{className:"ml-2 text-xs",children:Object.keys(t).join(", ")})]})]})}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("img",{src:t.image_url||"/placeholder.svg",alt:t.name||"Printer",className:"w-24 h-24 object-cover rounded-md flex-shrink-0",onError:N=>{N.currentTarget.src="/placeholder.svg"}}),e.jsx("div",{className:"flex-1 pr-8",children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h4",{className:"font-bold text-gray-800",children:[t.manufacturer,t.series,t.model||t.name].filter(Boolean).join(" ")})}),e.jsxs("div",{className:"flex gap-1 mt-1",children:[e.jsx(L,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>i(!0),title:"Edit Printer Details",children:e.jsx(Ke,{className:"h-4 w-4 text-blue-600"})}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:w,title:"Delete Printer",children:e.jsx(Ie,{className:"h-4 w-4 text-red-500"})}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>n(!0),title:"View Printer",children:e.jsx(qs,{className:"h-4 w-4 text-gray-700"})}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>m(!0),title:"Add to Inventory",children:e.jsx(Ct,{className:"h-4 w-4 text-green-600"})}),e.jsx(L,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>g(!0),title:"Update Compatible Products",children:e.jsx(Ee,{className:"h-4 w-4 text-purple-600"})})]})]})})})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-orange-200/50",children:e.jsx(Je,{printerId:t.id,className:"mt-1"})}),e.jsx(Rs,{isOpen:u,onClose:()=>n(!1),printer:t}),e.jsx(is,{isOpen:d,onClose:()=>i(!1),printer:t,onPrinterUpdated:()=>i(!1),isLoading:!1}),e.jsx(Kt,{isOpen:x,onClose:()=>m(!1),printer:t,onAdded:()=>{m(!1)}}),e.jsx(Wt,{isOpen:o,onClose:()=>h(!1),printer:t,onSuccess:E}),e.jsx(Yt,{isOpen:c,onClose:()=>g(!1),printer:t,onUpdated:()=>{g(!1)}})]})},Gt=({activeTab:t,searchQuery:l,onAddNew:s,printerFilter:r})=>{const n=(()=>{if(t===Re.PRINTERS&&r==="assigned")return{icon:De,title:l?"No printers found":"No printers yet",description:l?`No printers match "${l}". Try adjusting your search.`:"Assign printers to your clients for deployment and management.",buttonText:"Assign Printer",color:"text-purple-600"};switch(t){case Re.CLIENT:return{icon:vt,title:l?"No clients found":"No clients yet",description:l?`No clients match "${l}". Try adjusting your search.`:"Start by adding your first client to manage their departments and printers.",buttonText:"Add Client",color:"text-blue-600"};case Re.SUPPLIERS:return{icon:gt,title:l?"No suppliers found":"No suppliers yet",description:l?`No suppliers match "${l}". Try adjusting your search.`:"Add suppliers to manage product sourcing and pricing.",buttonText:"Add Supplier",color:"text-green-600"};case Re.PRINTERS:return{icon:De,title:l?"No printers found":"No printers yet",description:l?`No printers match "${l}". Try adjusting your search.`:"Add printers to your inventory for assignment and rental management.",buttonText:"Add Printer",color:"text-purple-600"};case Re.PRODUCT:return{icon:Ee,title:l?"No products found":"No products yet",description:l?`No products match "${l}". Try adjusting your search.`:"Start adding products to manage inventory and pricing.",buttonText:"Add Product",color:"text-orange-600"};default:return{icon:Ee,title:"No data found",description:"No items to display.",buttonText:"Add Item",color:"text-gray-600"}}})(),d=n.icon;return e.jsx(Ue,{children:e.jsxs(ze,{className:"p-8 text-center",children:[e.jsx(d,{className:`h-16 w-16 mx-auto mb-4 ${n.color} opacity-50`}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:n.title}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:n.description}),!l&&s&&e.jsxs(L,{onClick:s,className:"inline-flex items-center",children:[e.jsx(Ls,{className:"mr-2 h-4 w-4"}),n.buttonText]})]})})},Qt=[{key:"all",label:"All Events"},{key:"maintenance",label:"Maintenance History"},{key:"assignment",label:"Assignment History"},{key:"general",label:"General Printer History"},{key:"last_maintenance",label:"Last Maintenance Date"}];function Xt({open:t,onClose:l,printerId:s}){const[r,u]=a.useState("all"),[n,d]=a.useState(!1),[i,x]=a.useState([]);a.useEffect(()=>{t&&(d(!0),M.from("printer_assignments").select("id,last_service_date").eq("printer_id",s).then(async({data:o})=>{const h=(o||[]).map(j=>j.id),c=(o||[]).map(j=>j.last_service_date).filter(Boolean),[g,w,E]=await Promise.all([M.from("maintenance_history").select("*").eq("printer_id",s),h.length>0?M.from("printer_assignment_history").select(`
              *,
              previous_client:clients!printer_assignment_history_previous_client_id_fkey(name),
              new_client:clients!printer_assignment_history_new_client_id_fkey(name),
              previous_department_location:departments_location!printer_assignment_history_previous_department_location_id_fkey(
                name,
                department:departments(name)
              ),
              new_department_location:departments_location!printer_assignment_history_new_department_location_id_fkey(
                name,
                department:departments(name)
              )
            `).in("printer_assignment_id",h):Promise.resolve({data:[]}),M.from("printer_history").select("*").eq("printer_id",s)]),N=[...(g.data||[]).map(j=>({...j,type:"maintenance",date:j.performed_at})),...(w.data||[]).map(j=>({...j,type:"assignment",date:j.performed_at})),...(E.data||[]).map(j=>({...j,type:"general",date:j.timestamp})),...c.map(j=>({type:"last_maintenance",date:j,label:"Last Service Performed"}))];N.sort((j,T)=>new Date(T.date).getTime()-new Date(j.date).getTime()),x(N),d(!1)}))},[t,s]);const m=r==="all"?i:i.filter(o=>o.type===r);return e.jsx(de,{open:t,onOpenChange:l,children:e.jsxs(me,{className:"max-w-md w-full rounded-t-lg sm:rounded-lg p-0",children:[e.jsx(ve,{children:e.jsx(ue,{children:"Printer History"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs(gs,{value:r,onValueChange:u,children:[e.jsx(fs,{children:e.jsx(ps,{placeholder:"Select history type"})}),e.jsx(bs,{children:Qt.map(o=>e.jsx(ss,{value:o.key,children:o.label},o.key))})]}),e.jsx("div",{className:"mt-4 max-h-[60vh] overflow-y-auto",children:n?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Loading..."}):e.jsxs("ul",{className:"space-y-3",children:[m.map((o,h)=>{var c,g,w,E,N,j;return e.jsxs("li",{className:"bg-gray-50 rounded p-3 text-xs",children:[o.type==="maintenance"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Type:"})," ",o.maintenance_type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Action:"})," ",o.action_description]}),e.jsxs("div",{children:[e.jsx("b",{children:"Notes:"})," ",o.notes]}),e.jsxs("div",{children:[e.jsx("b",{children:"Date:"})," ",o.performed_at]})]}),o.type==="assignment"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Action:"})," ",o.action_type]}),o.action_type==="transferred"&&e.jsxs("div",{children:[e.jsx("b",{children:"From:"})," ",((c=o.previous_client)==null?void 0:c.name)||"N/A",o.previous_department_location&&e.jsxs("span",{children:[" (",((g=o.previous_department_location.department)==null?void 0:g.name)||""," - ",o.previous_department_location.name||"",")"]}),e.jsx("br",{}),e.jsx("b",{children:"To:"})," ",((w=o.new_client)==null?void 0:w.name)||"N/A",o.new_department_location&&e.jsxs("span",{children:[" (",((E=o.new_department_location.department)==null?void 0:E.name)||""," - ",o.new_department_location.name||"",")"]})]}),o.action_type==="assigned"&&o.new_client&&e.jsxs("div",{children:[e.jsx("b",{children:"Assigned to:"})," ",o.new_client.name,o.new_department_location&&e.jsxs("span",{children:[" (",((N=o.new_department_location.department)==null?void 0:N.name)||""," - ",o.new_department_location.name||"",")"]})]}),o.action_type==="unassigned"&&o.previous_client&&e.jsxs("div",{children:[e.jsx("b",{children:"Unassigned from:"})," ",o.previous_client.name,o.previous_department_location&&e.jsxs("span",{children:[" (",((j=o.previous_department_location.department)==null?void 0:j.name)||""," - ",o.previous_department_location.name||"",")"]})]}),o.reason&&e.jsxs("div",{children:[e.jsx("b",{children:"Reason:"})," ",o.reason]}),e.jsxs("div",{children:[e.jsx("b",{children:"Date:"})," ",o.performed_at]})]}),o.type==="general"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("b",{children:"Action:"})," ",o.action_type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Description:"})," ",o.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"Date:"})," ",o.timestamp]})]}),o.type==="last_maintenance"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("b",{children:o.label})}),e.jsxs("div",{children:[e.jsx("b",{children:"Date:"})," ",o.date]})]})]},o.id||o.date||h)}),!n&&m.length===0&&e.jsx("div",{className:"text-center text-gray-400 py-8",children:"No history found."})]})})]})]})})}const V=({icon:t,label:l,value:s,isBadge:r=!1,badgeVariant:u="outline"})=>e.jsxs("div",{className:"flex items-start space-x-4 py-2",children:[e.jsx(t,{className:"h-5 w-5 text-gray-400 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:l}),r?e.jsx(ne,{variant:u,className:"capitalize",children:s}):e.jsx("p",{className:"text-base text-gray-800 font-medium",children:s||e.jsx("span",{className:"text-gray-400 italic",children:"Not provided"})})]})]}),Zt=({isOpen:t,onClose:l,printer:s,assignment:r,inventoryRecords:u=[]})=>{if($s(),!t||!s)return null;const n=d=>d==="active"?"default":d==="inactive"?"secondary":d==="returned"?"destructive":"outline";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(De,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.manufacturer," ",s.model]})]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ae,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs(Cs,{defaultValue:"general",className:"h-full flex flex-col",children:[e.jsxs(ks,{className:"flex justify-center mt-2",children:[e.jsx(Ne,{value:"general",children:"General Information"}),e.jsx(Ne,{value:"specifications",children:"Specifications"}),e.jsx(Ne,{value:"inventory",children:"Inventory"}),r&&e.jsx(Ne,{value:"assignment",children:"Assignment"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs(_e,{value:"general",children:[e.jsx(V,{icon:Dt,label:"Model",value:s.model}),e.jsx(V,{icon:je,label:"Series",value:s.series}),e.jsx(V,{icon:Pt,label:"Color",value:s.color}),e.jsx(V,{icon:At,label:"Type",value:s.printer_type}),e.jsx(V,{icon:Ve,label:"Description",value:s.description}),e.jsx(V,{icon:ce,label:"Available for Assignment",value:s.is_available?"Yes":"No",isBadge:!0,badgeVariant:s.is_available?"default":"secondary"}),e.jsx(V,{icon:os,label:"Functions",value:s.functions}),e.jsx(V,{icon:es,label:"Purchase Price",value:s.purchase_price?`$${s.purchase_price}`:null}),e.jsx(V,{icon:es,label:"Monthly Rental Price",value:s.rental_price_per_month?`$${s.rental_price_per_month}`:null}),e.jsx(V,{icon:cs,label:"Created At",value:s.created_at?new Date(s.created_at).toLocaleDateString():void 0})]}),e.jsx(_e,{value:"specifications",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Performance Specifications"}),e.jsx(V,{icon:je,label:"Print Resolution",value:s.print_resolution}),e.jsx(V,{icon:je,label:"Print Speed (B&W)",value:s.print_speed_bw}),e.jsx(V,{icon:je,label:"Print Speed (Color)",value:s.print_speed_color}),e.jsx(V,{icon:je,label:"First Page Out Time",value:s.first_page_out_time}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 mt-6",children:"Paper Handling"}),e.jsx(V,{icon:je,label:"Input Tray Capacity",value:s.input_tray_capacity}),e.jsx(V,{icon:je,label:"Output Tray Capacity",value:s.output_tray_capacity}),e.jsx(V,{icon:je,label:"Supported Paper Sizes",value:s.supported_paper_sizes}),e.jsx(V,{icon:je,label:"Supported Paper Types",value:s.supported_paper_types}),e.jsx(V,{icon:ce,label:"Automatic Duplex",value:s.automatic_duplex?"Yes":"No",isBadge:!0,badgeVariant:s.automatic_duplex?"default":"secondary"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 mt-6",children:"Connectivity"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(V,{icon:ce,label:"USB",value:s.connectivity_usb?"Yes":"No",isBadge:!0,badgeVariant:s.connectivity_usb?"default":"secondary"}),e.jsx(V,{icon:ce,label:"Wi-Fi",value:s.connectivity_wifi?"Yes":"No",isBadge:!0,badgeVariant:s.connectivity_wifi?"default":"secondary"}),e.jsx(V,{icon:ce,label:"Wi-Fi Direct",value:s.connectivity_wifi_direct?"Yes":"No",isBadge:!0,badgeVariant:s.connectivity_wifi_direct?"default":"secondary"}),e.jsx(V,{icon:ce,label:"Ethernet",value:s.connectivity_ethernet?"Yes":"No",isBadge:!0,badgeVariant:s.connectivity_ethernet?"default":"secondary"}),e.jsx(V,{icon:ce,label:"Bluetooth",value:s.connectivity_bluetooth?"Yes":"No",isBadge:!0,badgeVariant:s.connectivity_bluetooth?"default":"secondary"}),e.jsx(V,{icon:ce,label:"NFC",value:s.connectivity_nfc?"Yes":"No",isBadge:!0,badgeVariant:s.connectivity_nfc?"default":"secondary"})]}),e.jsx(V,{icon:je,label:"Cloud Printing Support",value:s.cloud_printing_support}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 mt-6",children:"Software & Support"}),e.jsx(V,{icon:je,label:"Supported OS",value:s.supported_os}),e.jsx(V,{icon:Ve,label:"Driver Download",value:s.driver_download_url}),e.jsx(V,{icon:Ve,label:"Software Download",value:s.software_download_url}),e.jsx(V,{icon:Ve,label:"User Manual",value:s.user_manual_url})]})}),e.jsx(_e,{value:"inventory",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Inventory Records"}),e.jsxs(ne,{variant:"outline",children:[u.length," units"]})]}),u.length>0?e.jsx("div",{className:"space-y-3",children:u.map(d=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"font-medium",children:["S/N: ",d.serial_number||"Not provided"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(ne,{variant:n(d.status),children:d.status}),e.jsx(ne,{variant:"outline",children:d.usage_type})]})]}),d.deployment_date&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Deployed: ",new Date(d.deployment_date).toLocaleDateString()]}),d.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:d.notes})]},d.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ee,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No inventory records found for this printer model."}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Add units to inventory to track physical printers."})]})]})}),r&&e.jsxs(_e,{value:"assignment",children:[e.jsx(V,{icon:ye,label:"Client ID",value:r.client_id}),e.jsx(V,{icon:Us,label:"Department",value:r.department}),e.jsx(V,{icon:cs,label:"Deployment Date",value:r.deployment_date?new Date(r.deployment_date).toLocaleDateString():void 0}),e.jsx(V,{icon:os,label:"Usage Type",value:r.usage_type}),e.jsx(V,{icon:es,label:"Monthly Price",value:r.monthly_price?`$${r.monthly_price}`:null}),e.jsx(V,{icon:ce,label:"Assignment Status",value:r.status,isBadge:!0,badgeVariant:n(r.status)}),e.jsx(V,{icon:os,label:"Security Deposit",value:r.has_security_deposit?"Yes":"No"}),e.jsx(V,{icon:es,label:"Security Deposit Amount",value:r.security_deposit_amount?`$${r.security_deposit_amount}`:null}),e.jsx(V,{icon:Ve,label:"Notes",value:r.notes}),e.jsx(V,{icon:cs,label:"Created At",value:r.created_at?new Date(r.created_at).toLocaleDateString():void 0})]})]})]})}),e.jsx("div",{className:"flex space-x-3 p-6 bg-gray-50 border-t",children:e.jsx(L,{variant:"outline",onClick:l,className:"flex-1",children:"Close"})})]})})};function ea(t){switch(t){case"active":return"Assigned to Client";case"inactive":return"Assigned to Client (not in use)";case"decommissioned":return"Decommissioned";case"available":return"Not Assigned (available)";default:return t}}const sa=({assignment:t,onEdit:l,onDelete:s,onDataRefresh:r,debug:u=!1})=>{var ee,B;const{printer:n}=t,{toast:d}=xe(),[i,x]=a.useState(!1),[m,o]=a.useState(!1),[h,c]=a.useState(!1),[g,w]=a.useState(!1),[E,N]=a.useState(!1),[j,T]=a.useState(!1),[p,f]=a.useState("assign"),[k,q]=a.useState(!1),[y,U]=a.useState(!1),[I,C]=a.useState(n);a.useEffect(()=>{let b=!0;return(async()=>{if(n!=null&&n.printer_assignments)C(n);else{const{data:F,error:_}=await M.from("printers").select("*, printer_assignments(*)").eq("id",n.id).single();F&&b&&C(F)}})(),()=>{b=!1}},[n]);const H=async()=>{x(!0);try{await ts.deleteAssignment(t.id),d({title:"Success",description:"Assignment permanently deleted."}),w(!1),r&&r()}catch(b){d({title:"Error",description:`Failed to delete assignment ${t.id}: ${(b==null?void 0:b.message)||JSON.stringify(b)}`,variant:"destructive"}),console.error("Delete error details:",b)}finally{x(!1)}},O=async()=>{N(!0);try{await ts.makePrinterAvailable(t.id),d({title:"Success",description:"Printer is now available for assignment."}),r&&r()}catch(b){d({title:"Error",description:`Failed to make printer available: ${(b==null?void 0:b.message)||JSON.stringify(b)}`,variant:"destructive"}),console.error("Make available error details:",b)}finally{N(!1)}},z=()=>{f("assign"),T(!0)},K=()=>{f("edit_serial"),T(!0)},W=()=>{f("decommission"),T(!0)};return e.jsxs("div",{className:"bg-orange-50/80 border border-orange-200/80 rounded-lg shadow-sm w-full hover:shadow-md transition-shadow touch-manipulation",children:[u&&e.jsxs("details",{className:"m-2",children:[e.jsx("summary",{className:"text-xs font-medium text-yellow-800 cursor-pointer p-2 bg-yellow-100 rounded",children:"Debug Info (tap to expand)"}),e.jsx("pre",{className:"mt-1 text-xs text-yellow-900 bg-yellow-50 border border-yellow-200 rounded p-2 max-h-32 overflow-y-auto",children:JSON.stringify(t,null,2)})]}),e.jsxs("div",{className:"p-3 w-full max-w-full flex flex-col",children:[e.jsx("div",{className:"mb-1",children:e.jsx("span",{className:"font-bold text-base text-gray-900 truncate",children:[n==null?void 0:n.manufacturer,n==null?void 0:n.series,(n==null?void 0:n.model)||(n==null?void 0:n.name)].filter(Boolean).join(" ")})}),e.jsxs("div",{className:"flex items-start gap-3 mb-1",children:[e.jsx("div",{className:"relative flex-shrink-0",children:e.jsx("img",{src:(n==null?void 0:n.image_url)||"/placeholder.svg",alt:(n==null?void 0:n.name)||"Printer",className:"w-24 h-24 object-cover rounded-md",onError:b=>{b.currentTarget.src="/placeholder.svg"}})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-start h-auto space-y-1",children:[e.jsxs("div",{className:"flex gap-2 mb-1 justify-start",children:[e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8",title:"Assign",onClick:z,children:e.jsx(js,{className:"h-4 w-4 text-green-600"})}),e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8",title:"Edit Assignment",onClick:K,children:e.jsx(Ke,{className:"h-4 w-4 text-green-600"})}),e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8",title:"Delete Assignment",onClick:W,children:e.jsx(Ie,{className:"h-4 w-4 text-red-500"})}),e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8",title:"Edit",onClick:()=>c(!0),children:e.jsx(Ke,{className:"h-4 w-4 text-green-600"})}),e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8",title:"History",onClick:()=>o(!0),children:e.jsx(xt,{className:"h-4 w-4 text-blue-500"})}),t.status!=="available"&&e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8",title:"Make Available",onClick:O,disabled:E,children:E?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}):e.jsx(ce,{className:"h-4 w-4 text-blue-600"})}),e.jsx(L,{size:"icon",variant:"ghost",className:"h-8 w-8",title:"Delete Record",onClick:()=>w(!0),children:e.jsx(Ie,{className:"h-4 w-4 text-red-500"})})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Serial:"})," ",t.serial_number||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Client:"})," ",((ee=t.clients)==null?void 0:ee.name)||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"})," ",((B=t.departments_location)==null?void 0:B.name)||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created:"})," ",t.created_at?new Date(t.created_at).toLocaleDateString():"N/A"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-1",children:[e.jsx(ne,{variant:"secondary",className:`text-xs ${t.status==="active"?"bg-orange-100 text-orange-700":t.status==="available"?"bg-green-100 text-green-700":t.status==="decommissioned"?"bg-gray-200 text-gray-700":"bg-blue-100 text-blue-700"}`,children:ea(t.status)}),t.usage_type&&e.jsx(ne,{variant:"outline",className:"text-xs",children:t.usage_type}),(n==null?void 0:n.color)&&e.jsx(ne,{variant:"outline",className:"text-xs",children:n.color})]})]})]}),e.jsx("hr",{className:"my-2 border-t border-orange-200/50"}),e.jsx(Je,{printerId:n==null?void 0:n.id,className:"text-xs flex flex-row flex-wrap gap-2 mt-1"})]}),e.jsx(de,{open:g,onOpenChange:w,children:e.jsxs(me,{children:[e.jsx(ue,{children:"Delete Record"}),e.jsxs(vs,{children:["Are you sure you want to permanently delete this record? This action cannot be undone.",e.jsx("br",{}),e.jsx("b",{children:"Assignment ID:"})," ",t.id]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-4",children:[e.jsx(Fs,{asChild:!0,children:e.jsx(L,{variant:"outline",disabled:i,children:"Cancel"})}),e.jsx(L,{variant:"destructive",onClick:()=>{console.log("Attempting to delete assignment with ID:",t.id),H()},disabled:i,children:i?"Deleting...":"Delete Record"})]})]})}),e.jsx(Xt,{open:m,onClose:()=>o(!1),printerId:n==null?void 0:n.id}),e.jsx(Zt,{isOpen:h,onClose:()=>c(!1),printer:n,assignment:t}),e.jsx(Hs,{isOpen:j,onClose:()=>T(!1),printer:I,onAssignmentSelected:()=>T(!1),title:p==="assign"?"Assign Printer":p==="edit_serial"?"Edit Assignment Serial":"Decommission Assignment",description:p==="assign"?"Select an assignment to assign this printer.":p==="edit_serial"?"Select an assignment to edit its serial number.":"Select an assignment to decommission."}),e.jsx(is,{isOpen:k,onClose:()=>q(!1),printer:n,onPrinterUpdated:()=>q(!1)}),e.jsx(Vs,{isOpen:y,onClose:()=>U(!1),assignmentId:t.id,itemName:(n==null?void 0:n.name)||"Printer",onDeleted:()=>U(!1)})]})},ta=({activeTab:t,isLoading:l,filteredData:s,searchQuery:r,onItemClick:u,onAddNew:n,onEdit:d,onDelete:i,onDataRefresh:x,printerFilter:m,debug:o=!1})=>l?e.jsx(hs,{}):s.length===0?e.jsx(Gt,{activeTab:t,searchQuery:r,onAddNew:n,printerFilter:m}):e.jsx("div",{className:`space-y-3 w-full px-1 max-w-full${["assigned","available","inventory","catalog"].includes(m??"")?" pb-[60px]":""}`,children:e.jsx("div",{className:"grid grid-cols-1 gap-3 w-full max-w-full",children:s.map((h,c)=>m==="assigned"?e.jsx(Bt,{printer:h,onEdit:d,onDelete:i,onTransfer:()=>{},debug:o},h.id||c):m==="available"?e.jsx(Ht,{printer:h,onEditVisibility:()=>{},onDelete:i},h.id||c):m==="catalog"?e.jsx(Jt,{printer:h,onEdit:d,onDelete:i,debug:o},h.id||c):m==="inventory"?e.jsx(sa,{assignment:h,onEdit:d,onDelete:i,onDataRefresh:x,debug:o},h.id||c):null)})}),Ks=ls.memo(({isLoading:t,filteredData:l,searchQuery:s,onDataRefresh:r,printerFilter:u,debug:n=!1,onEditAssignment:d,onShowAssignModal:i,onShowAddToInventoryModal:x})=>{const m=Ye(),[o,h]=a.useState(!1),[c,g]=a.useState(!1),[w,E]=a.useState(!1),[N,j]=a.useState(null),[T,p]=a.useState(!1),{toast:f}=xe(),k=z=>{m(`/admin-dashboard/printers/${z.id}`)},q=()=>{u==="assigned"&&i?i():(u==="available"||u==="inventory")&&x?x():h(!0)},y=z=>{j(z),u==="assigned"&&d?d(z):g(!0)},U=z=>{j(z),E(!0)},I=()=>{g(!1),j(null),r()},C=async()=>{if(!N||T)return;p(!0);const z=N;E(!1),j(null);try{u==="catalog"?(await oe.softDeletePrinter(z.id),f({title:"Success",description:"Printer removed from catalog (soft deleted)"})):(await oe.deletePrinter(z.id),f({title:"Success",description:"Printer deleted successfully"})),r()}catch(K){f({title:"Error",description:`Failed to ${u==="catalog"?"remove printer":"delete printer"}: ${(K==null?void 0:K.message)||(K==null?void 0:K.toString())}`,variant:"destructive"})}finally{p(!1)}},O=u==="catalog"?{title:"Remove from Catalog",message:"Are you sure you want to remove this printer from the catalog? The printer data and history will be preserved.",confirmText:"Remove from Catalog"}:{title:"Delete Printer",message:"Are you sure you want to permanently delete this printer? This action cannot be undone.",confirmText:"Delete"};return e.jsxs(e.Fragment,{children:[e.jsx(ta,{activeTab:"printers",isLoading:t,filteredData:l,searchQuery:s,onItemClick:k,onAddNew:q,onEdit:y,onDelete:U,onDataRefresh:r,printerFilter:u,debug:n}),e.jsx(Ss,{isOpen:o,onClose:()=>h(!1),onPrinterAdded:r}),N&&c&&u!=="assigned"&&e.jsx(is,{isOpen:c,onClose:()=>{g(!1),j(null)},printer:N,onPrinterUpdated:I,isLoading:!1}),N&&w&&!T&&e.jsx(tt,{open:w&&!!N&&!T,onOpenChange:z=>{z||(E(!1),j(null))},children:e.jsxs(at,{children:[e.jsxs(nt,{children:[e.jsx(lt,{children:O.title}),e.jsx(it,{children:O.message})]}),e.jsxs(rt,{children:[e.jsx(ct,{children:"Cancel"}),e.jsx(ot,{onClick:C,className:"bg-red-600 hover:bg-red-700",children:O.confirmText})]})]})})]})});Ks.displayName="PrinterTabContent";const Ws=({isOpen:t,onClose:l,onAdded:s})=>{const[r,u]=a.useState(1),[n,d]=a.useState(null),[i,x]=a.useState(""),[m,o]=a.useState(""),[h,c]=a.useState("service_unit"),[g,w]=a.useState(!1),[E,N]=a.useState(!1),{toast:j}=xe(),T=ws(),[p,f]=a.useState(!1),[k,q]=a.useState(!1),[y,U]=a.useState(null),[I,C]=a.useState(!1),{data:H=[],isLoading:O}=Ns({queryKey:["catalog-printers"],queryFn:async()=>{const{data:_,error:P}=await M.from("printers").select("id, name, manufacturer, model, series, image_url").eq("status","active").order("name");if(P)throw P;return _},enabled:t&&r===1}),z=H.filter(_=>_.name.toLowerCase().includes(i.toLowerCase())||_.model&&_.model.toLowerCase().includes(i.toLowerCase())||_.manufacturer&&_.manufacturer.toLowerCase().includes(i.toLowerCase())),K=_=>{d(_),u(2)},W=_=>{f(_),_?q(!0):U(null)},ee=_=>{U(_),q(!1)},B=async()=>{N(!0);try{const{error:_}=await M.from("printer_assignments").insert({printer_id:n.id,client_id:p&&y?y.id:null,serial_number:m.trim()||null,usage_type:p?"client_owned":"service_unit",status:p?"undeployed":"available",is_client_owned:p});if(_)throw _;j({title:"Success",description:"Printer added to inventory successfully."}),ge.clearCache(),await T.invalidateQueries({queryKey:["all-assignments"]}),await T.invalidateQueries({queryKey:["available-assignments"]}),await T.invalidateQueries({queryKey:["optimized-printer-data"]}),await T.invalidateQueries({queryKey:["catalog-printers"]}),window.dispatchEvent(new CustomEvent("refresh-printer-data")),s(),A()}catch(_){j({title:"Error",description:_.message||"Failed to add printer to inventory.",variant:"destructive"})}finally{N(!1)}},b=_=>{_.preventDefault(),n&&B()},A=()=>{u(1),d(null),x(""),o(""),c("service_unit"),w(!1),l()},F=()=>{u(1),d(null)};return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center z-50",children:e.jsxs("div",{className:"relative flex flex-col h-screen w-screen sm:h-auto sm:w-full sm:max-w-lg sm:rounded-2xl sm:shadow-2xl bg-white animate-in fade-in-0 slide-in-from-bottom-8",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 sm:rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-green-100 p-2.5 rounded-xl",children:e.jsx(De,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:r===1?"Select Printer":"Add to Inventory"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:r===1?"Choose a printer from catalog":"Configure inventory details"})]})]}),e.jsx("button",{onClick:A,className:"p-2 -m-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-100",children:e.jsx(Ae,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[r===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-xl border border-green-100",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(us,{className:"h-4 w-4 mr-2 text-green-600"}),"Search Printers"]}),e.jsxs("div",{className:"relative",children:[e.jsx(us,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(ie,{type:"text",placeholder:"Search printers...",value:i,onChange:_=>x(_.target.value),className:"pl-10 h-12 text-base"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2 text-gray-600"}),"Available Printers"]}),O?e.jsx(hs,{}):z.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx(De,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No printers found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search criteria"})]}):e.jsx("div",{className:"space-y-3",children:z.map(_=>e.jsx(Ue,{className:"cursor-pointer border-gray-200 hover:border-gray-300 hover:bg-gray-50 hover:shadow-sm transition-all duration-200",onClick:()=>K(_),children:e.jsx(ze,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"font-bold text-base text-gray-900 mb-2 truncate",children:[_.manufacturer,_.series,_.model||_.name].filter(Boolean).join(" ")}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-16 h-16 flex-shrink-0 flex items-center justify-center bg-gray-100 rounded-xl border-2 border-gray-200 overflow-hidden",children:_.image_url?e.jsx("img",{src:_.image_url,alt:_.name,className:"object-contain w-full h-full"}):e.jsx(De,{className:"h-8 w-8 text-gray-400"})}),e.jsx("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:e.jsx(Je,{printerId:_.id,className:"mt-2 flex flex-row flex-wrap gap-2"})}),e.jsx(ft,{className:"h-4 w-4 text-gray-400 flex-shrink-0"})]})]})})},_.id))})]})]}),r===2&&n&&e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:b,className:"space-y-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 p-4 rounded-xl border border-purple-100",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ut,{className:"h-4 w-4 mr-2 text-purple-600"}),"Inventory Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"serialNumber",className:"text-sm font-semibold text-gray-700",children:"Serial Number"}),e.jsx(ie,{id:"serialNumber",type:"text",value:m,onChange:_=>o(_.target.value),placeholder:"Enter serial number (optional)",className:"h-12 text-base"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-purple-200",children:[e.jsxs("div",{children:[e.jsx(X,{htmlFor:"client_owned_toggle",className:"text-sm font-semibold text-gray-700",children:"Service Unit / Client Owned"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Switch to Client Owned to assign to a client"})]}),e.jsx(L,{type:"button",variant:"outline",onClick:()=>q(!0),className:"mr-2",disabled:!p,children:y?`Client: ${y.name}`:"Select Client"}),e.jsx("input",{type:"checkbox",id:"client_owned_toggle",checked:p,onChange:_=>W(_.target.checked),className:"h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"})]}),p&&y&&e.jsxs("div",{className:"ml-4 text-xs text-gray-600 mb-2",children:["Selected: ",y.name]})]})]})}),e.jsx(Nt,{isOpen:k,onClose:()=>q(!1),onClientSelected:ee,title:"Select Client Owner",description:"Choose a client to own this printer."}),e.jsx(de,{open:I,onOpenChange:C,children:e.jsxs(me,{children:[e.jsx(ue,{children:"No serial number has been added"}),e.jsx(vs,{children:"You can go back to enter it now, or click 'Done' to skip and update it later."}),e.jsxs(ys,{children:[e.jsx(L,{variant:"outline",onClick:()=>C(!1),children:"Go Back"}),e.jsx(L,{onClick:()=>{C(!1),B()},className:"bg-green-600 hover:bg-green-700 text-white",children:"Done"})]})]})})]})]})}),e.jsx("div",{className:"sticky bottom-0 z-10 bg-white border-t border-gray-200 sm:rounded-b-2xl",children:e.jsx("div",{className:"p-4 sm:p-6",children:e.jsx("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3",children:r===1?e.jsx(L,{variant:"outline",onClick:A,className:"w-full sm:w-auto h-12 text-base font-medium",children:"Cancel"}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{type:"button",variant:"outline",onClick:F,className:"w-full sm:w-auto h-12 text-base font-medium",children:[e.jsx(Is,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx(L,{onClick:b,disabled:E,className:"w-full sm:w-auto h-12 text-base font-medium bg-green-600 hover:bg-green-700 text-white",children:E?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(Zs,{className:"h-4 w-4 mr-2"}),"Add to Inventory"]})})]})})})})]})}):null},aa=({leftSection:t,centerSection:l,rightSection:s,className:r=""})=>e.jsx("nav",{className:`fixed bottom-0 left-0 w-full z-50 bg-white/95 backdrop-blur-lg border-t border-gray-200 shadow-2xl transition-all ${r}`,children:e.jsxs("div",{className:"flex items-center px-2 py-2 min-h-[60px]",children:[t&&e.jsx("div",{className:"flex-shrink-0 w-12 flex justify-center",children:t}),l&&e.jsx("div",{className:"flex-1 flex items-center min-w-0",children:l}),s&&s]})}),na=[{key:"assigned",label:"Assigned",icon:bt},{key:"available",label:"Available",icon:Ee}],la=({printerFilter:t,setPrinterFilter:l})=>e.jsx(St,{options:na,activeFilter:t,onFilterChange:s=>l(s)}),ia=({label:t,count:l,isActive:s,onClick:r,icon:u,show:n=!0,isInitial:d=!1})=>n?t.toLowerCase()==="back"?e.jsx("button",{onClick:r,className:"h-12 w-12 rounded-lg flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-50 transition-all duration-200","aria-label":"Back",children:e.jsx(Is,{className:"h-5 w-5"})}):e.jsxs(L,{variant:s?"default":"ghost",onClick:r,className:et("flex-1 relative h-12 flex flex-col items-center justify-center gap-1 text-xs",s&&"bg-blue-600 text-white"),children:[u&&e.jsx("span",{className:"text-base",children:u}),e.jsx("span",{className:"font-medium",children:t}),l!==void 0&&l>0&&e.jsx(ne,{variant:"secondary",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:l})]}):null,ra=({printerFilter:t,setPrinterFilter:l,onFilteredDataChange:s,editAssignmentModal:r})=>{const[u,n]=a.useState(null),[d,i]=a.useState(!1),[x,m]=a.useState(!1),[o,h]=a.useState(!1),[c,g]=a.useState(!1),[w,E]=a.useState(!1),[N,j]=a.useState(null),T=st(),p=Ye(),f=()=>{i(!1),n(null)},k=()=>{g(!1),j(null)},q=()=>{h(!0)},y=()=>{m(!0)},U=()=>{E(!0)},I=()=>{E(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(aa,{leftSection:e.jsx(ia,{label:"Back",isActive:!1,show:T.pathname!=="/",onClick:()=>p(-1)}),centerSection:e.jsx(la,{printerFilter:t,setPrinterFilter:l}),rightSection:e.jsx(pt,{onAssignPrinter:q,onAddPrinter:y,onAddToInventory:U})}),d&&u&&e.jsx(wt,{isOpen:d,onClose:f,product:u}),x&&e.jsx(Ss,{isOpen:x,onClose:()=>m(!1),onPrinterAdded:()=>{}}),w&&e.jsx(Ws,{isOpen:w,onClose:()=>E(!1),onAdded:I}),o&&e.jsx(as,{isOpen:o,onClose:()=>h(!1),onAssigned:k}),c&&N&&e.jsx(as,{isOpen:c,onClose:()=>g(!1),onAssigned:k,preSelectedClientId:N.id})]})},Ys=ls.memo(({printerFilter:t})=>{const s=(()=>{switch(t){case"assigned":return null;case"available":return"🛈 Available Tab: List of Printers with Status = Available";case"catalog":return"🛈 Catalog Tab: List of Printers Supported by Our Products";default:return null}})();return s?e.jsx("div",{className:"w-full bg-blue-50 border-b border-blue-100 py-2 px-4 text-sm text-blue-900 flex items-center gap-2",children:e.jsx("span",{children:e.jsx("b",{children:s})})}):null});Ys.displayName="PrinterDashboardHelpBanner";const ca=({isOpen:t,onClose:l,onPrinterAdded:s})=>{const[r,u]=a.useState({name:"",manufacturer:"",model:"",series:"",color:"",description:"",image_url:""}),[n,d]=a.useState([]),[i,x]=a.useState(""),[m,o]=a.useState([]),[h,c]=a.useState(!1),[g,w]=a.useState(!1),[E,N]=a.useState(null),[j,T]=a.useState(""),[p,f]=a.useState(!1),{toast:k}=xe(),q=[{value:"CMYK",label:"CMYK (Color)"},{value:"Monochrome",label:"Monochrome (Black Only)"}];a.useEffect(()=>{t&&(u({name:"",manufacturer:"",model:"",series:"",color:"",description:"",image_url:""}),d([]),x(""),N(null),T(""),f(!1))},[t]),a.useEffect(()=>{U()},[]);const y=async b=>{if(!b.trim()){f(!1);return}try{const F=(await oe.searchPrinters(b.trim())).find(_=>_.name.toLowerCase()===b.trim().toLowerCase());f(!!F)}catch(A){console.error("Error checking printer name:",A)}},U=async()=>{try{const b=await _s.getProducts();o(b)}catch(b){console.error("Failed to load available products:",b)}},I=b=>{var F;const A=(F=b.target.files)==null?void 0:F[0];if(A){N(A);const _=new FileReader;_.onload=P=>{var v;T((v=P.target)==null?void 0:v.result)},_.readAsDataURL(A)}},C=async b=>{var A;if(b.preventDefault(),p){k({title:"Error",description:"A printer with this name already exists. Please choose a different name.",variant:"destructive"});return}if(!r.name.trim()){k({title:"Error",description:"Printer name is required.",variant:"destructive"});return}w(!0);try{if((await oe.searchPrinters(r.name.trim())).find(J=>J.name.toLowerCase()===r.name.trim().toLowerCase())){k({title:"Error",description:"A printer with this name already exists. Please choose a different name.",variant:"destructive"}),w(!1);return}let P=r.image_url;E&&!r.image_url&&(P=j);const v=await oe.createPrinter({name:r.name.trim(),manufacturer:r.manufacturer.trim()||null,model:r.model.trim()||null,series:r.series.trim()||null,color:r.color||null,description:r.description.trim()||null,image_url:P||null});if(n.length>0){const J=n.map(Z=>Z.id);await oe.updatePrinterProducts(v.id,J)}k({title:"Success",description:"Printer added successfully!"}),s(),l()}catch(F){console.error("Failed to add printer:",F);let _="Failed to add printer. Please try again.";(F==null?void 0:F.code)==="23505"&&((A=F==null?void 0:F.details)!=null&&A.includes("printers_name_key"))&&(_="A printer with this name already exists. Please choose a different name."),k({title:"Error",description:_,variant:"destructive"})}finally{w(!1)}},H=b=>{const{name:A,value:F}=b.target;u(_=>({..._,[A]:F})),A==="name"&&y(F)},O=b=>{u(A=>({...A,color:b}))},z=b=>{x(b),c(b.length>0)},K=b=>{const A=m.find(F=>F.id===b);A&&(n.some(F=>F.id===A.id)||d(F=>[...F,{id:A.id,name:A.name,color:A.color}]),x(""),c(!1))},W=b=>{d(A=>A.filter(F=>F.id!==b))},ee=b=>{if(b.key==="Enter"||b.key===","){b.preventDefault();const A=i.trim();A&&K(A)}},B=m.filter(b=>b.name.toLowerCase().includes(i.toLowerCase())&&!n.some(A=>A.id===b.id));return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Add New Printer"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Ae,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:C,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Printer Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:r.name,onChange:H,required:!0,disabled:g,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 ${p?"border-red-500":"border-gray-300"}`,placeholder:"Enter printer name"}),p&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"A printer with this name already exists. Please choose a different name."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"manufacturer",className:"block text-sm font-medium text-gray-700 mb-1",children:"Make/Manufacturer"}),e.jsx("input",{type:"text",id:"manufacturer",name:"manufacturer",value:r.manufacturer,onChange:H,disabled:g,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",placeholder:"e.g., HP, Canon, Epson"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"model",className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),e.jsx("input",{type:"text",id:"model",name:"model",value:r.model,onChange:H,disabled:g,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",placeholder:"e.g., LaserJet Pro M404n"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"series",className:"block text-sm font-medium text-gray-700 mb-1",children:"Series"}),e.jsx("input",{type:"text",id:"series",name:"series",value:r.series,onChange:H,disabled:g,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",placeholder:"e.g., LaserJet Pro, PIXMA, MFP"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Color Variation"}),e.jsxs(gs,{value:r.color,onValueChange:O,disabled:g,children:[e.jsx(fs,{className:"w-full",children:e.jsx(ps,{placeholder:"Select color type"})}),e.jsx(bs,{children:q.map(b=>e.jsx(ss,{value:b.value,children:b.label},b.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:r.description,onChange:H,disabled:g,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",placeholder:"Enter printer description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Printer Image"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{htmlFor:"image-upload",className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(Os,{className:"w-8 h-8 mb-2 text-gray-500"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," printer image"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG or JPEG (MAX. 10MB)"})]}),e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",onChange:I,disabled:g,className:"hidden"})]})}),j&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:j,alt:"Preview",className:"w-full h-32 object-cover rounded-lg border"}),e.jsx("button",{type:"button",onClick:()=>{N(null),T("")},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600",children:"×"})]}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:"OR"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"image_url",className:"block text-sm font-medium text-gray-700 mb-1",children:"Image URL"}),e.jsx("input",{type:"url",id:"image_url",name:"image_url",value:r.image_url,onChange:H,disabled:g,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",placeholder:"https://example.com/printer-image.jpg"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supported Products"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i,onChange:b=>z(b.target.value),onKeyPress:ee,disabled:g,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",placeholder:"Type product name and press Enter or comma"}),h&&B.length>0&&e.jsx("div",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-40 overflow-y-auto",children:B.slice(0,5).map(b=>e.jsxs("button",{type:"button",onClick:()=>K(b.id),className:"w-full text-left px-3 py-2 hover:bg-gray-100 border-b border-gray-100 last:border-b-0 flex items-center gap-2",children:[b.color&&e.jsx("span",{className:"w-3 h-3 rounded-full border border-gray-300",style:{backgroundColor:b.color,display:"inline-block"}}),b.name,b.sku&&e.jsxs("span",{className:"ml-1 text-gray-400",children:["(",b.sku,")"]})]},b.id))})]}),n.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:n.map(b=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 gap-1",children:[b.color&&e.jsx("span",{className:"w-3 h-3 rounded-full border border-gray-300 mr-1",style:{backgroundColor:b.color,display:"inline-block"}}),b.name,e.jsx("button",{type:"button",onClick:()=>W(b.id),className:"ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full text-blue-400 hover:bg-blue-200 hover:text-blue-600",children:"×"})]},b.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Type product names and press Enter or comma to add them"})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:l,disabled:g,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g||p,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:g?"Adding...":"Add Printer"})]})]})]})}):null},Js=ls.memo(({showPrinterSelection:t,onClosePrinterSelection:l,onPrinterSelected:s,showAssignToClient:r,onCloseAssignToClient:u,selectedPrinter:n,onAssignmentComplete:d,showAddPrinter:i,onCloseAddPrinter:x,onPrinterAdded:m,showEditAssignmentModal:o,onCloseEditAssignmentModal:h,selectedPrinterForAssignment:c,onAssignmentUpdated:g})=>e.jsxs(e.Fragment,{children:[t&&e.jsx(as,{isOpen:t,onClose:l,onAssigned:d}),i&&e.jsx(ca,{isOpen:i,onClose:x,onPrinterAdded:m}),o&&c&&e.jsx(As,{isOpen:o,onClose:h,printerId:c.id,onAssignmentUpdated:g,isLoading:!1})]}));Js.displayName="PrinterDashboardModals";const Te=class Te{constructor(){Xe(this,"memoryThreshold",50*1024*1024);Xe(this,"checkInterval",null)}static getInstance(){return Te.instance||(Te.instance=new Te),Te.instance}startMonitoring(){this.checkInterval||(this.checkInterval=setInterval(()=>{this.checkMemoryUsage()},3e4))}stopMonitoring(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}isMemoryPressure(){return"memory"in performance?performance.memory.usedJSHeapSize>this.memoryThreshold*.8:!1}isHighMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize>this.memoryThreshold:!1}setMemoryThreshold(l){this.memoryThreshold=l*1024*1024}checkMemoryUsage(){if("memory"in performance){const s=performance.memory.usedJSHeapSize;console.log(`📊 Memory usage: ${(s/1024/1024).toFixed(2)}MB`),s>this.memoryThreshold&&(console.warn("🚨 High memory usage detected, triggering cleanup..."),this.performMemoryCleanup())}}performMemoryCleanup(){const l=["cached_products","cached_printers","cached_clients","search_cache","normalized_printer_data","temp_data","filter_cache"],s=this.isHighMemoryUsage()?9e5:36e5;l.forEach(r=>{const u=localStorage.getItem(`${r}_timestamp`);u&&Date.now()-parseInt(u)>s&&(localStorage.removeItem(r),localStorage.removeItem(`${r}_timestamp`),console.log(`🧹 Cleared cache: ${r}`))}),"gc"in window&&typeof window.gc=="function"&&window.gc()}clearCache(){this.performMemoryCleanup()}getMemoryInfo(){if("memory"in performance){const l=performance.memory;return{used:Math.round(l.usedJSHeapSize/1024/1024),total:Math.round(l.totalJSHeapSize/1024/1024),limit:Math.round(l.jsHeapSizeLimit/1024/1024)}}return null}};Xe(Te,"instance");let xs=Te;const We=xs.getInstance(),rs=(t,l)=>(a.useEffect(()=>{l&&ge.preloadTabData(t)},[t,l]),Ns({queryKey:["optimized-printer-data",t],queryFn:async()=>{if(!We.isHighMemoryUsage()){const s=ge.getCachedNormalizedData(),r=s?ge.denormalizePrinterData(t):[];if(s&&r.length>0)return r}if(t==="catalog"){const{data:s,error:r}=await M.from("printers").select(`
            id,
            name,
            manufacturer,
            model,
            series,
            color,
            image_url,
            rental_eligible,
            status,
            created_at
          `).neq("status","deleted").order("created_at",{ascending:!1});if(r)throw r;return s||[]}else{let s=M.from("printer_assignments").select(`
            id,
            printer_id,
            serial_number,
            usage_type,
            status,
            client_id,
            department_location_id,
            assignment_effective_date,
            condition,
            reason_for_change,
            notes,
            created_at,
            updated_at,
            is_client_owned,
            printer:printers!inner(
              id,
              name,
              manufacturer,
              model,
              series,
              color,
              image_url,
              rental_eligible,
              status
            ),
            clients(id, name),
            departments_location(
              id,
              name,
              department:departments(id, name)
            )
          `);switch(t){case"assigned":s=s.in("status",["active","inactive","undeployed"]).not("client_id","is",null);break;case"available":s=s.is("client_id",null);break}s=s.order("printer(name)");const{data:r,error:u}=await s;if(u)throw u;const n=ge.normalizeAssignmentData(r||[]);return ge.cacheNormalizedData(n),ge.denormalizePrinterData(t)}},enabled:l,staleTime:5*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1,refetchOnMount:!1})),oa=()=>{a.useEffect(()=>{let t;return(()=>{We.isMemoryPressure()||(t=setInterval(async()=>{try{We.isMemoryPressure()||await ge.prefetchTabData("inventory")}catch(s){console.warn("Background sync failed:",s)}},6e5))})(),()=>{t&&clearInterval(t)}},[])},da=t=>rs("assigned",t),ma=t=>rs("inventory",t),ua=t=>rs("catalog",t),xa=t=>rs("available",t),ha=({printerFilter:t,onRefresh:l})=>{const s=ws();a.useEffect(()=>{console.log("🔄 Setting up real-time subscription for",t);const r=M.channel("printer-changes").on("postgres_changes",{event:"*",schema:"public",table:"printers"},n=>{console.log("📡 Printer table change detected:",n),n.eventType==="INSERT"&&t==="catalog"&&(console.log("🆕 New printer added to catalog, refreshing..."),ge.clearCache(),s.invalidateQueries({queryKey:["optimized-printer-data","catalog"]}),l()),(n.eventType==="UPDATE"||n.eventType==="DELETE")&&(console.log(`🔄 Printer ${n.eventType.toLowerCase()}, refreshing ${t}...`),ge.clearCache(),s.invalidateQueries({queryKey:["optimized-printer-data",t]}),l())}).subscribe(),u=M.channel("assignment-changes").on("postgres_changes",{event:"*",schema:"public",table:"printer_assignments"},n=>{console.log("📡 Assignment change detected:",n),["assigned","available","inventory"].includes(t)&&(ge.clearCache(),s.invalidateQueries({queryKey:["optimized-printer-data",t]}),l())}).subscribe();return()=>{console.log("🔌 Cleaning up real-time subscriptions"),M.removeChannel(r),M.removeChannel(u)}},[t,l,s])},Ka=()=>{const{user:t,userProfile:l,loading:s,userProfileLoading:r}=ns();$s(),Ye();const u=ws(),[n,d]=a.useState(""),[i,x]=a.useState(()=>new URLSearchParams(window.location.search).get("tab")||"assigned"),[m,o]=a.useState(!1),[h,c]=a.useState(!1),[g,w]=a.useState(!1),[E,N]=a.useState(null),[j,T]=a.useState([]),[p,f]=a.useState(!1),[k,q]=a.useState(!1),[y,U]=a.useState(null),[I,C]=a.useState(!1),[H,O]=a.useState(!1),[z,K]=a.useState(!1),[W,ee]=a.useState(!1),[B,b]=a.useState(!1),[A,F]=a.useState(!1),[_,P]=a.useState(!1),{data:v}=Ns({queryKey:["client-access",t==null?void 0:t.id,l==null?void 0:l.role],queryFn:async()=>{if(!(t!=null&&t.id)||(l==null?void 0:l.role)!=="client")return null;const{data:$,error:ae}=await M.from("client_access").select("client_id").eq("user_id",t.id);if(ae)throw ae;return $.map(be=>be.client_id)},enabled:!!(t!=null&&t.id)&&(l==null?void 0:l.role)==="client"});oa(),a.useEffect(()=>(We.startMonitoring(),()=>We.stopMonitoring()),[]);const J=a.useCallback($=>{x($);const ae=new URL(window.location.href);ae.searchParams.set("tab",$),window.history.replaceState({},"",ae.toString())},[]);a.useEffect(()=>{const $=new URL(window.location.href);$.searchParams.set("tab",i),window.history.replaceState({},"",$.toString())},[i]),a.useEffect(()=>{const $=()=>{const be=new URLSearchParams(window.location.search).get("tab");be&&be!==i&&x(be)};return window.addEventListener("popstate",$),()=>window.removeEventListener("popstate",$)},[i]);const{data:Z=[],isLoading:te}=da(i==="assigned"),{data:Y=[],isLoading:G}=ma(!0),{data:re=[],isLoading:Me}=ua(!0),{data:fe=[],isLoading:we}=xa(!0),Pe=te||G||we||Me,le=a.useCallback(async()=>{console.log("🔄 Refreshing printer data..."),ge.clearCache(),await u.invalidateQueries({queryKey:["assigned-assignments"]}),await u.invalidateQueries({queryKey:["available-assignments"]}),await u.invalidateQueries({queryKey:["all-assignments"]}),await u.invalidateQueries({queryKey:["catalog-printers"]}),await u.invalidateQueries({queryKey:["optimized-printer-data"]}),console.log("✅ Printer data refreshed")},[u]);ha({printerFilter:i,onRefresh:le}),a.useEffect(()=>{(i==="catalog"||i==="available"||i==="inventory")&&(console.log(`🔄 Switching to ${i} tab, refreshing data...`),le())},[i,le]);const Ce=a.useCallback($=>{if((l==null?void 0:l.role)!=="client"||!v)return $;switch(i){case"assigned":return $.filter(ae=>{var be;return(be=ae.printer_assignments)==null?void 0:be.some(Es=>Es.client_id&&v.includes(Es.client_id))});case"available":return $.filter(ae=>!ae.printer_assignments||ae.printer_assignments.length===0?!0:ae.printer_assignments.some(be=>!be.client_id||v.includes(be.client_id)));case"inventory":return $.filter(ae=>ae.client_id?v.includes(ae.client_id):!0);case"catalog":return $;default:return $}},[l==null?void 0:l.role,v,i]),$e=a.useMemo(()=>{let $;switch(i){case"assigned":$=Z;break;case"available":$=fe;break;case"inventory":$=Y;break;case"catalog":$=re;break;default:$=[]}return Ce($)},[i,Z,fe,Y,re,Ce]),D=a.useMemo(()=>j.length>0?j:$e,[j,$e]),S=a.useMemo(()=>i!=="inventory"?Y:Y.filter($=>I||H&&$.status==="available"||z&&["active","inactive","undeployed"].includes($.status)&&$.client_id!=null&&$.client_id!==""||W&&$.is_client_owned?!0:!I&&!H&&!z&&!W?$.client_id==null&&$.status!=="available":!1),[Y,I,H,z,W,i]),R=a.useCallback(($,ae)=>{N({id:$,name:ae}),c(!1),w(!0)},[]),se=a.useCallback(()=>{w(!1),N(null),le()},[le]),pe=a.useCallback(()=>{o(!1),le()},[le]),he=a.useCallback($=>{T($)},[]),Ge=a.useCallback($=>{U($),q(!0)},[]),Qe=a.useCallback(async()=>{console.log("🔄 Assignment updated, refreshing data...");try{await le(),q(!1),U(null)}catch($){console.error("Error refreshing data:",$)}},[le]),qe=()=>b(!0),Oe=()=>F(!1),Ps=()=>F(!0),Gs=()=>P(!0),Ds=()=>P(!1);return a.useEffect(()=>{n.trim()||T([])},[i,n]),e.jsx(dt,{children:e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-blue-50 to-indigo-50 safe-area-inset-top",children:[e.jsx("header",{className:"sticky top-0 z-20 bg-blue-100/95 backdrop-blur-sm border-b border-blue-200 shadow-sm safe-area-inset-top",children:e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 min-h-[44px]",children:[e.jsx("div",{className:"flex items-center gap-2 flex-1",children:e.jsx(De,{className:"w-5 h-5 text-blue-500 flex-shrink-0"})}),(l==null?void 0:l.role)!=="client"&&e.jsx(L,{variant:"ghost",size:"sm",className:"h-10 w-20 flex-shrink-0 min-touch-target",onClick:()=>x("catalog"),"aria-label":"Catalog",children:"Catalog"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain pb-safe",children:e.jsxs("div",{className:"py-2 space-y-3 w-full max-w-full p-0 m-0",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-lg border border-blue-100 p-3",children:e.jsx(_t,{})}),e.jsx(Ys,{printerFilter:i}),e.jsxs("main",{className:"pb-4",children:[i==="inventory"&&e.jsx("div",{className:"w-full z-10 sticky top-[44px] sm:static mb-3",style:{},children:e.jsxs("div",{className:`\r
                      bg-white/90 border border-blue-100 rounded-xl p-3\r
                      flex flex-col gap-2\r
                      sm:flex-row sm:gap-4 sm:items-center\r
                      shadow-sm\r
                    `,"aria-label":"Inventory Filters",children:[e.jsx("span",{className:"text-xs font-semibold text-blue-700 mb-1 sm:mb-0",children:"Filters"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:$=>C($.target.checked),className:"w-5 h-5 accent-blue-500"}),"All"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:$=>O($.target.checked),className:"w-5 h-5 accent-blue-500"}),"Available"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:$=>K($.target.checked),className:"w-5 h-5 accent-blue-500"}),"Assigned"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:W,onChange:$=>ee($.target.checked),className:"w-5 h-5 accent-blue-500"}),"Client Owned"]})]})}),e.jsx(Ks,{debug:p,isLoading:Pe,filteredData:i==="inventory"?S:D,searchQuery:n,onDataRefresh:le,printerFilter:i,onEditAssignment:Ge,onShowAssignModal:qe,onShowAddToInventoryModal:Ps})]})]})}),e.jsx("div",{className:"sticky bottom-0 z-30 w-full safe-area-inset-bottom",children:e.jsx(ra,{printerFilter:i,setPrinterFilter:J,onFilteredDataChange:he,editAssignmentModal:k&&y?e.jsx("div",{}):null})}),e.jsx(Js,{showPrinterSelection:h,onClosePrinterSelection:()=>c(!1),onPrinterSelected:R,showAssignToClient:g,onCloseAssignToClient:()=>w(!1),selectedPrinter:E,onAssignmentComplete:se,showAddPrinter:m,onCloseAddPrinter:()=>o(!1),onPrinterAdded:pe,showEditAssignmentModal:k,onCloseEditAssignmentModal:()=>{q(!1),U(null)},selectedPrinterForAssignment:y,onAssignmentUpdated:Qe}),B&&e.jsx(as,{isOpen:B,onClose:()=>b(!1),onAssigned:()=>b(!1)}),A&&e.jsx(Ws,{isOpen:A,onClose:Oe,onAdded:Oe}),(l==null?void 0:l.role)!=="client"&&(i==="inventory"||i==="available"||i==="assigned"||i==="catalog")&&!(B||A||_)&&e.jsxs("button",{className:"fixed bottom-[80px] right-6 z-50 w-10 h-10 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-2xl flex items-center justify-center text-3xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400",style:{pointerEvents:"auto"},"aria-label":i==="assigned"?"Assign Printer":i==="catalog"?"Add Printer to Catalog":"Add Printer",onClick:i==="assigned"?qe:i==="catalog"?Gs:Ps,children:[e.jsx("span",{className:"sr-only",children:i==="assigned"?"Assign Printer":i==="catalog"?"Add Printer to Catalog":"Add Printer"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})]}),_&&e.jsx(Ss,{isOpen:_,onClose:Ds,onPrinterAdded:Ds})]})})};export{Ka as default};
//# sourceMappingURL=PrinterDashboard-YVrGXVMM.js.map

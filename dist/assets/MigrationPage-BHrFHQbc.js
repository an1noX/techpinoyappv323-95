const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-FgfazPn4.js","assets/index-CWiAdddQ.css"])))=>i.map(i=>d[i]);
import{c as $,r as l,j as e,T as L,B as g,t as d,_ as B,s as n}from"./index-FgfazPn4.js";import{C as m,b as u,c as h,d as p,a as j}from"./card-S-815Fh1.js";import{B as I}from"./badge-PQ_Xgg0c.js";import{T as G,a as X,b as f,c as y}from"./tabs-CXhmf9qd.js";import{A as k,a as M}from"./alert-5f0mIJz3.js";import{D as R}from"./database-RojKuwWx.js";import{F as Z}from"./file-text-hP0IkulY.js";import{C as T}from"./clock-UXFbK2OM.js";import{C as Y}from"./circle-x-7G5sk1I3.js";import{C as Q}from"./circle-check-big-B5GuSQz3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=$("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),x={current:{name:"Current Server",url:"https://mzjcmtltwdcpbdvunmzk.supabase.co",anon_key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16amNtdGx0d2RjcGJkdnVubXprIiwicm9sZUiOiJhbm9uIiwiaWF0IjoxNzQ4NjAzNDAwLCJleHAiOjIwNjQxNzk0MDB9.yap8eSNbFjYJsz43kwUZtGh8O3V7V9YPQC5bgx3cFWs",status:"active"},new:{name:"New Server (kong.techpinoy.com)",url:"https://mzjcmtltwdcpbdvunmzk.supabase.co",anon_key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16amNtdGx0d2RjcGJkdnVubXprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2MDM0MDAsImV4cCI6MjA2NDE3OTQwMH0.yap8eSNbFjYJsz43kwUZtGh8O3V7V9YPQC5bgx3cFWs",status:"ready"}},q=()=>{const[c,_]=l.useState("current"),[J,H]=l.useState("completed"),[w,v]=l.useState([]),[N,b]=l.useState(!1),C=async s=>{try{const{createClient:t}=await B(async()=>{const{createClient:U}=await import("./index-FgfazPn4.js").then(O=>O.aJ);return{createClient:U}},__vite__mapDeps([0,1])),r=x[s],a=t(r.url,r.anon_key),{data:i,error:o}=await a.from("clients").select("count",{count:"exact",head:!0});if(o)throw o;return{name:`${r.name} Connection`,status:"success",message:`Connected successfully. ${(i==null?void 0:i.length)||0} clients found.`}}catch(t){return{name:`${x[s].name} Connection`,status:"error",message:`Connection failed: ${t instanceof Error?t.message:"Unknown error"}`}}},z=async()=>{try{const{data:s,error:t}=await n.rpc("get_total_page_views");if(t)throw t;return{name:"Database Functions",status:"success",message:"Functions are working correctly",details:s}}catch(s){return{name:"Database Functions",status:"error",message:`Function test failed: ${s instanceof Error?s.message:"Unknown error"}`}}},V=async()=>{try{const s=[n.from("clients").select("id").limit(1),n.from("departments").select("id").limit(1),n.from("printers").select("id").limit(1),n.from("products").select("id").limit(1)],t=await Promise.allSettled(s),r=t.filter(a=>a.status==="rejected");if(r.length>0)throw new Error(`RLS policy failures: ${r.length}/${t.length} tests failed`);return{name:"RLS Policies",status:"success",message:"All RLS policies are functioning correctly"}}catch(s){return{name:"RLS Policies",status:"error",message:`RLS test failed: ${s instanceof Error?s.message:"Unknown error"}`}}},E=async()=>{try{const{data:s,error:t}=await n.from("clients").select("id, name, department_count, printer_count").limit(5);if(t)throw t;for(const r of s||[]){const{count:a}=await n.from("departments").select("*",{count:"exact",head:!0}).eq("client_id",r.id),{count:i}=await n.from("printer_assignments").select("*",{count:"exact",head:!0}).eq("client_id",r.id).eq("status","active");if(r.department_count!==a||r.printer_count!==i)throw new Error(`Data integrity issue for client ${r.name}`)}return{name:"Data Integrity",status:"success",message:`Verified ${(s==null?void 0:s.length)||0} clients - all counts accurate`}}catch(s){return{name:"Data Integrity",status:"error",message:`Integrity test failed: ${s instanceof Error?s.message:"Unknown error"}`}}},F=async()=>{b(!0),v([]);const s=[()=>C("current"),()=>C("new"),z,V,E],t=[];for(const a of s){const i=await a();t.push(i),v([...t]),await new Promise(o=>setTimeout(o,500))}b(!1);const r=t.filter(a=>a.status==="error");r.length===0?d({title:"Migration Validation Complete",description:"All tests passed successfully! Migration is ready."}):d({title:"Migration Issues Detected",description:`${r.length} test(s) failed. Please review the results.`,variant:"destructive"})},S=async s=>{try{_(s),d({title:"Server Switched",description:`Now using ${x[s].name}`})}catch(t){d({title:"Server Switch Failed",description:t instanceof Error?t.message:"Unknown error",variant:"destructive"})}},A=s=>{switch(s){case"success":return e.jsx(Q,{className:"h-4 w-4 text-green-500"});case"error":return e.jsx(Y,{className:"h-4 w-4 text-red-500"});case"pending":return e.jsx(T,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(T,{className:"h-4 w-4 text-gray-400"})}},P=s=>{const t={active:"default",ready:"secondary",error:"destructive",pending:"outline"};return e.jsx(I,{variant:t[s]||"outline",children:s})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(m,{children:e.jsxs(u,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Database Migration Control Panel"]}),e.jsx(p,{children:"Manage and validate the migration from old server to new server (kong.techpinoy.com)"})]})}),e.jsxs(G,{defaultValue:"status",className:"space-y-4",children:[e.jsxs(X,{children:[e.jsx(f,{value:"status",children:"Migration Status"}),e.jsx(f,{value:"testing",children:"Validation Tests"}),e.jsx(f,{value:"server-control",children:"Server Control"})]}),e.jsxs(y,{value:"status",className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(x).map(([s,t])=>e.jsxs(m,{className:`${c===s?"ring-2 ring-blue-500":""}`,children:[e.jsx(u,{children:e.jsxs(h,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),t.name]}),P(t.status)]})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["URL: ",t.url]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Key: ",t.anon_key.substring(0,20),"..."]}),c===s&&e.jsx(I,{variant:"outline",children:"Currently Active"})]})})]},s))}),e.jsxs(k,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs(M,{children:[e.jsxs("strong",{children:["Migration Status: ",J.toUpperCase()]}),e.jsx("br",{}),"Database migration has been successfully executed on the new server. All functions, triggers, and RLS policies have been migrated."]})]})]}),e.jsx(y,{value:"testing",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"Migration Validation Tests"}),e.jsx(p,{children:"Comprehensive tests to ensure migration integrity and functionality"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsx(g,{onClick:F,disabled:N,className:"w-full",children:N?"Running Tests...":"Run Migration Tests"}),w.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Test Results:"}),w.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[A(s.status),e.jsx("span",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.message}),s.details&&e.jsxs("p",{className:"text-xs text-gray-500",children:[JSON.stringify(s.details,null,2).substring(0,100),"..."]})]})]},t))]})]})]})}),e.jsx(y,{value:"server-control",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"Server Management"}),e.jsx(p,{children:"Switch between servers and manage the migration process"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(g,{variant:c==="current"?"default":"outline",onClick:()=>S("current"),className:"h-20 flex flex-col gap-2",children:[e.jsx(D,{className:"h-6 w-6"}),"Use Current Server",e.jsx("span",{className:"text-xs opacity-70",children:"Original production server"})]}),e.jsxs(g,{variant:c==="new"?"default":"outline",onClick:()=>S("new"),className:"h-20 flex flex-col gap-2",children:[e.jsx(R,{className:"h-6 w-6"}),"Use New Server",e.jsx("span",{className:"text-xs opacity-70",children:"kong.techpinoy.com"})]})]}),e.jsxs(k,{children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs(M,{children:[e.jsx("strong",{children:"Phase 3 Complete:"})," Database migration successfully executed.",e.jsx("br",{}),e.jsx("strong",{children:"Phase 4 In Progress:"})," Validate migration and test functionality.",e.jsx("br",{}),"Use the validation tests above to verify everything is working correctly."]})]})]})]})})]})]})},oe=()=>e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Server Migration Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage the transition between old and new Supabase servers"})]}),e.jsx(q,{})]});export{oe as default};
//# sourceMappingURL=MigrationPage-BHrFHQbc.js.map

import{c as $,a as D,r as n,E as R,j as e,C as M,G as E,s as T,u as U,X as G}from"./index-FgfazPn4.js";import{B as Q}from"./badge-PQ_Xgg0c.js";import{C as V,a as X}from"./card-S-815Fh1.js";import{D as _}from"./database-RojKuwWx.js";import{C as L}from"./chevron-right-BqyfOyy6.js";import{M as H}from"./printer-X5np4qGe.js";import{P as J,U as C}from"./users-7LwHL_dG.js";import{C as W}from"./clock-UXFbK2OM.js";import{u as Y,c as Z}from"./clientService-scOH6ADK.js";import{S as O}from"./checkbox-De7F5xfH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=$("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),de=()=>{const{userProfile:o,userProfileLoading:d}=D(),[p,w]=n.useState([]),[y,h]=n.useState(0),[m,x]=n.useState(!0),{data:g,isLoading:i,error:s}=R({queryKey:["printer-assignments-summary"],queryFn:async()=>{const{data:l,error:u}=await T.from("printer_assignments").select("status").neq("status","deleted");if(u)throw u;return l||[]},refetchInterval:3e4});return n.useEffect(()=>{if(g){const l=g.filter(c=>c.status!=="decommissioned"),u=new Map;l.forEach(c=>{const r=c.status||"unknown";u.set(r,(u.get(r)||0)+1)});const b={active:{color:"bg-green-100 text-green-800 border-green-200",icon:e.jsx(H,{className:"h-4 w-4"})},inactive:{color:"bg-gray-100 text-gray-800 border-gray-200",icon:e.jsx(q,{className:"h-4 w-4"})},available:{color:"bg-blue-100 text-blue-800 border-blue-200",icon:e.jsx(J,{className:"h-4 w-4"})},delisted:{color:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:e.jsx(q,{className:"h-4 w-4"})},unknown:{color:"bg-gray-100 text-gray-800 border-gray-200",icon:e.jsx(W,{className:"h-4 w-4"})}},j=Array.from(u.entries()).map(([c,r])=>({status:c,count:r,...b[c]||b.unknown})).sort((c,r)=>r.count-c.count);w(j),h(l.length)}},[g]),d||(o==null?void 0:o.role)!=="admin"?null:i?e.jsx("div",{className:"bg-white border-b border-gray-200 p-4",children:e.jsx(M,{message:"Loading database summary"})}):s?e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-4 w-4 text-blue-600"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:["Printers Total: ",y]}),e.jsx("button",{onClick:()=>x(!m),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:m?e.jsx(L,{className:"h-4 w-4"}):e.jsx(E,{className:"h-4 w-4"})})]})}),!m&&e.jsx("div",{className:"text-center text-sm text-red-600 mt-2",children:"Error loading database summary"})]}):e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-4 w-4 text-blue-600"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:["Printers Total: ",y]}),e.jsx("button",{onClick:()=>x(!m),className:"p-1 hover:bg-gray-100 rounded transition-colors",children:m?e.jsx(L,{className:"h-4 w-4"}):e.jsx(E,{className:"h-4 w-4"})})]})}),!m&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mt-3",children:p.map(l=>e.jsx(V,{className:"border-0 shadow-none",children:e.jsx(X,{className:"p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[l.icon,e.jsx("span",{className:"text-xs font-medium capitalize",children:l.status})]}),e.jsx(Q,{variant:"outline",className:`text-xs ${l.color}`,children:l.count})]})})},l.status))})]})},me=({isOpen:o,onClose:d,onClientSelected:p,title:w="Select a Client",description:y="Choose a client to view their details."})=>{const[h,m]=n.useState(""),{clients:x,loading:g}=Y(),{user:i,userProfile:s}=D(),l=n.useRef(null),u=n.useRef(null),{toast:b}=U(),[j,c]=n.useState(!1),[r,f]=n.useState({name:"",contact_email:"",address:"",phone:""}),[v,k]=n.useState(!1),N=n.useRef(null),{data:A,isLoading:I}=R({queryKey:["client-access",i==null?void 0:i.id],queryFn:async()=>{if(!(i!=null&&i.id)||(s==null?void 0:s.role)!=="client")return[];const{data:t,error:a}=await T.from("client_access").select("client_id").eq("user_id",i.id);if(a)throw console.error("Error fetching client access:",a),a;return!t||!Array.isArray(t)?[]:t.map(K=>K.client_id)},enabled:!!(i!=null&&i.id)&&(s==null?void 0:s.role)==="client"}),z=(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="sales_admin"||(s==null?void 0:s.role)==="superadmin"?x:(s==null?void 0:s.role)==="client"&&A?x.filter(t=>A.includes(t.id)):x,B=g||(s==null?void 0:s.role)==="client"&&I;n.useEffect(()=>{if(o&&l.current){const t=l.current.querySelector("input");t&&t.focus()}},[o]),n.useEffect(()=>{o&&N.current&&N.current.blur()},[o]),n.useEffect(()=>{if(!o)return;const t=a=>{a.key==="Escape"&&d()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[o,d]);const F=async t=>{if(t.preventDefault(),!r.name.trim()||!r.contact_email.trim()||!r.address.trim()||!r.phone.trim()){b({title:"All fields required",description:"Please fill in Company Name, Email, Address, and Phone.",variant:"destructive"});return}k(!0);try{await Z.createClient({name:r.name.trim(),contact_email:r.contact_email.trim(),address:r.address.trim(),phone:r.phone.trim()}),b({title:"Client added",description:"Client was added successfully."}),c(!1),f({name:"",contact_email:"",address:"",phone:""}),window.location.reload()}catch(a){b({title:"Error",description:a.message||"Failed to add client",variant:"destructive"})}finally{k(!1)}},S=z.filter(t=>{var a;return t.name.toLowerCase().includes(h.toLowerCase())||((a=t.contact_email)==null?void 0:a.toLowerCase().includes(h.toLowerCase()))});return o?e.jsx("div",{className:"fixed inset-0 z-[10001] flex flex-col bg-white",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},role:"dialog","aria-modal":"true","aria-labelledby":"client-list-modal-title","aria-describedby":"client-list-modal-desc",children:e.jsxs("div",{ref:l,className:"relative flex flex-col h-full w-full bg-white animate-in slide-in-from-bottom-4 duration-300",children:[e.jsxs("div",{className:"sticky top-0 z-20 bg-blue-50/95 backdrop-blur-sm border-b border-blue-200 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{id:"client-list-modal-title",className:"text-lg font-semibold text-gray-900 truncate",children:w}),e.jsx("p",{id:"client-list-modal-desc",className:"text-xs text-gray-600 truncate",children:y})]})]}),e.jsx("button",{onClick:d,className:"p-2 rounded-full hover:bg-blue-100 transition-colors flex-shrink-0 touch-target","aria-label":"Close",children:e.jsx(G,{className:"h-5 w-5 text-blue-600"})})]}),e.jsxs("div",{className:"relative mt-3",children:[e.jsx("div",{tabIndex:0,"aria-hidden":"true",style:{width:0,height:0,overflow:"hidden"}}),e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{ref:N,type:"text",value:h,onChange:t=>m(t.target.value),className:"w-full pl-10 pr-4 h-10 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white",placeholder:"Search clients...","aria-label":"Search clients"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-2",children:B?e.jsx(M,{message:"Loading clients"}):S.length>0?e.jsx("div",{className:"space-y-2",children:S.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-all duration-200 border-gray-200 hover:border-blue-400 hover:bg-blue-50/50 bg-white active:scale-[0.98] touch-target",onClick:()=>{p(t),d()},tabIndex:0,role:"button","aria-label":`Select client ${t.name}`,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(p(t),d())},children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(C,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate text-sm",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[t.contact_email&&`${t.contact_email}`,t.phone&&t.contact_email&&" â€¢ ",t.phone&&`${t.phone}`]})]})]},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-sm",children:h?"No clients match your search":(s==null?void 0:s.role)==="client"?"No clients assigned to you":"No clients available"})]})}),e.jsxs("div",{className:"sticky bottom-0 bg-white/95 backdrop-blur-sm border-t border-gray-200 p-4 space-y-2",children:[(s==null?void 0:s.role)!=="client"&&e.jsx("button",{className:"w-full h-12 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium text-sm transition-all duration-200 active:scale-[0.98] touch-target",onClick:()=>c(!0),"aria-label":"Add Client",children:"Add Client"}),e.jsx("button",{ref:u,className:"w-full h-12 rounded-lg bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-gray-700 font-medium text-sm transition-all duration-200 active:scale-[0.98] touch-target",onClick:d,"aria-label":"Cancel",children:"Cancel"})]}),j&&e.jsx("div",{className:"fixed inset-0 z-[10002] flex items-center justify-center bg-black/40",children:e.jsxs("form",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-sm mx-auto space-y-4",onSubmit:F,children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Add New Client"}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2",placeholder:"Company Name*",value:r.name,onChange:t=>f(a=>({...a,name:t.target.value})),required:!0,autoFocus:!0}),e.jsx("input",{type:"email",className:"w-full border rounded px-3 py-2",placeholder:"Email*",value:r.contact_email,onChange:t=>f(a=>({...a,contact_email:t.target.value})),required:!0}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2",placeholder:"Address*",value:r.address,onChange:t=>f(a=>({...a,address:t.target.value})),required:!0}),e.jsx("input",{type:"tel",className:"w-full border rounded px-3 py-2",placeholder:"Phone*",value:r.phone,onChange:t=>f(a=>({...a,phone:t.target.value})),required:!0}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"flex-1 h-10 rounded bg-gray-100 hover:bg-gray-200 text-gray-700",onClick:()=>c(!1),disabled:v,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 h-10 rounded bg-blue-600 hover:bg-blue-700 text-white",disabled:v,children:v?"Adding...":"Add"})]})]})})]})}):null};export{me as C,de as D};
//# sourceMappingURL=ClientListModal-BmJzvTJR.js.map

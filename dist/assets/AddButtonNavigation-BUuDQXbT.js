var Je=Object.defineProperty;var Ze=(t,s,a)=>s in t?Je(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var be=(t,s,a)=>Ze(t,typeof s!="symbol"?s+"":s,a);import{c as de,Q as et,r as x,V as tt,W as st,j as e,Y as $e,Z as rt,$ as at,a0 as nt,l as Ee,s as u,u as He,X as xe,S as ie,q as le,v as oe,w as ce,x as q,P as ve,B as F,F as Ne,b as Ke,z as it,a as lt,E as Ie,R as je,C as ot,A as ct,N as dt,U as mt}from"./index-FgfazPn4.js";import{I as ne}from"./input-Cc5DIsqr.js";import{L as P,C as ut,T as pt}from"./label-C7AHjZf1.js";import{C as Qe,S as Me}from"./checkbox-De7F5xfH.js";import{a as _e,c as qe}from"./clientService-scOH6ADK.js";import{U as ht}from"./upload-BCc2dJv1.js";import{S as xt,C as Re}from"./alert-dialog-a1roshmq.js";import{B as $}from"./badge-PQ_Xgg0c.js";import{C as gt,a as ft}from"./card-S-815Fh1.js";import{P as ee}from"./printer-X5np4qGe.js";import{S as Ue,B as yt}from"./settings-T9C6ttIn.js";import{P as he,U as Fe,D as bt}from"./users-7LwHL_dG.js";import{C as vt}from"./circle-alert-YIDi-HZf.js";import{A as jt,m as _t}from"./ProductDetailsModal-BJyiyVc3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=de("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=de("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=de("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=de("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=de("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);var Pe="Switch",[Nt,Zt]=et(Pe),[Ct,Pt]=Nt(Pe),Ve=x.forwardRef((t,s)=>{const{__scopeSwitch:a,name:r,checked:f,defaultChecked:y,required:b,disabled:j,value:h="on",onCheckedChange:k,form:d,...l}=t,[g,v]=x.useState(null),K=tt(s,T=>v(T)),E=x.useRef(!1),z=g?d||!!g.closest("form"):!0,[D=!1,N]=st({prop:f,defaultProp:y,onChange:k});return e.jsxs(Ct,{scope:a,checked:D,disabled:j,children:[e.jsx($e.button,{type:"button",role:"switch","aria-checked":D,"aria-required":b,"data-state":Ye(D),"data-disabled":j?"":void 0,disabled:j,value:h,...l,ref:K,onClick:rt(t.onClick,T=>{N(M=>!M),z&&(E.current=T.isPropagationStopped(),E.current||T.stopPropagation())})}),z&&e.jsx(kt,{control:g,bubbles:!E.current,name:r,value:h,checked:D,required:b,disabled:j,form:d,style:{transform:"translateX(-100%)"}})]})});Ve.displayName=Pe;var We="SwitchThumb",Ge=x.forwardRef((t,s)=>{const{__scopeSwitch:a,...r}=t,f=Pt(We,a);return e.jsx($e.span,{"data-state":Ye(f.checked),"data-disabled":f.disabled?"":void 0,...r,ref:s})});Ge.displayName=We;var kt=t=>{const{control:s,checked:a,bubbles:r=!0,...f}=t,y=x.useRef(null),b=at(a),j=nt(s);return x.useEffect(()=>{const h=y.current,k=window.HTMLInputElement.prototype,l=Object.getOwnPropertyDescriptor(k,"checked").set;if(b!==a&&l){const g=new Event("click",{bubbles:r});l.call(h,a),h.dispatchEvent(g)}},[b,a,r]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...f,tabIndex:-1,ref:y,style:{...t.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Ye(t){return t?"checked":"unchecked"}var Xe=Ve,St=Ge;const H=x.forwardRef(({className:t,...s},a)=>e.jsx(Xe,{className:Ee("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 bg-gray-300",t),...s,ref:a,children:e.jsx(St,{className:Ee("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));H.displayName=Xe.displayName;const es={async getPrinters(){const{data:t,error:s}=await u.from("printers").select("*").order("created_at",{ascending:!1});if(s)throw s;return t||[]},async createPrinter(t){const{data:s,error:a}=await u.from("printers").insert(t).select().single();if(a)throw a;return s},async updatePrinter(t,s){const{data:a,error:r}=await u.from("printers").update(s).eq("id",t).select().single();if(r)throw r;return a},async deletePrinter(t){const{error:s}=await u.from("printers").delete().eq("id",t);if(s)throw s},async createAssignment(t){const{data:s,error:a}=await u.from("printer_assignments").insert({printer_id:t.printer_id,client_id:t.client_id,serial_number:t.serial_number,department:t.department,department_location_id:null,deployment_date:t.deployment_date,usage_type:t.usage_type,monthly_price:t.monthly_price,has_security_deposit:t.has_security_deposit,security_deposit_amount:t.security_deposit_amount,notes:t.notes,status:"available"}).select(`
        *,
        printer:printers(*),
        client:clients(*)
      `).single();if(a)throw a;return s},async updateAssignment(t,s){const{data:a,error:r}=await u.from("printer_assignments").update(s).eq("id",t).select(`
        *,
        printer:printers(*),
        client:clients(*)
      `).single();if(r)throw r;return a},async deleteAssignment(t){try{console.log(`Attempting to delete assignment: ${t}`);const{data:s,error:a}=await u.from("printer_assignments").select("id").eq("id",t).single();if(a||!s)throw new Error("Assignment not found");console.log("Disabling triggers to prevent foreign key constraint violations...");const{error:r}=await u.rpc("disable_printer_assignment_history_trigger");r&&console.warn("Could not disable trigger, proceeding anyway:",r),console.log("Deleting all references to assignment...");const{error:f}=await u.from("printer_assignment_history").delete().eq("printer_assignment_id",t);f&&console.warn("Could not delete history records:",f);const{error:y}=await u.from("maintenance_history").delete().eq("assignment_id",t);y&&console.warn("Could not delete maintenance records:",y);const{error:b}=await u.from("printer_status").delete().eq("assignment_id",t);b&&console.warn("Could not delete status records:",b);const{error:j}=await u.from("usage_logs").delete().eq("assignment_id",t);j&&console.warn("Could not delete usage records:",j),console.log("Deleting assignment...");const{error:h}=await u.from("printer_assignments").delete().eq("id",t);if(h)throw console.error("Final delete failed:",h),new Error(`Failed to delete assignment: ${h.message}`);console.log("Re-enabling triggers...");const{error:k}=await u.rpc("enable_printer_assignment_history_trigger");k&&console.warn("Could not re-enable trigger:",k),console.log("Assignment deletion completed successfully")}catch(s){console.error("Error in deleteAssignment:",s);try{console.log("Re-enabling triggers after error..."),await u.rpc("enable_printer_assignment_history_trigger")}catch(a){console.error("Failed to re-enable trigger:",a)}throw s}},async getAllAssignments(){const{data:t,error:s}=await u.from("printer_assignments").select(`
        *,
        printer:printers(*),
        client:clients(*)
      `).order("created_at",{ascending:!1});if(s)throw s;return t||[]},async getAssignmentById(t){const{data:s,error:a}=await u.from("printer_assignments").select(`
        *,
        printer:printers(*),
        client:clients(*)
      `).eq("id",t).single();if(a)throw a;return s},async getAssignmentsByClient(t){const{data:s,error:a}=await u.from("printer_assignments").select(`
        *,
        printer:printers(*),
        client:clients(*)
      `).eq("client_id",t).order("created_at",{ascending:!1});if(a)throw a;return s||[]},async getClientInactiveAssignments(t){const{data:s,error:a}=await u.from("printer_assignments").select(`
        *,
        printer:printers(*),
        departments_location(
          id,
          name,
          department:departments(id, name)
        )
      `).eq("client_id",t).eq("status","inactive");if(a)throw a;return(s||[]).map(r=>({...r,status:r.status}))},async getClientPrinterPool(t){const{data:s,error:a}=await u.from("printer_assignments").select(`
        *,
        printer:printers(*),
        client:clients(*)
      `).eq("client_id",t).eq("status","undeployed").order("created_at",{ascending:!1});if(a)throw a;return s||[]},async deployPrinterFromPool(t,s){const{data:a,error:r}=await u.from("printer_assignments").update({department_location_id:s,status:"active",deployment_date:new Date().toISOString().split("T")[0]}).eq("id",t).select(`
        *,
        printer:printers(*),
        client:clients(*)
      `).single();if(r)throw r;return a},async getAvailablePrinters(){const{data:t,error:s}=await u.from("printers").select("*").eq("is_available",!0).order("created_at",{ascending:!1});if(s)throw s;return t||[]},async searchAssignments(t){const{data:s,error:a}=await u.from("printer_assignments").select(`
        *,
        printer:printers(*),
        client:clients(*)
      `).or(`serial_number.ilike.%${t}%,notes.ilike.%${t}%`).order("created_at",{ascending:!1});if(a)throw a;return s||[]},async getMaintenanceSchedule(t){const{data:s,error:a}=await u.from("maintenance_schedules").select("*").eq("printer_id",t).order("scheduled_date",{ascending:!0});if(a)throw a;return(s||[]).map(r=>({...r,status:r.status}))},async createMaintenanceSchedule(t){const{data:s,error:a}=await u.from("maintenance_schedules").insert(t).select().single();if(a)throw a;return{...s,status:s.status}},async updateMaintenanceSchedule(t,s){const{data:a,error:r}=await u.from("maintenance_schedules").update(s).eq("id",t).select().single();if(r)throw r;return{...a,status:a.status}},async getMaintenanceHistory(t){const{data:s,error:a}=await u.from("maintenance_history").select("*").eq("printer_id",t).order("performed_at",{ascending:!1});if(a)throw a;return s||[]},async addMaintenanceHistoryEntry(t){const{data:s,error:a}=await u.from("maintenance_history").insert(t).select().single();if(a)throw a;return s},async updateMaintenanceHistoryEntry(t,s){const{data:a,error:r}=await u.from("maintenance_history").update(s).eq("id",t).select().single();if(r)throw r;return a},async getPrinterHistory(t){const{data:s,error:a}=await u.from("printer_history").select("*").eq("printer_id",t).order("timestamp",{ascending:!1});if(a)throw a;return(s||[]).map(r=>({...r,action_type:r.action_type}))},async addPrinterHistoryEntry(t){const{data:s,error:a}=await u.from("printer_history").insert(t).select().single();if(a)throw a;return{...s,action_type:s.action_type}},async getPrinterDocuments(t){const{data:s,error:a}=await u.from("printer_documents").select("*").eq("printer_id",t).order("uploaded_at",{ascending:!1});if(a)throw a;return(s||[]).map(r=>({...r,document_type:r.document_type}))},async uploadPrinterDocument(t){const{data:s,error:a}=await u.from("printer_documents").insert(t).select().single();if(a)throw a;return{...s,document_type:s.document_type}},async deletePrinterDocument(t){const{error:s}=await u.from("printer_documents").delete().eq("id",t);if(s)throw s},async makePrinterAvailable(t){const{error:s}=await u.from("printer_assignments").update({status:"available",client_id:null,department_location_id:null}).eq("id",t);if(s)throw s},async deleteDepartment(t){const{error:s}=await u.from("departments").delete().eq("id",t);if(s)throw s}},S=[];for(let t=0;t<256;++t)S.push((t+256).toString(16).slice(1));function At(t,s=0){return(S[t[s+0]]+S[t[s+1]]+S[t[s+2]]+S[t[s+3]]+"-"+S[t[s+4]]+S[t[s+5]]+"-"+S[t[s+6]]+S[t[s+7]]+"-"+S[t[s+8]]+S[t[s+9]]+"-"+S[t[s+10]]+S[t[s+11]]+S[t[s+12]]+S[t[s+13]]+S[t[s+14]]+S[t[s+15]]).toLowerCase()}let we;const Dt=new Uint8Array(16);function Lt(){if(!we){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");we=crypto.getRandomValues.bind(crypto)}return we(Dt)}const Tt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Be={randomUUID:Tt};function Et(t,s,a){var f;if(Be.randomUUID&&!s&&!t)return Be.randomUUID();t=t||{};const r=t.random??((f=t.rng)==null?void 0:f.call(t))??Lt();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,At(r)}const ts={CLIENT:"client",SUPPLIERS:"suppliers",PRINTERS:"printers",PRODUCT:"product"},ss={CLIENT_NOT_FOUND:"Client not found or you do not have permission to view it.",GENERIC_ERROR:"An error occurred. Please try again."},rs=({isOpen:t,onClose:s,onPrinterAdded:a})=>{const{toast:r}=He(),[f,y]=x.useState(!1),[b,j]=x.useState(null),[h,k]=x.useState(null),[d,l]=x.useState(""),[g,v]=x.useState(null),[K,E]=x.useState(!1),[z,D]=x.useState(""),[N,T]=x.useState(!1),[M,O]=x.useState(""),[c,A]=x.useState([]),I=["HP","Brother","Samsung","Canon","Epson","Xerox","Lexmark","Dell","Ricoh","Kyocera"],me=["A4","A3","A5","Letter","Legal","Executive","Folio"],[m,Q]=x.useState({manufacturer:"",model:"",series:"",color:"",printer_type:"Print Only",technology_type:"laser",image_url:"",is_available:!0,supported_paper_sizes:"A4, Letter, Legal, Folio",connectivity_usb:!0,connectivity_wifi:!1,connectivity_wifi_direct:!1,connectivity_ethernet:!1}),B=(()=>{const n=[];return m.manufacturer&&n.push(m.manufacturer),m.series&&n.push(m.series),m.model&&n.push(m.model),n.join(" ")||"New Printer"})(),Y=m.supported_paper_sizes?m.supported_paper_sizes.split(",").map(n=>n.trim()).filter(n=>n):[],ge=n=>/\b(DCP|MFC)\b/i.test(n);x.useEffect(()=>{m.series&&(ge(m.series)?Q(n=>({...n,printer_type:"Multifunction",technology_type:"multifunction"})):Q(n=>({...n,printer_type:"Print Only",technology_type:"laser"})))},[m.series]);const ue=(n,w)=>{let C=[...Y];w?C.includes(n)||C.push(n):C=C.filter(W=>W!==n);const V=C.join(", ");_("supported_paper_sizes",V)};x.useEffect(()=>{t&&X()},[t]);const X=async n=>{try{const w=await _e.getUniqueSeries(n);A(w.filter(C=>C&&C.trim()!==""))}catch(w){console.error("Error fetching series options:",w),A([])}},_=(n,w)=>{Q(C=>({...C,[n]:w}))},pe=n=>{n==="custom"?(E(!0),D(""),_("manufacturer",""),A([]),_("series","")):(E(!1),D(""),_("manufacturer",n),X(n),_("series",""))},se=n=>{D(n),_("manufacturer",n),n&&n.trim()!==""?X(n.trim()):A([]),_("series","")},fe=n=>{n==="custom"?(T(!0),O(""),_("series","")):(T(!1),O(""),_("series",n))},ye=n=>{O(n),_("series",n)},re=n=>{j(n),n==="colored"?_("color","CYMK"):n==="monochrome"&&_("color","Monochrome")},i=n=>{var C;const w=(C=n.target.files)==null?void 0:C[0];if(w){if(!w.type.startsWith("image/")){r({title:"Invalid File",description:"Please select an image file (PNG, JPG, JPEG, GIF)",variant:"destructive"});return}if(w.size>5*1024*1024){r({title:"File Too Large",description:"Please select an image smaller than 5MB",variant:"destructive"});return}k(w),v(null);const V=URL.createObjectURL(w);l(V),_("image_url","")}},o=async n=>{try{const w=n.name.split(".").pop(),C=`${Et()}.${w}`,{data:V,error:W}=await u.storage.from("printer-images").upload(C,n,{cacheControl:"3600",upsert:!1,contentType:n.type});if(W)throw new Error(`Image upload failed: ${W.message}`);const{data:J}=u.storage.from("printer-images").getPublicUrl(C);return(J==null?void 0:J.publicUrl)||null}catch(w){throw console.error("Error uploading image:",w),w}},p=()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d),k(null),l(""),_("image_url",""),v(null)},ae=async n=>{var w,C,V,W,J,Se,Ae,De,Le,Te;if(n.preventDefault(),!((w=m.manufacturer)!=null&&w.trim())){r({title:"Error",description:"Please select a manufacturer",variant:"destructive"});return}if(!((C=m.model)!=null&&C.trim())){r({title:"Error",description:"Please enter a model",variant:"destructive"});return}y(!0),v(null);try{let L=m.image_url;if(h)try{L=await o(h),L&&r({title:"Image Uploaded",description:"Image uploaded successfully"})}catch(U){v(`Image upload failed: ${U.message}`),r({title:"Upload Failed",description:U.message||"Failed to upload image",variant:"destructive"}),y(!1);return}const R={name:B,manufacturer:m.manufacturer||null,model:m.model||null,series:m.series||null,color:m.color||null,printer_type:m.printer_type||null,description:null,image_url:L||null,rental_status:null,rental_price_per_month:null,rental_start_date:null,rental_end_date:null,rental_eligible:!1,rental_price_type:null,rental_price_per_print:null,purchase_price:null,status:"active",is_available:m.is_available,aliases:null,location_count:null,automatic_duplex:null,connectivity_usb:m.connectivity_usb,connectivity_wifi:m.connectivity_wifi,connectivity_wifi_direct:m.connectivity_wifi_direct,connectivity_ethernet:m.connectivity_ethernet,connectivity_bluetooth:!1,connectivity_nfc:!1,cloud_printing_support:null,driver_download_url:null,software_download_url:null,user_manual_url:null,supported_os:null,print_resolution:null,print_speed_bw:null,print_speed_color:null,first_page_out_time:null,input_tray_capacity:null,output_tray_capacity:null,supported_paper_sizes:m.supported_paper_sizes||null,supported_paper_types:null},Z=await _e.createPrinter(R);await _e.createPrinterAssignment({printer_id:Z.id,client_id:null,serial_number:null,usage_type:"service_unit",status:"available",deployment_date:null,department_location_id:null,is_client_owned:!1}),r({title:"Success",description:"Printer added to catalog and inventory successfully"}),a(),s(),d&&d.startsWith("blob:")&&URL.revokeObjectURL(d),Q({manufacturer:"",model:"",series:"",color:"",printer_type:"Print Only",technology_type:"laser",image_url:"",is_available:!0,supported_paper_sizes:"A4, Letter, Legal, Folio",connectivity_usb:!0,connectivity_wifi:!1,connectivity_wifi_direct:!1,connectivity_ethernet:!1}),E(!1),D(""),T(!1),O(""),j(null),k(null),l(""),v(null)}catch(L){console.error("Error adding printer:",L);let R="Failed to add printer. Please try again.",Z="Error";if(L.code==="23505"||(V=L.message)!=null&&V.toLowerCase().includes("duplicate key")||(W=L.message)!=null&&W.toLowerCase().includes("unique constraint")||(J=L.message)!=null&&J.toLowerCase().includes("already exists")){Z="Duplicate Printer";const U=(L.message||"").toLowerCase();U.includes("unique_printer_name")||U.includes("name")&&U.includes("duplicate")?R=`A printer named "${B}" already exists. Please choose different values.`:U.includes("unique_printer_model")||U.includes("model")&&U.includes("duplicate")?R=`A printer with model "${((Se=m.model)==null?void 0:Se.trim())||""}" already exists. Please choose a different model.`:R="A printer with the same name or model already exists. Please use different values."}else(Ae=L.message)!=null&&Ae.includes("permission denied")||(De=L.message)!=null&&De.includes("unauthorized")?(Z="Permission Error",R="You do not have permission to add printers. Please contact your administrator."):((Le=L.message)!=null&&Le.includes("network")||(Te=L.message)!=null&&Te.includes("fetch"))&&(Z="Connection Error",R="Network error occurred. Please check your connection and try again.");v(R),r({title:Z,description:R,variant:"destructive"})}finally{y(!1)}},ke=()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d),s()};return x.useEffect(()=>()=>{d&&d.startsWith("blob:")&&URL.revokeObjectURL(d)},[d]),t?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white w-full h-full sm:h-auto sm:max-h-[95vh] sm:max-w-lg sm:rounded-2xl sm:shadow-2xl flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-100 sm:rounded-t-2xl",children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("button",{onClick:ke,className:"absolute right-4 top-4 p-1.5 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-100",children:e.jsx(xe,{className:"h-5 w-5"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-1",children:B}),e.jsx("p",{className:"text-sm text-gray-500",children:B==="New Printer"?"Enter details to generate printer name":"Auto-generated from manufacturer, series & model"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:ae,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-900",children:"Printer Image"}),e.jsxs("div",{className:"flex items-center gap-3",children:[d||m.image_url?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:d||m.image_url,alt:"Printer Preview",className:"w-20 h-20 object-cover rounded-lg border border-gray-200",onError:n=>{n.currentTarget.style.display="none"}}),e.jsx("button",{type:"button",className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-0.5 hover:bg-red-600 transition-colors",onClick:p,title:"Remove image",children:e.jsx(xe,{className:"h-3 w-3"})}),h&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-blue-600 bg-opacity-90 text-white text-xs px-1 py-0.5 rounded-b-lg text-center",children:"Preview"})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center w-20 h-20 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[e.jsx(ht,{className:"h-5 w-5 text-gray-400 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Upload"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:i,disabled:f})]}),e.jsx("div",{className:"flex-1",children:e.jsx(ne,{value:m.image_url,onChange:n=>{_("image_url",n.target.value),n.target.value&&h&&(d&&d.startsWith("blob:")&&URL.revokeObjectURL(d),k(null),l(""))},placeholder:"Or paste image URL...",className:"h-11",disabled:!!h||f})})]}),h&&e.jsxs("div",{className:"text-xs text-blue-600 bg-blue-50 p-2 rounded",children:["ðŸ“ ",h.name," (",(h.size/1024/1024).toFixed(2)," MB) - Will upload when printer is saved"]}),g&&e.jsx("div",{className:"text-red-500 text-sm",children:g})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"model",className:"text-sm font-medium text-gray-900",children:"Model *"}),e.jsx(ne,{id:"model",value:m.model,onChange:n=>_("model",n.target.value),required:!0,className:"h-11",placeholder:"e.g., M404dn, P1006, TS3520"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enter only the model number (e.g., M404dn, P1006) without manufacturer or series"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"manufacturer",className:"text-sm font-medium text-gray-900",children:"Manufacturer *"}),K?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{value:z,onChange:n=>se(n.target.value),className:"h-11",placeholder:"Enter custom manufacturer",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{type:"button",variant:"outline",size:"sm",onClick:()=>{E(!1),D(""),_("manufacturer","")},children:"Cancel"}),e.jsxs(F,{type:"button",size:"sm",onClick:()=>{z.trim()&&E(!1)},disabled:!z.trim(),children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"Confirm"]})]})]}):e.jsxs(ie,{value:m.manufacturer,onValueChange:pe,children:[e.jsx(le,{className:"h-11",children:e.jsx(oe,{placeholder:"Select manufacturer..."})}),e.jsxs(ce,{children:[I.map(n=>e.jsx(q,{value:n,children:n},n)),e.jsx(q,{value:"custom",className:"border-t mt-1 pt-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-3 w-3 mr-2"}),"Add Custom Manufacturer"]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"series",className:"text-sm font-medium text-gray-900",children:"Series"}),N?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{value:M,onChange:n=>ye(n.target.value),className:"h-11",placeholder:`Enter series for ${m.manufacturer}`,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{type:"button",variant:"outline",size:"sm",onClick:()=>{T(!1),O(""),_("series","")},children:"Cancel"}),e.jsxs(F,{type:"button",size:"sm",onClick:()=>{M.trim()&&T(!1)},disabled:!M.trim(),children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"Confirm"]})]})]}):e.jsxs(ie,{value:m.series,onValueChange:fe,disabled:!m.manufacturer,children:[e.jsx(le,{className:"h-11",children:e.jsx(oe,{placeholder:m.manufacturer?c.length===0?"No series found":"Select series...":"Select manufacturer first..."})}),e.jsx(ce,{children:c.length>0?e.jsxs(e.Fragment,{children:[c.map(n=>e.jsx(q,{value:n,children:n},n)),e.jsx(q,{value:"custom",className:"border-t mt-1 pt-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-3 w-3 mr-2"}),"Add Custom Series"]})})]}):m.manufacturer?e.jsx(q,{value:"custom",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-3 w-3 mr-2"}),"Add New Series for ",m.manufacturer]})}):null})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-900",children:"Color Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"colorType",checked:b==="colored",onChange:()=>re("colored"),className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Colored (CYMK)"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"colorType",checked:b==="monochrome",onChange:()=>re("monochrome"),className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-sm",children:"Monochrome"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-900",children:"Connectivity Options"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-2 border rounded-lg hover:bg-gray-50",children:[e.jsx("span",{className:"text-sm",children:"USB"}),e.jsx(H,{checked:m.connectivity_usb||!1,onCheckedChange:n=>_("connectivity_usb",n),className:"data-[state=checked]:bg-green-500 data-[state=checked]:border-green-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-2 border rounded-lg hover:bg-gray-50",children:[e.jsx("span",{className:"text-sm",children:"Wi-Fi"}),e.jsx(H,{checked:m.connectivity_wifi||!1,onCheckedChange:n=>_("connectivity_wifi",n),className:"data-[state=checked]:bg-green-500 data-[state=checked]:border-green-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-2 border rounded-lg hover:bg-gray-50",children:[e.jsx("span",{className:"text-sm",children:"Wi-Fi Direct"}),e.jsx(H,{checked:m.connectivity_wifi_direct||!1,onCheckedChange:n=>_("connectivity_wifi_direct",n),className:"data-[state=checked]:bg-green-500 data-[state=checked]:border-green-500"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-2 border rounded-lg hover:bg-gray-50",children:[e.jsx("span",{className:"text-sm",children:"Ethernet"}),e.jsx(H,{checked:m.connectivity_ethernet||!1,onCheckedChange:n=>_("connectivity_ethernet",n),className:"data-[state=checked]:bg-green-500 data-[state=checked]:border-green-500"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium text-gray-900",children:"Supported Paper Sizes"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:me.map(n=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-2 border rounded-lg hover:bg-gray-50",children:[e.jsx(Qe,{id:`paper-${n}`,checked:Y.includes(n),onCheckedChange:w=>ue(n,w)}),e.jsx("span",{className:"text-sm",children:n})]},n))}),Y.length>0&&e.jsxs("div",{className:"text-xs text-blue-600 bg-blue-50 p-2 rounded",children:["Selected: ",Y.join(", ")]})]})]})}),e.jsx("div",{className:"sticky bottom-0 z-10 bg-white border-t border-gray-100 sm:rounded-b-2xl",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{type:"button",variant:"outline",onClick:ke,disabled:f,className:"flex-1 h-11",children:"Cancel"}),e.jsx(F,{onClick:ae,disabled:f||!m.manufacturer||!m.model,className:"flex-1 h-11 bg-blue-600 hover:bg-blue-700 text-white",children:f?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),h?"Uploading & Adding...":"Adding..."]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Add Printer"]})})]})})})]})}):null},G=class G{constructor(){be(this,"normalizedData",{printers:{},assignments:{},clients:{},departmentLocations:{},lastUpdated:0})}static getInstance(){return G.instance||(G.instance=new G),G.instance}normalizeAssignmentData(s){const a={printers:{},assignments:{},clients:{},departmentLocations:{},lastUpdated:Date.now()};return s.forEach(r=>{r.printer&&(a.printers[r.printer.id]={id:r.printer.id,name:r.printer.name,manufacturer:r.printer.manufacturer,model:r.printer.model,series:r.printer.series,color:r.printer.color,image_url:r.printer.image_url,rental_eligible:r.printer.rental_eligible,status:r.printer.status}),a.assignments[r.id]={id:r.id,printer_id:r.printer_id,serial_number:r.serial_number,usage_type:r.usage_type,status:r.status,client_id:r.client_id,department_location_id:r.department_location_id,assignment_effective_date:r.assignment_effective_date,condition:r.condition,reason_for_change:r.reason_for_change,notes:r.notes,created_at:r.created_at,updated_at:r.updated_at,is_client_owned:r.is_client_owned},r.clients&&(a.clients[r.clients.id]={id:r.clients.id,name:r.clients.name}),r.departments_location&&(a.departmentLocations[r.departments_location.id]={id:r.departments_location.id,name:r.departments_location.name,department:r.departments_location.department})}),a}cacheNormalizedData(s){this.normalizedData=s}getCachedNormalizedData(){return this.normalizedData.lastUpdated>0?this.normalizedData:null}denormalizePrinterData(s){const a=this.getCachedNormalizedData();if(!a)return[];const{printers:r,assignments:f,clients:y,departmentLocations:b}=a;switch(s){case"assigned":const h=Object.values(f).filter(l=>(l.status==="active"||l.status==="inactive"||l.status==="undeployed")&&l.client_id!==null&&l.client_id!==void 0).reduce((l,g)=>{const v=r[g.printer_id];return v&&(l[v.id]||(l[v.id]={printer:v,assignments:[],count:0}),l[v.id].assignments.push({...g,clients:g.client_id?y[g.client_id]:null,departments_location:g.department_location_id?b[g.department_location_id]:null}),l[v.id].count++),l},{});return Object.values(h).map(l=>({...l.printer,printer_assignments:l.assignments,assigned_count:l.count}));case"available":const d=Object.values(f).filter(l=>l.client_id==null||l.client_id==="").reduce((l,g)=>{const v=r[g.printer_id];return v&&(l[v.id]||(l[v.id]={printer:v,assignments:[],count:0}),l[v.id].assignments.push({...g,clients:g.client_id?y[g.client_id]:null,departments_location:g.department_location_id?b[g.department_location_id]:null}),l[v.id].count++),l},{});return Object.values(d).map(l=>({...l.printer,printer_assignments:l.assignments,available_count:l.count}));case"inventory":return Object.values(f).map(l=>({...l,printer:r[l.printer_id],clients:l.client_id?y[l.client_id]:null,departments_location:l.department_location_id?b[l.department_location_id]:null}));case"catalog":return Object.values(r);default:return[]}}async preloadTabData(s){const a=this.getPredictedTabs(s);for(const r of a)try{await this.prefetchTabData(r)}catch(f){console.warn(`Failed to preload data for tab ${r}:`,f)}}getPredictedTabs(s){return{assigned:["available","all"],available:["assigned","catalog"],catalog:["available","assigned"],all:["assigned","available"]}[s]||[]}async prefetchTabData(s){switch(this.getCachedNormalizedData(),s){case"assigned":case"available":case"all":await this.prefetchAssignmentData();break;case"catalog":await this.prefetchCatalogData();break}}async prefetchAssignmentData(){const{data:s}=await u.from("printer_assignments").select(`
        id,
        printer_id,
        serial_number,
        usage_type,
        status,
        client_id,
        department_location_id,
        assignment_effective_date,
        condition,
        reason_for_change,
        notes,
        created_at,
        updated_at,
        is_client_owned,
        printer:printers(
          id,
          name,
          manufacturer,
          model,
          series,
          color,
          image_url,
          rental_eligible,
          status
        ),
        clients(id, name),
        departments_location(
          id,
          name,
          department:departments(id, name)
        )
      `).neq("printer.status","deleted").order("printer(name)");if(s){const a=this.normalizeAssignmentData(s);this.cacheNormalizedData(a)}}async prefetchCatalogData(){const{data:s}=await u.from("printers").select(`
        id,
        name,
        manufacturer,
        model,
        series,
        color,
        image_url,
        rental_eligible,
        status
      `).neq("status","deleted").order("name");if(s){const a=this.getCachedNormalizedData()||{printers:{},assignments:{},clients:{},departmentLocations:{},lastUpdated:0};s.forEach(r=>{a.printers[r.id]=r}),a.lastUpdated=Date.now(),this.cacheNormalizedData(a)}}clearCache(){this.normalizedData={printers:{},assignments:{},clients:{},departmentLocations:{},lastUpdated:0}}};be(G,"instance");let Ce=G;const It=Ce.getInstance(),Mt=({isOpen:t,onClose:s,onAssigned:a,preSelectedClientId:r})=>{const f=Ke(),y=f.pathname.includes("/clients/"),b=r||(y?f.pathname.split("/clients/")[1]:null),j=it(),[h,k]=x.useState(1),[d,l]=x.useState(null),[g,v]=x.useState(""),[K,E]=x.useState([]),[z,D]=x.useState([]),[N,T]=x.useState(!1),[M,O]=x.useState(!1),[c,A]=x.useState({clientId:r||"",departmentLocationId:"",deploymentDate:"",assignToPool:!1,usageType:"service_unit",monthlyPrice:"",hasSecurityDeposit:!1,securityDepositAmount:"",notes:""}),[I,me]=x.useState(!1),[m,Q]=x.useState(!1),{toast:te}=He(),{userProfile:B}=lt(),{data:Y=[],isLoading:ge}=Ie({queryKey:["printer-assignments",N,M,b,y],queryFn:async()=>{let i=u.from("printer_assignments").select(`
          id,
          printer_id,
          serial_number,
          usage_type,
          status,
          client_id,
          department_location_id,
          printer:printers(
            id,
            name,
            manufacturer,
            model,
            series,
            color,
            image_url
          ),
          client:clients(
            id,
            name
          ),
          department_location:departments_location(
            id,
            name,
            department:departments(
              name
            )
          )
        `);N?y&&b&&!M?i=i.eq("client_id",b).in("status",["active","inactive","undeployed"]):y&&b&&M?i=i.neq("client_id",b).in("status",["active","undeployed"]):i=i.in("status",["active","undeployed"]):i=i.eq("status","available");const{data:o,error:p}=await i.order("printer(name)");if(p)throw p;return o},enabled:t&&h===1});Ie({queryKey:["clients"],queryFn:async()=>{const i=await qe.getClients();return E(i),i},enabled:t&&h===2}),je.useEffect(()=>{(async()=>{if(!c.clientId||c.assignToPool){D([]);return}Q(!0);try{const o=await qe.getDepartmentsByClient(c.clientId);D(o)}catch{D([])}Q(!1)})()},[c.clientId,c.assignToPool]),je.useEffect(()=>{if(t&&h===2){const i=new Date().toISOString().split("T")[0];A(o=>({...o,deploymentDate:i,clientId:r||""}))}},[t,h,r]);const ue=Y.filter(i=>{var o;return i.printer.name.toLowerCase().includes(g.toLowerCase())||i.printer.model&&i.printer.model.toLowerCase().includes(g.toLowerCase())||i.printer.manufacturer&&i.printer.manufacturer.toLowerCase().includes(g.toLowerCase())||i.serial_number.toLowerCase().includes(g.toLowerCase())||((o=i.client)==null?void 0:o.name)&&i.client.name.toLowerCase().includes(g.toLowerCase())}),X=je.useMemo(()=>{const i={};return ue.forEach(o=>{var ae;const p=((ae=o.client)==null?void 0:ae.name)||"Unassigned";i[p]||(i[p]=[]),i[p].push(o)}),i},[ue]),_=i=>{l(i),k(2)},pe=async i=>{if(i.preventDefault(),!d||!c.clientId||!c.deploymentDate){te({title:"Error",description:"Please fill in all required fields.",variant:"destructive"});return}if(!c.assignToPool&&!c.departmentLocationId){te({title:"Error",description:"Please select a department/location or choose to assign to client pool.",variant:"destructive"});return}me(!0);try{const o={client_id:c.clientId,deployment_date:c.deploymentDate,usage_type:c.usageType,monthly_price:c.usageType==="rental"&&c.monthlyPrice?parseFloat(c.monthlyPrice):null,has_security_deposit:c.hasSecurityDeposit,security_deposit_amount:c.hasSecurityDeposit&&c.securityDepositAmount?parseFloat(c.securityDepositAmount):null,notes:c.notes||null};c.assignToPool?(o.status="undeployed",o.department_location_id=null):(o.status="active",o.department_location_id=c.departmentLocationId);const{error:p}=await u.from("printer_assignments").update(o).eq("id",d.id);if(p)throw p;te({title:"Success",description:c.assignToPool?"Printer assigned to client pool successfully!":N?"Printer transferred successfully!":"Printer assigned to client successfully!"}),It.clearCache(),await j.invalidateQueries({queryKey:["all-assignments"]}),await j.invalidateQueries({queryKey:["available-assignments"]}),await j.invalidateQueries({queryKey:["assigned-assignments"]}),await j.invalidateQueries({queryKey:["optimized-printer-data"]}),await j.invalidateQueries({queryKey:["printer-assignments"]}),y&&b&&(await j.invalidateQueries({queryKey:["client-printer-assignments",b]}),await j.invalidateQueries({queryKey:["client-departments",b]})),window.dispatchEvent(new CustomEvent("refresh-printer-data")),a(),se()}catch(o){te({title:"Error",description:o.message||`Failed to ${N?"transfer":"assign"} printer.`,variant:"destructive"})}finally{me(!1)}},se=()=>{k(1),l(null),v(""),T(!1),O(!1),A({clientId:r||"",departmentLocationId:"",deploymentDate:"",assignToPool:!1,usageType:"service_unit",monthlyPrice:"",hasSecurityDeposit:!1,securityDepositAmount:"",notes:""}),s()},fe=()=>{k(1),l(null)},ye=i=>{const o=i.status,p=i.department_location_id;return o==="available"?e.jsx($,{variant:"secondary",className:"text-xs bg-green-100 text-green-700",children:"Available"}):o==="undeployed"?e.jsx($,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:"Pooled"}):o==="active"&&p?e.jsx($,{variant:"secondary",className:"text-xs bg-orange-100 text-orange-700",children:"Assigned"}):e.jsx($,{variant:"outline",className:"text-xs",children:o})},re=i=>i.department_location?`${i.department_location.department.name} - ${i.department_location.name}`:"No specific location";return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center z-50",children:e.jsxs("div",{className:"relative flex flex-col h-screen w-screen sm:h-auto sm:w-full sm:max-w-lg sm:rounded-2xl sm:shadow-2xl bg-white animate-in fade-in-0 slide-in-from-bottom-8",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 sm:rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2.5 rounded-xl",children:N?e.jsx(Oe,{className:"h-5 w-5 text-blue-600"}):e.jsx(ee,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:h===1?N?"Transfer Printer":"Select Printer":N?"Transfer to Client":"Assign to Client"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:h===1?N?"Choose a printer to transfer":"Choose an available printer":"Configure assignment details"})]})]}),e.jsx("button",{onClick:se,className:"p-2 -m-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-100",children:e.jsx(xe,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[h===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-indigo-50 p-4 rounded-xl border border-purple-100",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2 text-purple-600"}),"Operation Mode"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Oe,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"transferMode",className:"text-sm font-semibold text-gray-700",children:"Transfer Mode"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Move printers between clients"})]})]}),e.jsx(H,{id:"transferMode",checked:N,onCheckedChange:T})]}),N&&y&&(B==null?void 0:B.role)!=="client"&&e.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-white rounded-lg border border-purple-200",children:[e.jsx(Qe,{id:"otherClients",checked:M,onCheckedChange:i=>O(i===!0)}),e.jsx(P,{htmlFor:"otherClients",className:"text-sm font-semibold text-gray-700",children:"Show printers from other clients"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-100",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Me,{className:"h-4 w-4 mr-2 text-blue-600"}),"Search ",N?"Printers to Transfer":"Available Printers"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(ne,{type:"text",placeholder:"Search by name, model, manufacturer, serial number, or client...",value:g,onChange:i=>v(i.target.value),className:"pl-10 h-12 text-base"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center",children:[e.jsx(he,{className:"h-4 w-4 mr-2 text-gray-600"}),N?"Printers Available for Transfer":"Available Printers"]}),ge?e.jsx(ot,{}):Object.keys(X).length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsx(ee,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500 font-medium",children:["No ",N?"printers available for transfer":"available printers"," found"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search criteria"})]}):e.jsx("div",{className:"space-y-6",children:Object.entries(X).map(([i,o])=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{className:"h-4 w-4 text-gray-600"}),e.jsx("h4",{className:"font-medium text-gray-800",children:i}),e.jsx($,{variant:"outline",className:"text-xs",children:o.length})]}),e.jsx("div",{className:"space-y-3 pl-6",children:o.map(p=>e.jsx(gt,{className:"cursor-pointer border-gray-200 hover:border-gray-300 hover:bg-gray-50 hover:shadow-sm transition-all duration-200",onClick:()=>_(p),children:e.jsx(ft,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"font-bold text-base text-gray-900 mb-2 truncate",children:[p.printer.manufacturer,p.printer.series,p.printer.model||p.printer.name].filter(Boolean).join(" ")}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-16 h-16 flex-shrink-0 flex items-center justify-center bg-gray-100 rounded-xl border-2 border-gray-200 overflow-hidden",children:p.printer.image_url?e.jsx("img",{src:p.printer.image_url,alt:p.printer.name,className:"object-contain w-full h-full"}):e.jsx(ee,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[p.serial_number&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Serial: ",p.serial_number]}),p.client&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Client: ",p.client.name]}),p.department_location&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Location: ",re(p)]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[ye(p),p.usage_type&&e.jsx($,{variant:"outline",className:"text-xs",children:p.usage_type}),p.printer.color&&e.jsx($,{variant:"outline",className:"text-xs",children:p.printer.color})]}),e.jsx("div",{className:"mt-2",children:e.jsx(Re,{printerId:p.printer.id,className:""})})]})})},p.id))})]},i))})]})]}),h===2&&d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-100",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-2 text-blue-600"}),"Selected Printer"]}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-16 h-16 flex-shrink-0 flex items-center justify-center bg-gray-100 rounded-xl border-2 border-gray-200 overflow-hidden",children:d.printer.image_url?e.jsx("img",{src:d.printer.image_url,alt:d.printer.name,className:"object-contain w-full h-full"}):e.jsx(ee,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg mb-2",children:[d.printer.manufacturer,d.printer.series,d.printer.model||d.printer.name].filter(Boolean).join(" ")}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:d.serial_number&&e.jsx($,{variant:"outline",className:"text-xs",children:d.serial_number})}),N&&d.client&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Current Client:"})," ",d.client.name]}),d.department_location&&e.jsxs("p",{children:[e.jsx("strong",{children:"Current Location:"})," ",re(d)]})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 p-4 rounded-xl border border-orange-100",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(he,{className:"h-4 w-4 mr-2 text-orange-600"}),"Compatible Products"]}),e.jsx(Re,{printerId:d.printer.id,className:""})]}),e.jsxs("form",{onSubmit:pe,className:"space-y-6",children:[!r&&e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-xl border border-green-100",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2 text-green-600"}),"Client Selection"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"clientId",className:"text-sm font-semibold text-red-600",children:"Client *"}),e.jsxs(ie,{value:c.clientId,onValueChange:i=>A(o=>({...o,clientId:i,departmentLocationId:""})),children:[e.jsx(le,{className:"w-full h-12 text-left",children:e.jsx(oe,{placeholder:"Select a client"})}),e.jsx(ce,{children:K.map(i=>e.jsx(q,{value:i.id,children:i.name},i.id))})]})]})]}),c.clientId&&e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 p-4 rounded-xl border border-indigo-100",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ze,{className:"h-4 w-4 mr-2 text-indigo-600"}),"Assignment Type"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-indigo-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(he,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"assignToPool",className:"text-sm font-semibold text-gray-700",children:"Assign to Client Pool"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Add printer to client's undeployed pool for later assignment"})]})]}),e.jsx(H,{id:"assignToPool",checked:c.assignToPool,onCheckedChange:i=>A(o=>({...o,assignToPool:i,departmentLocationId:i?"":o.departmentLocationId})),disabled:I})]}),c.assignToPool&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(vt,{className:"h-4 w-4 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium",children:"Pool Assignment"}),e.jsx("p",{children:`This printer will be marked as "UnDeployed" and added to the client's printer pool. It can be assigned to specific departments and locations later.`})]})]})})]})]}),c.clientId&&!c.assignToPool&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 p-4 rounded-xl border border-purple-100",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(ze,{className:"h-4 w-4 mr-2 text-purple-600"}),"Department & Location"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"departmentLocationId",className:"text-sm font-semibold text-red-600",children:"Department / Location *"}),m?e.jsx("div",{className:"animate-pulse h-12 bg-gray-200 rounded-lg w-full"}):e.jsxs(ie,{value:c.departmentLocationId,onValueChange:i=>A(o=>({...o,departmentLocationId:i})),children:[e.jsx(le,{className:"w-full h-12 text-left",children:e.jsx(oe,{placeholder:"Select a department and location"})}),e.jsx(ce,{children:z.map(i=>e.jsx(q,{value:i.id,children:i.name},i.id))})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-amber-50 p-4 rounded-xl border border-yellow-100",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2 text-yellow-600"}),"Assignment Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"deploymentDate",className:"text-sm font-semibold text-red-600 flex items-center",children:[e.jsx(ut,{className:"h-4 w-4 mr-2"}),c.assignToPool?"Assignment Date *":"Deployment Date *"]}),e.jsx("input",{type:"date",id:"deploymentDate",value:c.deploymentDate,onChange:i=>A(o=>({...o,deploymentDate:i.target.value})),required:!0,disabled:I,className:"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 disabled:bg-gray-100 text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"usageType",className:"text-sm font-semibold text-gray-700",children:"Usage Type"}),e.jsxs(ie,{value:c.usageType,onValueChange:i=>A(o=>({...o,usageType:i})),disabled:I,children:[e.jsx(le,{className:"w-full h-12 text-left",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(q,{value:"service_unit",children:"Service Unit"}),e.jsx(q,{value:"client_owned",children:"Client Owned"}),e.jsx(q,{value:"rental",children:"Rental"})]})]})]}),c.usageType==="rental"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(P,{htmlFor:"monthlyPrice",className:"text-sm font-semibold text-gray-700 flex items-center",children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"Monthly Rental Price"]}),e.jsx("input",{type:"number",id:"monthlyPrice",value:c.monthlyPrice,onChange:i=>A(o=>({...o,monthlyPrice:i.target.value})),disabled:I,min:"0",step:"0.01",className:"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 disabled:bg-gray-100 text-base",placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-yellow-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(wt,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"hasSecurityDeposit",className:"text-sm font-semibold text-gray-700",children:"Security Deposit"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Does this assignment require a security deposit?"})]})]}),e.jsx(H,{id:"hasSecurityDeposit",checked:c.hasSecurityDeposit,onCheckedChange:i=>A(o=>({...o,hasSecurityDeposit:i})),disabled:I})]}),c.hasSecurityDeposit&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"securityDepositAmount",className:"text-sm font-semibold text-gray-700",children:"Security Deposit Amount"}),e.jsx("input",{type:"number",id:"securityDepositAmount",value:c.securityDepositAmount,onChange:i=>A(o=>({...o,securityDepositAmount:i.target.value})),disabled:I,min:"0",step:"0.01",className:"w-full h-12 px-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 disabled:bg-gray-100 text-base",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"notes",className:"text-sm font-semibold text-gray-700",children:"Notes (Optional)"}),e.jsx(pt,{id:"notes",value:c.notes,onChange:i=>A(o=>({...o,notes:i.target.value})),disabled:I,placeholder:"Additional notes about this assignment...",className:"w-full min-h-[100px] resize-none text-base",rows:4})]})]})]})]})]})]})}),e.jsx("div",{className:"sticky bottom-0 z-10 bg-white border-t border-gray-200 sm:rounded-b-2xl",children:e.jsx("div",{className:"p-4 sm:p-6",children:e.jsx("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3",children:h===1?e.jsx(F,{variant:"outline",onClick:se,className:"w-full sm:w-auto h-12 text-base font-medium",children:"Cancel"}):e.jsxs(e.Fragment,{children:[e.jsxs(F,{type:"button",variant:"outline",onClick:fe,className:"w-full sm:w-auto h-12 text-base font-medium",children:[e.jsx(ct,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx(F,{onClick:pe,disabled:I||!c.clientId||!c.deploymentDate||!c.assignToPool&&!c.departmentLocationId,className:"w-full sm:w-auto h-12 text-base font-medium bg-blue-600 hover:bg-blue-700 text-white",children:I?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),N?"Transferring...":"Assigning..."]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),c.assignToPool?"Add to Pool":N?"Transfer Printer":"Assign Printer"]})})]})})})})]})}):null},as=({onAssignPrinter:t,onAddPrinter:s,onAddToInventory:a,onAddCompanyPrinter:r})=>{const[f,y]=x.useState(!1),[b,j]=x.useState(!1),{clientId:h}=dt(),d=Ke().pathname.startsWith("/clients/"),l=()=>{y(!1),j(!0)},g=()=>{y(!1),s()},v=()=>{y(!1),a()},K=()=>{y(!1),r==null||r()};return e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx(jt,{children:f&&e.jsx(_t.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},transition:{duration:.2,ease:"easeOut"},className:"absolute bottom-full right-0 mb-2 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-3 sm:p-4 w-72 sm:w-80 max-w-[90vw]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Add Options"}),e.jsx("button",{onClick:()=>y(!1),className:"p-1.5 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close menu",children:e.jsx(xe,{className:"h-4 w-4 text-gray-500"})})]}),e.jsxs("div",{className:"space-y-2",children:[d&&h&&r&&e.jsxs("button",{onClick:K,className:"w-full flex items-center gap-2 sm:gap-3 p-2.5 sm:p-3 rounded-xl bg-purple-50 hover:bg-purple-100 border border-purple-200 transition-colors text-left",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(yt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-purple-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm sm:text-base",children:"Add Printer"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:"Add and assign printer to this company"})]})]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center gap-2 sm:gap-3 p-2.5 sm:p-3 rounded-xl bg-orange-50 hover:bg-orange-100 border border-orange-200 transition-colors text-left",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(mt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-orange-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm sm:text-base",children:"Assign Printer"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:"Assign an existing printer to a client"})]})]}),!d&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:g,className:"w-full flex items-center gap-2 sm:gap-3 p-2.5 sm:p-3 rounded-xl bg-blue-50 hover:bg-blue-100 border border-blue-200 transition-colors text-left",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ee,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm sm:text-base",children:"Add New Printer"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:"Add a new printer model to the catalog"})]})]}),e.jsxs("button",{onClick:v,className:"w-full flex items-center gap-2 sm:gap-3 p-2.5 sm:p-3 rounded-xl bg-green-50 hover:bg-green-100 border border-green-200 transition-colors text-left",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(he,{className:"h-4 w-4 sm:h-5 sm:w-5 text-green-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm sm:text-base",children:"Add to Inventory"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:"Add a physical printer unit to inventory"})]})]})]})]})]})})}),b&&e.jsx(Mt,{isOpen:b,onClose:()=>j(!1),onAssigned:()=>j(!1),preSelectedClientId:d?h:void 0})]})};export{Xt as A,ze as B,ss as E,H as S,es as a,ts as b,rs as c,Jt as d,It as e,as as f,Mt as g,wt as h,Et as v};
//# sourceMappingURL=AddButtonNavigation-BUuDQXbT.js.map
